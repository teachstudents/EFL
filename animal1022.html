<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Animal Learning Game - Practice Pages</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'Comic Neue', cursive, sans-serif; 
      background-color: #f3f4f6;
      overflow: hidden; /* Prevent scrolling on the body */
    }
    .screen { 
      display: none; 
      height: calc(100vh - 72px); /* Full viewport height minus new header height */
      overflow-y: hidden; /* Force no scrolling */
    }
    .screen.active { 
      display: flex; 
      flex-direction: column;
    }
    .screen-title {
      font-size: 2rem;
      font-weight: 700;
      text-align: center;
      color: #312e81;
      padding: 0.5rem 0; /* Reduced padding */
    }
    .practice-card {
      background-color: white;
      border-radius: 1rem;
      padding: 0.5rem; /* Tighter card padding */
      margin: 0.25rem 0.5rem; /* Tighter card margin */
      box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
      flex-grow: 1;
      display: flex;
      flex-direction: column;
      justify-content: center; /* Center content vertically */
    }
    .qa-list {
      list-style-position: inside;
      list-style-type: decimal;
    }
    .qa-list li {
      background-color: #f4f4f5;
      padding: 0.25rem 0.5rem; /* Tighter item padding */
      border-radius: 0.5rem;
      margin-bottom: 0.25rem; /* Tighter item margin */
      cursor: pointer;
      transition: background-color 0.2s, transform 0.2s;
      font-size: 2.1rem; /* Much larger font */
      line-height: 1.1; /* Tighter line height */
    }
    .qa-list li:hover {
      background-color: #e0e7ff;
      transform: translateX(5px);
    }
    
    /* Titles on practice card */
    .practice-card-title {
        font-size: 1.125rem; /* text-lg */
        margin-bottom: 0.25rem; /* mb-1 */
    }
    /* Emoji on practice card */
    .practice-emoji-container {
        font-size: 3rem; /* text-5xl */
        line-height: 1;
    }
    /* Name on practice card */
    .practice-name-container {
        font-size: 1.25rem; /* text-xl */
    }

    #confetti-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1000;
    }
    .flying-token {
      position: fixed;
      width: 40px;
      height: 40px;
      background: radial-gradient(circle, #fde047, #f59e0b);
      color: #78350f;
      font-weight: 800;
      border-radius: 50%;
      border: 3px solid white;
      box-shadow: 0 0 15px #f59e0b;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1001;
      transition: transform 1s cubic-bezier(0.5, -0.5, 0.5, 1.5), opacity 1s linear;
      font-size: 1.1rem;
    }
    .praise-word {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 3rem;
        font-weight: 800;
        color: var(--color, #f43f5e);
        text-shadow: 2px 2px 0 white, -2px -2px 0 white, 2px -2px 0 white, -2px 2px 0 white;
        z-index: 1002;
        animation: pop-and-fade 1.5s ease-out forwards;
    }
    @keyframes pop-and-fade {
        0% { transform: translate(-50%, -50%) scale(0.5); opacity: 0; }
        20% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
        40% { transform: translate(-50%, -50%) scale(1); }
        100% { transform: translate(-50%, -100%) scale(1); opacity: 0; }
    }
    
    /* --- ANIMATIONS --- */
    .emoji-move {
      display: inline-block;
      animation: floaty 2s ease-in-out infinite;
    }
    @keyframes floaty {
      0%   { transform: translateY(0); }
      50%  { transform: translateY(-6px); }
      100% { transform: translateY(0); }
    }
    .emoji-move:hover {
      animation: wiggle 0.4s ease-in-out;
    }
    @keyframes wiggle {
      0% { transform: rotate(0deg); }
      25% { transform: rotate(-10deg); }
      50% { transform: rotate(10deg); }
      75% { transform: rotate(-10deg); }
      100% { transform: rotate(0deg); }
    }
    /* --- END ANIMATIONS --- */

  </style>
</head>
<body class="antialiased">
  <canvas id="confetti-canvas"></canvas>

  <!-- HEADER -->
  <header class="flex justify-between items-center bg-indigo-600 text-white p-3 sticky top-0 z-50 shadow-lg h-[72px]">
    <div class="flex gap-1.5">
      <button id="backBtn" class="bg-indigo-700 hover:bg-indigo-800 transition-colors px-3 py-1.5 rounded-md font-bold text-sm">Back</button>
      <button id="homeBtn" class="bg-indigo-700 hover:bg-indigo-800 transition-colors px-3 py-1.5 rounded-md font-bold text-sm">Home</button>
      <button id="nextBtn" class="bg-indigo-700 hover:bg-indigo-800 transition-colors px-3 py-1.5 rounded-md font-bold text-sm">Next</button>
    </div>
    <div class="flex items-center gap-3">
      <div class="text-lg font-bold">Score: <span id="scoreDisplay">0</span></div>
      <button id="badgesBtn" class="bg-teal-500 hover:bg-teal-600 transition-colors px-3 py-1.5 rounded-md font-bold text-sm">Badges: <span id="badgeCount">0</span></button>
      <button id="addPointsBtn" class="bg-amber-500 hover:bg-amber-600 transition-colors px-3 py-1.5 rounded-md font-bold text-sm">+1 Point</button>
    </div>
  </header>

  <!-- SCREENS -->
  <main>
    <!-- Screen 1: Animal Selection Grid -->
    <div id="screen1" class="screen active p-4">
      <h1 class="screen-title">Select an Animal to Practice</h1>
      <div id="animal-grid" class="grid grid-cols-5 sm:grid-cols-8 md:grid-cols-10 gap-4">
        <!-- JS will populate this with animal buttons -->
      </div>
    </div>

    <!-- Screen 2: Dynamic Practice Page -->
    <div id="screen2" class="screen">
      <!-- Content is dynamically generated by JS -->
    </div>
  </main>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- DATA: 40 Animals with 4 Standardized Q&As ---
      const animalData = {
        dog: { emoji: "🐶", plural: { text: "dogs", emoji: "🐶🐶" }, habitat: "a home or on a farm", questions: ["What sound does a dog make?", "Where does a dog live?", "What is a baby dog called?", "What do dogs like to eat?"], answers: ["A dog barks.", "A dog lives in a home or on a farm.", "A baby dog is a puppy.", "Dogs are omnivores and eat meat and plants."] },
        cat: { emoji: "🐱", plural: { text: "cats", emoji: "🐱🐱" }, habitat: "a house", questions: ["What sound does a happy cat make?", "Where does a cat usually live?", "What is a baby cat called?", "What is a fun fact about cats?"], answers: ["A happy cat purrs.", "A cat usually lives in a house.", "A baby cat is a kitten.", "Cats are nocturnal and are most active at night."] },
        mouse: { emoji: "🐭", plural: { text: "mice", emoji: "🐭🐭" }, habitat: "a field or house", questions: ["What sound does a mouse make?", "Where does a mouse live?", "What is a baby mouse called?", "What does a mouse eat?"], answers: ["A mouse squeaks.", "A mouse lives in a field or a house.", "A baby mouse is a pup or pinky.", "A mouse eats cheese and seeds."] },
        rabbit: { emoji: "🐰", plural: { text: "rabbits", emoji: "🐰🐰" }, habitat: "a field or forest", questions: ["What sound does a rabbit make?", "Where does a rabbit live?", "What is a baby rabbit called?", "What does a rabbit eat?"], answers: ["A rabbit is quiet but can thump its foot.", "A rabbit lives in a field or forest in a burrow.", "A baby rabbit is a kit.", "A rabbit eats plants and vegetables like carrots."] },
        fox: { emoji: "🦊", plural: { text: "foxes", emoji: "🦊🦊" }, habitat: "the forest", questions: ["What sound does a fox make?", "Where does a fox live?", "What is a baby fox called?", "What is a fun fact about foxes?"], answers: ["A fox makes a yipping or screaming sound.", "A fox lives in the forest.", "A baby fox is a cub or a kit.", "Foxes are known for being clever hunters."] },
        bear: { emoji: "🐻", plural: { text: "bears", emoji: "🐻🐻" }, habitat: "the forest", questions: ["What sound does a bear make?", "Where does a bear live?", "What is a baby bear called?", "What do bears do in winter?"], answers: ["A bear growls.", "A bear lives in the forest.", "A baby bear is a cub.", "Bears hibernate in the winter."] },
        panda: { emoji: "🐼", plural: { text: "pandas", emoji: "🐼🐼" }, habitat: "bamboo forests in China", questions: ["What sound does a panda make?", "Where does a panda live?", "What is a baby panda called?", "What does a panda eat?"], answers: ["A panda bleats, which sounds like a goat.", "A panda lives in bamboo forests in China.", "A baby panda is a cub.", "A panda almost only eats bamboo."] },
        lion: { emoji: "🦁", plural: { text: "lions", emoji: "🦁🦁" }, habitat: "the grasslands of Africa", questions: ["What sound does a lion make?", "Where does a lion live?", "What is a baby lion called?", "What is a group of lions called?"], answers: ["A lion roars.", "A lion lives on the grasslands of Africa.", "A baby lion is a cub.", "A group of lions is called a pride."] },
        tiger: { emoji: "🐯", plural: { text: "tigers", emoji: "🐯🐯" }, habitat: "the jungle", questions: ["What sound does a tiger make?", "Where does a tiger live?", "What is a baby tiger called?", "What is a fun fact about tigers?"], answers: ["A tiger roars and chuffs.", "A tiger lives in thejungle.", "A baby tiger is a cub.", "Every tiger has a unique pattern of stripes."] },
        cow: { emoji: "🐮", plural: { text: "cows", emoji: "🐮🐮" }, habitat: "a farm", questions: ["What sound does a cow make?", "Where does a cow live?", "What is a baby cow called?", "What does a cow eat?"], answers: ["A cow moos.", "A cow lives on a farm.", "A baby cow is a calf.", "A cow eats grass."] },
        pig: { emoji: "🐷", plural: { text: "pigs", emoji: "🐷🐷" }, habitat: "a farm", questions: ["What sound does a pig make?", "Where does a pig live?", "What is a baby pig called?", "What is a fun fact about pigs?"], answers: ["A pig oinks.", "A pig lives on a farm.", "A baby pig is a piglet.", "Pigs are very intelligent animals."] },
        monkey: { emoji: "🐵", plural: { text: "monkeys", emoji: "🐵🐵" }, habitat: "the jungle", questions: ["What sound does a monkey make?", "Where does a monkey live?", "What is a baby monkey called?", "What do monkeys use their tails for?"], answers: ["A monkey chatters.", "A monkey lives in the jungle.", "A baby monkey is an infant.", "Monkeys use their tails for balance."] },
        kangaroo: { emoji: "🦘", plural: { text: "kangaroos", emoji: "🦘🦘" }, habitat: "Australia", questions: ["What sound does a kangaroo make?", "Where does a kangaroo live?", "What is a baby kangaroo called?", "How does a mother kangaroo carry her baby?"], answers: ["A kangaroo makes a grunting sound.", "A kangaroo lives in Australia.", "A baby kangaroo is a joey.", "A mother kangaroo carries her baby in a pouch."] },
        giraffe: { emoji: "🦒", plural: { text: "giraffes", emoji: "🦒🦒" }, habitat: "the grasslands of Africa", questions: ["What sound does a giraffe make?", "Where does a giraffe live?", "What is a baby giraffe called?", "What is a fun fact about giraffes?"], answers: ["A giraffe is mostly quiet but can hum.", "A giraffe lives on the grasslands of Africa.", "A baby giraffe is a calf.", "Giraffes are the tallest mammals on Earth."] },
        elephant: { emoji: "🐘", plural: { text: "elephants", emoji: "🐘🐘" }, habitat: "Africa and Asia", questions: ["What sound does an elephant make?", "Where does an elephant live?", "What is a baby elephant called?", "What is an elephant's nose called?"], answers: ["An elephant makes a trumpet sound.", "An elephant lives in Africa and Asia.", "A baby elephant is a calf.", "An elephant's nose is a trunk."] },
        zebra: { emoji: "🦓", plural: { text: "zebras", emoji: "🦓🦓" }, habitat: "the grasslands of Africa", questions: ["What sound does a zebra make?", "Where does a zebra live?", "What is a baby zebra called?", "What is a fun fact about zebras?"], answers: ["A zebra barks or brays.", "A zebra lives on the grasslands of Africa.", "A baby zebra is a foal.", "Every zebra has a unique pattern of stripes."] },
        penguin: { emoji: "🐧", plural: { text: "penguins", emoji: "🐧🐧" }, habitat: "Antarctica", questions: ["What sound does a penguin make?", "Where does a penguin live?", "What is a baby penguin called?", "What is a fun fact about penguins?"], answers: ["A penguin makes a squawking sound.", "A penguin lives in Antarctica.", "A baby penguin is a chick.", "Penguins cannot fly, but they are great swimmers."] },
        eagle: { emoji: "🦅", plural: { text: "eagles", emoji: "🦅🦅" }, habitat: "the mountains", questions: ["What sound does an eagle make?", "Where does an eagle live?", "What is a baby eagle called?", "What is a fun fact about eagles?"], answers: ["An eagle makes a screeching sound.", "An eagle lives in the mountains in a nest called an eyrie.", "A baby eagle is an eaglet.", "Eagles have excellent eyesight."] },
        owl: { emoji: "🦉", plural: { text: "owls", emoji: "🦉🦉" }, habitat: "the forest", questions: ["What sound does an owl make?", "Where does an owl live?", "What is a baby owl called?", "When is an owl most active?"], answers: ["An owl hoots.", "An owl lives in the forest.", "A baby owl is an owlet.", "An owl is nocturnal and is most active at night."] },
        parrot: { emoji: "🦜", plural: { text: "parrots", emoji: "🦜🦜" }, habitat: "the rainforest", questions: ["What sound does a parrot make?", "Where does a parrot live?", "What is a baby parrot called?", "What special thing can a parrot do?"], answers: ["A parrot squawks.", "A parrot lives in the rainforest.", "A baby parrot is a chick.", "A parrot can mimic sounds and words."] },
        crocodile: { emoji: "🐊", plural: { text: "crocodiles", emoji: "🐊🐊" }, habitat: "the river", questions: ["What sound does a crocodile make?", "Where does a crocodile live?", "What is a baby crocodile called?", "Is a crocodile a reptile or a mammal?"], answers: ["A crocodile hisses or growls.", "A crocodile lives in the river.", "A baby crocodile is a hatchling.", "A crocodile is a reptile."] },
        turtle: { emoji: "🐢", plural: { text: "turtles", emoji: "🐢🐢" }, habitat: "the ocean or a pond", questions: ["What sound does a turtle make?", "Where does a turtle live?", "What is a baby turtle called?", "What does a turtle have for protection?"], answers: ["A turtle is mostly quiet but can hiss.", "A turtle lives in the ocean or a pond.", "A baby turtle is a hatchling.", "A turtle has a hard protective shell."] },
        snake: { emoji: "🐍", plural: { text: "snakes", emoji: "🐍🐍" }, habitat: "the forest or desert", questions: ["What sound does a snake make?", "Where does a snake live?", "What is a baby snake called?", "What is a fun fact about snakes?"], answers: ["A snake hisses.", "A snake lives in the forest or desert.", "A baby snake is a snakelet.", "Snakes shed their skin as they grow."] },
        shark: { emoji: "🦈", plural: { text: "sharks", emoji: "🦈🦈" }, habitat: "the ocean", questions: ["Are sharks noisy or quiet?", "Where does a shark live?", "What is a baby shark called?", "What is a shark's skeleton made of?"], answers: ["Sharks are silent hunters.", "A shark lives in the ocean.", "A baby shark is a pup.", "A shark's skeleton is made of cartilage, not bone."] },
        dolphin: { emoji: "🐬", plural: { text: "dolphins", emoji: "🐬🐬" }, habitat: "the ocean", questions: ["What sound does a dolphin make?", "Where does a dolphin live?", "What is a baby dolphin called?", "Are dolphins mammals or fish?"], answers: ["A dolphin communicates with clicks and whistles.", "A dolphin lives in the ocean.", "A baby dolphin is a calf.", "Dolphins are mammals."] },
        whale: { emoji: "🐳", plural: { text: "whales", emoji: "🐳🐳" }, habitat: "the ocean", questions: ["What sound does a whale make?", "Where does a whale live?", "What is a baby whale called?", "How do whales breathe?"], answers: ["A whale sings or makes clicks.", "A whale lives in the ocean.", "A baby whale is a calf.", "Whales breathe air through a blowhole."] },
        octopus: { emoji: "🐙", plural: { text: "octopuses", emoji: "🐙🐙" }, habitat: "the ocean", questions: ["Are octopuses noisy or quiet?", "Where does an octopus live?", "What can an octopus squirt?", "How many hearts does an octopus have?"], answers: ["Octopuses are silent.", "An octopus lives in the ocean.", "An octopus can squirt ink to defend itself.", "An octopus has three hearts."] },
        crab: { emoji: "🦀", plural: { text: "crabs", emoji: "🦀🦀" }, habitat: "the beach and ocean", questions: ["What sound does a crab make?", "Where does a crab live?", "What is a baby crab called?", "How does a crab walk?"], answers: ["A crab makes quiet clicking sounds.", "A crab lives on the beach and in the ocean.", "A baby crab is a zoea.", "A crab walks sideways."] },
        hamster: { emoji: "🐹", plural: { text: "hamsters", emoji: "🐹🐹" }, habitat: "a cage in a home", questions: ["What sound does a hamster make?", "Where does a pet hamster live?", "What is a baby hamster called?", "What does a hamster store in its cheeks?"], answers: ["A hamster squeaks.", "A pet hamster lives in a cage.", "A baby hamster is a pup.", "A hamster stores food in its cheeks."] },
        koala: { emoji: "🐨", plural: { text: "koalas", emoji: "🐨🐨" }, habitat: "Australia", questions: ["What sound does a koala make?", "Where does a koala live?", "What is a baby koala called?", "What does a koala eat?"], answers: ["A koala makes a loud grunting or bellowing sound.", "A koala lives in Australia.", "A baby koala is a joey.", "A koala eats eucalyptus leaves."] },
        gorilla: { emoji: "🦍", plural: { text: "gorillas", emoji: "🦍🦍" }, habitat: "the jungle", questions: ["What sound does a gorilla make?", "Where does a gorilla live?", "What is a baby gorilla called?", "What does a gorilla eat?"], answers: ["A gorilla grunts or roars.", "A gorilla lives in the jungle.", "A baby gorilla is an infant.", "A gorilla eats plants."] },
        camel: { emoji: "🐪", plural: { text: "camels", emoji: "🐪🐪" }, habitat: "the desert", questions: ["What sound does a camel make?", "Where does a camel live?", "What is a baby camel called?", "What does a camel store in its hump?"], answers: ["A camel makes a grunting sound.", "A camel lives in the desert.", "A baby camel is a calf.", "A camel stores fat in its hump for energy."] },
        chicken: { emoji: "🐔", plural: { text: "chickens", emoji: "🐔🐔" }, habitat: "a farm", questions: ["What sound does a chicken make?", "Where does a chicken live?", "What is a baby chicken called?", "What can a chicken lay?"], answers: ["A chicken clucks.", "A chicken lives on a farm.", "A baby chicken is a chick.", "A chicken can lay eggs."] },
        duck: { emoji: "🦆", plural: { text: "ducks", emoji: "🦆🦆" }, habitat: "a pond or river", questions: ["What sound does a duck make?", "Where does a duck live?", "What is a baby duck called?", "What is a fun fact about a duck's feathers?"], answers: ["A duck quacks.", "A duck lives near a pond or river.", "A baby duck is a duckling.", "A duck's feathers are waterproof."] },
        flamingo: { emoji: "🦩", plural: { text: "flamingos", emoji: "🦩🦩" }, habitat: "lakes and lagoons", questions: ["What sound does a flamingo make?", "Where does a flamingo live?", "What is a baby flamingo called?", "Why are flamingos pink?"], answers: ["A flamingo makes a honking sound.", "A flamingo lives near lakes and lagoons.", "A baby flamingo is a chick.", "They are pink because of the food they eat."] },
        swan: { emoji: "🦢", plural: { text: "swans", emoji: "🦢🦢" }, habitat:"a lake or pond", questions: ["What sound does a swan make?", "Where does a swan live?", "What is a baby swan called?", "What is special about a swan's neck?"], answers: ["A swan hisses or makes a trumpet-like sound.", "A swan lives on a lake or pond.", "A baby swan is a cygnet.", "A swan has a long, graceful neck."] },
        bird: { emoji: "🐦", plural: { text: "birds", emoji: "🐦🐦" }, habitat: "trees", questions: ["What sound does a bird make?", "Where does a bird live?", "What is a baby bird called?", "What do most birds eat?"], answers: ["A bird chirps or sings.", "A bird lives in a nest in trees.", "A baby bird is a chick.", "Most birds eat seeds or insects."] },
        chick: { emoji: "🐤", plural: { text: "chicks", emoji: "🐤🐤" }, habitat: "a farm", questions: ["What sound does a chick make?", "Where does a chick live?", "What is a baby chicken called?", "What does a chick grow into?"], answers: ["A chick peeps.", "A chick lives on a farm.", "A baby chicken is called a chick.", "A chick grows into a chicken."] },
        lizard: { emoji: "🦎", plural: { text: "lizards", emoji: "🦎🦎" }, habitat: "the desert or forest", questions: ["What sound does a lizard make?", "Where does a lizard live?", "What is a baby lizard called?", "What kind of skin does a lizard have?"], answers: ["A lizard is mostly quiet but can hiss.", "A lizard lives in the desert or forest.", "A baby lizard is a hatchling.", "A lizard has scaly skin."] },
        fish: { emoji: "🐟", plural: { text: "fish", emoji: "🐟🐟" }, habitat: "the ocean or a river", questions: ["Are fish noisy or quiet?", "Where does a fish live?", "What is a baby fish called?", "How does a fish breathe?"], answers: ["Fish are silent.", "A fish lives in the ocean or a river.", "A baby fish is a fry.", "A fish breathes with gills."] }
      };

      const praiseWords = ["Awesome!", "Great Job!", "Super!", "Excellent!", "Well Done!", "Amazing!"];
      const praiseColors = ["#f43f5e", "#f59e0b", "#10b981", "#0ea5e9", "#8b5cf6"];

      // --- STATE ---
      let currentScreen = 1;
      let score = 0;
      let badges = new Set();
      const animalsList = Object.keys(animalData);
      let currentAnimalIndex = 0;

      // --- UI ELEMENTS ---
      const screens = document.querySelectorAll('.screen');
      const scoreDisplay = document.getElementById('scoreDisplay');
      const badgeCountDisplay = document.getElementById('badgeCount');
      const addPointsBtn = document.getElementById('addPointsBtn');
      const animalGrid = document.getElementById('animal-grid');
      const practiceScreen = document.getElementById('screen2');

      // --- AUDIO & TTS ---
      let synth, maleVoice, femaleVoice;
      async function initAudio() {
        await Tone.start();
        synth = new Tone.PolySynth(Tone.Synth, {
          oscillator: { type: "sine" },
          envelope: { attack: 0.01, decay: 0.1, sustain: 0.2, release: 0.2 }
        }).toDestination();
        populateVoiceList();
      }
      
      function populateVoiceList() {
          if (typeof speechSynthesis === 'undefined') return;
          let voices = speechSynthesis.getVoices();
          if (voices.length === 0) {
              speechSynthesis.onvoiceschanged = () => {
                  voices = speechSynthesis.getVoices();
                  findVoices(voices);
              };
          } else {
              findVoices(voices);
          }
      }

      function findVoices(voices) {
        const maleVoiceNames = ['Brian', 'Andrew'];
        maleVoice = voices.find(voice => maleVoiceNames.some(name => voice.name.includes(name) && voice.lang.startsWith('en')));
        
        // Prioritize Emma, then Ava
        femaleVoice = voices.find(voice => voice.name.includes('Emma') && voice.lang.startsWith('en'));
        if (!femaleVoice) {
            femaleVoice = voices.find(voice => voice.name.includes('Ava') && voice.lang.startsWith('en'));
        }
      }

      document.body.addEventListener('click', initAudio, { once: true });
      
      function playSound(type) {
        if (!synth) return;
        const now = Tone.now();
        if (type === 'reward') synth.triggerAttackRelease(["C5", "E5", "G5"], "8n", now);
      }
      
      window.speak = function(text, type, element) {
        if ('speechSynthesis' in window) {
          speechSynthesis.cancel();
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.lang = 'en-US';
          utterance.rate = 0.85; // Slowed down for clarity
          
          if (type === 'question' && maleVoice) {
            utterance.voice = maleVoice;
          } else if (type === 'answer' && femaleVoice) {
            utterance.voice = femaleVoice;
          }

          speechSynthesis.speak(utterance);

          // Add bold effect and set timer to remove it
          if (element) {
            // Remove bold from all other items in the same list
            const listItems = element.parentElement.querySelectorAll('li');
            listItems.forEach(li => li.classList.remove('font-bold'));
            
            element.classList.add('font-bold');
            setTimeout(() => {
              element.classList.remove('font-bold');
            }, 15000); // 15 seconds
          }
        }
      };

      // --- FUNCTIONS ---
      function showScreen(screenNumber) {
        currentScreen = screenNumber;
        screens.forEach(s => s.classList.remove('active'));
        document.getElementById(`screen${screenNumber}`).classList.add('active');
        updateNavButtons();
      }

      function addPoints(num) {
        score += num;
        scoreDisplay.textContent = score;
      }

      function awardBadge(animalName) {
          if(!badges.has(animalName)) {
              badges.add(animalName);
              badgeCountDisplay.textContent = badges.size;
          }
      }

      function updateNavButtons() {
        document.getElementById('backBtn').style.opacity = currentScreen === 1 && currentAnimalIndex === 0 ? '0.5' : '1';
        document.getElementById('nextBtn').style.opacity = currentScreen === 2 && currentAnimalIndex === animalsList.length - 1 ? '0.5' : '1';
      }

      function createPracticePage(animalName) {
        const data = animalData[animalName];
        if (!data) return;

        currentAnimalIndex = animalsList.indexOf(animalName);
        
        practiceScreen.innerHTML = `
          <div class="flex flex-col h-full p-2">
            
            <!-- Top section: Q&A and Emoji -->
            <div class="grid grid-cols-12 gap-2 flex-grow min-h-0">
              
              <!-- Questions -->
              <div class="practice-card col-span-5">
                <h2 class="text-lg font-bold mb-1 text-rose-600 text-center practice-card-title">Questions</h2>
                <ol class="qa-list">
                  ${data.questions.map(q => `<li onclick="speak('${q.replace(/'/g, "\\'")}', 'question', this)">${q}</li>`).join('')}
                </ol>
              </div>
              
              <!-- Emoji -->
              <div class="flex flex-col items-center justify-center col-span-2">
                <div class="text-5xl emoji-move practice-emoji-container">${data.emoji}</div>
                <h1 class="text-xl font-bold mt-1 text-indigo-800 practice-name-container">${animalName}</h1>
              </div>

              <!-- Answers -->
              <div class="practice-card col-span-5">
                <h2 class="text-lg font-bold mb-1 text-green-600 text-center practice-card-title">Answers</h2>
                <ol class="qa-list">
                  ${data.answers.map(a => `<li onclick="speak('${a.replace(/'/g, "\\'")}', 'answer', this)">${a}</li>`).join('')}
                </ol>
              </div>
            </div>

            <!-- Bottom section: Spacer -->
            <div class="flex-shrink-0 h-1/4">
               <!-- This area is intentionally blank -->
            </div>

          </div>
        `;
        showScreen(2);
        awardBadge(animalName);
        addPoints(5);
      }
      
      function triggerRewardEffects() {
          addPoints(1);
          playSound('reward');
          showFlyingToken();
          showPraiseWord();
          startConfetti();
      }

      function showFlyingToken() {
          const token = document.createElement('div');
          token.className = 'flying-token';
          token.textContent = '+1';
          document.body.appendChild(token);
          
          const startRect = addPointsBtn.getBoundingClientRect();
          const endRect = scoreDisplay.getBoundingClientRect();

          token.style.left = `${startRect.left + startRect.width / 2 - 20}px`;
          token.style.top = `${startRect.top + startRect.height / 2 - 20}px`;

          requestAnimationFrame(() => {
              token.style.transform = `translate(${endRect.left - startRect.left}px, ${endRect.top - startRect.top}px) scale(0.5)`;
              token.style.opacity = '0';
          });
          token.addEventListener('transitionend', () => token.remove());
      }
      
      function showPraiseWord() {
          const word = document.createElement('div');
          word.className = 'praise-word';
          word.textContent = praiseWords[Math.floor(Math.random() * praiseWords.length)];
          word.style.setProperty('--color', praiseColors[Math.floor(Math.random()* praiseColors.length)]);
          document.body.appendChild(word);
          setTimeout(() => word.remove(), 1500);
      }

      // --- INITIALIZATION ---
      animalsList.forEach(animalName => {
        const data = animalData[animalName];
        const btn = document.createElement('button');
        btn.className = "bg-white rounded-lg shadow p-2 text-center transition-transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-indigo-500";
        btn.innerHTML = `
          <div class="text-4xl emoji-move">${data.emoji}</div>
          <div class="font-bold text-sm">${animalName}</div>
        `;
        btn.onclick = () => createPracticePage(animalName);
        animalGrid.appendChild(btn);
      });

      // --- EVENT LISTENERS ---
      document.getElementById('homeBtn').onclick = () => {
          practiceScreen.innerHTML = '';
          showScreen(1)
      };
      document.getElementById('nextBtn').onclick = () => {
        if (currentScreen === 2 && currentAnimalIndex < animalsList.length - 1) {
          createPracticePage(animalsList[currentAnimalIndex + 1]);
        }
      };
      document.getElementById('backBtn').onclick = () => {
        if (currentScreen === 2 && currentAnimalIndex > 0) {
          createPracticePage(animalsList[currentAnimalIndex - 1]);
        } else {
          showScreen(1);
        }
      };
      addPointsBtn.onclick = triggerRewardEffects;
      
      // --- CONFETTI ---
      const confettiCanvas = document.getElementById('confetti-canvas');
      const ctx = confettiCanvas.getContext('2d');
      let particles = [];
      function startConfetti() {
          confettiCanvas.width = window.innerWidth;
          confettiCanvas.height = window.innerHeight;
          particles = [];
          const particleCount = 100;
          const colors = ["#f43f5e", "#f59e0b", "#10b981", "#0ea5e9", "#8b5cf6"];
          for (let i = 0; i < particleCount; i++) {
              particles.push(new Particle(colors[i % colors.length]));
          }
          animateConfetti();
      }

      function Particle(color) {
          this.x = Math.random() * confettiCanvas.width;
          this.y = Math.random() * confettiCanvas.height - confettiCanvas.height;
          this.size = Math.random() * 5 + 5;
          this.color = color;
          this.speed = Math.random() * 2 + 1;
          this.gravity = 0.5;
          this.spin = Math.random() - 0.5;
          this.angle = 0;
      }

      function animateConfetti() {
          ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
          particles.forEach((p, i) => {
              p.y += p.speed;
              p.speed += p.gravity;
              p.angle += p.spin;
              p.x += Math.sin(p.angle);
              
              ctx.save();
              ctx.translate(p.x, p.Y);
              ctx.rotate(p.angle);
              ctx.fillStyle = p.color;
              ctx.fillRect(-p.size / 2, -p.size / 2, p.size, p.size);
              ctx.restore();

              if (p.y > confettiCanvas.height) {
                  particles.splice(i, 1);
              }
          });
          if (particles.length > 0) {
              requestAnimationFrame(animateConfetti);
          } else {
              ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
          }
      }

      updateNavButtons(); // Initial call
    });
  </script>
</body>
</html>
