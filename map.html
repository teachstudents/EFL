<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>City Map Speaking Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation;
            background-color: #f4f4f5; /* bg-zinc-100 */
        }
        .emoji {
            font-size: 2.25rem;
            line-height: 1;
        }
        .street-name {
            position: relative;
            z-index: 5;
            background-color: rgba(160, 174, 192, 0.7);
            padding: 2px 6px;
            border-radius: 4px;
            color: #2d3748;
            text-shadow: 1px 1px 2px white;
            font-weight: bold;
            font-size: 1.1rem;
        }
        .road {
            background-color: #a0aec0;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
        }
        .road.horizontal {
            width: 100%; height: 48px; top: 50%; left: 0;
            transform: translateY(-50%);
            border-top: 2px solid #718096; border-bottom: 2px solid #718096;
        }
        .road.vertical {
            width: 48px; height: 100%; top: 0;
            border-left: 2px solid #718096; border-right: 2px solid #718096;
        }
        .road.horizontal::before {
            content: ''; position: absolute; width: 100%; height: 4px;
            background-image: linear-gradient(to right, #f7fafc 75%, transparent 25%);
            background-size: 20px 4px;
        }
        .road.vertical::before {
            content: ''; position: absolute; height: 100%; width: 4px;
            background-image: linear-gradient(to bottom, #f7fafc 75%, transparent 25%);
            background-size: 4px 20px;
        }
        .slot {
            position: absolute; width: 80px; height: 80px;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 4px; transition: all 0.3s ease;
            background: none; border: none; box-shadow: none;
        }
        .slot p {
            text-transform: lowercase; font-size: 0.9rem; font-weight: 600;
            text-align: center; line-height: 1.2; color: #1f2937;
        }
        .highlight-start {
            border: 5px solid #2563eb; border-radius: 12px;
            transform: scale(1.1); z-index: 10;
        }
        .highlight-end {
            border: 5px solid #dc2626; border-radius: 12px;
            transform: scale(1.1); z-index: 10;
        }
        #route-path {
            stroke-dasharray: 10;
            animation: dash 1s linear infinite;
        }
        @keyframes dash { to { stroke-dashoffset: -20; } }
    </style>
</head>
<body class="p-4">

    <div class="w-full max-w-6xl mx-auto flex gap-4 items-start">
        
        <!-- Left Sidebar: Useful Phrases + Buttons -->
        <div class="w-60 flex-shrink-0 bg-white p-4 rounded-lg border shadow-sm flex flex-col justify-between" style="height: 650px;">
            <div>
                <h3 class="font-bold text-gray-800 mb-3 text-lg">Useful Phrases:</h3>
                <ul class="space-y-1.5 text-sm text-gray-700 font-semibold">
                    <li class="font-bold text-purple-700 mt-2">Directions</li>
                    <li>⬆️ go straight on...</li>
                    <li>⬅️ turn left on...</li>
                    <li>➡️ turn right on...</li>
                    <li>🔄 go around the corner...</li>
                    <li class="font-bold text-purple-700 mt-3">Locations</li>
                    <li>🏠 ...is next to the...</li>
                    <li>↔️ ...is across from the...</li>
                    <li>◻️ ...is on the corner of...</li>
                    <li>⬇️ ...is behind the...</li>
                    <li>⬆️ ...is in front of the...</li>
                    <li>↔️ ...is between __ and __</li>
                    <li class="font-bold text-purple-700 mt-3">Questions</li>
                    <li>❓ is there a ___ near here?</li>
                    <li>❓ how can i get to the ___?</li>
                    <li>❓ where is the nearest ___?</li>
                    <li class="font-bold text-purple-700 mt-3">Clarifications</li>
                    <li>👉 it’s on your left.</li>
                    <li>👉 it’s on your right.</li>
                    <li>👉 it’s opposite the ___.</li>
                </ul>
            </div>
            <div class="flex flex-col space-y-2 mt-6">
                <button id="shuffle-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-3 rounded-lg text-sm shadow-md">
                    Shuffle Buildings
                </button>
                <button id="challenge-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-3 rounded-lg text-sm shadow-md">
                    New Route Challenge
                </button>
                <button id="restart-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-3 rounded-lg text-sm shadow-md">
                    Restart Session
                </button>
            </div>
        </div>

        <!-- Main Game Area -->
        <div class="flex-grow bg-white p-6 rounded-lg border shadow-sm">
            <div class="w-full bg-gray-200 rounded-full h-8 mb-4 border border-gray-300 overflow-hidden">
                <div id="progress-bar-inner" class="bg-gradient-to-r from-green-400 to-blue-500 h-full rounded-full flex items-center justify-center transition-width duration-1000 linear">
                    <span id="timer-text" class="font-bold text-white text-lg">2:00</span>
                </div>
            </div>
            <div id="challenge-text" class="text-center text-lg font-bold my-4 p-3 bg-purple-100 border-l-4 border-purple-500 text-purple-800 rounded-md transition-colors duration-300">
                Click "New Route Challenge" to start!
            </div>
            <div id="map-container" class="w-full max-w-xl mx-auto aspect-square bg-green-200 rounded-lg shadow-inner relative border-4 border-gray-300 overflow-hidden">
                <!-- Roads -->
                <div class="road horizontal"><span class="street-name"></span></div>
                <div class="road vertical" style="left: 33.33%; transform: translateX(-50%);"><span class="street-name rotate-90 whitespace-nowrap"></span></div>
                <div class="road vertical" style="left: 66.66%; transform: translateX(-50%);"><span class="street-name rotate-90 whitespace-nowrap"></span></div>

                <!-- Visual Enhancements: Trees & Bushes -->
                <div class="absolute text-2xl" style="top:25%; left:20%; z-index: 0;">🌳</div>
                <div class="absolute text-xl" style="bottom:15%; right:25%; z-index: 0;">🌲</div>
                <div class="absolute text-2xl" style="top:60%; left:80%; z-index: 0;">🌴</div>
                <div class="absolute text-xl" style="top:10%; right:45%; z-index: 0;">🌿</div>
                <div class="absolute text-2xl" style="bottom:8%; left:20%; z-index: 0;">🌳</div>

                <!-- Traffic lights -->
                <div class="absolute text-2xl z-10" style="top: 35%; left: 28%;">🚦</div>
                <div class="absolute text-2xl z-10" style="top: 35%; left: 68%;">🚦</div>
                
                <svg id="route-svg" class="absolute top-0 left-0 w-full h-full" style="pointer-events: none; z-index: 20;">
                    <path id="route-path" d="" stroke="#f59e0b" stroke-width="8" fill="none" stroke-linecap="round" stroke-linejoin="round" />
                </svg>

                <!-- 9 Building Slots locked to corners & edges -->
                <div class="slot" style="top: 5%; left: 5%;" id="slot-0"></div>
                <div class="slot" style="top: 5%; right: 5%;" id="slot-1"></div>
                <div class="slot" style="bottom: 5%; left: 5%;" id="slot-2"></div>
                <div class="slot" style="top: 5%; left: 30%;" id="slot-3"></div>
                <div class="slot" style="top: 5%; left: 65%;" id="slot-4"></div>
                <div class="slot" style="bottom: 5%; left: 30%;" id="slot-5"></div>
                <div class="slot" style="bottom: 5%; left: 65%;" id="slot-6"></div>
                <div class="slot" style="top: 40%; left: 5%;" id="slot-7"></div>
                <div class="slot" style="top: 40%; right: 5%;" id="slot-8"></div>
            </div>
        </div>
    </div>

    <script>
        const allBuildings = [
            { emoji: '🏪', name: 'Store' }, { emoji: '🏫', name: 'School' }, { emoji: '🏥', name: 'Hospital' },
            { emoji: '🏦', name: 'Bank' }, { emoji: '🏤', name: 'Post Office' }, { emoji: '🏨', name: 'Hotel' },
            { emoji: '🏛️', name: 'Museum' }, { emoji: '🏢', name: 'Office' }, { emoji: '🗽', name: 'Statue' },
            { emoji: '🏰', name: 'Castle' }, { emoji: '🏟️', name: 'Stadium' }, { emoji: '🎡', name: 'Ferris Wheel' },
            { emoji: '🏬', name: 'Mall' }, { emoji: '🚉', name: 'Station' }, { emoji: '🚏', name: 'Bus Stop' }, 
            { emoji: '🏠', name: 'House' }, { emoji: '⛪', name: 'Church' }, { emoji: '🕌', name: 'Mosque'}
        ];
        
        const streetNames = {
            "St": ["First", "Second", "Third", "Fourth", "Fifth", "Sixth", "Seventh", "Eighth", "Ninth", "Tenth"],
            "Ave": ["Maple 🌳", "Oak 🌳", "Pine 🌲", "Elm 🌳", "Cedar 🌲", "Birch 🌳", "Willow 🌿", "Cherry 🌸"],
            "Blvd": ["Washington", "Lincoln", "Jefferson", "Adams", "Franklin", "Roosevelt", "Kennedy", "King"]
        };

        const allSlots = document.querySelectorAll('.slot');
        const shuffleBtn = document.getElementById('shuffle-btn');
        const challengeBtn = document.getElementById('challenge-btn');
        const restartBtn = document.getElementById('restart-btn');
        const timerText = document.getElementById('timer-text');
        const progressBarInner = document.getElementById('progress-bar-inner');
        const challengeText = document.getElementById('challenge-text');
        const routePath = document.getElementById('route-path');
        
        let timerInterval;
        let timeLeft = 120;

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        function randomStreetName(type) {
            const names = streetNames[type];
            const name = names[Math.floor(Math.random() * names.length)];
            return `${name} ${type}.`;
        }

        function refreshStreetNames() {
            document.querySelector('.road.horizontal .street-name').textContent = randomStreetName("St");
            document.querySelectorAll('.road.vertical .street-name')[0].textContent = randomStreetName("Ave");
            document.querySelectorAll('.road.vertical .street-name')[1].textContent = randomStreetName("Blvd");
        }

        function clearHighlightsAndRoute() {
            allSlots.forEach(s => s.classList.remove('highlight-start', 'highlight-end'));
            challengeText.textContent = 'Click "New Route Challenge" to start!';
            challengeText.className = 'text-center text-lg font-bold my-4 p-3 bg-purple-100 border-l-4 border-purple-500 text-purple-800 rounded-md transition-colors duration-300';
            routePath.setAttribute('d', '');
        }

        function placeRandomBuildings() {
            clearHighlightsAndRoute();
            allSlots.forEach(s => s.innerHTML = '');
            const shuffledBuildings = shuffleArray([...allBuildings]).slice(0, allSlots.length);
            allSlots.forEach((slot, index) => {
                const building = shuffledBuildings[index];
                slot.innerHTML = `<div class="emoji">${building.emoji}</div><p>${building.name}</p>`;
                slot.dataset.buildingName = building.name;
            });
            refreshStreetNames();
        }
        
        function getSlotCenter(slotElement) {
            const rect = slotElement.getBoundingClientRect();
            const parentRect = slotElement.parentElement.getBoundingClientRect();
            return {
                x: rect.left - parentRect.left + rect.width / 2,
                y: rect.top - parentRect.top + rect.height / 2
            };
        }
        
        function drawRoute(startSlot, endSlot) {
            const startPoint = getSlotCenter(startSlot);
            const endPoint = getSlotCenter(endSlot);
            const pathData = `M ${startPoint.x} ${startPoint.y} L ${startPoint.x} ${endPoint.y} L ${endPoint.x} ${endPoint.y}`;
            routePath.setAttribute('d', pathData);
        }

        function pickFarApartBuildings(placedBuildings) {
            let bestPair = [placedBuildings[0], placedBuildings[1]];
            let maxDistance = 0;
            for (let i = 0; i < placedBuildings.length; i++) {
                for (let j = i + 1; j < placedBuildings.length; j++) {
                    const a = getSlotCenter(placedBuildings[i]);
                    const b = getSlotCenter(placedBuildings[j]);
                    const dist = Math.hypot(a.x - b.x, a.y - b.y);
                    if (dist > maxDistance) {
                        maxDistance = dist;
                        bestPair = [placedBuildings[i], placedBuildings[j]];
                    }
                }
            }
            return bestPair;
        }

        function highlightRoute() {
            clearHighlightsAndRoute();
            const placedBuildings = Array.from(allSlots).filter(s => s.dataset.buildingName);
            if (placedBuildings.length < 2) return;
            const [start, end] = pickFarApartBuildings(placedBuildings);
            start.classList.add('highlight-start');
            end.classList.add('highlight-end');
            const startName = start.dataset.buildingName.toLowerCase();
            const endName = end.dataset.buildingName.toLowerCase();
            challengeText.textContent = `go from the ${startName} to the ${endName}!`;
            challengeText.className = 'text-center text-lg font-bold my-4 p-3 bg-green-100 border-l-4 border-green-500 text-green-800 rounded-md transition-colors duration-300';
            drawRoute(start, end);
        }

        function startTimer() {
            clearInterval(timerInterval);
            timeLeft = 120;
            updateTimerDisplay();
            timerInterval = setInterval(() => {
                if (timeLeft > 0) {
                    timeLeft--;
                    updateTimerDisplay();
                } else {
                    clearInterval(timerInterval);
                    timerText.textContent = "Time's Up!";
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            timerText.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            const percentage = (timeLeft / 120) * 100;
            progressBarInner.style.width = `${percentage}%`;
        }

        function init() {
            placeRandomBuildings();
            startTimer();
        }

        shuffleBtn.addEventListener('click', placeRandomBuildings);
        challengeBtn.addEventListener('click', highlightRoute);
        restartBtn.addEventListener('click', init);
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
