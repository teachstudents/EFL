<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Listening Practice Test 8</title>
    <style>
        :root {
            --primary: #005a9e;
            --bg: #f3f2f1;
            --paper: #ffffff;
            --text: #201f1e;
            --active-tab: #004578;
        }
        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 5px;
            font-size: 14px;
            line-height: 1.3;
        }
        .container {
            max-width: 980px; 
            margin: 0 auto;
            background: var(--paper);
            padding: 15px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-height: 95vh;
        }
        
        /* Compact Header with Integrated Buttons */
        .header-controls {
            display: flex;
            gap: 5px;
            margin-bottom: 10px;
            background: #fff;
            position: sticky;
            top: 0;
            z-index: 100;
            padding-bottom: 5px;
            border-bottom: 2px solid #eee;
            align-items: center;
        }
        
        .section-btn {
            background: #e1dfdd;
            color: #333;
            border: none;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            flex: 1;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }
        .section-btn:hover { background: #d0d0d0; }
        .section-btn.active { 
            background: var(--primary); 
            color: white; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .play-icon { font-size: 0.8em; }

        /* Content Area */
        h2 { 
            color: var(--primary); 
            font-size: 1.3rem; 
            margin: 0 0 12px 0; 
            border-bottom: 1px solid #eee;
            padding-bottom: 4px;
        }
        h3 { margin: 8px 0 6px 0; font-size: 1.1rem; color: #444; }
        p { margin: 6px 0; }
        
        .test-section { display: none; animation: fadeIn 0.2s ease-in; }
        .test-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .question-block {
            margin-bottom: 10px;
            padding: 10px 14px;
            background: #faf9f8;
            border-left: 4px solid #ddd;
        }
        
        /* Large Font Styles */
        label { display: block; margin-bottom: 4px; cursor: pointer; font-size: 1.2rem; }
        
        input[type="text"], input[type="number"] {
            padding: 5px 8px;
            border: 1px solid #999;
            border-radius: 3px;
            width: 160px;
            font-size: 1.2rem;
        }
        input[type="text"]:focus { border-color: var(--primary); outline: none; }
        
        .mcq-option { padding: 4px 6px; border-radius: 3px; }
        .mcq-option:hover { background: #f0f0f0; }

        /* GRID LAYOUT FOR MCQS (Sections 2 & 3 & 4) */
        .mcq-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr); 
            gap: 12px;
            margin-bottom: 15px;
        }
        .mcq-grid .question-block {
            margin-bottom: 0;
            height: 100%; 
            box-sizing: border-box;
            font-size: 1.2rem;
        }
        .mcq-grid p { font-size: 1.2rem; font-weight: 500; }
        
        @media(max-width: 800px) {
            .mcq-grid { grid-template-columns: repeat(2, 1fr); }
        }
        @media(max-width: 500px) {
            .mcq-grid { grid-template-columns: 1fr; }
        }

        /* LARGE FONT FOR SECTIONS 1 & 4 (Notes) */
        .large-font-section .question-block {
            font-size: 1.5rem; 
            line-height: 1.5;
        }
        .large-font-section input[type="text"], 
        .large-font-section input[type="number"] {
            font-size: 1.4rem; 
            padding: 6px 10px;
            width: 220px; 
        }
        .large-font-section h3 { font-size: 1.4rem; color: #333; }

        /* Results & Transcript */
        .feedback { display: none; margin-left: 8px; font-weight: bold; font-size: 0.85em; }
        .correct { color: #107c10; }
        .incorrect { color: #a80000; }
        
        #transcript-container {
            margin-top: 15px;
            padding: 10px;
            background: #f8f8f8;
            display: none;
            border: 1px solid #ddd;
            font-size: 1rem;
            max-height: 200px;
            overflow-y: auto;
        }
        .script-line { margin-bottom: 6px; color: #555; }
        
        .action-bar {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ccc;
            display: flex;
            gap: 10px;
        }
        .check-btn {
            background: #107c10;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
        }
        .check-btn:hover { background: #0b5a0b; }
        .secondary-btn {
            background: #605e5c;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }
    </style>
</head>
<body>

<div class="container">
    
    <div class="header-controls">
        <button class="section-btn" style="flex: 0 0 auto; background: #333; color: white;" onclick="calculateFinalScore()">
            Final Score
        </button>
        <button class="section-btn active" onclick="playSection(1)">
            <span class="play-icon">▶</span> Section 1
        </button>
        <button class="section-btn" onclick="playSection(2)">
            <span class="play-icon">▶</span> Section 2
        </button>
        <button class="section-btn" onclick="playSection(3)">
            <span class="play-icon">▶</span> Section 3
        </button>
        <button class="section-btn" onclick="playSection(4)">
            <span class="play-icon">▶</span> Section 4
        </button>
        <button class="section-btn" style="flex: 0 0 auto; background: #a80000; color: white;" onclick="stopAudio()" title="Stop Audio">
            ■
        </button>
    </div>

    <form id="test-form" onsubmit="return false;">
        
        <!-- SECTION 1 (Active) -->
        <div id="sec-1" class="test-section active large-font-section">
            <h2>Section 1: Lost Property Report</h2>
            <div class="question-block">
                <h3>Caller Details</h3>
                <p>1. Surname: Mr. <input type="text" id="q1" class="ans-input" data-key="jarvis"> <span class="feedback" id="fb-q1"></span></p>
                <p>2. Flight Number: <input type="text" id="q2" class="ans-input" data-key="ba293/ba 293"> <span class="feedback" id="fb-q2"></span></p>
                <p>3. Seat Number: <input type="text" id="q3" class="ans-input" data-key="14a/14 a"> <span class="feedback" id="fb-q3"></span></p>
                <h3>Item Description</h3>
                <p>4. Item Lost: A leather <input type="text" id="q4" class="ans-input" data-key="briefcase/case"> <span class="feedback" id="fb-q4"></span></p>
                <p>5. Colour: Dark <input type="text" id="q5" class="ans-input" data-key="brown"> <span class="feedback" id="fb-q5"></span></p>
                <p>6. Distinguishing mark: A scratch near the <input type="text" id="q6" class="ans-input" data-key="handle"> <span class="feedback" id="fb-q6"></span></p>
                <h3>Contents</h3>
                <p>7. Inside: A laptop and some <input type="text" id="q7" class="ans-input" data-key="documents/papers"> <span class="feedback" id="fb-q7"></span></p>
                <p>8. Also contains: A pair of <input type="text" id="q8" class="ans-input" data-key="glasses"> <span class="feedback" id="fb-q8"></span></p>
                <h3>Delivery Instructions</h3>
                <p>9. Deliver to: The <input type="text" id="q9" class="ans-input" data-key="grand hotel"> <span class="feedback" id="fb-q9"></span></p>
                <p>10. Contact Number: <input type="text" id="q10" class="ans-input" data-key="07789 654321/07789654321"> <span class="feedback" id="fb-q10"></span></p>
            </div>
        </div>

        <!-- SECTION 2 (Hidden) -->
        <div id="sec-2" class="test-section">
            <h2>Section 2: Art Gallery Audio Guide</h2>
            
            <div class="mcq-grid">
                <div class="question-block">
                    <p><strong>11.</strong> Gallery founded in?</p>
                    <label class="mcq-option"><input type="radio" name="q11" value="A"> A. 1890</label>
                    <label class="mcq-option"><input type="radio" name="q11" value="B" data-key="B"> B. 1905</label>
                    <label class="mcq-option"><input type="radio" name="q11" value="C"> C. 1920</label>
                    <span class="feedback" id="fb-q11"></span>
                </div>
                <div class="question-block">
                    <p><strong>12.</strong> Special exhibition focus?</p>
                    <label class="mcq-option"><input type="radio" name="q12" value="A"> A. Oil paintings</label>
                    <label class="mcq-option"><input type="radio" name="q12" value="B"> B. Sculpture</label>
                    <label class="mcq-option"><input type="radio" name="q12" value="C" data-key="C"> C. Modern Photography</label>
                    <span class="feedback" id="fb-q12"></span>
                </div>
                <div class="question-block">
                    <p><strong>13.</strong> Audio guide cost?</p>
                    <label class="mcq-option"><input type="radio" name="q13" value="A" data-key="A"> A. Free with ticket</label>
                    <label class="mcq-option"><input type="radio" name="q13" value="B"> B. £2</label>
                    <label class="mcq-option"><input type="radio" name="q13" value="C"> C. £5</label>
                    <span class="feedback" id="fb-q13"></span>
                </div>
                <div class="question-block">
                    <p><strong>14.</strong> Cloakroom policy?</p>
                    <label class="mcq-option"><input type="radio" name="q14" value="A"> A. Coats only</label>
                    <label class="mcq-option"><input type="radio" name="q14" value="B" data-key="B"> B. Large bags must be stored</label>
                    <label class="mcq-option"><input type="radio" name="q14" value="C"> C. Closed today</label>
                    <span class="feedback" id="fb-q14"></span>
                </div>
                 <div class="question-block">
                    <p><strong>15.</strong> Afternoon tour starts?</p>
                    <label class="mcq-option"><input type="radio" name="q15" value="A"> A. 1:00 PM</label>
                    <label class="mcq-option"><input type="radio" name="q15" value="B"> B. 1:30 PM</label>
                    <label class="mcq-option"><input type="radio" name="q15" value="C" data-key="C"> C. 2:00 PM</label>
                    <span class="feedback" id="fb-q15"></span>
                </div>
            </div>

            <div class="question-block large-font-section">
                <h3>Gallery Map Locations</h3>
                <div class="question-block" style="border:none; padding:0;">
                    <p>16. Main Entrance leads to the <input type="text" id="q16" class="ans-input" data-key="rotunda">. <span class="feedback" id="fb-q16"></span></p>
                    <p>17. To the left is the <input type="text" id="q17" class="ans-input" data-key="blue room">. <span class="feedback" id="fb-q17"></span></p>
                    <p>18. On the right side is the <input type="text" id="q18" class="ans-input" data-key="gift shop">. <span class="feedback" id="fb-q18"></span></p>
                    <p>19. Directly ahead is the <input type="text" id="q19" class="ans-input" data-key="grand hall">. <span class="feedback" id="fb-q19"></span></p>
                    <p>20. The Cafe is located on the <input type="text" id="q20" class="ans-input" data-key="roof terrace">. <span class="feedback" id="fb-q20"></span></p>
                </div>
            </div>
        </div>

        <!-- SECTION 3 (Hidden) -->
        <div id="sec-3" class="test-section">
            <h2>Section 3: Architecture Project</h2>
            
            <div class="mcq-grid">
                <div class="question-block">
                    <p><strong>21.</strong> Project theme?</p>
                    <label class="mcq-option"><input type="radio" name="q21" value="A"> A. Urban Renewal</label>
                    <label class="mcq-option"><input type="radio" name="q21" value="B" data-key="B"> B. Sustainable Housing</label>
                    <label class="mcq-option"><input type="radio" name="q21" value="C"> C. Historic Restoration</label>
                    <span class="feedback" id="fb-q21"></span>
                </div>
                <div class="question-block">
                    <p><strong>22.</strong> Material choice?</p>
                    <label class="mcq-option"><input type="radio" name="q22" value="A"> A. Concrete</label>
                    <label class="mcq-option"><input type="radio" name="q22" value="B"> B. Recycled Plastic</label>
                    <label class="mcq-option"><input type="radio" name="q22" value="C" data-key="C"> C. Bamboo</label>
                    <span class="feedback" id="fb-q22"></span>
                </div>
                <div class="question-block">
                    <p><strong>23.</strong> Biggest challenge?</p>
                    <label class="mcq-option"><input type="radio" name="q23" value="A" data-key="A"> A. Budget constraints</label>
                    <label class="mcq-option"><input type="radio" name="q23" value="B"> B. Time management</label>
                    <label class="mcq-option"><input type="radio" name="q23" value="C"> C. Software issues</label>
                    <span class="feedback" id="fb-q23"></span>
                </div>
                <div class="question-block">
                    <p><strong>24.</strong> Tutor's advice?</p>
                    <label class="mcq-option"><input type="radio" name="q24" value="A"> A. Simplify design</label>
                    <label class="mcq-option"><input type="radio" name="q24" value="B" data-key="B"> B. Focus on insulation</label>
                    <label class="mcq-option"><input type="radio" name="q24" value="C"> C. Change location</label>
                    <span class="feedback" id="fb-q24"></span>
                </div>
                <div class="question-block">
                    <p><strong>25.</strong> Presentation style?</p>
                    <label class="mcq-option"><input type="radio" name="q25" value="A" data-key="A"> A. 3D Model</label>
                    <label class="mcq-option"><input type="radio" name="q25" value="B"> B. Digital Slides</label>
                    <label class="mcq-option"><input type="radio" name="q25" value="C"> C. Video walkthrough</label>
                    <span class="feedback" id="fb-q25"></span>
                </div>
                <div class="question-block">
                    <p><strong>26.</strong> Meeting deadline?</p>
                    <label class="mcq-option"><input type="radio" name="q26" value="A"> A. Monday</label>
                    <label class="mcq-option"><input type="radio" name="q26" value="B"> B. Wednesday</label>
                    <label class="mcq-option"><input type="radio" name="q26" value="C" data-key="C"> C. Friday</label>
                    <span class="feedback" id="fb-q26"></span>
                </div>
            </div>
            
            <div class="question-block large-font-section">
                <h3>Action Plan</h3>
                <div class="question-block" style="border:none; padding:0;">
                    <p>27. Step 1: Complete the <input type="text" id="q27" class="ans-input" data-key="drawings/sketches">. <span class="feedback" id="fb-q27"></span></p>
                    <p>28. Step 2: Research <input type="text" id="q28" class="ans-input" data-key="solar panels">. <span class="feedback" id="fb-q28"></span></p>
                    <p>29. Step 3: Write the <input type="text" id="q29" class="ans-input" data-key="cost analysis">. <span class="feedback" id="fb-q29"></span></p>
                    <p>30. Step 4: Practice the <input type="text" id="q30" class="ans-input" data-key="speech">. <span class="feedback" id="fb-q30"></span></p>
                </div>
            </div>
        </div>

        <!-- SECTION 4 (Hidden) -->
        <div id="sec-4" class="test-section">
            <h2>Section 4: The 15-Minute City</h2>
            
            <!-- Questions 31-35 (MCQs) -->
            <div class="mcq-grid">
                <div class="question-block">
                    <p><strong>31.</strong> What is the core definition?</p>
                    <label class="mcq-option"><input type="radio" name="q31" value="A"> A. Everything within 10 minutes</label>
                    <label class="mcq-option"><input type="radio" name="q31" value="B" data-key="B"> B. Everything within 15 minutes walk/bike</label>
                    <label class="mcq-option"><input type="radio" name="q31" value="C"> C. Cars banned for 15 minutes</label>
                    <span class="feedback" id="fb-q31"></span>
                </div>
                <div class="question-block">
                    <p><strong>32.</strong> What is the main aim?</p>
                    <label class="mcq-option"><input type="radio" name="q32" value="A"> A. Increase public transport</label>
                    <label class="mcq-option"><input type="radio" name="q32" value="B" data-key="B"> B. Reduce dependency on cars</label>
                    <label class="mcq-option"><input type="radio" name="q32" value="C"> C. Build taller buildings</label>
                    <span class="feedback" id="fb-q32"></span>
                </div>
                <div class="question-block">
                    <p><strong>33.</strong> Housing strategy?</p>
                    <label class="mcq-option"><input type="radio" name="q33" value="A"> A. Separate commercial zones</label>
                    <label class="mcq-option"><input type="radio" name="q33" value="B" data-key="B"> B. Mixed residential and commercial</label>
                    <label class="mcq-option"><input type="radio" name="q33" value="C"> C. High density only</label>
                    <span class="feedback" id="fb-q33"></span>
                </div>
                <div class="question-block">
                    <p><strong>34.</strong> Road changes?</p>
                    <label class="mcq-option"><input type="radio" name="q34" value="A"> A. Wider pavements</label>
                    <label class="mcq-option"><input type="radio" name="q34" value="B"> B. More car lanes</label>
                    <label class="mcq-option"><input type="radio" name="q34" value="C" data-key="C"> C. More cycling lanes</label>
                    <span class="feedback" id="fb-q34"></span>
                </div>
                <div class="question-block">
                    <p><strong>35.</strong> Environmental feature?</p>
                    <label class="mcq-option"><input type="radio" name="q35" value="A"> A. Solar streets</label>
                    <label class="mcq-option"><input type="radio" name="q35" value="B" data-key="B"> B. Increase in green spaces</label>
                    <label class="mcq-option"><input type="radio" name="q35" value="C"> C. Vertical farming</label>
                    <span class="feedback" id="fb-q35"></span>
                </div>
            </div>

            <!-- Questions 36-40 (Gap Fill) -->
            <div class="question-block large-font-section">
                <h3>Benefits & Challenges</h3>
                <div class="question-block" style="border:none; padding:0;">
                    <p>36. Health: People are more physically <input type="text" id="q36" class="ans-input" data-key="active">. <span class="feedback" id="fb-q36"></span></p>
                    <p>37. Pollution: Reduction in vehicle <input type="text" id="q37" class="ans-input" data-key="emissions">. <span class="feedback" id="fb-q37"></span></p>
                    <p>38. Social: Stronger sense of <input type="text" id="q38" class="ans-input" data-key="community">. <span class="feedback" id="fb-q38"></span></p>
                    <p>39. Economy: Small businesses struggle with high <input type="text" id="q39" class="ans-input" data-key="rent">. <span class="feedback" id="fb-q39"></span></p>
                    <p>40. Planning: Difficult to adapt <input type="text" id="q40" class="ans-input" data-key="old/existing"> cities. <span class="feedback" id="fb-q40"></span></p>
                </div>
            </div>
        </div>

        <div class="action-bar">
            <button class="check-btn" onclick="checkAnswers()">Check Section Answers</button>
            <button class="secondary-btn" onclick="toggleTranscript()">Transcript</button>
        </div>

    </form>
    <div id="transcript-container"></div>
</div>

<script>
    // --- 1. NEW TRANSCRIPT DATA (Test 8) ---
    // Strictly ensuring S values match Section Numbers
    const script = [
        // SECTION 1: Lost Property (Officer & Mr. Jarvis)
        { s:1, t: "Section 1. A man reports a lost item at an airport lost property office.", v: "Narrator" },
        { s:1, t: "Good morning, Airport Lost Property. How can I help?", v: "Emma" },
        { s:1, t: "Hello, I've lost my bag. I was hoping it had been handed in.", v: "Andrew" },
        { s:1, t: "I can check for you. Can I take your surname please?", v: "Emma" },
        { s:1, t: "Yes, it's Jarvis.", v: "Andrew" },
        { s:1, t: "Could you spell that?", v: "Emma" },
        { s:1, t: "J-A-R-V-I-S.", v: "Andrew" },
        { s:1, t: "J-A-R-V-I-S. Thank you Mr. Jarvis. Which flight were you on?", v: "Emma" },
        { s:1, t: "It was flight BA 293 from London.", v: "Andrew" },
        { s:1, t: "BA 293. And do you remember your seat number?", v: "Emma" },
        { s:1, t: "Yes, I was in seat 14A.", v: "Andrew" },
        { s:1, t: "14A. Okay. Can you describe the item?", v: "Emma" },
        { s:1, t: "It's a leather Briefcase.", v: "Andrew" },
        { s:1, t: "And the colour?", v: "Emma" },
        { s:1, t: "It's Dark Brown.", v: "Andrew" },
        { s:1, t: "Any distinguishing marks or scratches?", v: "Emma" },
        { s:1, t: "Yes, there is a distinct scratch near the Handle.", v: "Andrew" },
        { s:1, t: "Okay. What was inside?", v: "Emma" },
        { s:1, t: "My laptop, and some Documents.", v: "Andrew" },
        { s:1, t: "Anything else?", v: "Emma" },
        { s:1, t: "Yes, my reading Glasses were in the front pocket.", v: "Andrew" },
        { s:1, t: "I think we have it. Where should we send it?", v: "Emma" },
        { s:1, t: "Please send it to the Grand Hotel where I am staying.", v: "Andrew" },
        { s:1, t: "And a contact number?", v: "Emma" },
        { s:1, t: "07789 654321.", v: "Andrew" },
        { s:1, t: "Let me repeat that: 07789 654321.", v: "Emma" },
        { s:1, t: "That's correct.", v: "Andrew" },

        // SECTION 2: Art Gallery (Guide)
        { s:2, t: "Section 2. An audio guide introduces visitors to a modern art gallery.", v: "Narrator" },
        { s:2, t: "Welcome to the National Modern Art Gallery. This building is historic. While the collection started earlier, the gallery itself was founded in 1905.", v: "Eva" },
        { s:2, t: "We have a permanent collection of paintings, but our special exhibition this month focuses entirely on Modern Photography.", v: "Eva" },
        { s:2, t: "You are currently listening to the audio guide. Unlike other museums that charge, this guide is completely Free with your ticket.", v: "Eva" },
        { s:2, t: "Please note our cloakroom policy. You can keep your coats, but all Large Bags must be stored in the lockers.", v: "Eva" },
        { s:2, t: "If you want to join a guided tour, the morning one is full. The afternoon tour starts promptly at 2:00 PM.", v: "Eva" },
        { s:2, t: "Now, looking at the gallery map. You are standing in the Rotunda, the main circular entrance hall.", v: "Eva" },
        { s:2, t: "If you turn to your left, you will enter the Blue Room, which houses our impressionist paintings.", v: "Eva" },
        { s:2, t: "On the right hand side, opposite the Blue Room, is the Gift Shop.", v: "Eva" },
        { s:2, t: "Walking directly ahead from the Rotunda, you will enter the Grand Hall, our largest exhibition space.", v: "Eva" },
        { s:2, t: "Finally, for refreshments, the Cafe is not on the ground floor. It is located up on the Roof Terrace for a great view.", v: "Eva" },

        // SECTION 3: Architecture Project (Two Students & Tutor)
        { s:3, t: "Section 3. Two architecture students discuss their final project with a tutor.", v: "Narrator" },
        { s:3, t: "So, have you decided on a theme for your final design project?", v: "Brian" },
        { s:3, t: "Yes, we looked at urban renewal, but we decided to focus on Sustainable Housing.", v: "Emma" },
        { s:3, t: "That's a popular topic. What is your primary building material?", v: "Brian" },
        { s:3, t: "We wanted to use recycled plastic, but we settled on Bamboo because it grows fast.", v: "Andrew" },
        { s:3, t: "Interesting choice. What is the biggest challenge you are facing?", v: "Brian" },
        { s:3, t: "Definitely the Budget Constraints. Bamboo is cheap, but the specialized labor is expensive.", v: "Emma" },
        { s:3, t: "I see. My advice would be to Focus on Insulation. That is key for sustainability.", v: "Brian" },
        { s:3, t: "Good point. How should we present our design?", v: "Andrew" },
        { s:3, t: "Digital slides are standard, but for this, a physical 3D Model would be much more impressive.", v: "Brian" },
        { s:3, t: "Okay, we will build a model. When do we need to meet you again?", v: "Emma" },
        { s:3, t: "Let's meet next Friday to review your progress.", v: "Brian" },
        { s:3, t: "Okay, Action Plan. Step 1, we need to finish the technical Drawings.", v: "Andrew" },
        { s:3, t: "Right. Step 2, I need to research the efficiency of Solar Panels for the roof.", v: "Emma" },
        { s:3, t: "Step 3 is the boring part. Writing the Cost Analysis.", v: "Andrew" },
        { s:3, t: "And Step 4, we must Practice the Speech so we don't go over time.", v: "Emma" },

        // SECTION 4: 15-Minute City (Lecturer)
        { s:4, t: "Section 4. A lecture on the urban planning concept of the 15-Minute City.", v: "Narrator" },
        { s:4, t: "Today we are discussing a modern urban planning concept: The 15-Minute City.", v: "Eva" },
        { s:4, t: "The definition is simple. It is a city where every resident can reach their essential needs within a 15-minute Walk or bike ride.", v: "Eva" },
        { s:4, t: "The primary aim is to decentralize the city and reduce our dependency on Cars.", v: "Eva" },
        { s:4, t: "Key features include mixed-use housing. We want to blend Residential areas with commercial ones, so you live near shops.", v: "Eva" },
        { s:4, t: "Roads are also redesigned. We need fewer car lanes and more lanes dedicated to Cycling.", v: "Eva" },
        { s:4, t: "Environmentally, there is a push for an increase in Green Spaces like small parks in every neighborhood.", v: "Eva" },
        { s:4, t: "The benefits are clear. First, health improves as people become more Physically Active.", v: "Eva" },
        { s:4, t: "Second, pollution drops due to a significant reduction in vehicle Emissions.", v: "Eva" },
        { s:4, t: "Socially, it fosters a stronger sense of Community, as people spend more time in their local area.", v: "Eva" },
        { s:4, t: "However, challenges exist. Economically, high commercial Rent in residential areas can hurt small businesses.", v: "Eva" },
        { s:4, t: "And finally, planning is hard. It is difficult to adapt Old cities that were built for cars.", v: "Eva" }
    ];

    // --- 2. TTS ENGINE ---
    const synth = window.speechSynthesis;
    let isPlaying = false;
    let currentSection = 1;
    let currentIndex = 0;
    let utterance = null;
    let voices = [];

    const voiceMap = {
        "Narrator": "Microsoft Brian Online (Natural)", 
        "Andrew": "Microsoft Andrew Online (Natural)",
        "Emma": "Microsoft Emma Online (Natural)",
        "Eva": "Microsoft Eva Online (Natural)",
        "Brian": "Microsoft Brian Online (Natural)"
    };

    function loadVoices() {
        voices = synth.getVoices();
    }

    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = loadVoices;
    }

    function getVoice(name) {
        const targetName = voiceMap[name] || name;
        let found = voices.find(v => v.name.includes(targetName));
        if (!found) found = voices.find(v => v.lang === 'en-US' && v.name.includes('Natural'));
        if (!found) found = voices.find(v => v.lang.startsWith('en'));
        return found;
    }

    function playSection(secNum) {
        stopAudio();
        
        document.querySelectorAll('.test-section').forEach(d => d.classList.remove('active'));
        document.querySelectorAll('.section-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(`sec-${secNum}`).classList.add('active');
        
        const allBtns = document.querySelectorAll('.section-btn');
        // Btn index 0 is Final Score, so Sec 1 is index 1
        if(allBtns[secNum]) allBtns[secNum].classList.add('active');

        currentSection = secNum;
        
        const transcriptDiv = document.getElementById('transcript-container');
        if (transcriptDiv.style.display === 'block') {
            transcriptDiv.innerHTML = script
                .filter(s => s.s === currentSection)
                .map(s => `<div class="script-line">${s.t}</div>`).join('');
        }

        currentIndex = script.findIndex(line => line.s === secNum);
        
        if (currentIndex !== -1) {
            isPlaying = true;
            if (voices.length === 0) loadVoices();
            playNext();
        }
    }

    function playNext() {
        if (!isPlaying || currentIndex >= script.length) {
            isPlaying = false;
            return;
        }

        const line = script[currentIndex];
        
        if (line.s !== currentSection) {
            isPlaying = false;
            return; 
        }

        utterance = new SpeechSynthesisUtterance(line.t);
        utterance.voice = getVoice(line.v);
        utterance.rate = 0.85; 

        utterance.onend = function() {
            if (isPlaying) {
                currentIndex++;
                setTimeout(playNext, 500); 
            }
        };

        synth.speak(utterance);
    }

    function stopAudio() {
        synth.cancel();
        isPlaying = false;
    }

    // --- 3. UI LOGIC ---
    function checkAnswers() {
        const activeDiv = document.getElementById('sec-' + currentSection);
        if(!activeDiv) {
            alert("No section is currently active.");
            return;
        }

        const inputs = activeDiv.querySelectorAll('input[type="text"], input[type="number"]');
        const radios = activeDiv.querySelectorAll('input[type="radio"]');

        let score = 0;
        let total = 0;

        inputs.forEach(input => {
            const key = input.getAttribute('data-key');
            if(key) {
                total++;
                const userVal = input.value.trim().toLowerCase();
                const fb = document.getElementById(`fb-${input.id}`);
                const correctKeys = key.toLowerCase().split('/');
                
                if (correctKeys.includes(userVal)) {
                    score++;
                    fb.innerHTML = "✓";
                    fb.className = "feedback correct";
                } else {
                    fb.innerHTML = `✗ (${key.split('/')[0]})`;
                    fb.className = "feedback incorrect";
                }
                fb.style.display = "inline";
            }
        });

        const radioNames = new Set();
        radios.forEach(r => radioNames.add(r.name));
        
        radioNames.forEach(name => {
            total++;
            const selected = activeDiv.querySelector(`input[name="${name}"]:checked`);
            const fb = document.getElementById(`fb-${name}`);
            let correctVal = "";
            
            activeDiv.querySelectorAll(`input[name="${name}"]`).forEach(r => {
                if (r.getAttribute('data-key')) correctVal = r.value;
            });

            if (selected && selected.value === correctVal) {
                score++;
                fb.innerHTML = "✓ Correct";
                fb.className = "feedback correct";
            } else {
                fb.innerHTML = `✗ Correct: ${correctVal}`;
                fb.className = "feedback incorrect";
            }
            if(fb) fb.style.display = "block";
        });

        alert(`Section Score: ${score} out of ${total}`);
    }

    function calculateFinalScore() {
        let score = 0;
        let total = 0;

        document.querySelectorAll('input[type="text"], input[type="number"]').forEach(input => {
            const key = input.getAttribute('data-key');
            if(key) {
                total++;
                const userVal = input.value.trim().toLowerCase();
                const correctKeys = key.toLowerCase().split('/');
                if (correctKeys.includes(userVal)) score++;
            }
        });

        const allRadioNames = new Set();
        document.querySelectorAll('input[type="radio"]').forEach(r => allRadioNames.add(r.name));
        
        allRadioNames.forEach(name => {
            total++;
            const selected = document.querySelector(`input[name="${name}"]:checked`);
            let correctVal = "";
            document.querySelectorAll(`input[name="${name}"]`).forEach(r => {
                if (r.getAttribute('data-key')) correctVal = r.value;
            });
            if (selected && selected.value === correctVal) score++;
        });

        alert(`Final Score: ${score} out of ${total}`);
    }

    function toggleTranscript() {
        const div = document.getElementById('transcript-container');
        if (div.style.display === 'block') {
            div.style.display = 'none';
        } else {
            div.innerHTML = script
                .filter(s => s.s === currentSection)
                .map(s => `<div class="script-line">${s.t}</div>`).join('');
            div.style.display = 'block';
        }
    }
</script>

</body>
</html>
