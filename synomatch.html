<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Synonym Galaxy Challenge</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --space-dark: #0D0D2B;
            --space-mid: #1D1D4A;
            --space-light: #2C2C6A;
            --primary-glow: #00E5FF;
            --secondary-glow: #FF00FF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Orbitron', sans-serif;
            background: var(--space-dark);
            color: #E0E0E0;
            overflow: hidden;
            min-height: 100vh;
            position: relative;
        }

        #starfield {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: black;
        }

        .star {
            position: absolute;
            background-color: white;
            border-radius: 50%;
            animation: move linear infinite;
        }

        @keyframes move {
            from { transform: translateY(0px); }
            to { transform: translateY(-2000px); }
        }
        
        .laser-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            overflow: hidden;
        }

        .laser {
            position: absolute;
            width: 200px;
            height: 4px;
            background: linear-gradient(90deg, transparent, rgba(0, 229, 255, 0.8));
            border-radius: 5px;
            animation: shoot-ltr 2s linear forwards;
        }

        @keyframes shoot-ltr {
            0% { transform: translateX(-200px); opacity: 1; }
            100% { transform: translateX(100vw); opacity: 0; }
        }
        
        @keyframes shoot-rtl {
            0% { transform: translateX(200px); opacity: 1; }
            100% { transform: translateX(-100vw); opacity: 0; }
        }

        /* Game Container */
        .game-container {
            max-width: 960px; /* Reduced by 20% from 1200px */
            margin: 0 auto;
            padding: 10px;
            position: relative;
            z-index: 10;
        }

        /* Game Progress Header */
        .game-progress {
            background: rgba(29, 29, 74, 0.7);
            backdrop-filter: blur(5px);
            border-radius: 15px;
            padding: 0.5rem 1.5rem;
            margin-bottom: 0.5rem; /* Reduced margin */
            border: 2px solid var(--primary-glow);
            box-shadow: 0 0 15px var(--primary-glow);
            text-align: center;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: nowrap;
        }

        .progress-item {
            font-size: 1rem;
            font-weight: bold;
            text-shadow: 0 0 5px var(--primary-glow);
        }
        
        .progress-item-center {
            text-align: center;
        }

        .header-score {
            font-size: 1.2rem;
            color: var(--secondary-glow);
            text-shadow: 0 0 10px var(--secondary-glow);
        }
        
        .header-score span {
            display: block;
            font-size: 0.9rem;
            color: #E0E0E0;
            margin-bottom: 4px;
        }
        
        /* Game Modes */
        .game-modes {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1.5rem;
            margin: 5rem 0;
            flex-wrap: wrap;
        }

        .mode-btn {
            padding: 1.5rem 2.5rem;
            font-size: 1.3rem;
            font-weight: bold;
            background: linear-gradient(45deg, var(--space-mid), var(--space-light));
            color: #FFF;
            border: 2px solid var(--primary-glow);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 0 10px rgba(0, 229, 255, 0.5);
        }

        .mode-btn:hover {
            transform: translateY(-5px) scale(1.05);
            background: linear-gradient(45deg, var(--primary-glow), var(--secondary-glow));
            color: var(--space-dark);
            box-shadow: 0 0 25px var(--primary-glow), 0 0 15px var(--secondary-glow);
        }
        
        /* Team Setup & Player Selection */
        .team-setup, .player-selection {
            display: none;
            text-align: center;
            background: rgba(13, 13, 43, 0.7);
            backdrop-filter: blur(5px);
            border-radius: 20px;
            padding: 2rem;
            border: 2px solid var(--primary-glow);
        }
        
        .player-selection-area { display: flex; justify-content: center; gap: 2rem; margin: 2.5rem auto 1.5rem; }
        .player-display { width: 300px; height: 150px; border: 3px solid var(--primary-glow); border-radius: 15px; background: rgba(0,0,0,0.5); display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1rem; box-shadow: 0 0 15px var(--primary-glow); }
        .player-display-team-name { color: var(--secondary-glow); font-size: 1.2rem; margin-bottom: 1rem; }
        .player-display-window { font-size: 1.5rem; font-weight: bold; animation: text-flicker 0.1s infinite alternate; }
        @keyframes text-flicker { 0% { text-shadow: 0 0 5px #fff, 0 0 10px var(--primary-glow); } 100% { text-shadow: 0 0 10px #fff, 0 0 20px var(--primary-glow); } }

        .teams-display { display: flex; justify-content: space-between; gap: 2rem; margin-top: 1rem; }
        .team { flex: 1; background: var(--space-mid); border-radius: 15px; padding: 1.5rem; border: 2px solid var(--primary-glow); }
        .team h3 { font-size: 1.5rem; margin-bottom: 1rem; color: var(--secondary-glow); text-shadow: 0 0 10px var(--secondary-glow); }
        .team-member { padding: 0.5rem; margin: 0.5rem 0; background: rgba(0, 229, 255, 0.1); border-radius: 10px; font-size: 1rem; }
        
        /* Game Play */
        .game-play { display: none; position: relative; flex-direction: column;}
        .game-area { display: flex; justify-content: space-between; align-items: stretch; gap: 1rem; }
        .versus-indicator { font-size: 3rem; font-weight: bold; color: var(--secondary-glow); text-shadow: 0 0 15px var(--secondary-glow); animation: bonusPulse 1.5s ease-in-out infinite; display: flex; align-items: center; }
        .team-game-area { flex: 1; display: flex; flex-direction: column; gap: 1rem; position: relative; }
        
        .team-score-display { background: rgba(29, 29, 74, 0.8); border-radius: 15px; padding: 0.5rem; border: 2px solid var(--primary-glow); text-align: center; }
        .team-score-display .team-name { font-size: 1.2rem; font-weight: bold; }
        .team-score-display .score-number { font-size: 2.2rem; color: var(--secondary-glow); text-shadow: 0 0 15px var(--secondary-glow); }

        .player-area {
            flex-grow: 1;
            background: rgba(29, 29, 74, 0.8);
            border-radius: 20px;
            padding: 1rem;
            border: 2px solid var(--primary-glow);
            box-shadow: 0 0 10px var(--primary-glow);
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: space-around; /* Adjusted for better spacing */
        }

        .player-name { font-size: 1.2rem; font-weight: bold; margin-bottom: 0.5rem; text-shadow: 0 0 10px var(--primary-glow); min-height: 30px; }
        
        .target-word-container { margin-bottom: 1rem; }
        .target-word { font-size: 2.5rem; font-weight: 700; color: #FFF; text-shadow: 0 0 15px var(--secondary-glow); }

        .answer-buttons { display: grid; grid-template-columns: 1fr; gap: 0.5rem; }
        .answer-btn { padding: 1rem; font-size: 1.3rem; font-weight: bold; background: linear-gradient(45deg, rgba(0, 229, 255, 0.25), rgba(0, 191, 165, 0.4)); color: #ffffff; border: 2px solid var(--primary-glow); border-radius: 10px; cursor: pointer; transition: all 0.3s ease; text-shadow: 0 0 3px rgba(0,0,0,0.5); }
        .answer-btn:hover { background: linear-gradient(45deg, rgba(0, 229, 255, 0.5), rgba(0, 191, 165, 0.7)); transform: scale(1.05); }
        .answer-btn.correct { background: linear-gradient(45deg, #2ecc71, #27ae60); color: #fff; animation: correctPulse 0.5s ease; }
        .answer-btn.incorrect { background: linear-gradient(45deg, #e74c3c, #c0392b); color: #fff; animation: incorrectShake 0.5s ease; }
        @keyframes correctPulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }
        @keyframes incorrectShake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }
        
        .correct-answer-reveal { font-size: 1rem; color: var(--secondary-glow); margin-top: 0.5rem; font-weight: bold; text-shadow: 0 0 8px var(--secondary-glow); height: 25px; display: flex; align-items: center; justify-content: center; }
        
        .timer-container { margin-bottom: 0.5rem; text-align: center; }
        .timer-display { font-size: 2.2rem; font-weight: bold; color: var(--secondary-glow); text-shadow: 0 0 20px var(--secondary-glow); }
        .timer-bar { width: 100%; height: 10px; background: rgba(0,0,0,0.5); border-radius: 10px; overflow: hidden; border: 1px solid var(--primary-glow); }
        .timer-progress { height: 100%; background: linear-gradient(90deg, var(--secondary-glow), var(--primary-glow)); transition: width 0.1s linear; border-radius: 10px; }

        .stardust-particle, .splash-star {
            position: absolute;
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
        }

        .stardust-particle {
            width: 8px;
            height: 8px;
            background: var(--secondary-glow);
            border-radius: 50%;
            animation: fly-to-score 1s ease-out forwards;
            box-shadow: 0 0 8px var(--secondary-glow), 0 0 12px var(--primary-glow);
        }

        @keyframes fly-to-score {
            0% { transform: translate(0, 0) scale(1); opacity: 1; }
            100% { transform: translate(var(--x-end), var(--y-end)) scale(0); opacity: 0; }
        }
        
        /* New Effects */
        .star-particle { position: absolute; color: #fff; font-size: 14px; animation: star-fly 1.5s linear forwards; pointer-events: none; z-index: 1001; }
        @keyframes star-fly {
            0% { transform: translate(0,0) scale(0.5); opacity: 1; }
            100% { transform: translate(var(--dx), var(--dy)) scale(1.5); opacity: 0; }
        }

        .asteroid { position: absolute; background: #ff4d4d; border-radius: 50%; animation: asteroid-burst 1s ease-out forwards; pointer-events: none; z-index: 1001; }
        @keyframes asteroid-burst {
            0% { transform: translate(0,0) scale(0.5); opacity: 1; }
            100% { transform: translate(var(--dx), var(--dy)) scale(1.2); opacity: 0; }
        }

        .rocket-pulse { animation: rocket-pulse 0.6s ease-out; }
        @keyframes rocket-pulse {
            0% { transform: scale(1); box-shadow: 0 0 5px var(--primary-glow); }
            50% { transform: scale(1.15); box-shadow: 0 0 20px var(--primary-glow), 0 0 30px var(--primary-glow); }
            100% { transform: scale(1); box-shadow: 0 0 5px var(--primary-glow); }
        }
        
        .praise-word, .encouragement-phrase {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); font-size: 2.5rem; font-weight: bold;
            z-index: 100; pointer-events: none; animation: praise-animation 1.5s ease-out forwards;
        }
        .encouragement-phrase { color: var(--primary-glow); text-shadow: 0 0 10px var(--primary-glow); }
        @keyframes praise-animation { 0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; } 100% { transform: translate(-50%, -200%) scale(1.2); opacity: 0; } }

    </style>
</head>
<body>
    <div id="starfield"></div>
    <div class="laser-container"></div>
    <div class="game-container">
        <!-- Header, Game Modes, etc. -->
        <div class="game-progress" id="gameProgress" style="display: none;">
            <div class="progress-info">
                <div class="header-score">
                    <span id="headerTeam1Name">Team 1</span>
                    <div id="headerTeam1Score">0</div>
                </div>
                <div class="progress-item-center">
                    <div class="progress-item">Round: <span id="currentRoundDisplay">1</span>/<span id="totalRoundsHeader"></span></div>
                    <div class="progress-item">Card: <span id="currentCard">1</span>/10</div>
                </div>
                <div class="header-score">
                    <span id="headerTeam2Name">Team 2</span>
                    <div id="headerTeam2Score">0</div>
                </div>
            </div>
        </div>

        <div class="game-modes" id="gameModes">
            <button class="mode-btn" onclick="selectGradeAndStart(10)">Grade 10</button>
            <button class="mode-btn" onclick="selectGradeAndStart(11)">Grade 11</button>
            <button class="mode-btn" onclick="selectGradeAndStart(12)">Grade 12</button>
        </div>

        <div id="game-content" style="display: none;">
            <div class="team-setup" id="teamSetup">
                <h2 style="font-size: 2rem; margin-bottom: 1rem; text-shadow: 0 0 15px var(--primary-glow);">👥 Team Formation</h2>
                <div class="teams-display">
                    <div class="team"><h3 id="team1Name"></h3><div id="team1Members"></div></div>
                    <div class="team"><h3 id="team2Name"></h3><div id="team2Members"></div></div>
                </div>
            </div>

            <div class="player-selection" id="playerSelection">
                <h2 style="font-size: 2rem; margin-bottom: 1rem; text-shadow: 0 0 15px var(--primary-glow);">🚀 PLAYER SELECTION 🚀</h2>
                <div class="player-selection-area">
                    <div class="player-display">
                        <div class="player-display-team-name" id="display1TeamName"></div>
                        <div class="player-display-window" id="player1Display">-- Standby --</div>
                    </div>
                     <div class="player-display">
                        <div class="player-display-team-name" id="display2TeamName"></div>
                        <div class="player-display-window" id="player2Display">-- Standby --</div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 1rem; font-size: 1.2rem; color: var(--secondary-glow);">
                    <div id="selectionCountdown">Round starts in <span id="countdownTimer">10</span>s...</div>
                </div>
            </div>

            <div class="game-play" id="gamePlay">
                <div class="timer-container">
                    <div class="timer-display" id="timerDisplay">10</div>
                    <div class="timer-bar"><div class="timer-progress" id="timerProgress"></div></div>
                </div>
                <div class="game-area">
                    <div class="team-game-area" id="team1GameArea">
                         <div class="team-score-display"><div class="team-name" id="gameTeam1Name">Team 1</div><div class="score-number" id="team1RoundScore">0</div></div>
                         <div class="player-area">
                            <div class="player-name" id="player1Name"></div>
                            <div class="target-word-container">
                                <div class="target-word" id="targetWord1">WORD</div>
                            </div>
                            <div class="answer-buttons" id="player1Buttons"></div>
                            <div class="correct-answer-reveal" id="player1AnswerReveal"></div>
                        </div>
                    </div>
                     <div class="versus-indicator">VS</div>
                    <div class="team-game-area" id="team2GameArea">
                        <div class="team-score-display"><div class="team-name" id="gameTeam2Name">Team 2</div><div class="score-number" id="team2RoundScore">0</div></div>
                         <div class="player-area">
                            <div class="player-name" id="player2Name"></div>
                             <div class="target-word-container">
                                <div class="target-word" id="targetWord2">WORD</div>
                            </div>
                            <div class="answer-buttons" id="player2Buttons"></div>
                            <div class="correct-answer-reveal" id="player2AnswerReveal"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // --- STARFIELD EFFECT ---
        function createStars() {
            const container = document.getElementById('starfield');
            if (!container) return;
            container.innerHTML = '';
            for (let i = 0; i < 500; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                const size = Math.random() * 3 + 1;
                star.style.width = `${size}px`;
                star.style.height = `${size}px`;
                star.style.top = `${Math.random() * 2000}px`;
                star.style.left = `${Math.random() * 100}%`;
                const duration = Math.random() * 5 + 5;
                star.style.animationDuration = `${duration}s`;
                star.style.animationDelay = `${Math.random() * duration}s`;
                container.appendChild(star);
            }
        }
        
        // --- PLAYER & WORD DATA ---
        const grade10Players = ["冯奕尘 / Feng, Yichen", "黄若涵 / Huang, Ruohan", "李丰屹 / Li, Fengyi", "李鹏潞 / Li, Penglu", "梁锦天 / Ling, Jintian", "刘景扬 / Liu, Jingyang", "龙俊志 / Long, Junzhi", "马赫 / Ma, He", "聂溪康 / Nie, Xikang", "庞云蔚 / Pang, Yunwei", "曲家瑞 / Qu, Jiarui", "孙诗童 / Sun, Shitong", "王子言 / Wang, Ziyan", "杨晴珺 / Yang, Qingjun", "张宸恺 / Zhang, Chenkai", "赵浩文 / Zhao, Haowen"];
        const grade11Players = ["陈峻弘 / Chen, Junhong", "韩睿雄 / Han, Ruixiong", "何怡敏 / He, Yimin", "康艺芸 / Kang, Yiyun", "李雨霏 / Li, Yufei", "李沾衣 / Li, Zhanyi", "刘圃言 / Liu, Puyan", "庞泽霖 / Pang, Zelin", "王梓晗 / Wang, Zihan", "尹九思 / Yin, Jiusi", "游项雯 / You, Xiangwen", "于浚哲 / Yu, Junzhe", "臧姝婷 / Zang, Shuting", "张澜馨 / Zhang, Lanxin"];
        const grade12Players = ["安政聿 / An, Zhengyu", "蔡子墨 / Cai, Zimo", "刘镇榕 / Liu, Zhenrong", "马知行 / Ma, Zhixing", "邱天 / Qiu, Tian", "盛思语 / Sheng, Siyu", "唐可盈 / Tang, Keying", "田子凡 / Tian, Zifan", "谢斯飞 / Xie, Sifei", "杨加麒 / Yang, Jiaqi", "张程皓 / Zhang, Chenghao", "赵晨达鑫 / Zhao, Chendaxin", "周逸凡 / Zhou, Yifan"];
        let playerNames = [];
        const wordSet1 = [ { word: "happy", synonyms: ["joyful", "cheerful", "merry", "content"] }, { word: "sad", synonyms: ["unhappy", "sorrowful", "gloomy", "miserable"] }, { word: "big", synonyms: ["large", "huge", "enormous", "vast"] }, { word: "small", synonyms: ["little", "tiny", "diminutive", "compact"] }, { word: "fast", synonyms: ["quick", "rapid", "swift", "speedy"] }, { word: "slow", synonyms: ["leisurely", "unhurried", "gradual", "plodding"] }, { word: "good", synonyms: ["excellent", "fine", "wonderful", "pleasant"] }, { word: "bad", synonyms: ["awful", "terrible", "horrible", "nasty"] }, { word: "smart", synonyms: ["intelligent", "bright", "clever", "brilliant"] }, { word: "funny", synonyms: ["amusing", "hilarious", "comical", "witty"] } ];
        const wordSet2 = [ { word: "run", synonyms: ["dash", "sprint", "bolt", "jog"] }, { word: "walk", synonyms: ["stroll", "saunter", "trek", "hike"] }, { word: "look", synonyms: ["gaze", "stare", "glance", "peer"] }, { word: "say", synonyms: ["speak", "state", "declare", "utter"] }, { word: "make", synonyms: ["create", "build", "construct", "produce"] }, { word: "break", synonyms: ["fracture", "shatter", "smash", "rupture"] }, { word: "take", synonyms: ["grab", "seize", "snatch", "acquire"] }, { word: "give", synonyms: ["provide", "offer", "donate", "bestow"] }, { word: "help", synonyms: ["assist", "aid", "support", "serve"] }, { word: "use", synonyms: ["utilize", "employ", "operate", "apply"] } ];
        const wordSet3 = [ { word: "beautiful", synonyms: ["gorgeous", "stunning", "lovely", "attractive"] }, { word: "ugly", synonyms: ["hideous", "unattractive", "unsightly", "repulsive"] }, { word: "difficult", synonyms: ["hard", "challenging", "tough", "complex"] }, { word: "easy", synonyms: ["simple", "effortless", "straightforward", "uncomplicated"] }, { word: "important", synonyms: ["significant", "crucial", "vital", "essential"] }, { word: "interesting", synonyms: ["fascinating", "engaging", "intriguing", "captivating"] }, { word: "boring", synonyms: ["dull", "tedious", "monotonous", "uninteresting"] }, { word: "quiet", synonyms: ["silent", "peaceful", "calm", "hushed"] }, { word: "noisy", synonyms: ["loud", "rowdy", "boisterous", "clamorous"] }, { word: "rich", synonyms: ["wealthy", "affluent", "prosperous", "loaded"] } ];
        const wordSet4 = [ { word: "ubiquitous", synonyms: ["everywhere", "omnipresent", "pervasive", "universal"] }, { word: "ephemeral", synonyms: ["fleeting", "transient", "momentary", "brief"] }, { word: "meticulous", synonyms: ["careful", "thorough", "precise", "diligent"] }, { word: "conundrum", synonyms: ["problem", "puzzle", "riddle", "dilemma"] }, { word: "alleviate", synonyms: ["relieve", "ease", "soothe", "lessen"] }, { word: "ambiguous", synonyms: ["unclear", "vague", "equivocal", "cryptic"] }, { word: "benevolent", synonyms: ["kind", "generous", "compassionate", "caring"] }, { word: "austere", synonyms: ["plain", "strict", "harsh", "severe"] }, { word: "verbose", synonyms: ["wordy", "talkative", "loquacious", "chatty"] }, { word: "zealous", synonyms: ["enthusiastic", "passionate", "eager", "fervent"] } ];
        const wordSet5 = [ { word: "angry", synonyms: ["furious", "irate", "enraged", "livid"] }, { word: "scared", synonyms: ["afraid", "terrified", "frightened", "panicked"] }, { word: "brave", synonyms: ["courageous", "heroic", "valiant", "fearless"] }, { word: "calm", synonyms: ["serene", "tranquil", "peaceful", "composed"] }, { word: "eager", synonyms: ["keen", "excited", "enthusiastic", "avid"] }, { word: "tired", synonyms: ["exhausted", "weary", "fatigued", "drained"] }, { word: "surprised", synonyms: ["amazed", "astonished", "startled", "stunned"] }, { word: "proud", synonyms: ["arrogant", "haughty", "smug", "vain"] }, { word: "shy", synonyms: ["bashful", "timid", "reserved", "introverted"] }, { word: "honest", synonyms: ["truthful", "sincere", "candid", "forthright"] } ];
        const wordSet6 = [ { word: "abundant", synonyms: ["plentiful", "ample", "copious", "bountiful"] }, { word: "candid", synonyms: ["frank", "honest", "outspoken", "direct"] }, { word: "diligent", synonyms: ["hardworking", "industrious", "assiduous", "conscientious"] }, { word: "gregarious", synonyms: ["sociable", "friendly", "outgoing", "affable"] }, { word: "novice", synonyms: ["beginner", "neophyte", "trainee", "apprentice"] }, { word: "omit", synonyms: ["exclude", "leave out", "forget", "neglect"] }, { word: "ponder", synonyms: ["consider", "contemplate", "reflect", "think"] }, { word: "refute", synonyms: ["disprove", "rebut", "contradict", "deny"] }, { word: "spurious", synonyms: ["false", "fake", "counterfeit", "bogus"] }, { word: "tenacious", synonyms: ["persistent", "determined", "steadfast", "unshakable"] } ];
        const praiseAudioPhrases = ["Great answer!", "Excellent!", "Correct!", "Well done!", "Perfect!", "That's right!", "Amazing!", "Fantastic!"];
        const correctPhrases = ["Stellar work!", "You've got it!", "Absolutely brilliant!", "That's the one!", "Incredible!", "You're a genius!", "Keep it up!", "Outstanding!", "Perfectly done!", "You're on fire!"];
        const incorrectPhrases = ["Great attempt!", "Not this time.", "Keep trying!", "Mistakes are proof that you are trying.", "That's not it, but I believe in you!", "So close!", "Don't worry, try again.", "That's a learning opportunity!", "Your persistence is inspiring.", "Even experts get it wrong sometimes."];
        let gameState;
        let preferredEnglishVoices = [];
        let preferredChineseVoices = [];
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // --- SOUNDS ---
        const correctSounds=[{seq:[{freq:1046,dur:.3}]},{seq:[{freq:784,dur:.15},{freq:1046,dur:.2}]},{seq:[{freq:523,dur:.1},{freq:659,dur:.1},{freq:784,dur:.15}]},{seq:[{freq:1200,type:"square",dur:.08}]},{seq:[{freq:440,dur:.1},{freq:554,dur:.1},{freq:659,dur:.15}]},{seq:[{freq:880,dur:.2}]},{seq:[{freq:659,dur:.2},{freq:987,dur:.25}]},{seq:[{freq:1568,dur:.05},{freq:2093,dur:.08}]},{seq:[{freq:500,type:"sawtooth",dur:.1},{freq:1e3,type:"sawtooth",dur:.15}]},{seq:[{freq:622,type:"triangle",dur:.15},{freq:830,type:"triangle",dur:.2}]},{seq:[{freq:1e3,dur:.05},{freq:1500,dur:.05},{freq:2e3,dur:.05}]},{seq:[{freq:1046,dur:.05,gap:.05},{freq:1046,dur:.2}]},{seq:[{freq:784,type:"sine",vol:.4,dur:.3}]},{seq:[{freq:523,dur:.4},{freq:659,dur:.4,gap:-.4},{freq:784,dur:.4,gap:-.4}]},{seq:[{freq:1318,dur:.3,vol:.3},{freq:1328,dur:.3,vol:.3,gap:-.3}]},{seq:[{freq:523,dur:.08},{freq:587,dur:.08},{freq:659,dur:.08},{freq:698,dur:.08},{freq:784,dur:.15}]},{seq:[{freq:784,dur:.1},{freq:659,dur:.1},{freq:523,dur:.2}]},{seq:[{freq:987,dur:.25}]},{seq:[{freq:1046,dur:.05,gap:.02},{freq:1318,dur:.05,gap:.02},{freq:1568,dur:.1}]},{seq:[{freq:493,dur:.2},{freq:523,dur:.3}]}];
        const incorrectSounds=[{seq:[{freq:150,type:"square",dur:.4}]},{seq:[{freq:220,dur:.15,gap:.05},{freq:220,dur:.15}]},{seq:[{freq:440,dur:.1},{freq:330,dur:.1},{freq:220,dur:.3}]},{seq:[{freq:110,dur:.5}]},{seq:[{freq:440,type:"sawtooth",dur:.3},{freq:450,type:"sawtooth",dur:.3,gap:-.3}]},{seq:[{freq:100,type:"square",dur:.3}]},{seq:[{freq:523,dur:.2},{freq:261,dur:.3}]},{seq:[{freq:300,dur:.1}]},{seq:[{freq:130,dur:.6}]},{seq:[{freq:600,dur:.1},{freq:200,dur:.2}]},{seq:[{freq:180,dur:.08,gap:.04},{freq:180,dur:.08}]},{seq:[{freq:200,type:"triangle",dur:.4}]},{seq:[{freq:247,dur:.3},{freq:261,dur:.3,gap:-.3}]},{seq:[{freq:400,type:"square",dur:.1,gap:.05},{freq:200,type:"square",dur:.2}]},{seq:[{freq:300,dur:.05,gap:.05},{freq:300,dur:.05,gap:.05},{freq:300,dur:.05}]},{seq:[{freq:330,dur:.3},{freq:230,dur:.3,gap:-.3}]},{seq:[{freq:120,type:"sawtooth",dur:.4},{freq:122,type:"sawtooth",dur:.4,gap:-.4}]},{seq:[{freq:250,dur:.2}]},{seq:[{freq:196,dur:.25}]},{seq:[{freq:90,type:"sawtooth",dur:.5}]}];
        function playSound(type){let e="correct"===type?correctSounds:incorrectSounds,t=e[Math.floor(Math.random()*e.length)],o=audioContext.currentTime;t.seq.forEach(e=>{e.gap&&e.gap>0&&(o+=e.gap);let t=audioContext.createOscillator(),n=audioContext.createGain();t.connect(n),n.connect(audioContext.destination),t.frequency.setValueAtTime(e.freq,o),t.type=e.type||"sine",n.gain.setValueAtTime(e.vol||.5,o),n.gain.exponentialRampToValueAtTime(.001,o+e.dur),t.start(o),t.stop(o+e.dur),e.gap&&e.gap>=0||(o+=e.dur)})}
        
        // --- TTS ---
        function loadVoices() {
            const voices = speechSynthesis.getVoices();
            if (voices.length === 0) return; 

            const wantedEnglish = ["Microsoft Ava Online (Natural) - English (United States)", "Microsoft Brian Online (Natural) - English (United Kingdom)", "Microsoft Emma Online (Natural) - English (United Kingdom)", "Microsoft Andrew Online (Natural) - English (United States)", "Microsoft William Online (Natural) - English (United States)"];
            preferredEnglishVoices = voices.filter(v => wantedEnglish.includes(v.name));

            const wantedChinese = ["Microsoft Xiaoxiao Online (Natural) - Chinese (Mainland)", "Microsoft Yunxi Online (Natural) - Chinese (Mainland)", "Microsoft Yunjian Online (Natural) - Chinese (Mainland)"];
             preferredChineseVoices = voices.filter(v => wantedChinese.includes(v.name));
        }
        speechSynthesis.onvoiceschanged = loadVoices;
        
        function playEnglishAudio(text, onEnd = null) {
            if ('speechSynthesis' in window && preferredEnglishVoices.length > 0) {
                speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.voice = preferredEnglishVoices[Math.floor(Math.random() * preferredEnglishVoices.length)];
                utterance.lang = 'en-US';
                utterance.rate = 0.85;
                if (typeof onEnd === 'function') utterance.onend = onEnd;
                speechSynthesis.speak(utterance);
            } else if (typeof onEnd === 'function') {
                onEnd();
            }
        }

        function playChineseAudio(text, onEnd = null) {
            if ('speechSynthesis' in window && preferredChineseVoices.length > 0) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.voice = preferredChineseVoices[Math.floor(Math.random() * preferredChineseVoices.length)];
                utterance.lang = 'zh-CN';
                utterance.rate = 0.85;
                 if (typeof onEnd === 'function') utterance.onend = onEnd;
                speechSynthesis.speak(utterance);
            } else if (typeof onEnd === 'function') {
                onEnd();
            }
        }
        
        // --- CORE GAME LOGIC ---
        function resetGameState() {
            gameState = {
                currentRound: 1, currentCard: 1, team1Score: 0, team2Score: 0,
                team1Queue: [], team2Queue: [], roundScore1: 0, roundScore2: 0,
                rounds: [], totalRoundsNeeded: 0, isRoundActive: false,
                currentPlayer1: '', currentPlayer2: '', currentQuestion: null
            };
        }

        function selectGradeAndStart(grade) {
            if (grade === 10) playerNames = [...grade10Players];
            if (grade === 11) playerNames = [...grade11Players];
            if (grade === 12) playerNames = [...grade12Players];
            startAutoChampionship();
        }

        function startAutoChampionship() {
            resetGameState();
            gameState.totalRoundsNeeded = Math.ceil(playerNames.length / 2);
            
            document.getElementById('gameModes').style.display = 'none';
            document.getElementById('game-content').style.display = 'block';
            document.getElementById('gameProgress').style.display = 'block';
            document.getElementById('totalRoundsHeader').textContent = gameState.totalRoundsNeeded;

            shuffleTeams();
            buildAllRounds();
            
            document.getElementById('headerTeam1Name').textContent = gameState.team1.name;
            document.getElementById('headerTeam2Name').textContent = gameState.team2.name;
            updateHeaderScores();

            switchScreen('teamSetup');
            setTimeout(() => {
                selectPlayersForRound();
            }, 5000);
        }

        function shuffleTeams() {
            const academicTeams = ["The Void Voyagers 🚀", "The Quasar Questers ✨", "The Nebula Navigators 🌌", "The Celestial Challengers 🪐"];
            const shuffledTeams = academicTeams.sort(() => .5 - Math.random());
            gameState.team1 = { name: shuffledTeams[0], players: [] };
            gameState.team2 = { name: shuffledTeams[1], players: [] };
            
            const shuffledPlayers = [...playerNames].sort(() => .5 - Math.random());
            const mid = Math.ceil(shuffledPlayers.length / 2);
            gameState.team1.players = shuffledPlayers.slice(0, mid);
            gameState.team2.players = shuffledPlayers.slice(mid);
            
            document.getElementById('team1Name').innerHTML = gameState.team1.name;
            document.getElementById('team2Name').innerHTML = gameState.team2.name;
            document.getElementById('team1Members').innerHTML = gameState.team1.players.map(p => `<div class="team-member">${p}</div>`).join('');
            document.getElementById('team2Members').innerHTML = gameState.team2.players.map(p => `<div class="team-member">${p}</div>`).join('');
        }

        function buildAllRounds() {
            gameState.rounds = [];
            const allWords = [wordSet1, wordSet2, wordSet3, wordSet4, wordSet5, wordSet6].flat();
            
            let availableSets = {
                set1: [...wordSet1],
                set2: [...wordSet2],
                set3: [...wordSet3],
                set4: [...wordSet4],
                set5: [...wordSet5],
                set6: [...wordSet6]
            };
            
            const masterSets = {
                set1: [...wordSet1],
                set2: [...wordSet2],
                set3: [...wordSet3],
                set4: [...wordSet4],
                set5: [...wordSet5],
                set6: [...wordSet6]
            };

            for (let i = 0; i < gameState.totalRoundsNeeded; i++) {
                let roundWordData = [];
                
                // Replenish pools if they run low
                if(availableSets.set1.length < 2) availableSets.set1.push(...masterSets.set1.sort(() => 0.5 - Math.random()));
                if(availableSets.set2.length < 2) availableSets.set2.push(...masterSets.set2.sort(() => 0.5 - Math.random()));
                if(availableSets.set3.length < 2) availableSets.set3.push(...masterSets.set3.sort(() => 0.5 - Math.random()));
                if(availableSets.set4.length < 1) availableSets.set4.push(...masterSets.set4.sort(() => 0.5 - Math.random()));
                if(availableSets.set5.length < 2) availableSets.set5.push(...masterSets.set5.sort(() => 0.5 - Math.random()));
                if(availableSets.set6.length < 1) availableSets.set6.push(...masterSets.set6.sort(() => 0.5 - Math.random()));

                // Draw words from each set for a balanced round
                roundWordData.push(...availableSets.set1.splice(0, 2));
                roundWordData.push(...availableSets.set2.splice(0, 2));
                roundWordData.push(...availableSets.set3.splice(0, 2));
                roundWordData.push(...availableSets.set4.splice(0, 1));
                roundWordData.push(...availableSets.set5.splice(0, 2));
                roundWordData.push(...availableSets.set6.splice(0, 1));
                
                // Shuffle the final 10 questions for the round
                roundWordData.sort(() => 0.5 - Math.random());

                const roundQuestionsData = roundWordData.map(wordData => {
                    const correctAnswer = wordData.synonyms[Math.floor(Math.random() * wordData.synonyms.length)];
                    let distractorPool = allWords
                        .filter(item => item.word !== wordData.word)
                        .flatMap(item => item.synonyms);
                    distractorPool = [...new Set(distractorPool)];
                    distractorPool.sort(() => 0.5 - Math.random());
                    const distractors = distractorPool.slice(0, 2);
                    return { word: wordData.word, answer: correctAnswer, distractors: distractors };
                });
                gameState.rounds.push(roundQuestionsData);
            }
        }
        
        function selectPlayersForRound() {
            if (gameState.team1Queue.length === 0) gameState.team1Queue = [...gameState.team1.players].sort(() => .5 - Math.random());
            if (gameState.team2Queue.length === 0) gameState.team2Queue = [...gameState.team2.players].sort(() => .5 - Math.random());
            
            gameState.currentPlayer1 = gameState.team1Queue.pop();
            gameState.currentPlayer2 = gameState.team2Queue.pop();
            
            switchScreen('playerSelection');
            createDataStreamSelection();
        }

        function createDataStreamSelection() {
            document.getElementById('display1TeamName').textContent = gameState.team1.name;
            document.getElementById('display2TeamName').textContent = gameState.team2.name;

            const p1Display = document.getElementById('player1Display');
            const p2Display = document.getElementById('player2Display');
            
            p1Display.style.animation = 'text-flicker 0.1s infinite alternate';
            p2Display.style.animation = 'text-flicker 0.1s infinite alternate';

            const animateSelection = (displayEl, players, finalPlayer) => {
                let flickerInterval = setInterval(() => {
                    displayEl.textContent = players[Math.floor(Math.random() * players.length)];
                }, 75);

                setTimeout(() => {
                    clearInterval(flickerInterval);
                    displayEl.textContent = finalPlayer;
                    displayEl.style.animation = 'none'; // Stop flicker
                }, 3000);
            };

            animateSelection(p1Display, gameState.team1.players, gameState.currentPlayer1);
            animateSelection(p2Display, gameState.team2.players, gameState.currentPlayer2);
            
            startGameCountdown(); 
            
            setTimeout(() => {
                announcePlayers();
            }, 3000);
        }

        function announcePlayers() {
            const p1Name = gameState.currentPlayer1.split('/')[0].trim();
            const p2Name = gameState.currentPlayer2.split('/')[0].trim();

            playChineseAudio(p1Name, () => {
                playChineseAudio(p1Name, () => {
                    playChineseAudio(p2Name, () => {
                        playChineseAudio(p2Name);
                    });
                });
            });
        }
        
        function startGameCountdown() {
            let count = 10;
            const timerEl = document.getElementById('countdownTimer');
            timerEl.textContent = count;
            document.getElementById('selectionCountdown').style.display = 'block';

            const interval = setInterval(() => {
                count--;
                timerEl.textContent = count;
                if (count <= 0) { 
                    clearInterval(interval);
                    document.getElementById('selectionCountdown').style.display = 'none';
                    start10CardRound();
                }
            }, 1000);
        }
        
        function start10CardRound() {
            gameState.currentCard = 1;
            gameState.roundScore1 = 0;
            gameState.roundScore2 = 0;
            updateHeaderScores();
            switchScreen('gamePlay');
            playNextCard();
        }

        function playNextCard() {
             if (gameState.currentCard > 10) {
                 gameState.currentRound++;
                 if (gameState.currentRound > gameState.totalRoundsNeeded) {
                     alert("GAME OVER!"); // Placeholder for end game screen
                     return;
                 }
                 selectPlayersForRound();
                 return;
             }
            setupQuestionForCard();
            document.getElementById('currentCard').textContent = gameState.currentCard;
            document.getElementById('currentRoundDisplay').textContent = gameState.currentRound;
        }

        function setupQuestionForCard() {
            gameState.isRoundActive = true;
            const questionData = gameState.rounds[gameState.currentRound-1][gameState.currentCard-1];
            if (!questionData) return;
            gameState.currentQuestion = questionData;
            playEnglishAudio(questionData.word);

            document.getElementById('player1Name').textContent = gameState.currentPlayer1;
            document.getElementById('player2Name').textContent = gameState.currentPlayer2;
            document.getElementById('targetWord1').textContent = questionData.word;
            document.getElementById('targetWord2').textContent = questionData.word;
            
            document.getElementById('player1AnswerReveal').textContent = '';
            document.getElementById('player2AnswerReveal').textContent = '';
            
            setupAnswerButtons(1, questionData);
            setupAnswerButtons(2, questionData);
            startRoundTimer();
        }

        function setupAnswerButtons(playerNum, questionData) {
            const container = document.getElementById(`player${playerNum}Buttons`);
            container.innerHTML = '';
            let answers = [questionData.answer, ...questionData.distractors];
            answers.sort(() => 0.5 - Math.random());

            answers.forEach(ans => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = ans;
                btn.onclick = (event) => selectAnswer(playerNum, ans, event.target);
                container.appendChild(btn);
            });
        }
        
        function selectAnswer(playerNum, selectedAns, buttonElement) {
            if (!gameState.isRoundActive) return;
            gameState.isRoundActive = false;
            clearTimeout(gameState.roundTimer);

            triggerRocketPulse(buttonElement);
            const isCorrect = selectedAns === gameState.currentQuestion.answer;
            
            setTimeout(() => {
                buttonElement.classList.add(isCorrect ? 'correct' : 'incorrect');
                playSound(isCorrect ? 'correct' : 'incorrect');

                if(isCorrect) {
                    if(playerNum === 1) { gameState.team1Score++; gameState.roundScore1++; }
                    else { gameState.team2Score++; gameState.roundScore2++; }
                    createStardustEffect(playerNum);
                    triggerFlyingStars(buttonElement);
                    playEnglishAudio(praiseAudioPhrases[Math.floor(Math.random() * praiseAudioPhrases.length)]);
                } else {
                    if(playerNum === 1) { gameState.team2Score++; gameState.roundScore2++; }
                    else { gameState.team1Score++; gameState.roundScore1++; }
                    triggerAsteroidBurst(buttonElement);
                }
                updateHeaderScores();

                revealCorrectAnswers();
                setTimeout(() => {
                    gameState.currentCard++;
                    playNextCard();
                }, 2500);
            }, 600);
        }

        function revealCorrectAnswers() {
            const correctAnswer = gameState.currentQuestion.answer;
            document.getElementById('player1AnswerReveal').textContent = correctAnswer;
            document.getElementById('player2AnswerReveal').textContent = correctAnswer;
             for (let i = 1; i <= 2; i++) {
                const buttons = document.getElementById(`player${i}Buttons`).children;
                for (let btn of buttons) {
                    btn.onclick = null; 
                    if (btn.textContent === correctAnswer) {
                        btn.classList.add('correct');
                    }
                }
            }
        }
        
        function updateHeaderScores() {
             document.getElementById('headerTeam1Score').textContent = gameState.team1Score;
             document.getElementById('headerTeam2Score').textContent = gameState.team2Score;
             document.getElementById('team1RoundScore').textContent = gameState.roundScore1;
             document.getElementById('team2RoundScore').textContent = gameState.roundScore2;
        }

        function startRoundTimer() {
            clearTimeout(gameState.roundTimer);
            let timeLeft = 10;
            const timerDisp = document.getElementById('timerDisplay');
            const timerProg = document.getElementById('timerProgress');
            
            timerDisp.textContent = timeLeft;
            timerProg.style.width = '100%';

            gameState.roundTimer = setInterval(() => {
                timeLeft--;
                timerDisp.textContent = timeLeft;
                timerProg.style.width = `${(timeLeft / 10) * 100}%`;

                if (timeLeft <= 0) {
                    clearInterval(gameState.roundTimer);
                    gameState.isRoundActive = false;
                    playSound('incorrect');
                    revealCorrectAnswers();
                    setTimeout(() => {
                        gameState.currentCard++;
                        playNextCard();
                    }, 2500); 
                }
            }, 1000);
        }

        function createStardustEffect(playerNum) {
            const headerScoreEl = document.getElementById(`headerTeam${playerNum}Score`);
            const playerArea = document.getElementById(`team${playerNum}GameArea`).querySelector('.player-area');
            if (!headerScoreEl || !playerArea) return;

            const startRect = playerArea.getBoundingClientRect();
            const endRect = headerScoreEl.getBoundingClientRect();

            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'stardust-particle';
                
                const startX = startRect.left + startRect.width / 2 + (Math.random() - 0.5) * startRect.width;
                const startY = startRect.top + startRect.height / 2 + (Math.random() - 0.5) * startRect.height;
                const endX = endRect.left + endRect.width / 2;
                const endY = endRect.top + endRect.height / 2;

                particle.style.left = `${startX}px`;
                particle.style.top = `${startY}px`;
                
                particle.style.setProperty('--x-end', `${endX - startX}px`);
                particle.style.setProperty('--y-end', `${endY - startY}px`);
                particle.style.animationDelay = `${Math.random() * 0.3}s`;

                document.body.appendChild(particle);
                setTimeout(() => particle.remove(), 1300);
            }
        }
        
        function triggerFlyingStars(element) {
            const rect = element.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            for (let i = 0; i < 12; i++) {
                const star = document.createElement('div');
                star.className = 'star-particle';
                star.textContent = '✦';
                const angle = Math.random() * 2 * Math.PI;
                const distance = 80 + Math.random() * 50;
                star.style.setProperty('--dx', `${Math.cos(angle) * distance}px`);
                star.style.setProperty('--dy', `${Math.sin(angle) * distance}px`);
                star.style.left = `${centerX}px`;
                star.style.top = `${centerY}px`;
                document.body.appendChild(star);
                setTimeout(() => star.remove(), 1500);
            }
        }

        function triggerAsteroidBurst(element) {
            const rect = element.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            for (let i = 0; i < 10; i++) {
                const rock = document.createElement('div');
                rock.className = 'asteroid';
                const size = 6 + Math.random() * 8;
                rock.style.width = `${size}px`;
                rock.style.height = `${size}px`;
                const angle = Math.random() * 2 * Math.PI;
                const distance = 60 + Math.random() * 40;
                rock.style.setProperty('--dx', `${Math.cos(angle) * distance}px`);
                rock.style.setProperty('--dy', `${Math.sin(angle) * distance}px`);
                rock.style.left = `${centerX}px`;
                rock.style.top = `${centerY}px`;
                document.body.appendChild(rock);
                setTimeout(() => rock.remove(), 1000);
            }
        }

        function triggerRocketPulse(buttonEl) {
            buttonEl.classList.add('rocket-pulse');
            setTimeout(() => buttonEl.classList.remove('rocket-pulse'), 600);
        }

        function switchScreen(activeScreen) {
            ['teamSetup', 'playerSelection', 'gamePlay', 'gameModes'].forEach(id => {
                 const el = document.getElementById(id);
                 if (el) {
                    el.style.display = (id === activeScreen) ? 'block' : 'none';
                    if(id === 'gamePlay' && activeScreen === 'gamePlay') el.style.display = 'flex';
                 }
            });
        }

        window.addEventListener('load', () => {
            createStars();
            loadVoices();
            resetGameState();
            switchScreen('gameModes');
        });
    </script>
</body>
</html>
