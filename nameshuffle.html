<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grade Level Shuffler</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* --- TECH THEME SETUP --- */
    @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&display=swap');

    body {
      background-color: #050505;
      color: #e2e8f0;
      overflow: hidden;
      font-family: 'JetBrains Mono', monospace;
    }

    /* CRT Scanline Overlay */
    .scanlines {
      background: linear-gradient(
        to bottom,
        rgba(255,255,255,0),
        rgba(255,255,255,0) 50%,
        rgba(0,0,0,0.2) 50%,
        rgba(0,0,0,0.2)
      );
      background-size: 100% 4px;
      pointer-events: none;
      position: absolute;
      inset: 0;
      z-index: 50;
    }

    /* Glitch Animation Classes */
    .glitch-cyan { color: #06b6d4; text-shadow: 2px 0 #fff; }
    .glitch-magenta { color: #d946ef; text-shadow: -2px 0 #fff; }
    .glitch-lime { color: #84cc16; text-shadow: 2px 0 #000; }
    .glitch-yellow { color: #eab308; }

    .locked-in {
      animation: flashWhite 0.5s ease-out;
      background-color: rgba(34, 197, 94, 0.1);
      border-color: #22c55e;
    }

    @keyframes flashWhite {
      0% { background-color: #ffffff; color: #000; }
      100% { background-color: rgba(34, 197, 94, 0.1); color: #e2e8f0; }
    }

    /* Scrollbars */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #0f172a; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 3px; }

    /* Button Hover Glows */
    .btn-grade-10:hover { box-shadow: 0 0 20px #3b82f6; border-color: #60a5fa; }
    .btn-grade-11:hover { box-shadow: 0 0 20px #a855f7; border-color: #e879f9; }
    .btn-grade-12:hover { box-shadow: 0 0 20px #f97316; border-color: #fdba74; }

    .hidden-view { display: none !important; }
  </style>
</head>
<body class="h-screen w-screen relative">

  <!-- CRT Overlay -->
  <div class="scanlines"></div>

  <!-- VIEW 1: MAIN MENU -->
  <div id="menuView" class="absolute inset-0 flex flex-col items-center justify-center bg-[#050505] z-40 transition-opacity duration-500">
    <div class="text-center mb-12">
      <h1 class="text-6xl font-extrabold tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 animate-pulse">
        SYSTEM_SELECT
      </h1>
      <p class="text-slate-500 mt-2 tracking-[0.5em] text-sm">SECURE RANDOMIZATION PROTOCOL</p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 w-full max-w-5xl px-8">
      <!-- Grade 10 Button -->
      <button onclick="selectGrade('10')" class="btn-grade-10 group relative h-64 border border-slate-700 bg-slate-900/50 backdrop-blur rounded-xl flex flex-col items-center justify-center transition-all duration-300 hover:-translate-y-2">
        <div class="text-6xl font-bold text-blue-500 mb-4 group-hover:scale-110 transition-transform">10</div>
        <div class="text-slate-400 text-sm tracking-widest group-hover:text-blue-300">SOPHOMORE_DB</div>
        <div class="absolute bottom-4 text-[10px] text-slate-600">STATUS: READY</div>
      </button>

      <!-- Grade 11 Button -->
      <button onclick="selectGrade('11')" class="btn-grade-11 group relative h-64 border border-slate-700 bg-slate-900/50 backdrop-blur rounded-xl flex flex-col items-center justify-center transition-all duration-300 hover:-translate-y-2">
        <div class="text-6xl font-bold text-purple-500 mb-4 group-hover:scale-110 transition-transform">11</div>
        <div class="text-slate-400 text-sm tracking-widest group-hover:text-purple-300">JUNIOR_DB</div>
        <div class="absolute bottom-4 text-[10px] text-slate-600">STATUS: READY</div>
      </button>

      <!-- Grade 12 Button -->
      <button onclick="selectGrade('12')" class="btn-grade-12 group relative h-64 border border-slate-700 bg-slate-900/50 backdrop-blur rounded-xl flex flex-col items-center justify-center transition-all duration-300 hover:-translate-y-2">
        <div class="text-6xl font-bold text-orange-500 mb-4 group-hover:scale-110 transition-transform">12</div>
        <div class="text-slate-400 text-sm tracking-widest group-hover:text-orange-300">SENIOR_DB</div>
        <div class="absolute bottom-4 text-[10px] text-slate-600">STATUS: READY</div>
      </button>
    </div>
  </div>

  <!-- VIEW 2: SHUFFLE INTERFACE -->
  <div id="shuffleView" class="flex h-full w-full hidden-view opacity-0 transition-opacity duration-1000">
    
    <!-- LEFT PANEL: GRID -->
    <main class="w-3/4 h-full p-4 flex flex-col border-r border-slate-800 bg-slate-900/30 relative">
      <!-- Animated BG -->
      <div class="absolute inset-0 opacity-10 pointer-events-none" 
           style="background-image: radial-gradient(circle at 50% 50%, #1e293b 1px, transparent 1px); background-size: 30px 30px;">
      </div>

      <!-- Header -->
      <header class="mb-2 flex justify-between items-end border-b border-slate-700 pb-2 z-10 shrink-0">
        <div class="flex gap-4 items-center">
          <button onclick="returnToMenu()" class="text-xs text-slate-500 hover:text-white border border-slate-700 px-2 py-1 rounded transition-colors">
            &larr; BACK
          </button>
          <div>
            <h1 class="text-2xl font-bold text-white tracking-tight" id="gradeTitle">GRADE_X_DB</h1>
            <p class="text-slate-500 text-[10px] uppercase tracking-widest">
              Nodes: <span id="nodeCount" class="text-blue-400">0</span> // 
              Status: <span id="systemStatus" class="text-green-500">ONLINE</span>
            </p>
          </div>
        </div>
        <!-- Progress Bar -->
        <div class="w-1/3 flex flex-col items-end">
          <div class="w-full h-2 bg-slate-800 rounded-full overflow-hidden">
            <div id="progressBar" class="h-full bg-gradient-to-r from-blue-500 to-purple-500 w-0 transition-all duration-100 ease-linear"></div>
          </div>
          <span class="text-[10px] text-blue-400 mt-1 font-mono" id="timerText">0.00s</span>
        </div>
      </header>

      <!-- The Grid -->
      <!-- We use 'flex-1' to fill space, 'grid-flow-col' to list vertically then wrap -->
      <div id="gridContainer" class="grid grid-flow-col gap-x-8 gap-y-2 content-start flex-1 z-10 pr-2 pb-4">
        <!-- Cards go here -->
      </div>
    </main>

    <!-- RIGHT PANEL: CONTROLS -->
    <aside class="w-1/4 h-full bg-black flex flex-col relative z-20 shadow-2xl border-l border-slate-800">
      <div class="p-6 bg-slate-900 border-b border-slate-800 space-y-4 shrink-0">
        <div class="text-center mb-2">
          <div class="text-5xl mb-2 animate-bounce-slow">üé≤</div>
          <div class="text-[10px] text-slate-500 uppercase">Quantum Randomizer</div>
        </div>
        
        <button id="shuffleBtn" class="group relative w-full overflow-hidden rounded bg-indigo-600 px-8 py-5 transition-all hover:bg-indigo-500 active:scale-95 shadow-[0_0_20px_rgba(79,70,229,0.3)]">
          <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-20">
            <div class="h-20 w-20 translate-x-full rotate-45 bg-white transition-transform duration-1000 group-hover:-translate-x-full"></div>
          </div>
          <span class="relative text-lg font-bold text-white tracking-widest">INITIATE</span>
        </button>

        <button id="resetBtn" class="w-full py-3 text-slate-600 hover:text-red-400 text-xs font-mono border border-slate-800 rounded hover:border-red-900/50 transition-colors">
          > SYSTEM_RESET
        </button>
      </div>

      <!-- Terminal Log -->
      <div class="flex-1 flex flex-col min-h-0 p-2 bg-black">
        <div class="text-[10px] text-slate-500 mb-1 flex justify-between font-mono px-1">
          <span>> KERNEL_LOG</span>
          <span class="text-emerald-500 animate-pulse">‚óè</span>
        </div>
        <div id="log" class="flex-1 overflow-y-auto p-2 text-[10px] text-green-500/80 leading-snug font-mono bg-[#020202] rounded border border-slate-900 shadow-inner">
          <div>_System idling.</div>
        </div>
      </div>
    </aside>
  </div>

  <script>
    // --- DATA ---
    const dataSets = {
      '10': ["Dino", "Tracy", "Billie", "Jessie", "Von Tony", "Jim", "Andrew", "Mark", "Leo", "Apollo", "Jenny", "Tony", "Haowlin", "Lion", "Steven", "Mike"],
      '11': ["Grace", "Cathy", "Jim", "Jay", "Sandy", "Iris", "Jackie", "Max", "Emily", "Rhea", "Vicky"],
      '12': ["Anna", "Mia", "Kenn", "Max", "Sky", "Sheng", "Keying", "Zifan", "Sifei", "Jiaqi", "Zack", "Azure", "Joe"]
    };

    let activeGradeKey = '10';
    let currentNames = [];
    let isAnimating = false;
    const glitchChars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789#@&%$¬£‚Ç¨¬•";

    // --- AUDIO SYSTEM ---
    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();
    let masterGain;

    function initAudio() {
      if(masterGain) return;
      if (audioCtx.state === 'suspended') audioCtx.resume();
      masterGain = audioCtx.createGain();
      masterGain.connect(audioCtx.destination);
    }

    function playTone(freq, type, duration, vol=0.1) {
      initAudio();
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = type;
      osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
      osc.connect(gain);
      gain.connect(masterGain);
      gain.gain.setValueAtTime(vol, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
      osc.start();
      osc.stop(audioCtx.currentTime + duration);
    }

    function playSelectSound() {
      // Sci-fi "Lock-in" sound
      initAudio();
      const now = audioCtx.currentTime;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.type = 'sawtooth';
      osc.connect(gain);
      gain.connect(masterGain);
      
      osc.frequency.setValueAtTime(110, now);
      osc.frequency.linearRampToValueAtTime(880, now + 0.1);
      
      gain.gain.setValueAtTime(0.2, now);
      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.3);
      
      osc.start(now);
      osc.stop(now + 0.3);
    }

    function playShuffleSound(duration) {
      initAudio();
      const now = audioCtx.currentTime;
      
      // 1. Rumble Layer
      const oscLow = audioCtx.createOscillator();
      const gainLow = audioCtx.createGain();
      oscLow.type = 'square';
      oscLow.frequency.setValueAtTime(50, now);
      oscLow.frequency.linearRampToValueAtTime(200, now + duration);
      oscLow.connect(gainLow);
      gainLow.connect(masterGain);
      gainLow.gain.setValueAtTime(0.05, now);
      gainLow.gain.linearRampToValueAtTime(0, now + duration);
      oscLow.start(now);
      oscLow.stop(now + duration);

      // 2. High Data Layer (FM Synthesisish)
      const oscHigh = audioCtx.createOscillator();
      const gainHigh = audioCtx.createGain();
      oscHigh.type = 'sawtooth';
      oscHigh.frequency.setValueAtTime(800, now);
      oscHigh.frequency.linearRampToValueAtTime(2000, now + duration);
      
      // Tremolo
      const lfo = audioCtx.createOscillator();
      lfo.frequency.value = 20; // Fast flutter
      const lfoGain = audioCtx.createGain();
      lfoGain.gain.value = 0.5;
      lfo.connect(lfoGain.gain);
      
      oscHigh.connect(gainHigh);
      gainHigh.connect(masterGain);
      gainHigh.gain.setValueAtTime(0.02, now);
      
      oscHigh.start(now);
      oscHigh.stop(now + duration);
      lfo.start(now);
      lfo.stop(now + duration);
    }

    function playSuccessChord() {
      initAudio();
      const now = audioCtx.currentTime;
      const notes = [440, 554.37, 659.25, 880]; // A Major 7
      notes.forEach((freq, i) => {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'triangle';
        osc.frequency.value = freq;
        osc.connect(gain);
        gain.connect(masterGain);
        
        gain.gain.setValueAtTime(0, now);
        gain.gain.linearRampToValueAtTime(0.1, now + 0.05 + (i*0.05));
        gain.gain.exponentialRampToValueAtTime(0.001, now + 2);
        
        osc.start(now);
        osc.stop(now + 2);
      });
    }

    // --- LOGIC ---

    const logBox = document.getElementById('log');
    function log(msg) {
      const el = document.createElement('div');
      el.textContent = `> ${msg}`;
      logBox.appendChild(el);
      logBox.scrollTop = logBox.scrollHeight;
    }

    // Navigation
    function selectGrade(grade) {
      playSelectSound();
      activeGradeKey = grade;
      currentNames = [...dataSets[grade]];
      
      // Update UI Titles
      document.getElementById('gradeTitle').textContent = `GRADE ${grade} DATABASE`;
      document.getElementById('gradeTitle').className = `text-2xl font-bold tracking-tight ${grade==='10'?'text-blue-400':grade==='11'?'text-purple-400':'text-orange-400'}`;
      
      // Transition Views
      const menu = document.getElementById('menuView');
      const shuffle = document.getElementById('shuffleView');
      
      menu.style.opacity = '0';
      setTimeout(() => {
        menu.classList.add('hidden-view');
        shuffle.classList.remove('hidden-view');
        // Trigger reflow
        void shuffle.offsetWidth; 
        shuffle.style.opacity = '1';
        renderList(currentNames);
        log(`Loaded Grade ${grade} DB. ${currentNames.length} Records.`);
      }, 500);
    }

    function returnToMenu() {
      if(isAnimating) return;
      const menu = document.getElementById('menuView');
      const shuffle = document.getElementById('shuffleView');
      
      shuffle.style.opacity = '0';
      setTimeout(() => {
        shuffle.classList.add('hidden-view');
        menu.classList.remove('hidden-view');
        void menu.offsetWidth;
        menu.style.opacity = '1';
        log("Returned to Main Menu.");
      }, 500);
    }

    // Rendering
    const container = document.getElementById('gridContainer');
    
    function renderList(names) {
      container.innerHTML = '';
      document.getElementById('nodeCount').textContent = names.length;

      // --- DYNAMIC GRID ROW CALCULATION ---
      // This forces the grid to fill vertically first (column flow) but limits rows to fit 2 columns
      const rowCount = Math.ceil(names.length / 2);
      container.style.gridTemplateRows = `repeat(${rowCount}, minmax(0, 1fr))`;
      
      names.forEach((name, index) => {
        const el = document.createElement('div');
        // Reduced height to h-12 (3rem) for compactness
        el.className = `
          relative flex items-center bg-slate-800/60 rounded-r-lg border-l-4 
          ${activeGradeKey==='10'?'border-blue-500':activeGradeKey==='11'?'border-purple-500':'border-orange-500'}
          overflow-hidden group backdrop-blur-md h-12 transition-all shadow-md
        `;
        
        // Random tech ID
        const techID = Math.floor(Math.random()*9000) + 1000;
        
        el.innerHTML = `
          <div class="w-10 h-full bg-slate-900/80 flex items-center justify-center border-r border-white/10">
            <span class="text-lg font-bold text-slate-500 font-mono">${index + 1}</span>
          </div>
          <div class="flex-1 px-3 flex items-center justify-between">
            <span class="name-text text-xl font-bold text-slate-100 tracking-wide uppercase truncate">${name}</span>
            <div class="flex flex-col items-end">
               <span class="text-[8px] font-mono text-slate-500">ID-${techID}</span>
               <div class="h-0.5 w-6 bg-slate-700 rounded-full mt-1 overflow-hidden">
                 <div class="h-full bg-slate-500 w-[${Math.random()*100}%]"></div>
               </div>
            </div>
          </div>
        `;
        container.appendChild(el);
      });
    }

    // Shuffle Logic
    async function runShuffle() {
      if (isAnimating) return;
      isAnimating = true;
      const statusEl = document.getElementById('systemStatus');
      statusEl.textContent = "ENCRYPTING...";
      statusEl.className = "text-yellow-400 animate-pulse";
      
      // Sound
      playShuffleSound(4.0);
      
      // Algorithm
      log("Initializing CSPRNG Shuffle...");
      const target = [...currentNames];
      for (let i = target.length - 1; i > 0; i--) {
        const buf = new Uint32Array(1);
        window.crypto.getRandomValues(buf);
        const j = buf[0] % (i + 1);
        [target[i], target[j]] = [target[j], target[i]];
      }

      // Animation
      const DURATION = 4000;
      const startTime = Date.now();
      const nameEls = Array.from(document.querySelectorAll('.name-text'));
      const progressBar = document.getElementById('progressBar');
      const timerText = document.getElementById('timerText');
      
      // Colors for glitch
      const glitchClasses = ['glitch-cyan', 'glitch-magenta', 'glitch-lime', 'glitch-yellow'];

      return new Promise(resolve => {
        const interval = setInterval(() => {
          const elapsed = Date.now() - startTime;
          const progress = Math.min(elapsed / DURATION, 1);
          
          progressBar.style.width = `${progress * 100}%`;
          timerText.textContent = `${(elapsed/1000).toFixed(2)}s`;

          if (elapsed < DURATION) {
            nameEls.forEach(el => {
              // 30% chance to glitch
              if (Math.random() > 0.7) {
                 el.className = `name-text text-xl font-bold tracking-wide uppercase truncate ${glitchClasses[Math.floor(Math.random()*4)]}`;
                 // Random text
                 let s = "";
                 for(let k=0; k<6; k++) s+= glitchChars[Math.floor(Math.random()*glitchChars.length)];
                 el.textContent = s;
              } else {
                 el.className = "name-text text-xl font-bold text-slate-100 tracking-wide uppercase truncate";
              }
            });
          } else {
            clearInterval(interval);
            currentNames = target;
            nameEls.forEach((el, index) => {
              el.textContent = currentNames[index];
              el.className = "name-text text-xl font-bold text-slate-100 tracking-wide uppercase truncate";
              // Flash green
              const parent = el.closest('div').parentElement;
              parent.classList.add('locked-in');
              setTimeout(() => parent.classList.remove('locked-in'), 800);
            });
            
            playSuccessChord();
            statusEl.textContent = "ONLINE";
            statusEl.className = "text-green-500";
            log("Sequence Complete.");
            isAnimating = false;
            resolve();
          }
        }, 50);
      });
    }

    // Listeners
    document.getElementById('shuffleBtn').addEventListener('click', runShuffle);
    document.getElementById('resetBtn').addEventListener('click', () => {
      if(isAnimating) return;
      currentNames = [...dataSets[activeGradeKey]];
      renderList(currentNames);
      document.getElementById('progressBar').style.width = '0%';
      document.getElementById('timerText').textContent = '0.00s';
      log("Data reset to default.");
    });

  </script>
</body>
</html>
