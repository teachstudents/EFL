<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Joel's Speaking Practice 13</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        body {
            font-family: 'Inter', sans-serif;
            height: 100vh;
            overflow: hidden; /* Prevent body from scrolling */
            position: relative;
        }
        /* Snowfall effect */
        .snowflake {
            color: #fff;
            font-size: 1em;
            font-family: Arial, sans-serif;
            text-shadow: 0 0 5px #000;
            position: fixed;
            top: -10%;
            z-index: 0;
            user-select: none;
            animation: snowfall linear infinite;
        }

        @keyframes snowfall {
            0% { transform: translateY(0) rotate(0deg); }
            100% { transform: translateY(105vh) rotate(360deg); opacity: 0; }
        }
        .timer-circle {
            stroke-dasharray: 283;
            stroke-dashoffset: 0;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
            transition: stroke-dashoffset 1s linear;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(239, 68, 68, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .recording-indicator {
            animation: pulse 1.5s infinite;
        }
        .app-shell {
            display: flex;
            flex-direction: column;
            height: 100%;
            max-height: 100vh;
        }
        audio::-webkit-media-controls-panel {
            padding: 5px;
        }
        audio::-webkit-media-controls-play-button,
        audio::-webkit-media-controls-timeline,
        audio::-webkit-media-controls-current-time-display,
        audio::-webkit-media-controls-time-remaining-display {
            margin: 0 2px;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #4f46e5;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Make sure app content is above the snow */
        #app-container {
            position: relative;
            z-index: 10;
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 flex items-center justify-center p-2 sm:p-4">
    
    <div id="snow-container"></div>

    <button id="theme-toggle" type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 fixed top-4 right-4 z-50">
        <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
        <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-.707 10.607a1 1 0 010-1.414l.707-.707a1 1 0 111.414 1.414l-.707-.707a1 1 0 01-1.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707z"></path></svg>
    </button>

    <div id="app-container" class="w-full max-w-xl mx-auto text-center h-full">
        
        <!-- Welcome Screen -->
        <div id="welcome-screen" class="bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-lg h-full flex flex-col justify-center">
            <div id="name-entry-container">
                <h1 class="text-3xl font-bold text-indigo-600 dark:text-indigo-400 mb-4">Joel's Speaking Practice 13</h1>
                <input type="text" id="name-input" placeholder="Your Name" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4 text-center text-lg text-gray-900 bg-white dark:bg-gray-700 dark:text-white dark:border-gray-600">
                <button id="start-with-name-btn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-6 rounded-lg text-xl shadow-md">Start</button>
            </div>
            <div id="topic-selection-container" class="hidden">
                 <h1 class="text-3xl font-bold text-indigo-600 dark:text-indigo-400 mb-2">Hello, <span id="user-name-display"></span>!</h1>
                 <div id="instructions" class="text-sm text-gray-600 dark:text-gray-400 mb-4 text-left space-y-2 p-3 bg-gray-50 dark:bg-gray-700/50 rounded-lg">
                     <p><i class="fas fa-bullhorn mr-2 text-indigo-500"></i>Try to speak until the time runs out. You can use the sentence starters and word bank for help.</p>
                     <p><i class="fas fa-download mr-2 text-blue-500"></i>After recording, download your answer and upload it. If the upload doesn't work, save the downloaded files.</p>
                     <p><i class="fas fa-award mr-2 text-yellow-500"></i>You must complete all 9 topics to get the Certificate of Completion as proof you finished the homework.</p>
                 </div>
                <div id="topic-selection" class="grid grid-cols-3 gap-4">
                    <!-- Topic buttons will be injected here -->
                </div>
            </div>
        </div>

        <!-- Main Practice Screen -->
        <div id="practice-screen" class="hidden bg-white dark:bg-gray-800 rounded-2xl shadow-lg app-shell p-3 sm:p-4">
            <header class="flex-shrink-0">
                <div class="flex justify-between items-center mb-1">
                    <button id="back-to-topics-btn" class="text-indigo-500 hover:text-indigo-700"><i class="fas fa-arrow-left mr-2"></i>Topics</button>
                </div>
                <!-- Timer Display -->
                <div class="relative w-20 h-20 sm:w-24 sm:h-24 mx-auto mb-2 flex-shrink-0">
                    <svg class="w-full h-full" viewBox="0 0 100 100">
                        <circle class="text-gray-200 dark:text-gray-700" stroke-width="10" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50" />
                        <circle id="timer-progress" class="timer-circle text-indigo-500" stroke-width="10" stroke-linecap="round" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50" />
                    </svg>
                    <div id="timer-display" class="absolute inset-0 flex items-center justify-center text-2xl font-bold"></div>
                </div>
                <p id="phase-indicator" class="font-semibold text-indigo-500 dark:text-indigo-400 mb-2 text-base flex-shrink-0"></p>

                <!-- Question Display -->
                <div id="question-container" class="min-h-[50px] flex items-center justify-center mb-2">
                    <h2 id="question-text" class="text-base sm:text-lg font-semibold leading-relaxed text-left w-full"></h2>
                </div>
                
                <div id="error-message-box" class="hidden text-red-500 bg-red-100 dark:bg-red-900/50 p-2 rounded-lg text-sm mb-2"></div>

                <!-- Recording Action Buttons -->
                <div id="recording-actions-container" class="flex flex-col items-center justify-center mb-2">
                    <!-- Initial Record Button -->
                    <button id="record-btn" class="bg-red-600 hover:bg-red-700 text-white font-bold w-14 h-14 rounded-full text-xl shadow-md transition-transform transform hover:scale-105 flex items-center justify-center">
                        <i class="fas fa-microphone"></i>
                    </button>
                    <!-- Stop Button -->
                    <button id="stop-record-btn" class="hidden bg-gray-700 hover:bg-gray-800 text-white font-bold w-14 h-14 rounded-full text-xl shadow-md flex items-center justify-center">
                        <i class="fas fa-stop"></i>
                    </button>
                    <!-- Post-Recording Controls -->
                    <div id="post-recording-actions" class="hidden w-full flex-col items-center justify-center space-y-2 mt-2">
                        <audio id="audio-player" controls class="w-full max-w-xs"></audio>
                        <div class="flex items-center justify-center space-x-2 w-full max-w-xs">
                             <button id="download-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-3 rounded-lg text-xs shadow-md transition-colors">
                                 <i class="fas fa-download mr-1"></i>Download
                             </button>
                            <a href="https://xichengacademy-my.sharepoint.com/:f:/g/personal/joelmitchell_xichengacademy_cn/EjxMFg8-baNEo5uuWUBc4EoBzn1DVWJ1Ym_NFx6hPlJ0dQ" target="_blank" class="flex-1 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-3 rounded-lg text-xs shadow-md">
                                 <i class="fas fa-upload mr-1"></i>Upload
                             </a>
                        </div>
                    </div>
                </div>
                 <div id="recording-status" class="hidden items-center justify-center text-red-500 font-semibold mb-1">
                     <div class="w-2 h-2 bg-red-500 rounded-full mr-2 recording-indicator"></div>
                     Recording...
                 </div>
            </header>
            
            <main class="flex-grow flex flex-col overflow-y-auto min-h-0 space-y-2 pt-2">
                 <!-- Sentence Starters -->
                <div id="starters-container" class="hidden text-left">
                    <h3 class="text-sm font-bold mb-1 text-center">Sentence Starters</h3>
                    <div id="starters-list" class="flex flex-wrap gap-2 justify-center bg-gray-50 dark:bg-gray-700/50 p-2 rounded-lg">
                        <!-- Buttons will be injected here -->
                    </div>
                </div>

                <!-- Word Bank -->
                <div id="word-bank-container" class="hidden text-left">
                    <h3 class="text-sm font-bold mb-1 text-center">Word Bank</h3>
                    <div id="word-bank-list" class="flex flex-wrap gap-2 justify-center bg-gray-50 dark:bg-gray-700/50 p-2 rounded-lg">
                        <!-- Buttons will be injected here -->
                    </div>
                </div>

                <!-- Sample Answers Display -->
                <div id="samples-container" class="hidden text-left">
                    <h3 class="text-sm font-bold mb-1 text-center flex-shrink-0">Sample Responses</h3>
                    <ul id="samples-list" class="space-y-2 list-disc list-inside bg-indigo-900/70 dark:bg-indigo-900/90 p-3 rounded-lg max-h-28 sm:max-h-32 overflow-y-auto">
                    </ul>
                </div>
            </main>

            <footer class="flex-shrink-0 mt-2">
                <!-- Next Button -->
                <div id="controls-container">
                     <button id="next-btn" class="hidden w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg text-lg shadow-md">Next</button>
                </div>
            </footer>
        </div>

        <!-- Certificate Screen -->
        <div id="certificate-screen" class="hidden bg-white dark:bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-lg h-full flex flex-col justify-center items-center">
            <div id="certificate-to-download" class="w-full bg-gray-50 dark:bg-gray-700 p-8 rounded-lg border-4 border-yellow-400 dark:border-yellow-500 text-center">
                <i class="fas fa-award text-6xl text-yellow-500 mb-4"></i>
                <h1 class="text-3xl font-bold text-gray-800 dark:text-white">Certificate of Completion</h1>
                <p class="text-lg mt-2 text-gray-600 dark:text-gray-300">This certificate is awarded to</p>
                <p id="certificate-name" class="text-4xl font-bold my-4 text-indigo-600 dark:text-indigo-400"></p>
                <p class="text-lg mt-2 text-gray-600 dark:text-gray-300">for successfully completing all 9 speaking practice topics.</p>
                <p class="text-sm mt-6 text-gray-500 dark:text-gray-400">Issued on: <span id="certificate-date"></span></p>
            </div>
            <button id="download-certificate-btn" class="mt-6 w-full max-w-xs bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-lg text-xl shadow-md">
                <i class="fas fa-download mr-2"></i>Download Certificate
            </button>
             <button id="back-to-main-menu-btn" class="mt-3 text-sm text-indigo-500 hover:underline">Back to Main Menu</button>
        </div>

    </div>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- DATA: Questions and Sample Answers for Part 13 ---
        const practiceData = {
            "Polite Requests": [
                {
                    question: "Scenario: You are in a quiet library and someone nearby is talking loudly on their phone. How would you politely ask them to be quiet?",
                    starters: ["Excuse me, I'm sorry to bother you, but...", "I was wondering if you would mind...", "Pardon me, but would it be possible to...", "I know you may not realize, but..."],
                    wordBank: ["a little quieter", "take your call outside", "this is a quiet area", "I'm trying to study", "would you mind", "I'd appreciate it"],
                    samples: [
                        "Excuse me, I'm sorry to bother you, but I'm trying to study and your conversation is a bit loud. Would you mind taking your call outside?",
                        "Pardon me, I was wondering if you would mind being a little quieter? This is a designated quiet area of the library.",
                        "I know you may not realize it, but your voice is carrying. I'd really appreciate it if you could lower your voice or step into the hallway."
                    ]
                },
                {
                    question: "Scenario: You are on a crowded bus and an elderly person gets on. There are no empty seats. How would you ask a young person sitting down to give up their seat?",
                    starters: ["Excuse me, would you mind...", "Pardon me, I see you're sitting, but...", "Would it be possible for...", "This person seems to need..."],
                    wordBank: ["offer your seat", "needs this seat more", "give up your seat", "let this person sit", "elderly person", "looks tired"],
                    samples: [
                        "Excuse me, I see this elderly person doesn't have a seat. Would you mind letting them sit here? I'm sure they would be very grateful.",
                        "Pardon me, but would you consider offering your seat to this older gentleman? It looks like he is having trouble standing.",
                        "Excuse me, would it be possible for this person to have your seat? The bus is very crowded and it's difficult for them to stand."
                    ]
                }
            ],
            "Giving Directions": [
                {
                    question: "Scenario: A tourist stops you on the street and asks for directions to the nearest subway station. Explain how to get there.",
                    starters: ["Of course, the subway station is not far.", "You'll want to go down this street and...", "Keep going straight for about...", "When you see the..., turn..."],
                    wordBank: ["go straight", "turn left", "turn right", "at the traffic lights", "on the corner", "it's about a 5-minute walk", "you can't miss it", "across from"],
                    samples: [
                        "Sure. You just need to go straight down this street for about two blocks. When you see a big bank on the corner, turn right, and the station entrance will be right there.",
                        "The easiest way is to walk straight ahead until you get to the next big intersection with traffic lights. Turn left there, and you will see the subway sign about 50 meters ahead.",
                        "It's very close. Just keep walking in this direction. You will pass a post office on your left. The station is right across the street from the post office. You can't miss it."
                    ]
                },
                {
                    question: "Scenario: A new classmate wants to know where the school cafeteria is. Give them clear directions from your current classroom.",
                    starters: ["Sure, it's easy to find.", "From this classroom, you just need to...", "Go out this door and turn...", "When you get to the main hall..."],
                    wordBank: ["go down the stairs", "at the end of the hallway", "on the first floor", "it's a big open room", "next to the gym", "follow the signs", "main building"],
                    samples: [
                        "From our classroom, just turn right and go all the way to the end of this hallway. Then, go down the main staircase to the first floor. The cafeteria is the big noisy room on your left.",
                        "It's on the ground floor. Go out of this room, turn left, and walk until you see the library. The cafeteria is right next to the library.",
                        "You just need to go down these stairs. When you get to the bottom, walk straight through the main hall, and the cafeteria is the last door on the right."
                    ]
                }
            ],
            "Making an Apology": [
                {
                    question: "Scenario: You are 15 minutes late to meet your friend at a cafe. Apologize and explain why you are late.",
                    starters: ["I am so sorry I'm late.", "I really apologize for keeping you waiting.", "There was some unexpected...", "I completely lost track of time because..."],
                    wordBank: ["the traffic was terrible", "my bus was delayed", "I missed my alarm", "I hope you weren't waiting long", "it won't happen again", "I feel really bad"],
                    samples: [
                        "I am so sorry I'm late. The traffic on my way here was much worse than I expected. Have you been waiting long?",
                        "I really apologize for being late. I was finishing up some homework and completely lost track of time. It's totally my fault.",
                        "I'm so sorry for keeping you waiting. My subway line had a temporary delay, and we were stopped for about 10 minutes. I should have messaged you sooner."
                    ]
                },
                {
                    question: "Scenario: You accidentally spilled a drink on a stranger's bag in a crowded place. Apologize and offer to help.",
                    starters: ["Oh my gosh, I am so sorry!", "I'm so terribly sorry, that was completely my fault.", "Please let me help you clean that up.", "Is there anything I can do?"],
                    wordBank: ["so clumsy of me", "completely my fault", "let me get you some napkins", "can I buy you a new one?", "I wasn't paying attention", "are you okay?"],
                    samples: [
                        "Oh, I am so sorry! That was so clumsy of me. Here, let me get you some napkins to clean that up. Is there anything inside your bag that might be damaged?",
                        "I am so terribly sorry, I wasn't looking where I was going. Please, let me help. Is it okay? I feel awful about this.",
                        "That was completely my fault, I apologize. Can I buy you a coffee to make up for it? I would also be happy to pay for cleaning if the bag is stained."
                    ]
                }
            ],
            "Expressing an Opinion": [
                {
                    question: "Scenario: Your friends are debating whether online classes are better than in-person classes. What is your opinion and why?",
                    starters: ["That's an interesting debate. In my opinion...", "I can see both sides, but I personally think...", "From my perspective, ... is better because...", "I have to disagree, I believe that..."],
                    wordBank: ["flexibility", "self-discipline", "interaction", "social aspect", "more engaging", "convenient", "focus", "pros and cons"],
                    samples: [
                        "In my opinion, in-person classes are much better because I find it easier to focus and ask questions when the teacher is right there in the room with you.",
                        "I can see both sides. Online classes offer more flexibility with your schedule, but you miss out on the social aspect of being with your classmates.",
                        "From my perspective, it really depends on the subject. For a lecture-based class, online can be very efficient. But for a lab or a discussion-based class, in-person is necessary."
                    ]
                },
                {
                    question: "Scenario: Your teacher asks the class if they think schools should give less homework. What would you say?",
                    starters: ["I believe schools should give less homework because...", "On one hand, homework is important for practice, but...", "In my view, the amount of homework is...", "I think the focus should be on the quality, not the quantity..."],
                    wordBank: ["too much pressure", "not enough time", "mental health", "quality over quantity", "busy work", "reinforce learning", "time for hobbies", "balanced"],
                    samples: [
                        "I believe schools should give less homework because students already spend a long day at school. They need time in the evening to rest, pursue hobbies, and spend time with family.",
                        "In my view, the focus should be on the quality of the homework, not the quantity. One meaningful assignment is better than three hours of repetitive busy work.",
                        "On one hand, some homework is necessary to reinforce what we learn in class. But I think the current amount is too much and causes a lot of stress for students."
                    ]
                }
            ],
            "Social Situations": [
                {
                    question: "Scenario: You are at a party where you don't know anyone except the host, who is busy. How would you start a conversation with someone?",
                    starters: ["Hi, I'm [Your Name]. How do you know [Host's Name]?", "This is a great party. I'm [Your Name], by the way.", "I really like your shirt. My name is...", "Excuse me, is this seat taken?"],
                    wordBank: ["start a conversation", "introduce myself", "ask a question", "find a common interest", "friendly", "approachable", "compliment"],
                    samples: [
                        "I would probably go up to a small group of people, wait for a pause in their conversation, and then say, 'Hi, sorry to interrupt. I'm a friend of the host. My name is [Your Name].'",
                        "I might start by asking a simple question related to the situation, like 'This music is great, do you know who the artist is?' and then introduce myself.",
                        "I would look for someone else who also seems to be standing alone and say something like, 'Hi, I'm [Your Name]. This is a great party, but I don't know many people here. How do you know the host?'"
                    ]
                },
                {
                    question: "Scenario: A friend is telling you about a problem they are having. What would you say to show you are listening and that you care?",
                    starters: ["That sounds really difficult. I'm sorry you're going through that.", "Wow, that's a lot to deal with.", "I'm here for you if you need to talk.", "What can I do to help?"],
                    wordBank: ["empathy", "supportive", "good listener", "I understand", "that must be tough", "I'm here for you", "offer help", "active listening"],
                    samples: [
                        "While they are talking, I would nod and use small phrases like 'I see' or 'That makes sense' to show I am actively listening.",
                        "After they finish, I would say something like, 'That sounds really stressful. Thank you for telling me. Is there anything I can do to help?'",
                        "I would try to show empathy by saying, 'I can understand why you would feel that way. That must be really tough to deal with. I'm always here if you need to vent.'"
                    ]
                }
            ],
            "At the Store": [
                {
                    question: "Scenario: You are in a clothing store and you can't find your size. How would you ask a shop assistant for help?",
                    starters: ["Excuse me, I was wondering if you could help me.", "Pardon me, do you work here?", "I really like this shirt, but I can't find it in...", "Could you please check if you have this in a size...?"],
                    wordBank: ["size medium", "in the back", "in stock", "another color", "fitting room", "shop assistant", "could you help me?"],
                    samples: [
                        "Excuse me, I really like this jacket, but I can't seem to find it in a size large. Could you please check if you have any more in the back?",
                        "Pardon me, I'm looking for these trousers in a smaller size. Do you know if you have any more in stock?",
                        "Excuse me, could you help me for a moment? I was wondering if this sweater comes in any other colors besides blue."
                    ]
                },
                {
                    question: "Scenario: You bought an electronic device yesterday, but it doesn't work. Explain the problem to the store manager and ask for a refund.",
                    starters: ["Hello, I bought this... here yesterday.", "Unfortunately, it doesn't seem to be working properly.", "The problem is that it won't...", "I would like to return it for a full refund, please."],
                    wordBank: ["defective", "doesn't turn on", "something is wrong", "receipt", "exchange", "refund", "customer service", "manager"],
                    samples: [
                        "Hello, I bought these headphones here yesterday, and I have the receipt. Unfortunately, they seem to be defective because the sound only comes out of one side.",
                        "I would like to return this electronic dictionary. I charged it all night, but the screen won't turn on at all. I think the battery is broken.",
                        "Excuse me, I'd like to speak to a manager. I purchased this device yesterday, but it's not working correctly. I have followed all the instructions, so I believe it is faulty and I would like a full refund."
                    ]
                }
            ],
            "At a Restaurant": [
                {
                    question: "Scenario: You are in a restaurant and you are ready to order your food. How do you get the waiter's attention and place your order?",
                    starters: ["Excuse me, we're ready to order.", "Pardon me, could we order please?", "When you have a moment, we'd like to order.", "I think I'll have the..."],
                    wordBank: ["get their attention", "make eye contact", "raise my hand slightly", "I would like...", "Could I please have...", "For my main course..."],
                    samples: [
                        "First, I would try to make eye contact with the waiter. If that doesn't work, I would raise my hand slightly and say, 'Excuse me, we're ready to order when you have a chance.'",
                        "When the waiter comes, I would say, 'Hello, I think we're ready. Could I please have the beef noodles, and a glass of water?'",
                        "I would politely say, 'Pardon me.' Once they come to the table, I'd say 'I'll start with the spring rolls, and for my main course, I'd like the Kung Pao chicken.'"
                    ]
                },
                {
                    question: "Scenario: The food you ordered is not what you expected (e.g., it's too cold or too spicy). How would you politely complain to the waiter?",
                    starters: ["Excuse me, I'm sorry to say this, but...", "Pardon me, there seems to be a small problem with my dish.", "I believe I may have ordered the..., but this seems to be...", "This isn't quite what I expected..."],
                    wordBank: ["a bit cold", "too salty", "undercooked", "not what I ordered", "is it possible to...", "I would appreciate it if...", "polite complaint"],
                    samples: [
                        "Excuse me, I'm sorry to bother you, but my soup is a little cold. Would it be possible to heat it up a bit?",
                        "Pardon me, but I think this might be a little too spicy for me. I didn't realize it would be this hot. Is there anything that can be done?",
                        "Excuse me, I believe I ordered the chicken, but this appears to be fish. I think there might have been a mistake in the kitchen."
                    ]
                }
            ],
            "Making Plans": [
                {
                    question: "Scenario: You want to invite a friend to see a movie on the weekend. How would you ask them and suggest a time?",
                    starters: ["Hey, are you free on Saturday?", "I was wondering if you'd like to see a movie with me this weekend.", "There's a new movie out called... Would you be interested?", "What time works best for you?"],
                    wordBank: ["are you busy", "would you like to", "what about", "how about", "we could go", "let me know", "sounds fun"],
                    samples: [
                        "Hey, there's a new sci-fi movie I really want to see. Would you be interested in going with me this Saturday? Maybe in the afternoon?",
                        "I was wondering if you have any plans this weekend. If not, would you like to go to the movies? I'm free on either Saturday or Sunday.",
                        "Hey, are you busy on Sunday evening? There's a movie I'd like to see. We could go to the 7 PM show if that works for you."
                    ]
                },
                {
                    question: "Scenario: A friend invites you to a party, but you are not feeling well. How would you politely decline their invitation?",
                    starters: ["Thank you so much for inviting me, but...", "That sounds really fun, but I don't think I can make it.", "I would love to, but unfortunately...", "I'm not feeling very well, so..."],
                    wordBank: ["I'm not feeling well", "I need to rest", "I'm sorry to miss it", "have fun without me", "maybe next time", "I appreciate the invitation"],
                    samples: [
                        "That sounds like so much fun, thank you for the invitation! Unfortunately, I'm not feeling very well today, so I think I need to stay home and rest.",
                        "I would love to come, but I've been feeling a bit sick since this morning. I'm so sorry to miss it, but I hope you all have a great time!",
                        "Thank you for thinking of me! I don't think I can make it tonight. I have a bit of a headache and I need to get some rest. Let's hang out soon, though."
                    ]
                }
            ],
            "Asking for a Favor": [
                {
                    question: "Scenario: You missed a class yesterday. How would you ask a classmate if you could borrow their notes?",
                    starters: ["Hi, I'm sorry to bother you. I missed class yesterday...", "I was wondering if I could possibly...", "Would you mind if I...", "It would be a huge help if..."],
                    wordBank: ["borrow your notes", "take a picture", "get the notes", "I would really appreciate it", "a huge help", "I missed the lecture"],
                    samples: [
                        "Hi there. I wasn't in our history class yesterday and I'm a bit worried about falling behind. I was wondering if I could possibly borrow your notes just to see what I missed?",
                        "Excuse me, since I was sick yesterday, I missed the physics lecture. Would you mind if I took a quick picture of your notes? I would really appreciate it.",
                        "Hi, you're in my math class, right? I had to miss it yesterday. It would be a huge help if I could look at your notes for a few minutes. I can give them right back."
                    ]
                },
                {
                    question: "Scenario: You need to move a heavy piece of furniture in your room. How would you ask a friend or family member for help?",
                    starters: ["Hey, I have a quick favor to ask.", "Are you busy right now? I could really use your help with something.", "I'm trying to move my..., and I can't do it alone.", "Would you mind giving me a hand for a minute?"],
                    wordBank: ["give me a hand", "I can't lift it by myself", "it will only take a minute", "I need your help", "heavy", "furniture", "I'd really appreciate it"],
                    samples: [
                        "Hey Dad, are you free for a second? I'm trying to move my bookshelf, but it's too heavy for me to lift by myself. Would you mind giving me a hand?",
                        "Hi, are you busy? I could really use your help for just a minute. I need to move my desk to the other side of the room and I can't do it alone.",
                        "I have a quick favor to ask. Would you be able to help me move a heavy box? It should only take a couple of minutes, and I'd really appreciate your help."
                    ]
                }
            ]
        };


        // --- DOM Elements ---
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
        const welcomeScreen = document.getElementById('welcome-screen');
        const practiceScreen = document.getElementById('practice-screen');
        const nameEntryContainer = document.getElementById('name-entry-container');
        const nameInput = document.getElementById('name-input');
        const startWithNameBtn = document.getElementById('start-with-name-btn');
        const topicSelectionContainer = document.getElementById('topic-selection-container');
        const userNameDisplay = document.getElementById('user-name-display');
        const topicSelection = document.getElementById('topic-selection');
        const nextBtn = document.getElementById('next-btn');
        const backToTopicsBtn = document.getElementById('back-to-topics-btn');
        
        const timerDisplay = document.getElementById('timer-display');
        const timerProgress = document.getElementById('timer-progress');
        const phaseIndicator = document.getElementById('phase-indicator');
        
        const questionContainer = document.getElementById('question-container');
        const questionText = document.getElementById('question-text');
        const samplesContainer = document.getElementById('samples-container');
        const samplesList = document.getElementById('samples-list');
        const startersContainer = document.getElementById('starters-container');
        const startersList = document.getElementById('starters-list');
        const wordBankContainer = document.getElementById('word-bank-container');
        const wordBankList = document.getElementById('word-bank-list');
        const errorMessagebox = document.getElementById('error-message-box');

        const recordBtn = document.getElementById('record-btn');
        const stopRecordBtn = document.getElementById('stop-record-btn');
        const audioPlayer = document.getElementById('audio-player');
        const recordingStatus = document.getElementById('recording-status');
        const postRecordingActions = document.getElementById('post-recording-actions');
        const downloadBtn = document.getElementById('download-btn');
        
        // Certificate UI
        const certificateScreen = document.getElementById('certificate-screen');
        const downloadCertificateBtn = document.getElementById('download-certificate-btn');
        const backToMainMenuBtn = document.getElementById('back-to-main-menu-btn');


        // --- State Variables ---
        let userName = '';
        let currentQuestionIndex = 0;
        let currentQuestions = [];
        let timerInterval;
        let mediaRecorder;
        let audioChunks = [];
        let recordedBlob = null;
        let completedTopics = {};
        let speechRecognition;
        let finalTranscript = '';

        const FULL_DASH_ARRAY = 283;
        const DEFAULT_RESPONSE_TIME = 60;
        const READ_TIME = 60;

        // --- Text-to-Speech ---
        const synth = window.speechSynthesis;
        let preferredVoice = null;
        let ttsInitialized = false;

        function initializeTTS() {
            return new Promise((resolve) => {
                if (!synth) {
                    ttsInitialized = true;
                    return resolve();
                }

                const setBestVoice = () => {
                    const voices = synth.getVoices();
                    if (voices.length === 0) return;
                    
                    const scoreVoice = (voice) => {
                        let score = 0;
                        const name = voice.name.toLowerCase();
                        if (name.includes('natural')) score += 5;
                        if (name.includes('brian') || name.includes('emma')) score += 4;
                        if (name.includes('microsoft')) score += 3;
                        if (name.includes('google')) score += 2;
                        if (voice.localService) score += 1;
                        return score;
                    };

                    const englishVoices = voices.filter(voice => voice.lang.startsWith('en'));
                    if (englishVoices.length > 0) {
                        englishVoices.sort((a, b) => scoreVoice(b) - scoreVoice(a));
                        preferredVoice = englishVoices[0];
                    }
                    
                    ttsInitialized = true;
                    resolve();
                };

                if (synth.getVoices().length > 0) {
                    setBestVoice();
                } else {
                    synth.onvoiceschanged = setBestVoice;
                }
            });
        }

        function speak(text, isFeedback = false) {
            if (!ttsInitialized) return;
            try {
                if (synth.speaking) synth.cancel();
                const utterThis = new SpeechSynthesisUtterance(text);
                utterThis.onerror = (event) => console.error('SpeechSynthesisUtterance.onerror', event);
                if (preferredVoice) utterThis.voice = preferredVoice;
                utterThis.pitch = 1;  
                utterThis.rate = 0.85; // Slow down speech as requested
                synth.speak(utterThis);
            } catch (e) {
                console.error("Speech synthesis failed:", e);
            }
        }

        // --- Local Storage ---
        function loadProgress() {
            const savedCompletedTopics = localStorage.getItem('languagePracticeCompletedTopics');
            if (savedCompletedTopics) {
                try {
                    const parsed = JSON.parse(savedCompletedTopics);
                    // Basic validation to ensure it's an object
                    if (typeof parsed === 'object' && parsed !== null) {
                       completedTopics = parsed;
                    } else {
                        completedTopics = {};
                    }
                } catch (e) {
                    console.error("Failed to parse saved progress:", e);
                    completedTopics = {}; // Reset progress if data is corrupt
                }
            }
            const savedName = localStorage.getItem('languagePracticeUserName');
            if (savedName) {
                 userName = savedName;
                 nameInput.value = userName;
            }
        }

        function saveProgress() {
            localStorage.setItem('languagePracticeCompletedTopics', JSON.stringify(completedTopics));
            if(userName) localStorage.setItem('languagePracticeUserName', userName);
        }

        // --- UI Initialization ---
        function initializeTopics() {
            topicSelection.innerHTML = '';
            for (const topic in practiceData) {
                const button = document.createElement('button');
                
                let checkmark = '';
                if (completedTopics && completedTopics[topic]) {
                    checkmark = `<i class="fas fa-check-circle text-green-500 ml-2"></i>`;
                    button.className = "w-full bg-green-100 dark:bg-green-900/50 p-2 rounded-lg shadow-md hover:bg-green-200 dark:hover:bg-green-800/60 transition-colors flex items-center justify-center";
                } else {
                    button.className = "w-full bg-white dark:bg-gray-700 p-2 rounded-lg shadow-md hover:bg-indigo-100 dark:hover:bg-indigo-800 transition-all transform hover:scale-105 flex items-center justify-center";
                }

                button.innerHTML = `<span class="text-sm font-semibold">${topic}</span> ${checkmark}`;
                button.dataset.topic = topic;
                button.addEventListener('click', () => startPractice(topic));
                topicSelection.appendChild(button);
            }
        }

        // --- Core App Logic ---
        function startPractice(topic) {
            currentQuestions = practiceData[topic];
            currentQuestions.topicName = topic;
            currentQuestionIndex = 0;
            welcomeScreen.classList.add('hidden');
            practiceScreen.classList.remove('hidden');
            certificateScreen.classList.add('hidden');
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestionIndex >= currentQuestions.length) {
                phaseIndicator.textContent = "Topic Complete!";
                questionText.textContent = "You've finished this topic. Well done!";
                completedTopics[currentQuestions.topicName] = true;
                saveProgress();
                checkAllTopicsCompleted();
                resetRecordingUI();
                nextBtn.classList.add('hidden');
                speak("You've completed this topic! Well done.");
                return;
            }

            const item = currentQuestions[currentQuestionIndex];
            resetUIForNewQuestion();
            
            let fullQuestion = (item.intro ? item.intro + " " : "") + item.question;
            questionText.textContent = fullQuestion;
            questionText.classList.add('fade-in');
            setTimeout(() => questionText.classList.remove('fade-in'), 500);

            speak(fullQuestion);
            
            // Populate Sentence Starters
            if (item.starters && item.starters.length > 0) {
                startersList.innerHTML = '';
                item.starters.forEach(starter => {
                    const button = document.createElement('button');
                    button.className = 'bg-indigo-500 text-white text-sm font-medium px-2.5 py-1 rounded-full dark:bg-indigo-600 dark:text-white cursor-default';
                    button.textContent = starter;
                    startersList.appendChild(button);
                });
                startersContainer.classList.remove('hidden');
            }

            // Populate Word Bank
            if (item.wordBank && item.wordBank.length > 0) {
                wordBankList.innerHTML = '';
                item.wordBank.forEach(word => {
                    const button = document.createElement('button');
                    button.className = 'bg-green-500 text-white text-sm font-medium px-2.5 py-1 rounded-full dark:bg-green-600 dark:text-white cursor-default';
                    button.textContent = word;
                    wordBankList.appendChild(button);
                });
                wordBankContainer.classList.remove('hidden');
            }

            const responseTime = item.timer || DEFAULT_RESPONSE_TIME;
            phaseIndicator.textContent = `Prepare & Record (Question ${currentQuestionIndex + 1} of ${currentQuestions.length})`;
            startTimer(responseTime, showSampleAnswersAndStartReadTimer);
        }

        function showSampleAnswersAndStartReadTimer() {
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                stopRecording();
            }
            
            phaseIndicator.textContent = "Review";
            recordBtn.disabled = true;
            recordBtn.classList.add('opacity-50', 'cursor-not-allowed');

            const item = currentQuestions[currentQuestionIndex];
            if (item.samples && item.samples.length > 0) {
                samplesList.innerHTML = '';
                item.samples.forEach(sample => {
                    const li = document.createElement('li');
                    li.textContent = sample;
                    // Changed to white text as requested
                    li.className = 'text-white text-sm sm:text-base';
                    samplesList.appendChild(li);
                });
                samplesContainer.classList.remove('hidden');
            }


            startTimer(READ_TIME, () => {
                phaseIndicator.textContent = "Time's up!";
                nextBtn.classList.remove('hidden');
            });
        }
        
        // --- Certificate Logic ---
        function checkAllTopicsCompleted() {
            const totalTopics = Object.keys(practiceData).length;
            const completedCount = Object.keys(completedTopics).length;
            if (completedCount === totalTopics) {
                showCertificate();
            }
        }
        
        function showCertificate() {
            practiceScreen.classList.add('hidden');
            welcomeScreen.classList.add('hidden');
            certificateScreen.classList.remove('hidden');
            document.getElementById('certificate-name').textContent = userName;
            document.getElementById('certificate-date').textContent = new Date().toLocaleDateString();
        }
        
        function showErrorMessage(message) {
            errorMessagebox.textContent = message;
            errorMessagebox.classList.remove('hidden');
            setTimeout(() => {
                errorMessagebox.classList.add('hidden');
            }, 5000); // Hide after 5 seconds
        }

        // --- Recording & Transcription Logic ---
        async function startRecording() {
            if (!window.MediaRecorder) {
                showErrorMessage("Audio recording is not supported on this browser.");
                return;
            }
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                
                const isEdge = window.navigator.userAgent.includes("Edg");
                let options = {};
                if (!isEdge) {
                    const mimeTypes = ['audio/webm;codecs=opus', 'audio/ogg;codecs=opus', 'audio/webm', 'audio/ogg'];
                    const supportedType = mimeTypes.find(type => MediaRecorder.isTypeSupported(type));
                    if (supportedType) options.mimeType = supportedType;
                }
                
                mediaRecorder = new MediaRecorder(stream, options);
                mediaRecorder.start();
                startTranscription();

                recordBtn.classList.add('hidden');
                stopRecordBtn.classList.remove('hidden');
                recordingStatus.classList.remove('hidden');

                audioChunks = [];
                mediaRecorder.addEventListener("dataavailable", event => {
                    audioChunks.push(event.data);
                });

                mediaRecorder.addEventListener("stop", () => {
                    recordedBlob = new Blob(audioChunks, { type: mediaRecorder.mimeType || 'audio/webm' });
                    const audioUrl = URL.createObjectURL(recordedBlob);
                    audioPlayer.src = audioUrl;
                    postRecordingActions.classList.remove('hidden');
                    recordingStatus.classList.add('hidden');
                    stopRecordBtn.classList.add('hidden');
                    recordBtn.classList.add('hidden');
                });
            } catch (err) {
                console.error("Error starting recording:", err);
                showErrorMessage("Could not start audio recording. Please grant microphone permission.");
            }
        }

        function stopRecording() {
            if (mediaRecorder) {
                mediaRecorder.stop();
            }
            if (speechRecognition) {
                speechRecognition.stop();
            }
        }

        function startTranscription() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                console.warn("Speech recognition not supported.");
                return;
            }

            speechRecognition = new SpeechRecognition();
            speechRecognition.continuous = true;
            speechRecognition.interimResults = true;
            speechRecognition.lang = 'en-US';
            finalTranscript = '';

            speechRecognition.onresult = (event) => {
                let interimTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }
            };
            
            speechRecognition.onerror = (event) => {
                 console.error('Speech recognition error detected: ' + event.error);
            }

            speechRecognition.start();
        }

        // --- Timer Functions ---
        function startTimer(duration, onEndCallback) {
            let timeLeft = duration;
            clearInterval(timerInterval);
            updateTimerDisplay(timeLeft, duration);

            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay(timeLeft, duration);
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    if(onEndCallback) onEndCallback();
                }
            }, 1000);
        }

        function updateTimerDisplay(timeLeft, totalDuration) {
            const minutes = Math.floor(timeLeft / 60);
            let seconds = timeLeft % 60;
            if (seconds < 10) seconds = `0${seconds}`;
            timerDisplay.textContent = `${minutes}:${seconds}`;
            
            const fraction = timeLeft / totalDuration;
            const offset = fraction * FULL_DASH_ARRAY;
            timerProgress.style.strokeDashoffset = FULL_DASH_ARRAY - offset;
        }

        // --- UI Helper Functions ---
        function resetUIForNewQuestion() {
            samplesContainer.classList.add('hidden');
            startersContainer.classList.add('hidden');
            wordBankContainer.classList.add('hidden');
            nextBtn.classList.add('hidden');
            errorMessagebox.classList.add('hidden');
            recordBtn.disabled = false;
            recordBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            resetRecordingUI();
        }

        function resetRecordingUI() {
            recordBtn.classList.remove('hidden');
            stopRecordBtn.classList.add('hidden');
            recordingStatus.classList.add('hidden');
            postRecordingActions.classList.add('hidden');
            audioPlayer.src = '';
            audioChunks = [];
            recordedBlob = null;
            finalTranscript = '';
        }

        // --- Theme Toggle Logic ---
        const applyTheme = (theme) => {
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                themeToggleLightIcon.classList.remove('hidden');
                themeToggleDarkIcon.classList.add('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                themeToggleDarkIcon.classList.remove('hidden');
                themeToggleLightIcon.classList.add('hidden');
            }
        };
        
        // --- Snowfall Logic ---
        function createSnow() {
            const snowContainer = document.getElementById('snow-container');
            const snowflakeCount = 50;
            for (let i = 0; i < snowflakeCount; i++) {
                let snowflake = document.createElement('div');
                snowflake.innerHTML = '❄';
                snowflake.classList.add('snowflake');
                snowflake.style.left = Math.random() * 100 + 'vw';
                snowflake.style.animationDuration = Math.random() * 5 + 5 + 's'; // 5-10 seconds
                snowflake.style.animationDelay = Math.random() * 5 + 's';
                snowflake.style.fontSize = Math.random() * 1.5 + 0.5 + 'em';
                snowflake.style.opacity = Math.random();
                snowContainer.appendChild(snowflake);
            }
        }


        // --- Event Listeners ---
        startWithNameBtn.addEventListener('click', () => {
            userName = nameInput.value.trim();
            if (userName) {
                saveProgress();
                nameEntryContainer.classList.add('hidden');
                userNameDisplay.textContent = userName;
                topicSelectionContainer.classList.remove('hidden');
            } else {
                // Using a custom message box instead of alert()
                const nameError = document.createElement('div');
                nameError.textContent = "Please enter your name.";
                nameError.className = "text-red-500 text-sm mt-2";
                startWithNameBtn.insertAdjacentElement('afterend', nameError);
                setTimeout(() => nameError.remove(), 2000);
            }
        });

        recordBtn.addEventListener('click', startRecording);
        stopRecordBtn.addEventListener('click', stopRecording);
        
        downloadCertificateBtn.addEventListener('click', () => {
            const certificateNode = document.getElementById('certificate-to-download');
            html2canvas(certificateNode, { scale: 2 }).then(canvas => {
                const a = document.createElement('a');
                a.href = canvas.toDataURL('image/png');
                a.download = `Certificate_of_Completion_${userName.replace(/\s+/g, '_')}.png`;
                a.click();
            });
        });

        backToMainMenuBtn.addEventListener('click', () => {
            certificateScreen.classList.add('hidden');
            welcomeScreen.classList.remove('hidden');
            initializeTopics();
        });

        downloadBtn.addEventListener('click', () => {
            if (recordedBlob) {
                const topicName = currentQuestions.topicName.replace(/\s+/g, '_');
                const sanitizedUserName = userName.replace(/\s+/g, '_');
                const fileName = `${sanitizedUserName}_${topicName}_Q${currentQuestionIndex + 1}.webm`;
                
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = URL.createObjectURL(recordedBlob);
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);

                // Visual feedback
                const originalText = downloadBtn.innerHTML;
                downloadBtn.innerHTML = `<i class="fas fa-check mr-1"></i>Downloaded!`;
                downloadBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                downloadBtn.classList.add('bg-green-600');
                setTimeout(() => {
                    downloadBtn.innerHTML = originalText;
                    downloadBtn.classList.remove('bg-green-600');
                    downloadBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
                }, 2000);
            }
        });

        nextBtn.addEventListener('click', () => {
            currentQuestionIndex++;
            showQuestion();
        });

        backToTopicsBtn.addEventListener('click', () => {
            practiceScreen.classList.add('hidden');
            welcomeScreen.classList.remove('hidden');
            clearInterval(timerInterval);
            initializeTopics();
        });
        
        themeToggleBtn.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('color-theme', isDark ? 'dark' : 'light');
            applyTheme(isDark ? 'dark' : 'light');
        });

        // --- Initial Load ---
        async function main() {
            // Set initial theme
            const savedTheme = localStorage.getItem('color-theme');
            if (savedTheme) {
                applyTheme(savedTheme);
            } else {
                // If no theme saved, use system preference
                if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                    applyTheme('dark');
                } else {
                    applyTheme('light');
                }
            }
            
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia || !SpeechRecognition) {
                recordBtn.disabled = true;
                recordBtn.classList.add('opacity-50', 'cursor-not-allowed');
                recordBtn.title = "Audio recording or recognition is not supported on this browser.";
            }
            if (!window.speechSynthesis) {
                 console.warn("Text-to-speech is not supported on this browser.");
            }
            
            await initializeTTS().catch(err => console.error(err));
            
            createSnow();
            loadProgress();
            initializeTopics();
        }
        
        main();
    });
    </script>
</body>
</html>
