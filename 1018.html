<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animal Adventure: Pro Teaching Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; overflow: hidden; }
        .font-fredoka { font-family: 'Fredoka One', cursive; }
        .slide {
            display: none;
            width: 100%;
            height: 100vh;
            overflow: hidden;
            padding: 5rem 12rem 1rem 6rem;
            box-sizing: border-box;
            flex-direction: column;
            justify-content: space-evenly;
            align-items: center;
            text-align: center;
        }
        .slide.active { display: flex; }

        @media (max-width: 768px) {
          .slide {
            padding-left: 1rem;
            padding-right: 1rem;
          }
        }

        .top-bar {
            position: fixed;
            top: 0; left: 0; right: 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(5px);
            padding: 0.5rem 1rem;
            z-index: 100;
        }
        .game-button { transition: all 0.2s ease-in-out; }
        .game-button:hover { transform: scale(1.05); filter: brightness(1.1); }
        .game-button:active { transform: scale(0.98); }
        @keyframes floatAcross { 0% { left: -10%; } 100% { left: 110%; } }
        .moving-animal { position: absolute; font-size: 5rem; opacity: 0.2; animation: floatAcross 30s linear infinite; z-index: -1; }
        .confetti-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 100; }
        .confetti { position: absolute; width: 10px; height: 10px; background-color: #f00; opacity: 0.7; animation: confetti-fall 3s linear forwards; }
        @keyframes confetti-fall { 0% { transform: translateY(-10vh); } 100% { transform: translateY(110vh); } }
    </style>
</head>
<body class="bg-gradient-to-br from-teal-300 via-sky-400 to-indigo-500 text-white flex items-center justify-center">

    <div id="app-container" class="w-full h-full max-w-7xl mx-auto relative">
        <div class="moving-animal" style="top: 15%; animation-duration: 35s;">🐼</div>
        <div class="moving-animal" style="top: 45%; animation-delay: 10s; animation-duration: 40s;">🐬</div>
        <div class="moving-animal" style="top: 75%; animation-delay: 20s; animation-duration: 30s;">🦁</div>

        <div class="fixed top-20 left-2 w-16 bg-black/20 p-2 rounded-lg text-center space-y-2 text-3xl hidden md:block">
          <div>🐶</div> <div>🐱</div> <div>🐰</div> <div>🐹</div> <div>🐢</div> <div>🐮</div> <div>🐷</div> <div>🐔</div> <div>🐑</div> <div>🐴</div> <div>🦁</div> <div>🐯</div> <div>🐼</div> <div>🐒</div> <div>🦊</div> <div>🐘</div> <div>🐨</div> <div>🐬</div> <div>🦈</div> <div>🐳</div> <div>🐙</div> <div>🐦</div> <div>🐧</div> <div>🦉</div> <div>🦆</div> <div>🦅</div>
        </div>

        <div id="keyword-sidebar" class="fixed top-20 right-2 w-48 bg-black/20 p-3 rounded-lg text-left space-y-2 text-lg font-semibold hidden md:block"></div>

        <div class="top-bar">
          <div class="flex gap-2">
            <button class="nav-btn game-button bg-gray-600 text-white px-4 py-2 rounded-lg text-lg" data-target="1">🏠 Menu</button>
            <button class="nav-btn game-button bg-pink-500 text-white px-4 py-2 rounded-lg text-lg" data-target="prev">⬅ Back</button>
            <button class="nav-btn game-button bg-green-500 text-white px-4 py-2 rounded-lg text-lg" data-target="next">Next ➡</button>
          </div>
          <div class="flex items-center gap-4">
            <button id="hear-example-btn" class="game-button bg-sky-500 text-white px-3 py-2 rounded-full text-lg">🔊</button>
            <button id="correct-btn-global" class="game-button bg-yellow-500 text-black px-4 py-2 rounded-lg text-lg font-bold">✔ Correct! (+1)</button>
            <div class="bg-yellow-400 text-indigo-700 font-fredoka text-2xl px-4 py-1 rounded-lg shadow-md"> Score: <span id="score">0</span> </div>
          </div>
        </div>

        <div id="slide-1" class="slide active" style="padding-left: 1rem; padding-right: 1rem;">
            <h1 class="font-fredoka text-5xl md:text-7xl text-yellow-300 drop-shadow-lg">🐾 Animal Adventure</h1>
            <h2 class="text-3xl mt-4 mb-8">Choose a Grammar Pattern:</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <button class="nav-btn game-button font-fredoka bg-pink-500 text-white px-8 py-3 rounded-full text-2xl" data-target="2">1. "I like..."</button>
                <button class="nav-btn game-button font-fredoka bg-sky-500 text-white px-8 py-3 rounded-full text-2xl" data-target="4">2. "A ___ lives..."</button>
                <button class="nav-btn game-button font-fredoka bg-purple-500 text-white px-8 py-3 rounded-full text-2xl" data-target="6">3. "A ___ can..."</button>
                <button class="nav-btn game-button font-fredoka bg-orange-500 text-white px-8 py-3 rounded-full text-2xl" data-target="8">4. "...is the most..."</button>
                <button class="nav-btn game-button font-fredoka bg-red-500 text-white px-8 py-3 rounded-full text-2xl" data-target="10">5. "Which do you prefer?"</button>
                <button class="nav-btn game-button font-fredoka bg-teal-500 text-white px-8 py-3 rounded-full text-2xl" data-target="12">6. "Describe a time..."</button>
            </div>
        </div>

        <div id="slide-2" class="slide"></div> <div id="slide-3" class="slide"></div>
        <div id="slide-4" class="slide"></div> <div id="slide-5" class="slide"></div>
        <div id="slide-6" class="slide"></div> <div id="slide-7" class="slide"></div>
        <div id="slide-8" class="slide"></div> <div id="slide-9" class="slide"></div>
        <div id="slide-10" class="slide"></div> <div id="slide-11" class="slide"></div>
        <div id="slide-12" class="slide"></div> <div id="slide-13" class="slide"></div>

        <div id="slide-14" class="slide" style="padding-left: 1rem; padding-right: 1rem;">
            <div class="text-9xl mb-4">🏆</div>
            <h1 class="font-fredoka text-6xl md:text-7xl text-yellow-300 drop-shadow-lg">🎉 Congratulations!</h1>
            <div class="bg-white/30 backdrop-blur-sm p-6 rounded-2xl shadow-lg my-8">
                <p class="text-3xl">Your Final Score: <span id="final-score" class="font-bold text-yellow-300 text-5xl">0</span></p>
            </div>
            <button class="nav-btn game-button bg-gray-600 text-white px-8 py-3 rounded-full text-2xl" data-target="1">🏠 Main Menu</button>
        </div>
    </div>
    <div id="effect-container" class="confetti-container"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let score = 0, currentSlide = 1;
            let voices = [], voiceMap = {};
            let exampleIndexes = [0,0,0,0,0,0];
            const slides = document.querySelectorAll('.slide');
            const topBar = document.querySelector('.top-bar'), scoreEl = document.getElementById('score'), correctBtnGlobal = document.getElementById('correct-btn-global'), hearExampleBtn = document.getElementById('hear-example-btn');

            const animals = { pets: [{n:'Dog',p:'Dogs',e:'🐶'},{n:'Cat',p:'Cats',e:'🐱'},{n:'Rabbit',p:'Rabbits',e:'🐰'},{n:'Hamster',p:'Hamsters',e:'🐹'},{n:'Turtle',p:'Turtles',e:'🐢'}], farm: [{n:'Cow',p:'Cows',e:'🐮'},{n:'Pig',p:'Pigs',e:'🐷'},{n:'Chicken',p:'Chickens',e:'🐔'},{n:'Sheep',p:'Sheep',e:'🐑'},{n:'Horse',p:'Horses',e:'🐴'}], wild: [{n:'Lion',p:'Lions',e:'🦁'},{n:'Tiger',p:'Tigers',e:'🐯'},{n:'Panda',p:'Pandas',e:'🐼'},{n:'Monkey',p:'Monkeys',e:'🐒'},{n:'Fox',p:'Foxes',e:'🦊'},{n:'Elephant',p:'Elephants',e:'🐘'},{n:'Koala',p:'Koalas',e:'🐨'}], sea: [{n:'Dolphin',p:'Dolphins',e:'🐬'},{n:'Shark',p:'Sharks',e:'🦈'},{n:'Whale',p:'Whales',e:'🐳'},{n:'Octopus',p:'Octopuses',e:'🐙'}], birds: [{n:'Bird',p:'Birds',e:'🐦'},{n:'Penguin',p:'Penguins',e:'🐧'},{n:'Owl',p:'Owls',e:'🦉'},{n:'Duck',p:'Ducks',e:'🦆'},{n:'Eagle',p:'Eagles',e:'🦅'}] };
            const allAnimalsFlat = Object.values(animals).flat();
            const wordBanks = { adjectives: ["friendly","cute","big","fast","graceful","endangered","nocturnal"], places: [{n:"a farm", prep:"on"},{n:"the jungle", prep:"in"},{n:"the ocean", prep:"in"},{n:'Antarctica', prep:'in'}], actions: ["run","swim","fly","hunt","migrate"], superlatives: ["the most dangerous","the most beautiful","the strongest"], comparatives: [{adj:"friendlier"},{adj:"faster"},{adj:"stronger"}] };
            const grammarPatterns = [ { title: "I like ___ because..." }, { title: "A ___ lives ___." }, { title: "A ___ can ___." }, { title: "In my opinion, the ___ is ___." }, { title: "I prefer ___ to ___..." }, { title: "Describe a time when you saw a ___." } ];
            const ieltsQuestions = [ "Do you like ___? Why/why not?", "Where does a ___ live?", "What can a ___ do?", "Which animal is the most ___ in your opinion?", "Which animal do you prefer, and why?", "Describe a time when you saw a ___." ];
            const keywords = { 0: ["like", "because", "friendly", "cute", "fast", "graceful"], 1: ["lives in", "lives on", "farm", "jungle", "ocean", "Antarctica"], 2: ["can", "run", "swim", "fly", "hunt", "migrate"], 3: ["opinion", "most", "dangerous", "beautiful", "strongest"], 4: ["prefer", "to", "friendlier", "faster", "stronger", "than"], 5: ["firstly", "afterwards", "finally", "because", "although", "felt"] };

            const exampleSets = { 0: [], 1: [], 2: [], 3: [], 4: [], 5: [] };
            allAnimalsFlat.forEach(a => {
              wordBanks.adjectives.forEach(adj => { exampleSets[0].push(`I like ${a.e} ${a.p.toLowerCase()} because they are ${adj}.`); exampleSets[0].push(`I like ${a.e} the ${a.n.toLowerCase()} because it is ${adj}.`); });
              if (["Whale","Dolphin","Shark","Penguin"].includes(a.n)) { exampleSets[1].push(`A ${a.e} ${a.n.toLowerCase()} lives in the ocean.`); } else if (["Cow","Pig","Horse"].includes(a.n)) { exampleSets[1].push(`A ${a.e} ${a.n.toLowerCase()} lives on a farm.`); } else { exampleSets[1].push(`A ${a.e} ${a.n.toLowerCase()} lives in the jungle.`); }
              wordBanks.actions.forEach(act => { exampleSets[2].push(`A ${a.e} ${a.n.toLowerCase()} can ${act}.`); });
              wordBanks.superlatives.forEach(sup => { exampleSets[3].push(`In my opinion, the ${a.e} ${a.n.toLowerCase()} is ${sup}.`); });
              exampleSets[5].push(`One time I saw a ${a.e} ${a.n.toLowerCase()} at the zoo. It was eating and looked very calm. I felt amazed because it was the first time I had seen one in real life.`);
            });
            allAnimalsFlat.forEach(a1 => { allAnimalsFlat.forEach(a2 => { if (a1.n !== a2.n) { wordBanks.comparatives.forEach(c => { exampleSets[4].push(`I prefer ${a1.e} ${a1.p.toLowerCase()} to ${a2.e} ${a2.p.toLowerCase()} because they are ${c.adj}.`); }); } }); });
            
            const praisePhrases = { Ava: ["Fantastic!","Great job!"], Brian: ["Excellent!","Well done!"], Emma: ["Wonderful!","Brilliant!"], Andrew: ["Terrific!","Awesome!"] };

            function speak(text, persona = 'Ava') {
                if ('speechSynthesis' in window && text) {
                    // Create a version of the text with emojis removed for TTS
                    const textToSpeak = text.replace(/(\u00a9|\u00ae|[\u2000-\u3300]|\ud83c[\ud000-\udfff]|\ud83d[\ud000-\udfff]|\ud83e[\ud000-\udfff])/g, '').trim();
                    
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(textToSpeak);
                    if (voiceMap[persona]) utterance.voice = voiceMap[persona];
                    utterance.rate = 0.85; // Slow down speech to 85% per user request
                    utterance.pitch = 1.1;
                    window.speechSynthesis.speak(utterance);
                }
            }

            function setupTTS() {
                const setVoices = () => {
                    voices = window.speechSynthesis.getVoices();
                    if (voices.length > 0) {
                        const femaleUS = voices.find(v => v.lang.startsWith('en-US') && v.name.includes('Female')) || voices.find(v => v.lang.startsWith('en'));
                        const maleUK = voices.find(v => v.lang.startsWith('en-GB') && v.name.includes('Male')) || voices.find(v => v.lang.startsWith('en'));
                        voiceMap = { 'Ava': femaleUS, 'Brian': maleUK, 'Emma': voices.find(v => v.lang.startsWith('en-GB') && v.name.includes('Female')) || femaleUS, 'Andrew': voices.find(v => v.lang.startsWith('en-US') && v.name.includes('Male')) || maleUK };
                    }
                };
                setVoices(); if (voices.length === 0) window.speechSynthesis.onvoiceschanged = setVoices;
            }
            
            function showSlide(slideNumber) {
                if (slideNumber > 13) { document.getElementById('final-score').textContent = score; slideNumber = 14; }
                slides.forEach(slide => slide.classList.remove('active'));
                const targetSlide = document.getElementById(`slide-${slideNumber}`);
                if (targetSlide) {
                    targetSlide.classList.add('active'); currentSlide = slideNumber;
                    const isSpecialSlide = (currentSlide === 1 || currentSlide === 14);
                    topBar.style.visibility = isSpecialSlide ? 'hidden' : 'visible';
                    const keywordBox = document.getElementById("keyword-sidebar");
                    const pIndex = Math.floor((currentSlide - 2) / 2);
                    if (keywords[pIndex]) {
                      keywordBox.innerHTML = keywords[pIndex].map(k => `<div>${k}</div>`).join("");
                      keywordBox.style.display = "block";
                    } else {
                      keywordBox.style.display = "none";
                    }
                }
            }
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
              btn.addEventListener('click', () => {
                let target = btn.dataset.target;
                if (target === "next") showSlide(currentSlide + 1);
                else if (target === "prev") { if (currentSlide > 1) showSlide(currentSlide - 1); }
                else showSlide(parseInt(target));
              });
            });

            correctBtnGlobal.addEventListener('click', () => {
                score += 1; scoreEl.textContent = score;
                triggerConfetti();
                const randomVoice = ['Ava','Brian','Emma','Andrew'][Math.floor(Math.random()*4)];
                speak(praisePhrases[randomVoice][Math.floor(Math.random()*praisePhrases[randomVoice].length)], randomVoice);
            });

            hearExampleBtn.addEventListener('click', () => {
                const pIndex = Math.floor((currentSlide - 2) / 2);
                if (currentSlide % 2 !== 0 || pIndex < 0 || pIndex >= grammarPatterns.length) return;
                const examples = exampleSets[pIndex];
                if (!examples || examples.length === 0) return;
                if (exampleIndexes[pIndex] >= examples.length) exampleIndexes[pIndex] = 0;
                const sentence = examples[exampleIndexes[pIndex]];
                speak(sentence, 'Andrew');
                const outputEl = document.querySelector(`#slide-${currentSlide} .sentence-output`);
                if(outputEl) outputEl.textContent = sentence;
                exampleIndexes[pIndex]++;
            });

            function triggerConfetti() {
                const container = document.getElementById('effect-container');
                container.innerHTML = '';
                for (let i = 0; i < 50; i++) { const c = document.createElement('div'); c.className = 'confetti'; c.style.left = `${Math.random()*100}vw`; c.style.backgroundColor = `hsl(${Math.random()*360},100%,50%)`; c.style.animationDelay = `${Math.random()*2}s`; container.appendChild(c); }
                setTimeout(() => container.innerHTML = '', 3000);
            }

            function createLearningSlide(slideId, pIndex) {
              const slide = document.getElementById(slideId);
              slide.innerHTML = `
                    <h2 class="font-fredoka text-3xl md:text-4xl text-black">${ieltsQuestions[pIndex]}</h2>
                    <h1 class="font-fredoka text-5xl md:text-7xl mt-2 text-yellow-300 drop-shadow-lg">${grammarPatterns[pIndex].title}</h1>
                    <div class="sentence-output text-4xl mt-6 font-bold h-20 bg-black/20 rounded-lg flex items-center justify-center px-4 w-full max-w-4xl self-center">Click 🔊 in the top bar to hear examples</div>`;
            }

            function createPracticeSlide(slideId, pIndex) {
              const slide = document.getElementById(slideId);
              const generatePrompt = () => {
                const examples = exampleSets[pIndex];
                slide.querySelector('.practice-prompt').textContent = examples[Math.floor(Math.random() * examples.length)];
              };
              slide.innerHTML = `
                    <h2 class="font-fredoka text-3xl md:text-4xl text-green-300">Practice Phase: Say It Aloud!</h2>
                    <div class="practice-prompt text-4xl mt-6 bg-black/20 p-6 rounded-lg min-h-[8rem] flex items-center justify-center w-full max-w-4xl self-center"></div>
                    <div class="flex gap-4 mt-8 flex-wrap justify-center">
                      <button class="hear-btn game-button bg-sky-500 text-3xl px-8 py-4 rounded-full shadow-2xl">▶ Hear Prompt</button>
                      <button class="spin-btn game-button bg-purple-500 text-3xl px-8 py-4 rounded-full shadow-2xl">🎲 Spin Again</button>
                    </div>`;
              slide.querySelector('.spin-btn').addEventListener('click', generatePrompt);
              slide.querySelector('.hear-btn').addEventListener('click', () => { speak(slide.querySelector('.practice-prompt').textContent, 'Emma'); });
              generatePrompt();
            }

            grammarPatterns.forEach((p, i) => {
                createLearningSlide(`slide-${2+i*2}`, i);
                createPracticeSlide(`slide-${3+i*2}`, i);
            });
            
            setupTTS();
            showSlide(1);
        });
    </script>
</body>
</html>
