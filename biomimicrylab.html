<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biomimicry Idea Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&family=Inter:wght@400;600&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f9ff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow-x: hidden;
            position: relative; /* For absolute decorations */
        }
        
        .handwritten {
            font-family: 'Comic Neue', cursive;
        }

        .pattern-bg {
            background-image: radial-gradient(#e0f2fe 2px, transparent 2px);
            background-size: 20px 20px;
        }

        /* Empty State Placeholder Line */
        .placeholder-line {
            display: inline-block;
            height: 1em;
            width: 80%;
            background-color: #cbd5e1;
            border-radius: 4px;
            animation: pulse-gray 2s infinite;
        }

        @keyframes pulse-gray {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 0.3; }
        }

        /* Emoji Particle Styles for Burst */
        .emoji-particle {
            position: absolute;
            pointer-events: none;
            user-select: none;
            font-size: 1.5rem;
            animation: float-out 1s ease-out forwards;
            z-index: 50;
        }

        @keyframes float-out {
            0% {
                opacity: 1;
                transform: translate(0, 0) scale(0.5);
            }
            100% {
                opacity: 0;
                transform: translate(var(--tx), var(--ty)) scale(1.5) rotate(var(--rot));
            }
        }
        
        /* Text Reveal Animation */
        .reveal-text {
            animation: text-pop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes text-pop {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }

        /* Push Button Styles for Padding Areas */
        .push-area {
            cursor: pointer;
            transition: all 0.15s ease-in-out;
            position: relative;
            user-select: none; 
        }
        
        .push-area:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            background-color: rgba(255, 255, 255, 0.6);
        }
        
        .push-area:active {
            transform: scale(0.97) translateY(0);
            box-shadow: none;
        }

        /* Reading State Style - Increases Font Size */
        .reading-active {
            font-size: 125% !important; /* 25% larger */
            transition: font-size 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            /* Removed display: inline-block to prevent layout shifts */
        }

        /* Background Decoration Floating */
        .deco-emoji {
            position: fixed;
            font-size: 5rem; /* Increased size for emphasis */
            opacity: 0.3;    /* Increased opacity */
            pointer-events: none;
            z-index: 0;
            animation: float-idle 6s ease-in-out infinite;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.05)); /* Subtle shadow */
        }

        @keyframes float-idle {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-15px) rotate(8deg); }
        }

    </style>
</head>
<body class="p-4 pattern-bg">

    <!-- Background Decorations -->
    <div class="deco-emoji top-10 left-10 rotate-12 delay-0">üß¨</div>
    <div class="deco-emoji top-20 right-20 -rotate-12 delay-100">üî¨</div>
    <div class="deco-emoji bottom-32 left-8 rotate-45 delay-200">üåø</div>
    <div class="deco-emoji bottom-10 right-10 -rotate-12 delay-300">ü¶â</div>
    <div class="deco-emoji top-1/2 left-4 delay-500">üêù</div>
    <div class="deco-emoji top-1/3 right-8 rotate-180 delay-700">üï∏Ô∏è</div>
    <div class="deco-emoji bottom-10 left-1/3 rotate-6 delay-1000">ü¶à</div>
    <div class="deco-emoji top-5 left-1/2 -rotate-12 delay-500">üß™</div>

    <!-- Main Container -->
    <div class="max-w-xl w-full relative z-10"> <!-- Scale: max-w-md -> max-w-xl -->
        
        <!-- Header: Button Moved Here & Shrunk -->
        <div class="mb-8 text-center">
            <button onclick="fillBlanks()" class="group relative inline-flex items-center justify-center px-6 py-3 font-bold text-white transition-all duration-200 bg-emerald-500 text-lg rounded-full hover:bg-emerald-600 hover:shadow-lg hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 active:scale-95 shadow-emerald-200">
                <span class="mr-2 text-xl"><i class="fas fa-magic"></i></span> <!-- Icon shrunk slightly -->
                <span class="text-lg">Biomimicry Lab</span> <!-- Text shrunk from xl to lg -->
            </button>
        </div>

        <!-- The Card Template -->
        <div id="card-display" class="bg-white rounded-2xl shadow-xl min-h-[600px] flex flex-col p-0 border-l-[10px] border-slate-300 relative overflow-hidden transition-all duration-300"> <!-- Min-height increased -->
            
            <!-- 1. Human Problem Button Area (Emma) -->
            <div onclick="speakSection('problem')" class="push-area bg-slate-50 p-8 border-b border-slate-100 group"> <!-- Padding increased p-6 -> p-8 -->
                <p class="text-sm font-bold text-neutral-900 uppercase tracking-widest mb-2">Human Problem</p> <!-- Font increased xs -> sm -->
                <h2 id="problem-text" class="text-3xl font-bold text-slate-800 leading-tight min-h-[2.5rem] origin-left transition-all"> <!-- Font increased 2xl -> 3xl -->
                    <span class="placeholder-line w-3/4"></span>
                </h2>
            </div>

            <!-- Body Content -->
            <div class="p-8 flex-grow flex flex-col gap-6 relative"> <!-- Padding p-6 -> p-8, gap-4 -> gap-6 -->
                
                <!-- 2. Nature's Trick Button Area (Brian) -->
                <div onclick="speakSection('mechanism')" class="push-area rounded-xl p-5 border border-transparent hover:border-green-100 hover:bg-green-50/50 group">
                    <div class="flex items-center gap-3 mb-3">
                        <i class="fas fa-leaf text-green-500 text-xl"></i>
                        <span class="text-base font-bold text-green-600 uppercase">Nature's Blueprint</span> <!-- Font sm -> base -->
                    </div>
                    <p id="mechanism-text" class="text-xl text-slate-600 font-medium min-h-[4rem] origin-left transition-all"> <!-- Font lg -> xl -->
                        <span class="placeholder-line w-full mb-2"></span>
                        <span class="placeholder-line w-2/3"></span>
                    </p>
                </div>

                <div class="grid grid-cols-2 gap-6"> <!-- Gap increased -->
                    <!-- 3. Teacher Button Area (Ava) -->
                    <div onclick="speakSection('mentor')" class="push-area bg-purple-50 p-5 rounded-xl border border-purple-100 group">
                        <div class="flex justify-between items-start mb-2">
                            <span class="block text-sm font-bold text-purple-400 uppercase">Teacher</span> <!-- Font xs -> sm -->
                        </div>
                        <span id="mentor-text" class="block text-2xl font-handwritten font-bold text-purple-700 min-h-[2rem] origin-left transition-all"> <!-- Font xl -> 2xl -->
                            <span class="placeholder-line w-2/3 h-5"></span>
                        </span>
                    </div>

                    <!-- 4. Invention Button Area (Andrew) -->
                    <div onclick="speakSection('invention')" class="push-area bg-orange-50 p-5 rounded-xl border border-orange-100 group">
                        <div class="flex justify-between items-start mb-2">
                            <span class="block text-sm font-bold text-orange-400 uppercase">Invention</span> <!-- Font xs -> sm -->
                        </div>
                        <span id="invention-text" class="block text-2xl font-handwritten font-bold text-orange-700 min-h-[2rem] origin-left transition-all"> <!-- Font xl -> 2xl -->
                            <span class="placeholder-line w-2/3 h-5"></span>
                        </span>
                    </div>
                </div>

                <!-- 5. Say It Button Area (Ava) -->
                <div onclick="speakSection('vocab')" class="push-area mt-auto pt-6 pb-2 px-5 rounded-xl border border-transparent hover:bg-slate-50 hover:border-slate-100 group">
                    <div class="flex justify-between items-start">
                        <p class="text-base text-slate-400 italic w-full"> <!-- Font sm -> base -->
                            <span class="font-bold text-slate-500 not-italic">Say it:</span> 
                            "<span id="vocab-text" class="origin-left transition-all inline-block">...</span>"
                        </p>
                    </div>
                </div>
            </div>

            <!-- Burst Origin Point -->
            <div id="burst-center" class="absolute top-1/2 left-1/2 w-0 h-0 pointer-events-none"></div>

        </div>

    </div>

    <script>
        const biomimicryData = [
            {
                problem: "Needles hurt!",
                mentor: "Mosquito",
                mechanism: "Its mouth vibrates to slide into skin easily.",
                invention: "Painless Needle",
                vocab: "This mimics the shape of a mosquito's mouth."
            },
            {
                problem: "Trains go 'BOOM' in tunnels.",
                mentor: "Kingfisher Bird",
                mechanism: "Its pointy beak dives without splashing.",
                invention: "Bullet Train Nose",
                vocab: "This mimics the bird's pointy beak."
            },
            {
                problem: "Tape stops sticking when dirty.",
                mentor: "Gecko",
                mechanism: "Tiny hairs on its feet stick to walls.",
                invention: "Super-Grip Tape",
                vocab: "This mimics the hairs on gecko feet."
            },
            {
                problem: "Walls get dirty easily.",
                mentor: "Lotus Flower",
                mechanism: "Bumps on the leaf make dirt roll off.",
                invention: "Self-Cleaning Paint",
                vocab: "This mimics the bumpy leaf texture."
            },
            {
                problem: "Germs live on door handles.",
                mentor: "Shark",
                mechanism: "Its rough skin stops germs from sticking.",
                invention: "Germ-Proof Plastic",
                vocab: "This mimics the rough shark skin."
            },
            {
                problem: "No water in the desert.",
                mentor: "Namib Beetle",
                mechanism: "Bumps on its back catch fog water.",
                invention: "Fog-Catching Nets",
                vocab: "This mimics the beetle's bumpy back."
            },
            {
                problem: "Air conditioning is expensive.",
                mentor: "Termite",
                mechanism: "Tunnels in their mounds move hot air out.",
                invention: "Cool Buildings",
                vocab: "This mimics termite mound tunnels."
            },
            {
                problem: "Fans are too loud.",
                mentor: "Owl",
                mechanism: "Soft feather edges make flying silent.",
                invention: "Silent Fans",
                vocab: "This mimics owl feathers."
            },
            {
                problem: "Zippers get stuck.",
                mentor: "Burrs (Plant Seeds)",
                mechanism: "Hooks grab onto animal fur.",
                invention: "Velcro",
                vocab: "This mimics hook shapes on seeds."
            },
            {
                problem: "Wind turbines stop in bad wind.",
                mentor: "Humpback Whale",
                mechanism: "Bumps on fins help it turn easily.",
                invention: "Better Wind Turbines",
                vocab: "This mimics bumps on whale fins."
            }
        ];

        const cardDisplay = document.getElementById('card-display');
        const fields = {
            problem: document.getElementById('problem-text'),
            mechanism: document.getElementById('mechanism-text'),
            mentor: document.getElementById('mentor-text'),
            invention: document.getElementById('invention-text'),
            vocab: document.getElementById('vocab-text')
        };

        // TTS Setup
        let voices = [];
        window.speechSynthesis.onvoiceschanged = () => {
            voices = window.speechSynthesis.getVoices();
        };

        function resetAllFonts() {
            Object.values(fields).forEach(field => {
                field.classList.remove('reading-active');
            });
        }

        function speakSection(section) {
            // Cancel any current speech and reset visual states
            window.speechSynthesis.cancel();
            resetAllFonts();

            const textEl = document.getElementById(section + '-text');
            // Check if element has placeholder
            if (textEl.innerHTML.includes('placeholder-line')) {
                return; // Don't read if empty
            }
            
            // NOTE: We do NOT add 'reading-active' here anymore.
            // We wait for onstart to ensure timing is perfect.
            
            let textToRead = "";
            let intro = "";
            let preferredVoiceName = "";
            let preferredGender = "";

            // Mapping sections to specific voices
            switch(section) {
                case 'problem':
                    intro = "Human Problem. ";
                    textToRead = textEl.innerText;
                    preferredVoiceName = "Emma"; // Microsoft Emma
                    preferredGender = "female";
                    break;
                case 'mechanism':
                    intro = "Nature's Trick. ";
                    textToRead = textEl.innerText;
                    preferredVoiceName = "Brian"; // Microsoft Brian
                    preferredGender = "male";
                    break;
                case 'mentor':
                    intro = "Teacher. ";
                    textToRead = textEl.innerText;
                    preferredVoiceName = "Ava"; // Microsoft Ava
                    preferredGender = "female";
                    break;
                case 'invention':
                    intro = "Invention. ";
                    textToRead = textEl.innerText;
                    preferredVoiceName = "Andrew"; // Microsoft Andrew
                    preferredGender = "male";
                    break;
                case 'vocab':
                    intro = "Say it. ";
                    textToRead = textEl.innerText;
                    preferredVoiceName = "Ava"; // Microsoft Ava
                    preferredGender = "female";
                    break;
            }

            const utterance = new SpeechSynthesisUtterance(intro + textToRead);
            
            // Sync Visuals with Audio Start
            utterance.onstart = function() {
                textEl.classList.add('reading-active');
            };

            // Sync Visuals with Audio End
            utterance.onend = function() {
                textEl.classList.remove('reading-active');
            };
            
            if (!voices.length) voices = window.speechSynthesis.getVoices();
            
            // 1. Try to find the exact preferred Microsoft voice
            let selectedVoice = voices.find(v => v.name.includes(preferredVoiceName) && v.name.includes("Microsoft"));
            
            // 2. Fallback: Try finding the name without "Microsoft"
            if (!selectedVoice) {
                selectedVoice = voices.find(v => v.name.includes(preferredVoiceName));
            }

            // 3. Fallback: Gender matching
            if (!selectedVoice) {
                if (preferredGender === 'female') {
                    selectedVoice = voices.find(v => v.name.includes("Female") || v.name.includes("Google US English") || v.name.includes("Samantha"));
                } else {
                    selectedVoice = voices.find(v => v.name.includes("Male") || v.name.includes("Google UK English Male") || v.name.includes("David"));
                }
            }

            // 4. Final Fallback: Any English voice
            if (!selectedVoice) {
                 selectedVoice = voices.find(v => v.lang.startsWith('en'));
            }

            if (selectedVoice) {
                utterance.voice = selectedVoice;
            }

            // Student personalization: Slower rate
            utterance.rate = 0.85; 

            window.speechSynthesis.speak(utterance);
        }

        function fillBlanks() {
            // Cancel speech if user clicks while reading
            window.speechSynthesis.cancel();
            resetAllFonts();

            // 1. Pick Data
            const item = biomimicryData[Math.floor(Math.random() * biomimicryData.length)];

            // 2. Change Border Color Randomly
            const colors = ['border-sky-500', 'border-indigo-500', 'border-purple-500', 'border-emerald-500', 'border-rose-500'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            cardDisplay.className = `bg-white rounded-2xl shadow-xl min-h-[600px] flex flex-col p-0 border-l-[10px] ${randomColor} relative overflow-hidden transition-all duration-300`;

            // 3. Update Text with Animation Class
            updateFieldWithAnim(fields.problem, item.problem);
            updateFieldWithAnim(fields.mechanism, item.mechanism);
            updateFieldWithAnim(fields.mentor, item.mentor);
            updateFieldWithAnim(fields.invention, item.invention);
            updateFieldWithAnim(fields.vocab, item.vocab);

            // 4. Trigger Burst Effect
            createNatureBurst();
        }

        function updateFieldWithAnim(element, text) {
            // Remove animation class if present to restart it
            element.classList.remove('reveal-text');
            void element.offsetWidth; // trigger reflow
            
            element.innerText = text;
            element.classList.add('reveal-text');
        }

        function createNatureBurst() {
            const container = document.getElementById('card-display');
            const center = document.getElementById('burst-center');
            const emojis = ['üçÉ', 'üå∏', '‚ú®', 'üíß', 'ü¶ã', 'üçÑ', 'üåø', '‚òÄÔ∏è', 'üêû'];
            
            // Create 30 particles
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.classList.add('emoji-particle');
                particle.innerText = emojis[Math.floor(Math.random() * emojis.length)];
                
                // Random destination coordinates
                const tx = (Math.random() - 0.5) * 400 + 'px'; 
                const ty = (Math.random() - 0.5) * 400 + 'px';
                const rot = (Math.random() * 360) + 'deg';

                particle.style.setProperty('--tx', tx);
                particle.style.setProperty('--ty', ty);
                particle.style.setProperty('--rot', rot);
                
                particle.style.left = '50%';
                particle.style.top = '50%';

                container.appendChild(particle);

                setTimeout(() => {
                    particle.remove();
                }, 1000);
            }
        }
    </script>
</body>
</html>
