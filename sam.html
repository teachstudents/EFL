<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trinity GESE 4 Interactive Classroom</title>
    
    <!-- Tailwind CSS (Styling) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (Core Logic) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (To understand JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom Animations */
        @keyframes floatUp {
            0% { transform: translateY(0px) rotate(0deg) scale(1); opacity: 1; }
            100% { transform: translateY(-150px) rotate(360deg) scale(1.2); opacity: 0; }
        }
        .animate-float-up {
            animation: floatUp 1.5s ease-out forwards;
        }
        
        /* Custom Scrollbar for cleaner look */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 overflow-hidden h-screen">
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // --- ICON COMPONENTS ---
        const Icon = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        
        const Play = ({ className }) => <Icon className={className}><polygon points="5 3 19 12 5 21 5 3"></polygon></Icon>;
        const RotateCcw = ({ className }) => <Icon className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"></path><path d="M3 3v9h9"></path></Icon>;
        const MessageSquare = ({ className }) => <Icon className={className}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></Icon>;
        const BookOpen = ({ className }) => <Icon className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></Icon>;
        const AlertCircle = ({ className }) => <Icon className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></Icon>;
        const Star = ({ className }) => <Icon className={className}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></Icon>;
        const Trophy = ({ className }) => <Icon className={className}><path d="M8 21h8"></path><path d="M12 17v4"></path><path d="M7 4h10"></path><path d="M17 4v3a5 5 0 0 1-10 0V4"></path><path d="M7 4H5a2 2 0 0 0-2 2v2a3 3 0 0 0 3 3h1"></path><path d="M17 4h2a2 2 0 0 1 2 2v2a3 3 0 0 1-3 3h-1"></path></Icon>;
        const Clock = ({ className }) => <Icon className={className}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></Icon>;
        const CheckSquare = ({ className }) => <Icon className={className}><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></Icon>;

        // --- APP DATA ---

        const conversationData = {
            holidays: {
                title: "Holidays (å‡æœŸ)",
                icon: "âœˆï¸",
                color: "bg-blue-100 border-blue-300",
                vocab: ["flight (èˆªç­)", "hotel (é…’åº—)", "souvenir (çºªå¿µå“)", "scenery (é£Žæ™¯)", "relax (æ”¾æ¾)"],
                questions: [
                    "Where do you usually go on holiday?",
                    "Where did you go on your last holiday?",
                    "What did you do there?",
                    "Where are you going to go for your next holiday?",
                    "Which is better: beach holidays or mountain holidays?",
                    "Do you prefer travelling by car or by plane?",
                    "Tell me about a holiday place you didn't like.",
                    "How often do you go on holiday?"
                ]
            },
            shopping: {
                title: "Shopping (è´­ç‰©)",
                icon: "ðŸ›ï¸",
                color: "bg-pink-100 border-pink-300",
                vocab: ["receipt (æ”¶æ®)", "discount (æ‰“æŠ˜)", "online (ç½‘è´­)", "expensive (è´µ)", "cheap (ä¾¿å®œ)"],
                questions: [
                    "Do you like shopping? Why or why not?",
                    "Where do you usually go shopping?",
                    "What did you buy last weekend?",
                    "Is it better to shop online or in a shop?",
                    "What are you going to buy next?",
                    "Which is better: cheap things or expensive things?",
                    "How often do you go to the supermarket?"
                ]
            },
            school: {
                title: "School (å­¦æ ¡)",
                icon: "ðŸ“š",
                color: "bg-yellow-100 border-yellow-300",
                vocab: ["subject (ç§‘ç›®)", "homework (ä½œä¸š)", "uniform (æ ¡æœ)", "exam (è€ƒè¯•)", "classmate (åŒå­¦)"],
                questions: [
                    "What subjects do you like?",
                    "What did you do at school yesterday?",
                    "What are you going to do at school tomorrow?",
                    "Which is easier: Math or English?",
                    "Tell me about your best teacher.",
                    "How much homework do you usually have?",
                    "What job do you want to do in the future?"
                ]
            },
            hobbies: {
                title: "Hobbies (çˆ±å¥½)",
                icon: "âš½",
                color: "bg-green-100 border-green-300",
                vocab: ["equipment (è£…å¤‡)", "team (é˜Ÿä¼)", "practice (ç»ƒä¹ )", "fun (æœ‰è¶£)", "exciting (åˆºæ¿€)"],
                questions: [
                    "What hobbies do you have?",
                    "How often do you play sports?",
                    "Did you play any sport last weekend?",
                    "Which is better: playing sports or video games?",
                    "What are you going to do after school today?",
                    "Do you prefer team sports or individual sports?",
                    "Are you going to learn a new hobby soon?"
                ]
            },
            food: {
                title: "Food (é£Ÿç‰©)",
                icon: "ðŸ•",
                color: "bg-red-100 border-red-300",
                vocab: ["delicious (ç¾Žå‘³)", "spicy (è¾£)", "healthy (å¥åº·)", "restaurant (é¤åŽ…)", "cook (åšé¥­)"],
                questions: [
                    "What do you usually eat for breakfast?",
                    "What did you eat yesterday?",
                    "What are you going to eat this weekend?",
                    "Which is better: rice or noodles?",
                    "Do you like sweet food or salty food?",
                    "Who cooks in your family?",
                    "Have you ever cooked something?"
                ]
            },
            weekend: {
                title: "Weekend (å‘¨æœ«)",
                icon: "ðŸŒ¤ï¸",
                color: "bg-purple-100 border-purple-300",
                vocab: ["relax (æ”¾æ¾)", "park (å…¬å›­)", "cinema (ç”µå½±é™¢)", "weather (å¤©æ°”)", "busy (å¿™ç¢Œ)"],
                questions: [
                    "What do you usually do at the weekend?",
                    "What did you do last weekend?",
                    "What are you going to do next weekend?",
                    "Which season do you like best? Why?",
                    "Which is better: summer or winter?",
                    "Do you prefer Saturdays or Sundays?",
                    "How often do you go to the park?"
                ]
            },
            // --- NEW TOPICS ---
            online: {
                title: "Online Life (ç½‘ç»œç”Ÿæ´»)",
                icon: "ðŸ’»",
                color: "bg-indigo-100 border-indigo-300",
                vocab: ["app (åº”ç”¨)", "chat (èŠå¤©)", "video call (è§†é¢‘é€šè¯)", "game (æ¸¸æˆ)", "wifi (ç½‘ç»œ)"],
                questions: [
                    "How often do you use the internet?",
                    "What did you do online yesterday?",
                    "Which is better: online classes or school classes?",
                    "What are you going to do on your phone later?",
                    "Do you like playing online games?",
                    "What is your favourite app?",
                    "Do you prefer watching TV or watching videos on a phone?"
                ]
            },
            city: {
                title: "My City (æˆ‘çš„åŸŽå¸‚)",
                icon: "ðŸ™ï¸",
                color: "bg-gray-100 border-gray-300",
                vocab: ["traffic (äº¤é€š)", "building (å»ºç­‘)", "museum (åšç‰©é¦†)", "crowded (æ‹¥æŒ¤)", "subway (åœ°é“)"],
                questions: [
                    "What do you like about your city?",
                    "Where did you go in your city last week?",
                    "Is your city better in summer or winter?",
                    "Where are you going to visit in your city next?",
                    "How often do you take the bus or subway?",
                    "Is your city crowded?",
                    "Tell me about a famous place in your city."
                ]
            },
            pets: {
                title: "Pets & Animals (å® ç‰©)",
                icon: "ðŸ±",
                color: "bg-orange-100 border-orange-300",
                vocab: ["cute (å¯çˆ±)", "feed (å–‚å…»)", "fur (æ¯›)", "wild (é‡Žç”Ÿ)", "take care (ç…§é¡¾)"],
                questions: [
                    "Do you have a pet?",
                    "What animal do you like best?",
                    "Did you see any animals yesterday?",
                    "Which is better: cats or dogs?",
                    "Are you going to get a pet in the future?",
                    "Have you ever been to a zoo?",
                    "What animal are you afraid of?"
                ]
            },
            music: {
                title: "Music & Movies (éŸ³ä¹ç”µå½±)",
                icon: "ðŸŽµ",
                color: "bg-rose-100 border-rose-300",
                vocab: ["singer (æ­Œæ‰‹)", "loud (å¤§å£°)", "movie (ç”µå½±)", "pop music (æµè¡Œä¹)", "cinema (å½±é™¢)"],
                questions: [
                    "What kind of music do you like?",
                    "When do you usually listen to music?",
                    "What movie did you watch last time?",
                    "Which is better: watching movies at home or at the cinema?",
                    "Are you going to watch a movie this weekend?",
                    "Can you play a musical instrument?",
                    "Who is your favourite singer?"
                ]
            },
            daily: {
                title: "Daily Routine (æ—¥å¸¸ç”Ÿæ´»)",
                icon: "â°",
                color: "bg-teal-100 border-teal-300",
                vocab: ["wake up (èµ·åºŠ)", "brush teeth (åˆ·ç‰™)", "breakfast (æ—©é¤)", "tired (ç´¯)", "early (æ—©)"],
                questions: [
                    "What time do you usually wake up?",
                    "What did you do before bed last night?",
                    "What are you going to do tomorrow morning?",
                    "Which is better: getting up early or late?",
                    "How often do you exercise?",
                    "Do you have a busy routine?",
                    "What time do you go to sleep?"
                ]
            }
        };

        const mockExams = [
            { id: 1, title: "Mock 1: Volcano Exp. (ç«å±±å®žéªŒ)", topic: "My Volcano Experiment", areas: ["Hobbies & Sports", "Food"], vocab: ["vinegar (é†‹)", "baking soda (å°è‹æ‰“)", "lava (å²©æµ†)", "experiment (å®žéªŒ)", "messy (è„ä¹±)", "exciting (åˆºæ¿€)"], script: [ { role: "E", text: "Hello! How are you today? Let's start with your topic." }, { role: "C", text: "My topic is my volcano experiment." }, { role: "E", text: "Great. Tell me about it." }, { role: "E", text: "What did you do last time?" }, { role: "E", text: "What was the best part?" }, { role: "E", text: "Is this experiment better than other experiments?" }, { role: "E", text: "What are you going to do next time?" }, { role: "Note", text: "WAIT: Student must ask: 'Do you like science experiments?'" }, { role: "E", text: "Let's talk about Hobbies. What hobbies do you like?" }, { role: "E", text: "How often do you play sports?" }, { role: "E", text: "Did you play last weekend?" }, { role: "E", text: "Now Food. What do you usually eat for breakfast?" }, { role: "E", text: "What did you eat yesterday?" }, { role: "E", text: "What are you going to eat this weekend?" } ] },
            { id: 2, title: "Mock 2: Spring Festival (æ˜¥èŠ‚)", topic: "Best Spring Festival Moment", areas: ["Weekend & Seasons", "School & Work"], vocab: ["dumplings (é¥ºå­)", "grandparents (ç¥–çˆ¶æ¯)", "ugly (ä¸‘)", "tradition (ä¼ ç»Ÿ)", "family time (å®¶åº­æ—¶å…‰)"], script: [ { role: "E", text: "What's your topic today?" }, { role: "C", text: "My topic is my best Spring Festival moment." }, { role: "E", text: "Tell me about it." }, { role: "E", text: "What did you do last Spring Festival?" }, { role: "E", text: "Which was better: making dumplings or eating them?" }, { role: "E", text: "What are you going to do next year?" }, { role: "Note", text: "WAIT: Student must ask: 'What do you usually do for Spring Festival?'" }, { role: "E", text: "Conversation 1: Weekend Activities. What do you usually do at weekends?" }, { role: "E", text: "What did you do last weekend?" }, { role: "E", text: "What are you going to do next weekend?" }, { role: "E", text: "Conversation 2: School. What subjects do you like at school?" }, { role: "E", text: "What did you do at school yesterday?" }, { role: "E", text: "Which is easier, math or English?" } ] },
            { id: 3, title: "Mock 3: Magnet Challenge (ç£é“)", topic: "My Magnet Challenge", areas: ["Shopping", "Food"], vocab: ["test (æµ‹è¯•)", "metal (é‡‘å±ž)", "plastic (å¡‘æ–™)", "stick (å¸é™„)", "coins (ç¡¬å¸)", "paper clip (å›žå½¢é’ˆ)"], script: [ { role: "E", text: "Tell me your topic." }, { role: "C", text: "My topic is my magnet challenge." }, { role: "E", text: "What do you do in this challenge?" }, { role: "E", text: "What did you test last week?" }, { role: "E", text: "Which object was the best?" }, { role: "E", text: "What are you going to test next?" }, { role: "Note", text: "WAIT: Student must ask: 'Have you ever played with magnets?'" }, { role: "E", text: "Let's talk about Shopping. Where do you usually buy snacks?" }, { role: "E", text: "What did you buy last time?" }, { role: "E", text: "What are you going to buy next time?" }, { role: "E", text: "Now Food. What food do you like?" }, { role: "E", text: "What did you eat yesterday?" }, { role: "E", text: "Which is better, rice or noodles?" } ] },
            { id: 4, title: "Mock 4: Mooncake Rank (æœˆé¥¼æŽ’å)", topic: "My Mooncake Ranking", areas: ["Holidays", "Weekend & Seasons"], vocab: ["ranking (æŽ’å)", "flavour (å£å‘³)", "lotus seed (èŽ²è“‰)", "sweet (ç”œ)", "share (åˆ†äº«)", "festival (èŠ‚æ—¥)"], script: [ { role: "E", text: "What's your topic?" }, { role: "C", text: "My topic is my mooncake ranking." }, { role: "E", text: "Tell me about your ranking." }, { role: "E", text: "What happened last year?" }, { role: "E", text: "Which flavour is the best?" }, { role: "E", text: "What are you going to do next festival?" }, { role: "Note", text: "WAIT: Student must ask: 'What's your favourite mooncake flavour?'" }, { role: "E", text: "Holidays. Where did you go on your last holiday?" }, { role: "E", text: "Which is better: travelling or staying at home?" }, { role: "E", text: "Where are you going to go next holiday?" }, { role: "E", text: "Weekend Activities. What do you usually do on weekends?" }, { role: "E", text: "What are you going to do next weekend?" } ] },
            { id: 5, title: "Mock 5: Minecraft Build (æˆ‘çš„ä¸–ç•Œ)", topic: "My Minecraft Build", areas: ["School", "Hobbies"], vocab: ["creeper (è‹¦åŠ›æ€•)", "explode (çˆ†ç‚¸)", "base (åŸºåœ°)", "safe (å®‰å…¨)", "survival (ç”Ÿå­˜)", "creative (åˆ›é€ )"], script: [ { role: "E", text: "Tell me about your topic." }, { role: "C", text: "My topic is my Minecraft build." }, { role: "E", text: "What happened when you played yesterday?" }, { role: "E", text: "Why is your new base better than your old base?" }, { role: "E", text: "What are you going to build next weekend?" }, { role: "Note", text: "WAIT: Student must ask: 'What games do you like?'" }, { role: "E", text: "School. What is your favourite subject?" }, { role: "E", text: "What did you do at school yesterday?" }, { role: "E", text: "What are you going to do tomorrow?" }, { role: "E", text: "Hobbies. How often do you play games?" }, { role: "E", text: "Which is better: sports or games?" }, { role: "E", text: "What did you do last weekend?" } ] },
            { id: 6, title: "Mock 6: Zongzi Test (ç²½å­æµ‹è¯•)", topic: "Zongzi Taste Test", areas: ["Food", "Shopping"], vocab: ["salty (å’¸)", "sweet (ç”œ)", "sticky rice (ç³¯ç±³)", "bamboo (ç«¹å­)", "Dragon Boat (ç«¯åˆèŠ‚)"], script: [ { role: "E", text: "Please tell me your topic." }, { role: "C", text: "My topic is my zongzi taste test." }, { role: "E", text: "What did you try last Dragon Boat Festival?" }, { role: "E", text: "Which flavour is better: sweet or salty?" }, { role: "E", text: "What are you going to try next time?" }, { role: "Note", text: "WAIT: Student must ask: 'Do you like sweet or salty food?'" }, { role: "E", text: "Food. What do you usually eat for breakfast?" }, { role: "E", text: "What did you eat yesterday?" }, { role: "E", text: "Shopping. Where do you usually go shopping?" }, { role: "E", text: "What did you buy last time?" }, { role: "E", text: "What are you going to buy next?" } ] },
            { id: 7, title: "Mock 7: High-Speed Rail (é«˜é“)", topic: "My High-Speed Rail Trip", areas: ["Holidays", "School"], vocab: ["comfortable (èˆ’é€‚)", "fast (å¿«)", "scenery (é£Žæ™¯)", "station (è½¦ç«™)", "flexible (çµæ´»)"], script: [ { role: "E", text: "What is your topic?" }, { role: "C", text: "My topic is my high-speed rail trip." }, { role: "E", text: "Tell me about your trip last month." }, { role: "E", text: "Compare the train and the car. Which is faster?" }, { role: "E", text: "Where are you going to go next holiday?" }, { role: "Note", text: "WAIT: Student must ask: 'Do you like travelling by train or car?'" }, { role: "E", text: "Holidays. Where did you go last holiday?" }, { role: "E", text: "What did you do there?" }, { role: "E", text: "School. What time do you start school?" }, { role: "E", text: "What did you do at school yesterday?" }, { role: "E", text: "Which is easier: English or Math?" } ] },
            { id: 8, title: "Mock 8: School Club (å­¦æ ¡ç¤¾å›¢)", topic: "My School Club Project", areas: ["School", "Weekend"], vocab: ["project (é¡¹ç›®)", "teamwork (å›¢é˜Ÿåˆä½œ)", "model (æ¨¡åž‹)", "skill (æŠ€èƒ½)", "hands-on (åŠ¨æ‰‹)"], script: [ { role: "E", text: "Let's hear your topic." }, { role: "C", text: "My topic is my school club project." }, { role: "E", text: "What did you build yesterday?" }, { role: "E", text: "Why is club time better than normal class time?" }, { role: "E", text: "What are you going to build next month?" }, { role: "Note", text: "WAIT: Student must ask: 'Did you join a club at school?'" }, { role: "E", text: "School. What subjects do you like?" }, { role: "E", text: "What did you do at school yesterday?" }, { role: "E", text: "Weekend. What do you usually do at weekends?" }, { role: "E", text: "What are you going to do next weekend?" } ] }
        ];

        const sampleTopics = {
            "volcano": { title: "Volcano Experiment (ç«å±±å®žéªŒ)", point1: "NOW: I like science. I do experiments at home sometimes.", point2: "PAST: Last weekend I mixed vinegar and baking soda...", point3: "COMPARE: This experiment is better than my paper plane...", point4: "FUTURE: Next week Iâ€™m going to change the bottle...", question: "Do you like science experiments?", vocab: ["vinegar (é†‹)", "baking soda (å°è‹æ‰“)", "eruption (çˆ†å‘)", "lava (å²©æµ†)"] },
            "rail": { title: "High-Speed Rail Trip (é«˜é“ä¹‹æ—…)", point1: "NOW: I like travelling by train. Itâ€™s comfortable and fast.", point2: "PAST: Last month I went to another city...", point3: "COMPARE: The train is faster than the car...", point4: "FUTURE: Next holiday Iâ€™m going to visit a museum...", question: "Do you like travelling by train?", vocab: ["comfortable (èˆ’é€‚)", "scenery (é£Žæ™¯)", "fast (å¿«)", "ticket (è½¦ç¥¨)"] },
            "minecraft": { title: "Minecraft Build (æˆ‘çš„ä¸–ç•Œå»ºç­‘)", point1: "NOW: I play Minecraft once a week...", point2: "PAST: Yesterday I built a tall tower...", point3: "COMPARE: My new base is better than my old base...", point4: "FUTURE: Next weekend Iâ€™m going to build a farm...", question: "What games do you like?", vocab: ["creeper (è‹¦åŠ›æ€•)", "tower (å¡”)", "survival (ç”Ÿå­˜)", "creative (åˆ›é€ )"] },
            "spring": { title: "Spring Festival Moment (æ˜¥èŠ‚æ—¶åˆ»)", point1: "NOW: Spring Festival is important...", point2: "PAST: Last year I visited grandparents...", point3: "COMPARE: This year was better than last year...", point4: "FUTURE: Next year Iâ€™m going to help more...", question: "What do you usually do for Spring Festival?", vocab: ["dumplings (é¥ºå­)", "reunion (å›¢åœ†)", "fireworks (çƒŸèŠ±)", "ugly (ä¸‘)"] },
            "zongzi": { title: "Zongzi Taste Test (ç²½å­æµ‹è¯•)", point1: "NOW: I like eating zongzi...", point2: "PAST: Last Dragon Boat Festival I tried two kinds...", point3: "COMPARE: Sweet zongzi is better than salty...", point4: "FUTURE: Next time Iâ€™m going to try a new flavour...", question: "Sweet or salty?", vocab: ["salty (å’¸)", "sweet (ç”œ)", "sticky rice (ç³¯ç±³)", "bamboo (ç«¹)"] },
            "magnet": { title: "Magnet Challenge (ç£é“æŒ‘æˆ˜)", point1: "NOW: I like testing things...", point2: "PAST: Last week I tested coins, keys...", point3: "COMPARE: Keys are better than coins...", point4: "FUTURE: Next week Iâ€™m going to test more...", question: "Have you ever played with magnets?", vocab: ["attract (å¸å¼•)", "metal (é‡‘å±ž)", "strong (å¼º)", "test (æµ‹è¯•)"] },
            "club": { title: "School Club Project (å­¦æ ¡ç¤¾å›¢)", point1: "NOW: Iâ€™m in a school club...", point2: "PAST: Yesterday we built a simple model...", point3: "COMPARE: Club time is better than normal class...", point4: "FUTURE: Next month Iâ€™m going to learn...", question: "Did you join a club?", vocab: ["hands-on (åŠ¨æ‰‹)", "teamwork (å›¢é˜Ÿ)", "skill (æŠ€èƒ½)", "fix (ä¿®ç†)"] },
            "mooncake": { title: "Mooncake Ranking (æœˆé¥¼æŽ’å)", point1: "NOW: I enjoy mooncakes...", point2: "PAST: Last year I tried three flavours...", point3: "COMPARE: My favourite flavour is better...", point4: "FUTURE: Next festival Iâ€™m going to try...", question: "Favourite mooncake?", vocab: ["lotus seed (èŽ²è“‰)", "smooth (ç»†è…»)", "share (åˆ†äº«)", "traditional (ä¼ ç»Ÿ)"] }
        };

        // --- COMPONENTS DEFINED OUTSIDE APP (To fix resetting issue) ---

        const PhaseTimer = ({ timeLeft, timerActive, toggleTimer, resetTimer, formatTime }) => (
            <div className={`flex items-center gap-2 px-3 py-1 rounded-lg border ${timeLeft < 30 ? 'bg-red-100 border-red-500 text-red-700 animate-pulse' : 'bg-white border-gray-200 text-gray-700'}`}>
                <Clock className="w-4 h-4" />
                <span className="font-mono font-bold text-lg w-12 text-center">{formatTime(timeLeft)}</span>
                <button onClick={toggleTimer} className="text-xs font-bold hover:text-blue-600">{timerActive ? 'PAUSE' : 'START'}</button>
                <button onClick={resetTimer} className="text-xs font-bold hover:text-red-600">RESET</button>
            </div>
        );

        const GrammarChecklist = ({ onReward }) => {
            const [checkedItems, setCheckedItems] = useState({
                future: false,
                but: false,
                compare: false,
                past: false,
                question: false
            });

            const handleCheck = (key) => {
                if (!checkedItems[key]) {
                    onReward(5); // +5 points for new check
                    setCheckedItems(prev => ({ ...prev, [key]: true }));
                } else {
                    setCheckedItems(prev => ({ ...prev, [key]: false }));
                }
            };

            return (
                <div className="bg-blue-50 p-3 rounded-lg border border-blue-100 mt-2">
                    <div className="text-xs font-bold text-blue-800 uppercase mb-2 flex items-center gap-1"><CheckSquare size={12}/> Grammar Check (+5 pts)</div>
                    <div className="space-y-2">
                        {[
                            { k: 'future', label: 'Going to (Future)' },
                            { k: 'but', label: 'Linker: "But"' },
                            { k: 'compare', label: 'Comparative (-er)' },
                            { k: 'past', label: 'Past Tense' },
                            { k: 'question', label: 'Asked Question?' }
                        ].map(item => (
                            <button 
                                key={item.k}
                                onClick={() => handleCheck(item.k)}
                                className={`w-full text-left text-xs px-2 py-1 rounded flex items-center gap-2 transition-all ${checkedItems[item.k] ? 'bg-green-500 text-white line-through opacity-80' : 'bg-white text-gray-700 hover:bg-blue-100'}`}
                            >
                                <div className={`w-3 h-3 rounded border ${checkedItems[item.k] ? 'bg-white border-white' : 'border-gray-400'}`}></div>
                                {item.label}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const ConversationTool = ({ timerProps }) => {
            const [selectedArea, setSelectedArea] = useState(null);
            const [currentQuestion, setCurrentQuestion] = useState(null);

            const pickRandomQuestion = (areaKey) => {
                const qs = conversationData[areaKey].questions;
                const randomQ = qs[Math.floor(Math.random() * qs.length)];
                setCurrentQuestion(randomQ);
            };

            return (
                <div className="flex flex-col h-full overflow-hidden">
                    <div className="flex justify-between items-center mb-2 flex-shrink-0">
                        <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                            <MessageSquare className="w-6 h-6 text-blue-600" />
                            Conversation (5 mins)
                        </h2>
                        <PhaseTimer {...timerProps} />
                    </div>
                    
                    <div className="flex-shrink-0 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2 mb-3 max-h-[120px] overflow-y-auto">
                        {Object.entries(conversationData).map(([key, data]) => (
                            <button
                            key={key}
                            onClick={() => { setSelectedArea(key); pickRandomQuestion(key); }}
                            className={`p-2 rounded-lg border-2 transition-all flex flex-col items-center text-center ${
                                selectedArea === key 
                                ? 'border-blue-600 shadow-md bg-white' 
                                : 'border-transparent opacity-80 hover:opacity-100 hover:bg-white/50'
                            } ${data.color}`}
                            >
                            <div className="text-xl">{data.icon}</div>
                            <div className="font-bold text-gray-800 text-[10px] leading-tight mt-1">{data.title}</div>
                            </button>
                        ))}
                    </div>

                    <div className="flex-grow flex gap-4 overflow-hidden">
                        <div className="flex-grow bg-white rounded-xl shadow-inner border border-gray-200 p-6 flex flex-col items-start justify-center text-left relative transition-all">
                        {selectedArea ? (
                            <>
                            <span className="absolute top-4 left-4 text-xs font-bold uppercase text-gray-400 tracking-wider">
                                Current Subject: {conversationData[selectedArea].title}
                            </span>
                            <p className="text-2xl md:text-3xl font-medium text-gray-800 leading-relaxed animate-in fade-in slide-in-from-left-4 duration-500">
                                "{currentQuestion}"
                            </p>
                            <div className="mt-8">
                                <button 
                                onClick={() => pickRandomQuestion(selectedArea)}
                                className="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-full font-bold shadow-md active:transform active:scale-95 transition-all flex items-center gap-2"
                                >
                                <RotateCcw className="w-4 h-4" /> Next Question
                                </button>
                            </div>
                            </>
                        ) : (
                            <div className="w-full text-center text-gray-400 flex flex-col items-center">
                            <Star className="w-12 h-12 mb-2 opacity-20" />
                            <p>Select a topic above to start.</p>
                            </div>
                        )}
                        </div>

                        {selectedArea && (
                            <div className="hidden md:block w-48 bg-yellow-50 rounded-xl border border-yellow-100 p-4 overflow-y-auto flex-shrink-0 animate-in fade-in slide-in-from-right-4">
                                <div className="flex items-center gap-2 mb-3 text-yellow-800 font-bold border-b border-yellow-200 pb-2">
                                    <BookOpen size={16} /> Word Bank
                                </div>
                                <ul className="space-y-2">
                                    {conversationData[selectedArea].vocab.map((word, i) => (
                                        <li key={i} className="bg-white px-2 py-1 rounded text-sm text-gray-700 shadow-sm border border-yellow-100">
                                            {word}
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const MockExamTool = ({ timerProps, onReward }) => {
            const [selectedMock, setSelectedMock] = useState(null);
            const [lineIndex, setLineIndex] = useState(0);

            const handleNextLine = () => {
                if (selectedMock && lineIndex < selectedMock.script.length) {
                    setLineIndex(prev => prev + 1);
                }
            };

            return (
                <div className="h-full flex flex-col">
                        {!selectedMock ? (
                            <div className="h-full flex flex-col">
                            <div className="flex justify-between items-center mb-2 flex-shrink-0">
                                <h2 className="text-xl font-bold text-gray-800">Select Mock Exam</h2>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 overflow-y-auto pr-2 pb-2">
                                {mockExams.map(mock => (
                                <button
                                    key={mock.id}
                                    onClick={() => setSelectedMock(mock)}
                                    className="bg-white p-3 rounded-lg shadow-sm border border-gray-200 hover:border-blue-400 hover:shadow-md transition-all text-left group h-full"
                                >
                                    <div className="font-bold text-gray-800 group-hover:text-blue-600 text-sm">{mock.title}</div>
                                    <div className="text-xs text-gray-500 mt-1 line-clamp-1">{mock.topic}</div>
                                </button>
                                ))}
                            </div>
                        </div>
                    ) : (
                    <div className="flex flex-col h-full overflow-hidden">
                        <div className="flex items-center justify-between mb-2 border-b pb-2 flex-shrink-0">
                            <div className="flex items-center gap-4">
                                <h3 className="font-bold text-lg">{selectedMock.title}</h3>
                                <PhaseTimer {...timerProps} />
                            </div>
                            <button onClick={() => { setSelectedMock(null); setLineIndex(0); }} className="text-sm text-red-500 font-bold hover:bg-red-50 px-2 py-1 rounded">Exit</button>
                        </div>
                        
                        <div className="flex gap-4 h-full overflow-hidden">
                            <div className="flex-grow flex flex-col h-full overflow-hidden">
                                <div className="flex-grow overflow-y-auto bg-gray-50 rounded-xl p-4 mb-4 border border-gray-200 shadow-inner">
                                {selectedMock.script.slice(0, lineIndex + 1).map((line, idx) => (
                                    <div key={idx} className={`mb-3 flex ${line.role === 'E' ? 'justify-start' : (line.role === 'Note' ? 'justify-center' : 'justify-end')}`}>
                                        <div className={`max-w-[85%] rounded-2xl px-4 py-2 text-sm md:text-base shadow-sm
                                            ${line.role === 'E' ? 'bg-white text-gray-800 border-l-4 border-blue-500' : ''}
                                            ${line.role === 'C' ? 'bg-blue-100 text-blue-900 italic' : ''}
                                            ${line.role === 'Note' ? 'bg-yellow-100 text-yellow-800 font-bold border-2 border-yellow-300 animate-pulse text-center' : ''}
                                        `}>
                                            {line.text}
                                        </div>
                                    </div>
                                ))}
                                <div id="scroll-anchor"></div>
                                </div>
                                <div className="grid grid-cols-2 gap-3 flex-shrink-0">
                                    <button onClick={() => setLineIndex(0)} className="bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300">Restart</button>
                                    <button onClick={handleNextLine} disabled={lineIndex >= selectedMock.script.length - 1} className="bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 shadow-lg disabled:opacity-50 flex items-center justify-center gap-2">
                                        Next Line <Play className="w-4 h-4 fill-current" />
                                    </button>
                                </div>
                            </div>
                            <div className="hidden lg:flex flex-col w-48 gap-2 flex-shrink-0">
                                {/* WORD BANK */}
                                <div className="bg-yellow-50 rounded-xl border border-yellow-100 p-4 overflow-y-auto flex-grow h-1/2">
                                    <div className="flex items-center gap-2 mb-3 text-yellow-800 font-bold border-b border-yellow-200 pb-2"><BookOpen size={16} /> Word Bank</div>
                                    <ul className="space-y-2">
                                        {selectedMock.vocab.map((word, i) => (
                                            <li key={i} className="bg-white px-2 py-1 rounded text-sm text-gray-700 shadow-sm border border-yellow-100">{word}</li>
                                        ))}
                                    </ul>
                                </div>
                                
                                {/* GRAMMAR CHECKLIST */}
                                <GrammarChecklist onReward={onReward} />
                            </div>
                        </div>
                    </div>
                    )}
                </div>
            );
        };

        const TopicBuilder = ({ timerProps }) => {
            const [topicData, setTopicData] = useState({ title: "", point1: "", point2: "", point3: "", point4: "", question: "", vocab: [] });
            
            const loadTopic = (key) => {
                if(key === "") return;
                const t = sampleTopics[key];
                setTopicData({ 
                    title: t.title, 
                    point1: t.point1, 
                    point2: t.point2, 
                    point3: t.point3, 
                    point4: t.point4, 
                    question: t.question,
                    vocab: t.vocab 
                });
            };

            return (
                <div className="h-full overflow-hidden flex flex-col">
                    <div className="flex justify-between items-center mb-2 flex-shrink-0">
                        <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2"><BookOpen className="w-6 h-6 text-purple-600" /> Topic Planner</h2>
                        <div className="flex gap-4 items-center">
                            <PhaseTimer {...timerProps} />
                            <select onChange={(e) => loadTopic(e.target.value)} className="bg-purple-600 text-white text-xs font-bold py-1 px-3 rounded shadow-md border-none outline-none cursor-pointer max-w-[180px]">
                                <option value="">Load Topic...</option>
                                <option value="volcano">Volcano Exp.</option>
                                <option value="rail">High-Speed Rail</option>
                                <option value="minecraft">Minecraft</option>
                                <option value="spring">Spring Festival</option>
                                <option value="zongzi">Zongzi</option>
                                <option value="magnet">Magnet</option>
                                <option value="club">School Club</option>
                                <option value="mooncake">Mooncake</option>
                            </select>
                        </div>
                    </div>
                    
                    <div className="flex gap-4 h-full overflow-hidden">
                        {/* Main Form Area */}
                        <div className="bg-white p-1 rounded-xl shadow-sm border border-gray-200 overflow-y-auto flex-grow flex flex-col gap-1">
                            <div className="space-y-0.5">
                                <label className="text-[10px] font-bold uppercase text-gray-500">Topic Title</label>
                                <input readOnly value={topicData.title} type="text" className="w-full p-1 border rounded font-bold text-lg bg-gray-50" />
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-1 flex-grow">
                                <div className="p-1 border rounded bg-blue-50 flex flex-col">
                                    <label className="text-[10px] font-bold text-blue-600 block mb-0.5">1. Present</label>
                                    <textarea readOnly value={topicData.point1} className="w-full bg-white p-1 rounded text-sm resize-none flex-grow leading-tight"></textarea>
                                </div>
                                <div className="p-1 border rounded bg-green-50 flex flex-col">
                                    <label className="text-[10px] font-bold text-green-600 block mb-0.5">2. Past</label>
                                    <textarea readOnly value={topicData.point2} className="w-full bg-white p-1 rounded text-sm resize-none flex-grow leading-tight"></textarea>
                                </div>
                                <div className="p-1 border rounded bg-yellow-50 flex flex-col">
                                    <label className="text-[10px] font-bold text-yellow-600 block mb-0.5">3. Compare</label>
                                    <textarea readOnly value={topicData.point3} className="w-full bg-white p-1 rounded text-sm resize-none flex-grow leading-tight"></textarea>
                                </div>
                                <div className="p-1 border rounded bg-pink-50 flex flex-col">
                                    <label className="text-[10px] font-bold text-pink-600 block mb-0.5">4. Future</label>
                                    <textarea readOnly value={topicData.point4} className="w-full bg-white p-1 rounded text-sm resize-none flex-grow leading-tight"></textarea>
                                </div>
                            </div>

                            <div className="p-1 bg-red-50 border border-red-100 rounded flex items-center gap-2 flex-shrink-0">
                                <AlertCircle className="text-red-500 w-4 h-4" />
                                <div className="flex-grow">
                                    <label className="text-[10px] font-bold text-red-600 block">Question for Examiner:</label>
                                    <input readOnly value={topicData.question} type="text" className="w-full p-1 border rounded text-sm font-medium bg-white" />
                                </div>
                            </div>
                        </div>

                        {/* Word Bank Sidebar */}
                        <div className="hidden lg:flex flex-col w-40 gap-2 flex-shrink-0">
                            <div className="bg-purple-50 rounded-xl border border-purple-100 p-3 overflow-y-auto flex-grow">
                                <div className="flex items-center gap-2 mb-2 text-purple-800 font-bold border-b border-purple-200 pb-1 text-sm">
                                    <BookOpen size={14} /> Word Bank
                                </div>
                                {topicData.vocab.length > 0 ? (
                                    <ul className="space-y-1.5">
                                        {topicData.vocab.map((word, i) => (
                                            <li key={i} className="bg-white px-2 py-1 rounded text-xs text-gray-700 shadow-sm border border-purple-100 leading-tight">
                                                {word}
                                            </li>
                                        ))}
                                    </ul>
                                ) : (
                                    <div className="text-xs text-gray-400 text-center mt-4">Select a topic to see words</div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---

        const App = () => {
            const [activeTab, setActiveTab] = useState('conversation'); 
            const [score, setScore] = useState(0);
            const [rewards, setRewards] = useState([]);
            
            // Timer State
            const [timeLeft, setTimeLeft] = useState(300); // 5 minutes
            const [timerActive, setTimerActive] = useState(false);

            const playWinSound = useCallback(() => {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                const ctx = new AudioContext();
                const t = ctx.currentTime;
                [440, 554, 659, 880].forEach((freq, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = 'sine';
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(0.1, t + i * 0.05);
                    gain.gain.exponentialRampToValueAtTime(0.001, t + i * 0.05 + 0.5);
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.start(t + i * 0.05);
                    osc.stop(t + i * 0.05 + 0.5);
                });
            }, []);

            const triggerReward = useCallback((amount = 10) => {
                setScore(s => s + amount);
                playWinSound();
                const newRewards = Array.from({ length: 12 }).map((_, i) => ({
                    id: Date.now() + i,
                    x: 50 + (Math.random() * 40 - 20),
                    y: 50 + (Math.random() * 40 - 20),
                    emoji: ['ðŸª™', 'â­', 'âœ¨', 'ðŸ†'][Math.floor(Math.random() * 4)],
                    rotation: Math.random() * 360
                }));
                setRewards(prev => [...prev, ...newRewards]);
                setTimeout(() => setRewards(prev => prev.filter(r => r.id < Date.now())), 1500);
            }, [playWinSound]);

            // Timer Logic
            useEffect(() => {
                let interval = null;
                if (timerActive && timeLeft > 0) {
                    interval = setInterval(() => {
                        setTimeLeft(t => t - 1);
                    }, 1000);
                } else if (timeLeft === 0) {
                    setTimerActive(false);
                }
                return () => clearInterval(interval);
            }, [timerActive, timeLeft]);

            const formatTime = (seconds) => {
                const m = Math.floor(seconds / 60);
                const s = seconds % 60;
                return `${m}:${s < 10 ? '0' : ''}${s}`;
            };

            const toggleTimer = () => setTimerActive(!timerActive);
            const resetTimer = () => { setTimerActive(false); setTimeLeft(300); };

            const timerProps = { timeLeft, timerActive, toggleTimer, resetTimer, formatTime };

            return (
                <div className="bg-gray-100 font-sans text-gray-900 h-screen flex flex-col overflow-hidden">
                    {rewards.map(r => (<div key={r.id} className="animate-float-up absolute pointer-events-none z-50 text-4xl" style={{ left: `${r.x}%`, top: `${r.y}%` }}>{r.emoji}</div>))}

                    {/* Top Header */}
                    <header className="bg-slate-800 text-white p-2 shadow-md flex items-center justify-between shrink-0 h-12 z-20">
                        {/* Left: Nav Buttons */}
                        <div className="flex gap-2">
                            <button onClick={() => setActiveTab('conversation')} className={`flex items-center gap-1 px-3 py-1 rounded text-xs font-bold transition-all ${activeTab === 'conversation' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-700 hover:text-white'}`}>
                                <MessageSquare size={14} /> Talk
                            </button>
                            <button onClick={() => setActiveTab('mock')} className={`flex items-center gap-1 px-3 py-1 rounded text-xs font-bold transition-all ${activeTab === 'mock' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-700 hover:text-white'}`}>
                                <Play size={14} /> Mock
                            </button>
                            <button onClick={() => setActiveTab('dashboard')} className={`flex items-center gap-1 px-3 py-1 rounded text-xs font-bold transition-all ${activeTab === 'dashboard' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-700 hover:text-white'}`}>
                                <BookOpen size={14} /> Topic
                            </button>
                        </div>

                        {/* Right: Score */}
                        <div className="flex items-center gap-3">
                            <div className="bg-slate-700 rounded px-2 py-1 flex items-center gap-2">
                                <span className="text-[10px] text-slate-400 font-bold uppercase">Score</span>
                                <span className="text-sm font-black text-yellow-400">{score}</span>
                            </div>
                            <button onClick={() => triggerReward(10)} className="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-400 hover:to-orange-400 text-white font-bold py-1 px-3 rounded shadow-lg active:scale-95 flex items-center gap-1 text-xs">
                                <Trophy size={14} className="text-yellow-100" /> Award
                            </button>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="flex-grow p-4 h-full overflow-hidden relative flex flex-col">
                        <div className="bg-white rounded-xl shadow-lg h-full overflow-hidden border border-gray-200 flex-grow">
                            <div className="h-full p-4">
                                {activeTab === 'dashboard' && <TopicBuilder timerProps={timerProps} />}
                                {activeTab === 'conversation' && <ConversationTool timerProps={timerProps} />}
                                {activeTab === 'mock' && <MockExamTool timerProps={timerProps} onReward={triggerReward} />}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
