<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trinity GESE 4 Interactive Classroom</title>
    
    <!-- Tailwind CSS (Styling) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (Core Logic) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (To understand JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom Animations */
        @keyframes floatUp {
            0% { transform: translateY(0px) rotate(0deg) scale(1); opacity: 1; }
            100% { transform: translateY(-150px) rotate(360deg) scale(1.2); opacity: 0; }
        }
        .animate-float-up {
            animation: floatUp 1.5s ease-out forwards;
        }
        
        /* Custom Scrollbar for cleaner look */
        ::-webkit-scrollbar {
            width: 5px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; 
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; 
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 overflow-hidden h-screen">
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // --- ICON COMPONENTS ---
        const Icon = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        
        const Play = ({ className }) => <Icon className={className}><polygon points="5 3 19 12 5 21 5 3"></polygon></Icon>;
        const RotateCcw = ({ className }) => <Icon className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"></path><path d="M3 3v9h9"></path></Icon>;
        const MessageSquare = ({ className }) => <Icon className={className}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></Icon>;
        const BookOpen = ({ className }) => <Icon className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></Icon>;
        const AlertCircle = ({ className }) => <Icon className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></Icon>;
        const Star = ({ className }) => <Icon className={className}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></Icon>;
        const Trophy = ({ className }) => <Icon className={className}><path d="M8 21h8"></path><path d="M12 17v4"></path><path d="M7 4h10"></path><path d="M17 4v3a5 5 0 0 1-10 0V4"></path><path d="M7 4H5a2 2 0 0 0-2 2v2a3 3 0 0 0 3 3h1"></path><path d="M17 4h2a2 2 0 0 1 2 2v2a3 3 0 0 1-3 3h-1"></path></Icon>;
        const Clock = ({ className }) => <Icon className={className}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></Icon>;
        const CheckSquare = ({ className }) => <Icon className={className}><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></Icon>;

        // --- APP DATA ---

        const conversationData = {
            holidays: {
                title: "Holidays (å‡æœŸ)",
                icon: "âœˆï¸",
                color: "bg-blue-100 border-blue-300",
                vocab: ["flight (èˆªç­)", "hotel (é…’åº—)", "souvenir (çºªå¿µå“)", "scenery (é£Žæ™¯)", "relax (æ”¾æ¾)", "suitcase (æ‰‹æç®±)", "passport (æŠ¤ç…§)", "sightseeing (è§‚å…‰)", "beach (æµ·æ»©)", "mountain (å±±)", "tour guide (å¯¼æ¸¸)", "airport (æœºåœº)", "ticket (ç¥¨)", "map (åœ°å›¾)", "photos (ç…§ç‰‡)", "trip (æ—…è¡Œ)"],
                grammar: ["Past: I went to...", "Future: I'm going to...", "Compare: The beach is better than...", "Linker: It was fun, but hot."],
                questions: [
                    "Where do you usually go on holiday?",
                    "Where did you go on your last holiday?",
                    "What did you do there?",
                    "Where are you going to go for your next holiday?",
                    "Which is better: beach holidays or mountain holidays?",
                    "Do you prefer travelling by car or by plane?",
                    "Tell me about a holiday place you didn't like.",
                    "How often do you go on holiday?"
                ]
            },
            shopping: {
                title: "Shopping (è´­ç‰©)",
                icon: "ðŸ›ï¸",
                color: "bg-pink-100 border-pink-300",
                vocab: ["receipt (æ”¶æ®)", "discount (æ‰“æŠ˜)", "online (ç½‘è´­)", "expensive (è´µ)", "cheap (ä¾¿å®œ)", "supermarket (è¶…å¸‚)", "price (ä»·æ ¼)", "try on (è¯•ç©¿)", "cashier (æ”¶é“¶å‘˜)", "bargain (è®¨ä»·è¿˜ä»·)", "mall (å•†åœº)", "customer (é¡¾å®¢)", "change (é›¶é’±)", "size (å°ºå¯¸)", "fit (åˆèº«)", "pay (æ”¯ä»˜)"],
                grammar: ["Likes: I like buying...", "Past: I bought a...", "Compare: Online is cheaper than...", "Freq: I shop once a week."],
                questions: [
                    "Do you like shopping? Why or why not?",
                    "Where do you usually go shopping?",
                    "What did you buy last weekend?",
                    "Is it better to shop online or in a shop?",
                    "What are you going to buy next?",
                    "Which is better: cheap things or expensive things?",
                    "How often do you go to the supermarket?"
                ]
            },
            school: {
                title: "School (å­¦æ ¡)",
                icon: "ðŸ“š",
                color: "bg-yellow-100 border-yellow-300",
                vocab: ["subject (ç§‘ç›®)", "homework (ä½œä¸š)", "uniform (æ ¡æœ)", "exam (è€ƒè¯•)", "classmate (åŒå­¦)", "timetable (è¯¾è¡¨)", "teacher (è€å¸ˆ)", "library (å›¾ä¹¦é¦†)", "break time (è¯¾é—´)", "study (å­¦ä¹ )", "project (é¡¹ç›®)", "history (åŽ†å²)", "science (ç§‘å­¦)", "math (æ•°å­¦)", "art (ç¾Žæœ¯)", "strict (ä¸¥æ ¼)"],
                grammar: ["Likes: I enjoy math...", "Past: Yesterday I studied...", "Compare: Math is harder than...", "Future: I'm going to be a..."],
                questions: [
                    "What subjects do you like?",
                    "What did you do at school yesterday?",
                    "What are you going to do at school tomorrow?",
                    "Which is easier: Math or English?",
                    "Tell me about your best teacher.",
                    "How much homework do you usually have?",
                    "What job do you want to do in the future?"
                ]
            },
            hobbies: {
                title: "Hobbies (çˆ±å¥½)",
                icon: "âš½",
                color: "bg-green-100 border-green-300",
                vocab: ["equipment (è£…å¤‡)", "team (é˜Ÿä¼)", "practice (ç»ƒä¹ )", "fun (æœ‰è¶£)", "exciting (åˆºæ¿€)", "match (æ¯”èµ›)", "club (ä¿±ä¹éƒ¨)", "join (åŠ å…¥)", "win (èµ¢)", "lose (è¾“)", "hobby (çˆ±å¥½)", "collect (æ”¶é›†)", "paint (ç”»ç”»)", "read (é˜…è¯»)", "game (æ¸¸æˆ)", "player (é˜Ÿå‘˜)"],
                grammar: ["Freq: I play twice a week.", "Likes: I like playing...", "Past: I joined a club...", "Linker: I like X but I don't like Y."],
                questions: [
                    "What hobbies do you have?",
                    "How often do you play sports?",
                    "Did you play any sport last weekend?",
                    "Which is better: playing sports or video games?",
                    "What are you going to do after school today?",
                    "Do you prefer team sports or individual sports?",
                    "Are you going to learn a new hobby soon?"
                ]
            },
            food: {
                title: "Food (é£Ÿç‰©)",
                icon: "ðŸ•",
                color: "bg-red-100 border-red-300",
                vocab: ["delicious (ç¾Žå‘³)", "spicy (è¾£)", "healthy (å¥åº·)", "restaurant (é¤åŽ…)", "cook (åšé¥­)", "ingredients (é…æ–™)", "breakfast (æ—©é¤)", "lunch (åˆé¤)", "dinner (æ™šé¤)", "snack (é›¶é£Ÿ)", "sweet (ç”œ)", "salty (å’¸)", "bitter (è‹¦)", "sour (é…¸)", "fresh (æ–°é²œ)", "vegetables (è”¬èœ)"],
                grammar: ["Freq: I usually eat...", "Past: Last night I ate...", "Compare: Spicy is better than...", "Likes: I love sweet food."],
                questions: [
                    "What do you usually eat for breakfast?",
                    "What did you eat yesterday?",
                    "What are you going to eat this weekend?",
                    "Which is better: rice or noodles?",
                    "Do you like sweet food or salty food?",
                    "Who cooks in your family?",
                    "Have you ever cooked something?"
                ]
            },
            weekend: {
                title: "Weekend (å‘¨æœ«)",
                icon: "ðŸŒ¤ï¸",
                color: "bg-purple-100 border-purple-300",
                vocab: ["relax (æ”¾æ¾)", "park (å…¬å›­)", "cinema (ç”µå½±é™¢)", "weather (å¤©æ°”)", "busy (å¿™ç¢Œ)", "picnic (é‡Žé¤)", "visit (æ‹œè®¿)", "sleep late (ç¡æ‡’è§‰)", "watch TV (çœ‹ç”µè§†)", "homework (ä½œä¸š)", "hang out (é—²é€›)", "museum (åšç‰©é¦†)", "library (å›¾ä¹¦é¦†)", "tired (ç´¯)", "fun (å¥½çŽ©)", "plan (è®¡åˆ’)"],
                grammar: ["Future: I'm going to...", "Freq: I often go to...", "Past: I went to the...", "Linker: I wanted to go, but..."],
                questions: [
                    "What do you usually do at the weekend?",
                    "What did you do last weekend?",
                    "What are you going to do next weekend?",
                    "Which season do you like best? Why?",
                    "Which is better: summer or winter?",
                    "Do you prefer Saturdays or Sundays?",
                    "How often do you go to the park?"
                ]
            },
            // --- NEW TOPICS ---
            online: {
                title: "Online Life (ç½‘ç»œ)",
                icon: "ðŸ’»",
                color: "bg-indigo-100 border-indigo-300",
                vocab: ["app (åº”ç”¨)", "chat (èŠå¤©)", "video call (è§†é¢‘)", "game (æ¸¸æˆ)", "wifi (ç½‘ç»œ)", "internet (äº’è”ç½‘)", "smartphone (æ™ºèƒ½æ‰‹æœº)", "message (ä¿¡æ¯)", "download (ä¸‹è½½)", "website (ç½‘ç«™)", "social media (ç¤¾äº¤åª’ä½“)", "upload (ä¸Šä¼ )", "password (å¯†ç )", "safe (å®‰å…¨)", "link (é“¾æŽ¥)", "post (å‘å¸ƒ)"],
                grammar: ["Freq: I use it every day.", "Compare: Phone is better than...", "Likes: I like chatting...", "Past: I downloaded..."],
                questions: [
                    "How often do you use the internet?",
                    "What did you do online yesterday?",
                    "Which is better: online classes or school classes?",
                    "What are you going to do on your phone later?",
                    "Do you like playing online games?",
                    "What is your favourite app?",
                    "Do you prefer watching TV or watching videos on a phone?"
                ]
            },
            city: {
                title: "My City (æˆ‘çš„åŸŽå¸‚)",
                icon: "ðŸ™ï¸",
                color: "bg-gray-100 border-gray-300",
                vocab: ["traffic (äº¤é€š)", "building (å»ºç­‘)", "museum (åšç‰©é¦†)", "crowded (æ‹¥æŒ¤)", "subway (åœ°é“)", "park (å…¬å›­)", "famous (è‘—åçš„)", "shop (å•†åº—)", "noisy (åµé—¹)", "clean (å¹²å‡€)", "modern (çŽ°ä»£)", "tourist (æ¸¸å®¢)", "street (è¡—é“)", "bus stop (å…¬äº¤ç«™)", "center (ä¸­å¿ƒ)", "beautiful (ç¾Žä¸½)"],
                grammar: ["There is/are: There is a...", "Superlative: The best place...", "Future: I'm going to visit...", "Compare: It's bigger than..."],
                questions: [
                    "What do you like about your city?",
                    "Where did you go in your city last week?",
                    "Is your city better in summer or winter?",
                    "Where are you going to visit in your city next?",
                    "How often do you take the bus or subway?",
                    "Is your city crowded?",
                    "Tell me about a famous place in your city."
                ]
            },
            pets: {
                title: "Pets (å® ç‰©)",
                icon: "ðŸ±",
                color: "bg-orange-100 border-orange-300",
                vocab: ["cute (å¯çˆ±)", "feed (å–‚å…»)", "fur (æ¯›)", "wild (é‡Žç”Ÿ)", "take care (ç…§é¡¾)", "dog (ç‹—)", "cat (çŒ«)", "hamster (ä»“é¼ )", "fish (é±¼)", "walk (é›)", "play (çŽ©)", "bird (é¸Ÿ)", "rabbit (å…”å­)", "cage (ç¬¼å­)", "soft (è½¯)", "friendly (å‹å¥½)"],
                grammar: ["Compare: Dogs are friendlier...", "Likes: I love animals.", "Past: I fed my...", "Future: I'm going to get..."],
                questions: [
                    "Do you have a pet?",
                    "What animal do you like best?",
                    "Did you see any animals yesterday?",
                    "Which is better: cats or dogs?",
                    "Are you going to get a pet in the future?",
                    "Have you ever been to a zoo?",
                    "What animal are you afraid of?"
                ]
            },
            music: {
                title: "Music (éŸ³ä¹)",
                icon: "ðŸŽµ",
                color: "bg-rose-100 border-rose-300",
                vocab: ["singer (æ­Œæ‰‹)", "loud (å¤§å£°)", "movie (ç”µå½±)", "pop music (æµè¡Œä¹)", "cinema (å½±é™¢)", "instrument (ä¹å™¨)", "listen (å¬)", "headphones (è€³æœº)", "concert (éŸ³ä¹ä¼š)", "band (ä¹é˜Ÿ)", "song (æ­Œ)", "piano (é’¢ç´)", "guitar (å‰ä»–)", "violin (å°æç´)", "star (æ˜Žæ˜Ÿ)", "famous (å‡ºå)"],
                grammar: ["Likes: I like listening to...", "Adverb: I listen loudly.", "Past: I watched...", "Compare: Pop is better than..."],
                questions: [
                    "What kind of music do you like?",
                    "When do you usually listen to music?",
                    "What movie did you watch last time?",
                    "Which is better: watching movies at home or at the cinema?",
                    "Are you going to watch a movie this weekend?",
                    "Can you play a musical instrument?",
                    "Who is your favourite singer?"
                ]
            },
            daily: {
                title: "Daily Routine (æ—¥å¸¸)",
                icon: "â°",
                color: "bg-teal-100 border-teal-300",
                vocab: ["wake up (èµ·åºŠ)", "brush teeth (åˆ·ç‰™)", "breakfast (æ—©é¤)", "tired (ç´¯)", "early (æ—©)", "routine (ä¾‹è¡Œ)", "shower (æ´—æ¾¡)", "get dressed (ç©¿è¡£)", "bus (å…¬äº¤è½¦)", "sleep (ç¡è§‰)", "alarm (é—¹é’Ÿ)", "late (æ™š)", "lunch (åˆé¤)", "leave (ç¦»å¼€)", "arrive (åˆ°è¾¾)", "busy (å¿™)"],
                grammar: ["Time: I wake up at 7am.", "Freq: I always...", "Future: I'm going to sleep...", "Past: Yesterday I got up..."],
                questions: [
                    "What time do you usually wake up?",
                    "What did you do before bed last night?",
                    "What are you going to do tomorrow morning?",
                    "Which is better: getting up early or late?",
                    "How often do you exercise?",
                    "Do you have a busy routine?",
                    "What time do you go to sleep?"
                ]
            },
            friends: {
                title: "Friends (æœ‹å‹)",
                icon: "ðŸ‘«",
                color: "bg-cyan-100 border-cyan-300",
                vocab: ["best friend (æœ€å¥½çš„æœ‹å‹)", "friendly (å‹å¥½çš„)", "help (å¸®åŠ©)", "play (çŽ©)", "share (åˆ†äº«)", "secret (ç§˜å¯†)", "kind (å–„è‰¯)", "funny (æœ‰è¶£çš„)", "classmate (åŒå­¦)", "trust (ä¿¡ä»»)", "together (ä¸€èµ·)", "laugh (ç¬‘)", "present (ç¤¼ç‰©)", "visit (æ‹œè®¿)", "party (èšä¼š)"],
                grammar: ["Adjectives: He is kind.", "Freq: We often play...", "Past: We went to...", "Future: We are going to..."],
                questions: [
                    "Who is your best friend?",
                    "What do you usually do with your friends?",
                    "Do you prefer playing alone or with friends?",
                    "Tell me about a time you helped a friend.",
                    "What are you going to do with your friends this weekend?",
                    "Is it important to have many friends?"
                ]
            }
        };

        const mockExams = [
            { id: 1, title: "Mock 1: Volcano Exp. (ç«å±±å®žéªŒ)", topic: "My Volcano Experiment", areas: ["Hobbies & Sports", "Food"], vocab: ["vinegar (é†‹)", "baking soda (å°è‹æ‰“)", "lava (å²©æµ†)", "experiment (å®žéªŒ)", "messy (è„ä¹±)", "exciting (åˆºæ¿€)", "model (æ¨¡åž‹)", "science (ç§‘å­¦)", "chemical (åŒ–å­¦)", "reaction (ååº”)", "goggles (æŠ¤ç›®é•œ)", "pour (å€’)", "bubble (æ°”æ³¡)", "clean up (æ¸…ç†)", "fun (æœ‰è¶£)"], script: [ { role: "E", text: "Hello! How are you today? Let's start with your topic." }, { role: "C", text: "My topic is my volcano experiment." }, { role: "E", text: "Great. Tell me about it." }, { role: "E", text: "What did you do last time?" }, { role: "E", text: "What was the best part?" }, { role: "E", text: "Is this experiment better than other experiments?" }, { role: "E", text: "What are you going to do next time?" }, { role: "Note", text: "WAIT: Student must ask: 'Do you like science experiments?'" }, { role: "E", text: "Let's talk about Hobbies. What hobbies do you like?" }, { role: "E", text: "How often do you play sports?" }, { role: "E", text: "Did you play last weekend?" }, { role: "E", text: "Now Food. What do you usually eat for breakfast?" }, { role: "E", text: "What did you eat yesterday?" }, { role: "E", text: "What are you going to eat this weekend?" } ] },
            { id: 2, title: "Mock 2: Spring Festival (æ˜¥èŠ‚)", topic: "Best Spring Festival Moment", areas: ["Weekend & Seasons", "School & Work"], vocab: ["dumplings (é¥ºå­)", "grandparents (ç¥–çˆ¶æ¯)", "ugly (ä¸‘)", "tradition (ä¼ ç»Ÿ)", "family time (å®¶åº­æ—¶å…‰)", "red envelope (çº¢åŒ…)", "celebrate (åº†ç¥)", "decorate (è£…é¥°)", "dinner (æ™šé¤)", "special (ç‰¹åˆ«)", "visit (æ‹œè®¿)", "new clothes (æ–°è¡£)", "fireworks (çƒŸèŠ±)", "lucky (å¹¸è¿)", "happy (å¿«ä¹)"], script: [ { role: "E", text: "What's your topic today?" }, { role: "C", text: "My topic is my best Spring Festival moment." }, { role: "E", text: "Tell me about it." }, { role: "E", text: "What did you do last Spring Festival?" }, { role: "E", text: "Which was better: making dumplings or eating them?" }, { role: "E", text: "What are you going to do next year?" }, { role: "Note", text: "WAIT: Student must ask: 'What do you usually do for Spring Festival?'" }, { role: "E", text: "Conversation 1: Weekend Activities. What do you usually do at weekends?" }, { role: "E", text: "What did you do last weekend?" }, { role: "E", text: "What are you going to do next weekend?" }, { role: "E", text: "Conversation 2: School. What subjects do you like at school?" }, { role: "E", text: "What did you do at school yesterday?" }, { role: "E", text: "Which is easier, math or English?" } ] },
            { id: 3, title: "Mock 3: Magnet Challenge (ç£é“)", topic: "My Magnet Challenge", areas: ["Shopping", "Food"], vocab: ["test (æµ‹è¯•)", "metal (é‡‘å±ž)", "plastic (å¡‘æ–™)", "stick (å¸é™„)", "coins (ç¡¬å¸)", "paper clip (å›žå½¢é’ˆ)", "repel (æŽ’æ–¥)", "strong (å¼º)", "force (åŠ›)", "interesting (æœ‰è¶£)", "north pole (åŒ—æž)", "south pole (å—æž)", "push (æŽ¨)", "pull (æ‹‰)", "science (ç§‘å­¦)"], script: [ { role: "E", text: "Tell me your topic." }, { role: "C", text: "My topic is my magnet challenge." }, { role: "E", text: "What do you do in this challenge?" }, { role: "E", text: "What did you test last week?" }, { role: "E", text: "Which object was the best?" }, { role: "E", text: "What are you going to test next?" }, { role: "Note", text: "WAIT: Student must ask: 'Have you ever played with magnets?'" }, { role: "E", text: "Let's talk about Shopping. Where do you usually buy snacks?" }, { role: "E", text: "What did you buy last time?" }, { role: "E", text: "What are you going to buy next time?" }, { role: "E", text: "Now Food. What food do you like?" }, { role: "E", text: "What did you eat yesterday?" }, { role: "E", text: "Which is better, rice or noodles?" } ] },
            { id: 4, title: "Mock 4: Mooncake Rank (æœˆé¥¼æŽ’å)", topic: "My Mooncake Ranking", areas: ["Holidays", "Weekend & Seasons"], vocab: ["ranking (æŽ’å)", "flavour (å£å‘³)", "lotus seed (èŽ²è“‰)", "sweet (ç”œ)", "share (åˆ†äº«)", "festival (èŠ‚æ—¥)", "mid-autumn (ä¸­ç§‹)", "moon (æœˆäº®)", "round (åœ†)", "box (ç›’å­)", "gift (ç¤¼ç‰©)", "family (å®¶åº­)", "eat (åƒ)", "tea (èŒ¶)", "admire (æ¬£èµ)"], script: [ { role: "E", text: "What's your topic?" }, { role: "C", text: "My topic is my mooncake ranking." }, { role: "E", text: "Tell me about your ranking." }, { role: "E", text: "What happened last year?" }, { role: "E", text: "Which flavour is the best?" }, { role: "E", text: "What are you going to do next festival?" }, { role: "Note", text: "WAIT: Student must ask: 'What's your favourite mooncake flavour?'" }, { role: "E", text: "Holidays. Where did you go on your last holiday?" }, { role: "E", text: "Which is better: travelling or staying at home?" }, { role: "E", text: "Where are you going to go next holiday?" }, { role: "E", text: "Weekend Activities. What do you usually do on weekends?" }, { role: "E", text: "What are you going to do next weekend?" } ] },
            { id: 5, title: "Mock 5: Minecraft Build (æˆ‘çš„ä¸–ç•Œ)", topic: "My Minecraft Build", areas: ["School", "Hobbies"], vocab: ["creeper (è‹¦åŠ›æ€•)", "explode (çˆ†ç‚¸)", "base (åŸºåœ°)", "safe (å®‰å…¨)", "survival (ç”Ÿå­˜)", "creative (åˆ›é€ )", "blocks (æ–¹å—)", "build (å»ºé€ )", "design (è®¾è®¡)", "zombies (åƒµå°¸)", "night (å¤œæ™š)", "diamond (é’»çŸ³)", "tools (å·¥å…·)", "house (æˆ¿å­)", "fun (æœ‰è¶£)"], script: [ { role: "E", text: "Tell me about your topic." }, { role: "C", text: "My topic is my Minecraft build." }, { role: "E", text: "What happened when you played yesterday?" }, { role: "E", text: "Why is your new base better than your old base?" }, { role: "E", text: "What are you going to build next weekend?" }, { role: "Note", text: "WAIT: Student must ask: 'What games do you like?'" }, { role: "E", text: "School. What is your favourite subject?" }, { role: "E", text: "What did you do at school yesterday?" }, { role: "E", text: "What are you going to do tomorrow?" }, { role: "E", text: "Hobbies. How often do you play games?" }, { role: "E", text: "Which is better: sports or games?" }, { role: "E", text: "What did you do last weekend?" } ] },
            { id: 6, title: "Mock 6: Zongzi Test (ç²½å­æµ‹è¯•)", topic: "Zongzi Taste Test", areas: ["Food", "Shopping"], vocab: ["salty (å’¸)", "sweet (ç”œ)", "sticky rice (ç³¯ç±³)", "bamboo (ç«¹å­)", "Dragon Boat (ç«¯åˆèŠ‚)", "leaves (å¶å­)", "wrap (åŒ…è£¹)", "filling (é¦…æ–™)", "tradition (ä¼ ç»Ÿ)", "tasty (ç¾Žå‘³)", "pork (çŒªè‚‰)", "bean paste (è±†æ²™)", "boil (ç…®)", "grandmother (ç¥–æ¯)", "make (åˆ¶ä½œ)"], script: [ { role: "E", text: "Please tell me your topic." }, { role: "C", text: "My topic is my zongzi taste test." }, { role: "E", text: "What did you try last Dragon Boat Festival?" }, { role: "E", text: "Which flavour is better: sweet or salty?" }, { role: "E", text: "What are you going to try next time?" }, { role: "Note", text: "WAIT: Student must ask: 'Do you like sweet or salty food?'" }, { role: "E", text: "Food. What do you usually eat for breakfast?" }, { role: "E", text: "What did you eat yesterday?" }, { role: "E", text: "Shopping. Where do you usually go shopping?" }, { role: "E", text: "What did you buy last time?" }, { role: "E", text: "What are you going to buy next?" } ] },
            { id: 7, title: "Mock 7: High-Speed Rail (é«˜é“)", topic: "My High-Speed Rail Trip", areas: ["Holidays", "School"], vocab: ["comfortable (èˆ’é€‚)", "fast (å¿«)", "scenery (é£Žæ™¯)", "station (è½¦ç«™)", "flexible (çµæ´»)", "ticket (è½¦ç¥¨)", "seat (åº§ä½)", "modern (çŽ°ä»£)", "expensive (è´µ)", "convenient (æ–¹ä¾¿)", "arrive (åˆ°è¾¾)", "leave (ç¦»å¼€)", "passenger (ä¹˜å®¢)", "smooth (å¹³ç¨³)", "travel (æ—…è¡Œ)"], script: [ { role: "E", text: "What is your topic?" }, { role: "C", text: "My topic is my high-speed rail trip." }, { role: "E", text: "Tell me about your trip last month." }, { role: "E", text: "Compare the train and the car. Which is faster?" }, { role: "E", text: "Where are you going to go next holiday?" }, { role: "Note", text: "WAIT: Student must ask: 'Do you like travelling by train or car?'" }, { role: "E", text: "Holidays. Where did you go last holiday?" }, { role: "E", text: "What did you do there?" }, { role: "E", text: "School. What time do you start school?" }, { role: "E", text: "What did you do at school yesterday?" }, { role: "E", text: "Which is easier: English or Math?" } ] },
            { id: 8, title: "Mock 8: School Club (å­¦æ ¡ç¤¾å›¢)", topic: "My School Club Project", areas: ["School", "Weekend"], vocab: ["project (é¡¹ç›®)", "teamwork (å›¢é˜Ÿåˆä½œ)", "model (æ¨¡åž‹)", "skill (æŠ€èƒ½)", "hands-on (åŠ¨æ‰‹)", "build (å»ºé€ )", "learn (å­¦ä¹ )", "friends (æœ‹å‹)", "fun (æœ‰è¶£)", "join (åŠ å…¥)", "after school (æ”¾å­¦åŽ)", "science (ç§‘å­¦)", "art (è‰ºæœ¯)", "together (ä¸€èµ·)", "finish (å®Œæˆ)"], script: [ { role: "E", text: "Let's hear your topic." }, { role: "C", text: "My topic is my school club project." }, { role: "E", text: "What did you build yesterday?" }, { role: "E", text: "Why is club time better than normal class time?" }, { role: "E", text: "What are you going to build next month?" }, { role: "Note", text: "WAIT: Student must ask: 'Did you join a club at school?'" }, { role: "E", text: "School. What subjects do you like?" }, { role: "E", text: "What did you do at school yesterday?" }, { role: "E", text: "Weekend. What do you usually do at weekends?" }, { role: "E", text: "What are you going to do next weekend?" } ] }
        ];

        const sampleTopics = {
            "volcano": { title: "Volcano Experiment (ç«å±±å®žéªŒ)", point1: "NOW: I like science very much. I usually do simple experiments at home on weekends.", point2: "PAST: Last weekend I mixed vinegar and baking soda. It went out fast, but it was very exciting.", point3: "COMPARE: This experiment is better than my paper plane experiment because it is more colorful. The best part is the 'lava'.", point4: "FUTURE: Next week Iâ€™m going to change the bottle size. I am also going to use more baking soda.", question: "Do you like science experiments?", vocab: ["vinegar (é†‹)", "baking soda (å°è‹æ‰“)", "eruption (çˆ†å‘)", "lava (å²©æµ†)", "messy (è„ä¹±)", "exciting (åˆºæ¿€)", "science (ç§‘å­¦)", "experiment (å®žéªŒ)", "reaction (ååº”)", "goggles (æŠ¤ç›®é•œ)", "pour (å€’)", "bubble (æ°”æ³¡)", "clean up (æ¸…ç†)"] },
            "rail": { title: "High-Speed Rail Trip (é«˜é“ä¹‹æ—…)", point1: "NOW: I like travelling by train very much. Itâ€™s more comfortable and faster than the bus.", point2: "PAST: Last month I went to another city by high-speed rail. I watched the beautiful view and ate delicious snacks.", point3: "COMPARE: The train is faster than the car, but the car is more flexible. The best part is arriving quickly.", point4: "FUTURE: Next holiday Iâ€™m going to visit a big museum. I am going to take many photos there.", question: "Do you like travelling by train?", vocab: ["comfortable (èˆ’é€‚)", "scenery (é£Žæ™¯)", "fast (å¿«)", "ticket (è½¦ç¥¨)", "station (è½¦ç«™)", "seat (åº§ä½)", "modern (çŽ°ä»£)", "trip (æ—…è¡Œ)", "expensive (è´µ)", "convenient (æ–¹ä¾¿)", "arrive (åˆ°è¾¾)", "leave (ç¦»å¼€)", "passenger (ä¹˜å®¢)"] },
            "minecraft": { title: "Minecraft Build (æˆ‘çš„ä¸–ç•Œå»ºç­‘)", point1: "NOW: I play Minecraft once a week on my tablet. I like building huge houses, but I donâ€™t like losing my items.", point2: "PAST: Yesterday I built a very tall tower. It looked great, but a creeper exploded near it.", point3: "COMPARE: My new base is better than my old base because it is bigger. The best room is my storage room.", point4: "FUTURE: Next weekend Iâ€™m going to build a large farm. I am also going to build a bridge over the river.", question: "What games do you like?", vocab: ["creeper (è‹¦åŠ›æ€•)", "tower (å¡”)", "survival (ç”Ÿå­˜)", "creative (åˆ›é€ )", "blocks (æ–¹å—)", "build (å»ºé€ )", "zombies (åƒµå°¸)", "design (è®¾è®¡)", "night (å¤œæ™š)", "diamond (é’»çŸ³)", "tools (å·¥å…·)", "house (æˆ¿å­)", "fun (æœ‰è¶£)"] },
            "spring": { title: "Spring Festival Moment (æ˜¥èŠ‚æ—¶åˆ»)", point1: "NOW: Spring Festival is the most important festival. We usually have a big dinner with my family.", point2: "PAST: Last year I visited my grandparents in the countryside. We made dumplings together, but I made one ugly dumpling.", point3: "COMPARE: This year was better than last year because I had more free time. The best part was the family time.", point4: "FUTURE: Next year Iâ€™m going to help my mom more. I am going to learn a new dumpling shape.", question: "What do you usually do for Spring Festival?", vocab: ["dumplings (é¥ºå­)", "reunion (å›¢åœ†)", "fireworks (çƒŸèŠ±)", "ugly (ä¸‘)", "red envelope (çº¢åŒ…)", "celebrate (åº†ç¥)", "dinner (æ™šé¤)", "family (å®¶åº­)", "visit (æ‹œè®¿)", "new clothes (æ–°è¡£)", "lucky (å¹¸è¿)", "happy (å¿«ä¹)", "tradition (ä¼ ç»Ÿ)"] },
            "zongzi": { title: "Zongzi Taste Test (ç²½å­æµ‹è¯•)", point1: "NOW: I really like eating zongzi. However, I donâ€™t like very oily food.", point2: "PAST: Last Dragon Boat Festival I tried two kinds of zongzi. One was sweet and one was salty.", point3: "COMPARE: Sweet zongzi is better than salty zongzi for me. The best flavour is definitely red bean.", point4: "FUTURE: Next time Iâ€™m going to try a new flavour. I am going to rate it in my notebook.", question: "Sweet or salty?", vocab: ["salty (å’¸)", "sweet (ç”œ)", "sticky rice (ç³¯ç±³)", "bamboo (ç«¹)", "leaves (å¶å­)", "filling (é¦…æ–™)", "taste (å°)", "dragon boat (ç«¯åˆ)", "pork (çŒªè‚‰)", "bean paste (è±†æ²™)", "boil (ç…®)", "grandmother (ç¥–æ¯)", "make (åˆ¶ä½œ)"] },
            "magnet": { title: "Magnet Challenge (ç£é“æŒ‘æˆ˜)", point1: "NOW: I like testing things at home. I use a small magnet to check different objects.", point2: "PAST: Last week I tested coins, keys and plastic. The metal worked, but the plastic didnâ€™t.", point3: "COMPARE: Keys are better than coins for this test because they stick strongly. The best object was a paper clip.", point4: "FUTURE: Next week Iâ€™m going to test more objects in my room. I am going to make a simple list.", question: "Have you ever played with magnets?", vocab: ["attract (å¸å¼•)", "metal (é‡‘å±ž)", "strong (å¼º)", "test (æµ‹è¯•)", "repel (æŽ’æ–¥)", "force (åŠ›)", "north (åŒ—)", "south (å—)", "coins (ç¡¬å¸)", "paper clip (å›žå½¢é’ˆ)", "plastic (å¡‘æ–™)", "stick (å¸é™„)", "science (ç§‘å­¦)"] },
            "club": { title: "School Club Project (å­¦æ ¡ç¤¾å›¢)", point1: "NOW: Iâ€™m in a school science club. We make small projects every Friday afternoon.", point2: "PAST: Yesterday we built a simple model car. It didnâ€™t work at first, but we fixed it.", point3: "COMPARE: Club time is better than normal class time because it is more hands-on. The best part is the teamwork.", point4: "FUTURE: Next month Im going to learn a new skill. We are going to build something bigger.", question: "Did you join a club?", vocab: ["hands-on (åŠ¨æ‰‹)", "teamwork (å›¢é˜Ÿ)", "skill (æŠ€èƒ½)", "fix (ä¿®ç†)", "model (æ¨¡åž‹)", "project (é¡¹ç›®)", "learn (å­¦ä¹ )", "fun (æœ‰è¶£)", "join (åŠ å…¥)", "after school (æ”¾å­¦åŽ)", "science (ç§‘å­¦)", "art (è‰ºæœ¯)", "together (ä¸€èµ·)"] },
            "mooncake": { title: "Mooncake Ranking (æœˆé¥¼æŽ’å)", point1: "NOW: I enjoy eating mooncakes. I like the taste, but I donâ€™t like very sweet ones.", point2: "PAST: Last year I tried three flavours of mooncakes. One was my favourite and one was too sweet.", point3: "COMPARE: My favourite flavour is better than the others because it tastes smooth. The best is lotus seed.", point4: "FUTURE: Next festival Iâ€™m going to try one new flavour. I am going to share it with my cousin.", question: "Favourite mooncake?", vocab: ["lotus seed (èŽ²è“‰)", "smooth (ç»†è…»)", "share (åˆ†äº«)", "traditional (ä¼ ç»Ÿ)", "moon (æœˆäº®)", "mid-autumn (ä¸­ç§‹)", "round (åœ†)", "sweet (ç”œ)", "ranking (æŽ’å)", "flavour (å£å‘³)", "box (ç›’å­)", "gift (ç¤¼ç‰©)", "family (å®¶åº­)", "eat (åƒ)", "tea (èŒ¶)"] }
        };

        // --- COMPONENTS DEFINED OUTSIDE APP (To fix resetting issue) ---

        const PhaseTimer = ({ timeLeft, timerActive, toggleTimer, resetTimer, formatTime }) => (
            <div className={`flex items-center gap-2 px-3 py-1 rounded-lg border ${timeLeft < 30 ? 'bg-red-100 border-red-500 text-red-700 animate-pulse' : 'bg-white border-gray-200 text-gray-700'}`}>
                <Clock className="w-4 h-4" />
                <span className="font-mono font-bold text-lg w-12 text-center">{formatTime(timeLeft)}</span>
                <button onClick={toggleTimer} className="text-xs font-bold hover:text-blue-600">{timerActive ? 'PAUSE' : 'START'}</button>
                <button onClick={resetTimer} className="text-xs font-bold hover:text-red-600">RESET</button>
            </div>
        );

        const GrammarChecklist = ({ onReward }) => {
            const [checkedItems, setCheckedItems] = useState({
                future: false,
                but: false,
                compare: false,
                past: false,
                question: false
            });

            const handleCheck = (key) => {
                if (!checkedItems[key]) {
                    onReward(5); // +5 points for new check
                    setCheckedItems(prev => ({ ...prev, [key]: true }));
                } else {
                    setCheckedItems(prev => ({ ...prev, [key]: false }));
                }
            };

            return (
                <div className="bg-blue-50 p-2 rounded-lg border border-blue-100 mt-1 flex-shrink-0">
                    <div className="text-[10px] font-bold text-blue-800 uppercase mb-1 flex items-center gap-1"><CheckSquare size={12}/> Grammar Check (+5)</div>
                    <div className="space-y-1">
                        {[
                            { k: 'future', label: 'Future (Going to)' },
                            { k: 'but', label: 'Linker (But)' },
                            { k: 'compare', label: 'Compare (-er)' },
                            { k: 'past', label: 'Past Tense' },
                            { k: 'question', label: 'Question?' }
                        ].map(item => (
                            <button 
                                key={item.k}
                                onClick={() => handleCheck(item.k)}
                                className={`w-full text-left text-[10px] px-2 py-1 rounded flex items-center gap-2 transition-all ${checkedItems[item.k] ? 'bg-green-500 text-white line-through opacity-80' : 'bg-white text-gray-700 hover:bg-blue-100'}`}
                            >
                                <div className={`w-2 h-2 rounded border ${checkedItems[item.k] ? 'bg-white border-white' : 'border-gray-400'}`}></div>
                                {item.label}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const ConversationTool = ({ timerProps }) => {
            const [selectedArea, setSelectedArea] = useState(null);
            const [currentQuestion, setCurrentQuestion] = useState(null);

            const pickRandomQuestion = (areaKey) => {
                const qs = conversationData[areaKey].questions;
                const randomQ = qs[Math.floor(Math.random() * qs.length)];
                setCurrentQuestion(randomQ);
            };

            return (
                <div className="flex flex-col h-full overflow-hidden">
                    <div className="flex justify-between items-center mb-2 flex-shrink-0">
                        <div className="flex items-center gap-4">
                            <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <MessageSquare className="w-6 h-6 text-blue-600" />
                                Conversation (5 mins)
                            </h2>
                            {selectedArea && (
                                <button 
                                    onClick={() => pickRandomQuestion(selectedArea)}
                                    className="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg font-bold shadow-sm active:transform active:scale-95 transition-all flex items-center gap-2 text-xs"
                                >
                                    <RotateCcw className="w-3 h-3" /> Next Question
                                </button>
                            )}
                        </div>
                        <PhaseTimer {...timerProps} />
                    </div>
                    
                    <div className="flex-shrink-0 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2 mb-3">
                        {Object.entries(conversationData).map(([key, data]) => (
                            <button
                            key={key}
                            onClick={() => { setSelectedArea(key); pickRandomQuestion(key); }}
                            className={`p-2 rounded-lg border-2 transition-all flex flex-col items-center text-center ${
                                selectedArea === key 
                                ? 'border-blue-600 shadow-md bg-white' 
                                : 'border-transparent opacity-80 hover:opacity-100 hover:bg-white/50'
                            } ${data.color}`}
                            >
                            <div className="text-xl">{data.icon}</div>
                            <div className="font-bold text-gray-800 text-[10px] leading-tight mt-1">{data.title}</div>
                            </button>
                        ))}
                    </div>

                    <div className="flex-grow flex gap-4 overflow-hidden">
                        {/* 1. Grammar Column (Left) */}
                        {selectedArea && (
                            <div className="w-64 bg-blue-50 rounded-xl border border-blue-100 p-4 overflow-y-auto flex-shrink-0 animate-in fade-in slide-in-from-left-4 hidden md:flex flex-col">
                                <div className="flex items-center gap-2 mb-3 text-blue-800 font-bold border-b border-blue-200 pb-2">
                                    <CheckSquare size={16} /> Grammar
                                </div>
                                <ul className="space-y-2">
                                    {conversationData[selectedArea].grammar.map((rule, i) => (
                                        <li key={i} className="bg-white px-2 py-1 rounded text-xs text-blue-900 shadow-sm border border-blue-100">
                                            {rule}
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        )}

                        {/* 2. Question Area (Center) */}
                        <div className="flex-1 bg-white rounded-xl shadow-inner border border-gray-200 p-6 flex flex-col items-start justify-center text-left relative transition-all">
                        {selectedArea ? (
                            <>
                            <span className="absolute top-4 left-4 text-xs font-bold uppercase text-gray-400 tracking-wider">
                                Current Subject: {conversationData[selectedArea].title}
                            </span>
                            <p className="text-2xl md:text-3xl font-medium text-gray-800 leading-relaxed animate-in fade-in slide-in-from-top-4 duration-500">
                                "{currentQuestion}"
                            </p>
                            </>
                        ) : (
                            <div className="w-full text-center text-gray-400 flex flex-col items-center">
                            <Star className="w-12 h-12 mb-2 opacity-20" />
                            <p>Select a topic above to start.</p>
                            </div>
                        )}
                        </div>

                        {/* 3. Word Bank Column (Right) */}
                        {selectedArea && (
                            <div className="w-64 bg-yellow-50 rounded-xl border border-yellow-100 p-4 overflow-y-auto flex-shrink-0 animate-in fade-in slide-in-from-right-4 hidden md:flex flex-col">
                                <div className="flex items-center gap-2 mb-3 text-yellow-800 font-bold border-b border-yellow-200 pb-2">
                                    <BookOpen size={16} /> Word Bank
                                </div>
                                <ul className="space-y-2">
                                    {conversationData[selectedArea].vocab.map((word, i) => (
                                        <li key={i} className="bg-white px-2 py-1 rounded text-xs text-gray-700 shadow-sm border border-yellow-100">
                                            {word}
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const MockExamTool = ({ timerProps, onReward }) => {
            const [selectedMock, setSelectedMock] = useState(null);
            const [lineIndex, setLineIndex] = useState(0);

            const handleNextLine = () => {
                if (selectedMock && lineIndex < selectedMock.script.length) {
                    setLineIndex(prev => prev + 1);
                }
            };

            return (
                <div className="h-full flex flex-col">
                        {!selectedMock ? (
                            <div className="h-full flex flex-col">
                            <div className="flex justify-between items-center mb-2 flex-shrink-0">
                                <h2 className="text-xl font-bold text-gray-800">Select Mock Exam</h2>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3 overflow-y-auto pr-2 pb-2">
                                {mockExams.map(mock => (
                                <button
                                    key={mock.id}
                                    onClick={() => setSelectedMock(mock)}
                                    className="bg-white p-3 rounded-lg shadow-sm border border-gray-200 hover:border-blue-400 hover:shadow-md transition-all text-left group h-full"
                                >
                                    <div className="font-bold text-gray-800 group-hover:text-blue-600 text-sm">{mock.title}</div>
                                    <div className="text-xs text-gray-500 mt-1 line-clamp-1">{mock.topic}</div>
                                </button>
                                ))}
                            </div>
                        </div>
                    ) : (
                    <div className="flex flex-col h-full overflow-hidden">
                        <div className="flex items-center justify-between mb-2 border-b pb-2 flex-shrink-0">
                            <div className="flex items-center gap-4">
                                <h3 className="font-bold text-lg">{selectedMock.title}</h3>
                                <PhaseTimer {...timerProps} />
                            </div>
                            <button onClick={() => { setSelectedMock(null); setLineIndex(0); }} className="text-sm text-red-500 font-bold hover:bg-red-50 px-2 py-1 rounded">Exit</button>
                        </div>
                        
                        <div className="flex gap-4 h-full overflow-hidden">
                            <div className="flex-grow flex flex-col h-full overflow-hidden">
                                <div className="flex-grow overflow-y-auto bg-gray-50 rounded-xl p-4 mb-4 border border-gray-200 shadow-inner">
                                {selectedMock.script.slice(0, lineIndex + 1).map((line, idx) => (
                                    <div key={idx} className={`mb-3 flex ${line.role === 'E' ? 'justify-start' : (line.role === 'Note' ? 'justify-center' : 'justify-end')}`}>
                                        <div className={`max-w-[85%] rounded-2xl px-4 py-2 text-sm md:text-base shadow-sm
                                            ${line.role === 'E' ? 'bg-white text-gray-800 border-l-4 border-blue-500' : ''}
                                            ${line.role === 'C' ? 'bg-blue-100 text-blue-900 italic' : ''}
                                            ${line.role === 'Note' ? 'bg-yellow-100 text-yellow-800 font-bold border-2 border-yellow-300 animate-pulse text-center' : ''}
                                        `}>
                                            {line.text}
                                        </div>
                                    </div>
                                ))}
                                <div id="scroll-anchor"></div>
                                </div>
                                <div className="grid grid-cols-2 gap-3 flex-shrink-0">
                                    <button onClick={() => setLineIndex(0)} className="bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300">Restart</button>
                                    <button onClick={handleNextLine} disabled={lineIndex >= selectedMock.script.length - 1} className="bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 shadow-lg disabled:opacity-50 flex items-center justify-center gap-2">
                                        Next Line <Play className="w-4 h-4 fill-current" />
                                    </button>
                                </div>
                            </div>
                            <div className="hidden lg:flex flex-col w-48 gap-2 flex-shrink-0">
                                {/* WORD BANK */}
                                <div className="bg-yellow-50 rounded-xl border border-yellow-100 p-4 overflow-y-auto flex-grow h-1/2">
                                    <div className="flex items-center gap-2 mb-3 text-yellow-800 font-bold border-b border-yellow-200 pb-2"><BookOpen size={16} /> Word Bank</div>
                                    <ul className="space-y-2">
                                        {selectedMock.vocab.map((word, i) => (
                                            <li key={i} className="bg-white px-2 py-1 rounded text-sm text-gray-700 shadow-sm border border-yellow-100">{word}</li>
                                        ))}
                                    </ul>
                                </div>
                                
                                {/* GRAMMAR CHECKLIST */}
                                <GrammarChecklist onReward={onReward} />
                            </div>
                        </div>
                    </div>
                    )}
                </div>
            );
        };

        const TopicBuilder = ({ timerProps, onReward }) => {
            const [topicData, setTopicData] = useState({ title: "", point1: "", point2: "", point3: "", point4: "", question: "", vocab: [] });
            
            const loadTopic = (key) => {
                if(key === "") return;
                const t = sampleTopics[key];
                setTopicData({ 
                    title: t.title, 
                    point1: t.point1, 
                    point2: t.point2, 
                    point3: t.point3, 
                    point4: t.point4, 
                    question: t.question,
                    vocab: t.vocab 
                });
            };

            return (
                <div className="h-full overflow-hidden flex flex-col">
                    <div className="flex justify-between items-center mb-1 flex-shrink-0">
                        <h2 className="text-lg font-bold text-gray-800 flex items-center gap-2"><BookOpen className="w-5 h-5 text-purple-600" /> Topic Planner</h2>
                        <div className="flex gap-2 items-center">
                            <PhaseTimer {...timerProps} />
                            <select onChange={(e) => loadTopic(e.target.value)} className="bg-purple-600 text-white text-xs font-bold py-1 px-2 rounded shadow-md border-none outline-none cursor-pointer max-w-[150px]">
                                <option value="">Load Topic...</option>
                                <option value="volcano">Volcano Exp.</option>
                                <option value="rail">High-Speed Rail</option>
                                <option value="minecraft">Minecraft</option>
                                <option value="spring">Spring Festival</option>
                                <option value="zongzi">Zongzi</option>
                                <option value="magnet">Magnet</option>
                                <option value="club">School Club</option>
                                <option value="mooncake">Mooncake</option>
                            </select>
                        </div>
                    </div>
                    
                    <div className="flex gap-2 h-full overflow-hidden">
                        {/* Main Form Area */}
                        <div className="bg-white p-0 rounded-lg shadow-sm border border-gray-200 overflow-y-auto flex-grow flex flex-col gap-px">
                            <div className="space-y-0.5 flex-shrink-0 p-1">
                                <label className="text-[10px] font-bold uppercase text-gray-500">Topic Title</label>
                                <input readOnly value={topicData.title} type="text" className="w-full p-0.5 border rounded font-bold text-sm bg-gray-50" />
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-px flex-grow">
                                <div className="p-0.5 border rounded bg-blue-50 flex flex-col h-full">
                                    <label className="text-[10px] font-bold text-blue-600 block px-1">1. Present</label>
                                    <textarea readOnly value={topicData.point1} className="w-full bg-white p-1 rounded text-sm resize-none flex-grow leading-tight border-0 focus:ring-0"></textarea>
                                </div>
                                <div className="p-0.5 border rounded bg-green-50 flex flex-col h-full">
                                    <label className="text-[10px] font-bold text-green-600 block px-1">2. Past</label>
                                    <textarea readOnly value={topicData.point2} className="w-full bg-white p-1 rounded text-sm resize-none flex-grow leading-tight border-0 focus:ring-0"></textarea>
                                </div>
                                <div className="p-0.5 border rounded bg-yellow-50 flex flex-col h-full">
                                    <label className="text-[10px] font-bold text-yellow-600 block px-1">3. Compare</label>
                                    <textarea readOnly value={topicData.point3} className="w-full bg-white p-1 rounded text-sm resize-none flex-grow leading-tight border-0 focus:ring-0"></textarea>
                                </div>
                                <div className="p-0.5 border rounded bg-pink-50 flex flex-col h-full">
                                    <label className="text-[10px] font-bold text-pink-600 block px-1">4. Future</label>
                                    <textarea readOnly value={topicData.point4} className="w-full bg-white p-1 rounded text-sm resize-none flex-grow leading-tight border-0 focus:ring-0"></textarea>
                                </div>
                            </div>

                            <div className="p-1 bg-red-50 border border-red-100 rounded flex items-center gap-2 flex-shrink-0">
                                <AlertCircle className="text-red-500 w-4 h-4" />
                                <div className="flex-grow">
                                    <label className="text-[10px] font-bold text-red-600 block">Question for Examiner:</label>
                                    <input readOnly value={topicData.question} type="text" className="w-full p-0.5 border rounded text-sm font-medium bg-white" />
                                </div>
                            </div>
                        </div>

                        {/* Word Bank Sidebar + Grammar */}
                        <div className="hidden lg:flex flex-col w-40 gap-1 flex-shrink-0 h-full overflow-hidden">
                            <div className="bg-purple-50 rounded-lg border border-purple-100 p-2 overflow-y-auto flex-grow h-1/2">
                                <div className="flex items-center gap-1 mb-1 text-purple-800 font-bold border-b border-purple-200 pb-1 text-xs">
                                    <BookOpen size={12} /> Word Bank
                                </div>
                                {topicData.vocab.length > 0 ? (
                                    <ul className="space-y-1">
                                        {topicData.vocab.map((word, i) => (
                                            <li key={i} className="bg-white px-1.5 py-0.5 rounded text-[10px] text-gray-700 shadow-sm border border-purple-100 leading-tight">
                                                {word}
                                            </li>
                                        ))}
                                    </ul>
                                ) : (
                                    <div className="text-[10px] text-gray-400 text-center mt-2">Select topic...</div>
                                )}
                            </div>
                            
                            {/* Grammar Check */}
                            <GrammarChecklist onReward={onReward} />
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---

        const App = () => {
            const [activeTab, setActiveTab] = useState('conversation'); 
            const [score, setScore] = useState(0);
            const [rewards, setRewards] = useState([]);
            
            // Timer State
            const [timeLeft, setTimeLeft] = useState(300); // 5 minutes
            const [timerActive, setTimerActive] = useState(false);

            const playWinSound = useCallback(() => {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                const ctx = new AudioContext();
                const t = ctx.currentTime;
                [440, 554, 659, 880].forEach((freq, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = 'sine';
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(0.1, t + i * 0.05);
                    gain.gain.exponentialRampToValueAtTime(0.001, t + i * 0.05 + 0.5);
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.start(t + i * 0.05);
                    osc.stop(t + i * 0.05 + 0.5);
                });
            }, []);

            const triggerReward = useCallback((amount = 10) => {
                setScore(s => s + amount);
                playWinSound();
                const newRewards = Array.from({ length: 12 }).map((_, i) => ({
                    id: Date.now() + i,
                    x: 50 + (Math.random() * 40 - 20),
                    y: 50 + (Math.random() * 40 - 20),
                    emoji: ['ðŸª™', 'â­', 'âœ¨', 'ðŸ†'][Math.floor(Math.random() * 4)],
                    rotation: Math.random() * 360
                }));
                setRewards(prev => [...prev, ...newRewards]);
                setTimeout(() => setRewards(prev => prev.filter(r => r.id < Date.now())), 1500);
            }, [playWinSound]);

            // Timer Logic
            useEffect(() => {
                let interval = null;
                if (timerActive && timeLeft > 0) {
                    interval = setInterval(() => {
                        setTimeLeft(t => t - 1);
                    }, 1000);
                } else if (timeLeft === 0) {
                    setTimerActive(false);
                }
                return () => clearInterval(interval);
            }, [timerActive, timeLeft]);

            const formatTime = (seconds) => {
                const m = Math.floor(seconds / 60);
                const s = seconds % 60;
                return `${m}:${s < 10 ? '0' : ''}${s}`;
            };

            const toggleTimer = () => setTimerActive(!timerActive);
            const resetTimer = () => { setTimerActive(false); setTimeLeft(300); };

            const timerProps = { timeLeft, timerActive, toggleTimer, resetTimer, formatTime };

            return (
                <div className="bg-gray-100 font-sans text-gray-900 h-screen flex flex-col overflow-hidden">
                    {rewards.map(r => (<div key={r.id} className="animate-float-up absolute pointer-events-none z-50 text-4xl" style={{ left: `${r.x}%`, top: `${r.y}%` }}>{r.emoji}</div>))}

                    {/* Top Header */}
                    <header className="bg-slate-800 text-white p-2 shadow-md flex items-center justify-between shrink-0 h-12 z-20">
                        {/* Left: Nav Buttons */}
                        <div className="flex gap-2">
                            <button onClick={() => setActiveTab('conversation')} className={`flex items-center gap-1 px-3 py-1 rounded text-xs font-bold transition-all ${activeTab === 'conversation' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-700 hover:text-white'}`}>
                                <MessageSquare size={14} /> Talk
                            </button>
                            <button onClick={() => setActiveTab('mock')} className={`flex items-center gap-1 px-3 py-1 rounded text-xs font-bold transition-all ${activeTab === 'mock' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-700 hover:text-white'}`}>
                                <Play size={14} /> Mock
                            </button>
                            <button onClick={() => setActiveTab('dashboard')} className={`flex items-center gap-1 px-3 py-1 rounded text-xs font-bold transition-all ${activeTab === 'dashboard' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-700 hover:text-white'}`}>
                                <BookOpen size={14} /> Topic
                            </button>
                        </div>

                        {/* Right: Score */}
                        <div className="flex items-center gap-3">
                            <div className="bg-slate-700 rounded px-2 py-1 flex items-center gap-2">
                                <span className="text-[10px] text-slate-400 font-bold uppercase">Score</span>
                                <span className="text-sm font-black text-yellow-400">{score}</span>
                            </div>
                            <button onClick={() => triggerReward(10)} className="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-400 hover:to-orange-400 text-white font-bold py-1 px-3 rounded shadow-lg active:scale-95 flex items-center gap-1 text-xs">
                                <Trophy size={14} className="text-yellow-100" /> Award
                            </button>
                        </div>
                    </header>

                    {/* Main Content */}
                    <main className="flex-grow p-4 h-full overflow-hidden relative flex flex-col">
                        <div className="bg-white rounded-xl shadow-lg h-full overflow-hidden border border-gray-200 flex-grow">
                            <div className="h-full p-4">
                                {activeTab === 'dashboard' && <TopicBuilder timerProps={timerProps} onReward={triggerReward} />}
                                {activeTab === 'conversation' && <ConversationTool timerProps={timerProps} />}
                                {activeTab === 'mock' && <MockExamTool timerProps={timerProps} onReward={triggerReward} />}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
