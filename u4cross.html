<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Crossroads: Wildlife & Roads</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f4f8;
        }
        .tts-button {
            background-color: #4A90E2;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            box-shadow: 0 4px #357ABD;
            transition: all 0.1s ease-in-out;
            display: inline-block;
            margin-top: 1rem;
            width: 150px; /* Fixed width for consistency */
            text-align: center;
        }
        .tts-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px #357ABD;
        }
        .tts-button.playing {
            background-color: #e53e3e; /* Red color when playing */
            box-shadow: 0 4px #c53030;
        }
        .card {
            background-color: white;
            border-radius: 16px;
            padding: 2rem;
            box-shadow: 0 10px 20px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
        }
        .animation-container {
            position: relative;
            height: 150px; /* Increased height for better visuals */
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 24px;
            border: 2px dashed #cbd5e1;
        }
        .road {
            position: absolute;
            bottom: 50px; /* Adjusted position */
            left: 0;
            width: 100%;
            height: 25px; /* Made road thicker */
            background-color: #6b7280; /* Solid color for road */
            z-index: 10;
        }
        .emoji {
            position: absolute;
            font-size: 2.5rem; /* Larger emojis */
            animation-iteration-count: infinite;
            animation-timing-function: linear;
            will-change: transform, left, top;
        }
        .car-emoji {
            bottom: 35px; /* Positioned on the road */
            animation-name: move-right-to-left;
            animation-duration: 5s;
            z-index: 15;
        }
        .animal-emoji {
            animation-name: move-top-to-bottom;
            animation-duration: 8s;
            z-index: 5; /* Animals go "under" the road visually */
        }
        .explosion-emoji {
            font-size: 3rem;
            z-index: 20;
            animation: fadeOut 1s forwards;
        }
        
        @keyframes move-right-to-left {
            from { left: 110%; }
            to { left: -10%; }
        }
        @keyframes move-top-to-bottom {
            from { top: -15%; }
            to { top: 115%; }
        }
        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(1.5); }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 p-4 sm:p-6 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="text-center mb-12">
            <h1 class="text-5xl md:text-6xl font-bold text-gray-800">Global Crossroads: Wildlife & Roads</h1>
            <p class="text-xl text-gray-600 mt-4">An interactive look at the impact of roads on wildlife and our role in coexistence.</p>
        </header>
        
        <!-- Animations Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
            <div class="card">
                <h3 class="text-2xl font-semibold mb-3 text-red-600 text-center">The Problem: Collisions</h3>
                <div id="collision-animation" class="animation-container bg-red-50">
                    <div class="road"></div>
                </div>
            </div>
             <div class="card">
                <h3 class="text-2xl font-semibold mb-3 text-green-600 text-center">The Solution: Safe Crossings</h3>
                <div id="solution-animation" class="animation-container bg-green-50">
                    <div class="road"></div>
                </div>
            </div>
        </div>

        <!-- Content Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            
            <div class="card bg-blue-50 border-blue-200">
                <h2 class="text-3xl font-bold text-blue-800 mb-4">The Toll</h2>
                <div id="toll-text" class="space-y-4 text-xl text-blue-700 text-left">
                    <p>Over 1 million vertebrates are killed daily on US roads alone. These incidents lead to over 200 human fatalities and cost more than $8 billion annually. In Europe, the numbers are just as staggering, with tens of millions of animals lost each year.</p>
                </div>
                <button class="tts-button" data-text-id="toll-text">Read Aloud</button>
            </div>

            <div class="card bg-green-50 border-green-200">
                <h2 class="text-3xl font-bold text-green-800 mb-4">Ecological Rift</h2>
                <div id="rift-text" class="space-y-4 text-xl text-green-700 text-left">
                    <p>Roads create significant barriers in ecosystems. They cause habitat fragmentation, dividing landscapes and isolating animal populations. This barrier effect prevents animal movement, which in turn reduces gene flow and genetic diversity, and blocks species from shifting ranges in response to climate change.</p>
                </div>
                <button class="tts-button" data-text-id="rift-text">Read Aloud</button>
            </div>
            
            <div class="card bg-orange-50 border-orange-200">
                <h2 class="text-3xl font-bold text-orange-800 mb-4">Solutions by Design</h2>
                <div id="solutions-text" class="space-y-4 text-xl text-orange-700 text-left">
                    <p>Purpose-built wildlife crossings like overpasses and underpasses are a proven solution. Success stories from Banff, Canada, to China's G7 Expressway, show these can reduce collisions by over 80%, allowing animals to cross safely.</p>
                </div>
                <button class="tts-button" data-text-id="solutions-text">Read Aloud</button>
            </div>

            <div class="card bg-indigo-50 border-indigo-200">
                <h2 class="text-3xl font-bold text-indigo-800 mb-4">Global Lessons</h2>
                <div id="examples-text" class="space-y-4 text-xl text-indigo-700 text-left">
                    <p><strong>Australia:</strong> On Christmas Island, an overpass helps millions of red crabs migrate safely. In Queensland, rope bridges help gliders and possums cross highways, showing how solutions can be tailored to local wildlife.</p>
                    <p><strong>Germany:</strong> A leader in Europe, Germany has built nearly 100 wide, vegetated "green bridges" over its highways, helping large animals like deer and wildcats maintain vital migration routes.</p>
                </div>
                <button class="tts-button" data-text-id="examples-text">Read Aloud</button>
            </div>

             <div class="card bg-yellow-50 border-yellow-200">
                <h2 class="text-3xl font-bold text-yellow-800 mb-4">Why This Matters to You</h2>
                <div id="matters-text" class="space-y-4 text-xl text-yellow-700 text-left">
                    <p>This isn't just a government problem‚Äîit's a community responsibility. As China develops, it has a chance to build smarter infrastructure that protects its rich biodiversity. For you as students, this is a chance to be a leader.</p>
                    <p>You can join citizen science projects, raise awareness, and study fields like engineering and ecology to design future solutions. Your voice can influence how roads are built for a safer world.</p>
                </div>
                <button class="tts-button" data-text-id="matters-text">Read Aloud</button>
            </div>

            <div class="card bg-teal-50 border-teal-200">
                <h2 class="text-3xl font-bold text-teal-800 mb-4">A Shared Responsibility</h2>
                <div id="global-text" class="space-y-4 text-xl text-teal-700 text-left">
                     <p>This is about human-wildlife coexistence on a shared planet. Roads are a top threat to biodiversity. Prevention is cheaper than collisions. Young people like you are crucial drivers for change‚Äîyou can research, advocate, and help build a future where humanity and wildlife both thrive.</p>
                </div>
                <button class="tts-button" data-text-id="global-text">Read Aloud</button>
            </div>

        </div>
        
        <footer class="text-center mt-16 text-gray-600 text-lg">
            <p>Be part of the solution. Learn, Share, Act!</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const collisionContainer = document.getElementById('collision-animation');
            const solutionContainer = document.getElementById('solution-animation');

            // --- Animation Logic (remains the same) ---
            const cars = ['üöó', 'üöô', 'üöö', 'üöì', 'üöë', 'üèéÔ∏è'];
            const animals = ['ü¶å', 'ü¶ä', 'ü¶ù', 'üêá', 'üê®', 'üêøÔ∏è']; 
            
            function createEmoji(type, container) {
                const emoji = document.createElement('div');
                emoji.dataset.crashed = 'false';
                
                if (type === 'car') {
                    emoji.className = 'emoji car-emoji';
                    emoji.textContent = cars[Math.floor(Math.random() * cars.length)];
                    emoji.style.animationDelay = `${Math.random() * 5}s`;
                } else { // animal
                    emoji.className = 'emoji animal-emoji';
                    emoji.textContent = animals[Math.floor(Math.random() * animals.length)];
                    emoji.style.left = `${Math.random() * 90 + 5}%`; 
                    emoji.style.animationDelay = `${Math.random() * 8}s`;
                }
                
                container.appendChild(emoji);
                setTimeout(() => { emoji.remove(); }, 12000);
            }

            setInterval(() => createEmoji('car', collisionContainer), 2500);
            setInterval(() => createEmoji('animal', collisionContainer), 3500);
            setInterval(() => createEmoji('car', solutionContainer), 2500);
            setInterval(() => createEmoji('animal', solutionContainer), 4000);

            function checkCollisions() {
                const carEmojis = collisionContainer.querySelectorAll('.car-emoji');
                const animalEmojis = collisionContainer.querySelectorAll('.animal-emoji');

                animalEmojis.forEach(animal => {
                    if (animal.dataset.crashed === 'true') return;
                    const animalRect = animal.getBoundingClientRect();

                    carEmojis.forEach(car => {
                        if (car.dataset.crashed === 'true') return;
                        const carRect = car.getBoundingClientRect();

                        const isColliding = !(carRect.right < animalRect.left || 
                                              carRect.left > animalRect.right || 
                                              carRect.bottom < animalRect.top || 
                                              carRect.top > animalRect.bottom);

                        if (isColliding) {
                            car.dataset.crashed = 'true';
                            animal.dataset.crashed = 'true';
                            
                            car.style.animationPlayState = 'paused';
                            animal.style.display = 'none';

                            const explosion = document.createElement('div');
                            explosion.className = 'emoji explosion-emoji';
                            explosion.textContent = 'üí•';
                            explosion.style.left = `${animalRect.left - collisionContainer.getBoundingClientRect().left}px`;
                            explosion.style.top = `${animalRect.top - collisionContainer.getBoundingClientRect().top}px`;
                            collisionContainer.appendChild(explosion);

                            setTimeout(() => {
                                car.remove();
                                explosion.remove();
                                animal.remove(); 
                            }, 1000);
                        }
                    });
                });
            }
            setInterval(checkCollisions, 100);

            // --- FIXED, MORE ROBUST TTS Logic ---
            const synth = window.speechSynthesis;
            const buttons = document.querySelectorAll('.tts-button');
            let voices = [];
            let targetVoice = null;
            let activeButton = null;

            function populateVoiceList() {
                voices = synth.getVoices();
                if(voices.length > 0) {
                    targetVoice = voices.find(voice => voice.name.includes('Andrew')) || 
                                  voices.find(voice => voice.lang === 'en-US' && voice.name.includes('Male')) || 
                                  voices.find(voice => voice.lang === 'en-US');
                }
            }

            populateVoiceList();
            if (synth.onvoiceschanged !== undefined) {
                synth.onvoiceschanged = populateVoiceList;
            }
            // Fallback timer to populate voices if onvoiceschanged isn't fired.
            setTimeout(populateVoiceList, 250);

            function resetAllButtons() {
                buttons.forEach(btn => {
                    btn.classList.remove('playing');
                    btn.textContent = 'Read Aloud';
                });
            }
            
            // This is a known workaround for a Chrome bug where the speech engine can go silent.
            // Periodically "pinging" it can keep it active.
            setInterval(() => {
                if (synth && !synth.speaking) {
                    synth.resume();
                }
            }, 14000);


            buttons.forEach(button => {
                button.addEventListener('click', () => {
                    const textId = button.getAttribute('data-text-id');
                    const textElement = document.getElementById(textId);
                    if (!textElement) return;

                    // If this button is already active and speech is happening, stop it.
                    if (activeButton === button && synth.speaking) {
                        synth.cancel();
                        return;
                    }

                    const speakNow = () => {
                        // Double-check that nothing is speaking, as state can change during the timeout
                        if (synth.speaking) {
                           return;
                        }

                        const textToSpeak = textElement.innerText.trim();
                        const utterThis = new SpeechSynthesisUtterance(textToSpeak);
                        
                        activeButton = button;
                        
                        if (targetVoice) {
                            utterThis.voice = targetVoice;
                        }
                        utterThis.pitch = 1;
                        utterThis.rate = 0.85; 

                        utterThis.onstart = () => {
                            resetAllButtons();
                            button.classList.add('playing');
                            button.textContent = 'Stop ‚óº';
                        };

                        utterThis.onend = () => {
                            // Only reset if this was the utterance that was meant to be active.
                            // This prevents a delayed 'onend' from a cancelled utterance from
                            // resetting the UI for a newly started one.
                            if (activeButton === button) {
                                resetAllButtons();
                                activeButton = null;
                            }
                        };
                        
                        utterThis.onerror = (event) => {
                            console.error('SpeechSynthesisUtterance.onerror', event);
                            if (activeButton === button) {
                                resetAllButtons();
                                activeButton = null;
                            }
                        };
                        
                        synth.speak(utterThis);
                    };

                    // If speech is active, cancel it. Then wait a moment for the engine to
                    // fully stop and clear its state before starting the new speech.
                    if (synth.speaking) {
                        synth.cancel();
                        setTimeout(speakNow, 250); // A robust delay to prevent race conditions.
                    } else {
                        // If nothing is playing, we can start immediately.
                        speakNow();
                    }
                });
            });

            // Safety net: if user navigates away, stop speaking.
            window.addEventListener('beforeunload', () => {
                synth.cancel();
            });
        });
    </script>

</body>
</html>

