<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Sentence Builder A1</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Google Fonts: Comic Neue -->
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Comic Neue', 'Comic Sans MS', 'Comic Sans', cursive, sans-serif;
            background-color: #f3f4f6;
            touch-action: manipulation;
        }

        .no-select {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* Sentence Part Styling */
        .sentence-part {
            border-bottom-width: 4px;
            border-bottom-style: dashed;
            border-color: #d1d5db; /* Gray 300 */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            padding: 8px 12px; 
            border-radius: 12px;
            margin: 4px;
            display: inline-flex; 
            align-items: center;
            justify-content: center;
            background-color: #e5e7eb; /* Gray 200 */
            color: transparent; /* Text hidden initially */
            min-width: 60px;
            min-height: 50px;
            position: relative;
            text-shadow: none;
        }

        /* The Reveal State */
        .sentence-part.revealed {
            background-color: white;
            color: #1f2937; /* Gray 800 */
            border-bottom-style: solid;
            border-bottom-width: 6px;
        }

        /* Question Label (appears above text when revealed) */
        .sentence-part.revealed::before {
            content: attr(data-label);
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #374151;
            color: white;
            font-size: 0.6rem;
            padding: 2px 6px;
            border-radius: 999px;
            opacity: 0;
            animation: fadeIn 0.3s forwards;
            white-space: nowrap;
            font-weight: bold;
            letter-spacing: 0.05em;
            pointer-events: none;
        }

        @keyframes fadeIn {
            to { top: -20px; opacity: 1; }
        }

        /* Active/Highlight States (Matched to Button Colors) */
        .revealed.active-orange { border-color: #f97316; background-color: #fff7ed; } 
        .revealed.active-yellow { border-color: #eab308; background-color: #fefce8; } 
        .revealed.active-green  { border-color: #16a34a; background-color: #f0fdf4; } 
        .revealed.active-blue   { border-color: #0ea5e9; background-color: #f0f9ff; } 
        .revealed.active-brown  { border-color: #854d0e; background-color: #fdf8f6; } 
        .revealed.active-pink   { border-color: #ec4899; background-color: #fdf2f8; } 
        .revealed.active-purple { border-color: #a855f7; background-color: #faf5ff; } 
        .revealed.active-teal   { border-color: #14b8a6; background-color: #f0fdfa; }

        /* Specific text colors for emojis vs text if needed, but standard text color works well */

        /* Button interactions */
        .card:active { transform: scale(0.95); }
        
        /* Navigation Button Styles */
        .nav-btn {
            background-color: white;
            border: 2px solid #e5e7eb;
            padding: 8px 16px; 
            border-radius: 9999px;
            font-weight: bold;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #e5e7eb;
        }
        .nav-btn:active {
            transform: translateY(2px);
            box-shadow: none;
        }
        .nav-btn:hover {
            border-color: #d1d5db;
            background-color: #f9fafb;
        }

        /* Points Animation */
        @keyframes pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.3); }
            100% { transform: scale(1); }
        }
        .pop-anim { animation: pop 0.2s ease-in-out; }
    </style>
</head>
<body class="flex flex-col h-screen overflow-hidden text-gray-800">

    <!-- Header: Sentence Display & Navigation -->
    <div class="bg-white shadow-lg z-20 sticky top-0 border-b-2 border-gray-200 shrink-0">
        <div class="max-w-7xl mx-auto p-4 flex flex-col gap-4">
              
             <!-- The Sentence (Fixed Height Container) -->
             <div class="h-[20rem] md:h-[24rem] w-full relative flex items-center justify-center bg-gray-50 rounded-2xl border-2 border-dashed border-gray-200 p-6 shadow-inner">
                 <!-- Helper Text Removed -->

                 <div id="sentence-container" class="text-3xl md:text-5xl lg:text-6xl font-bold text-gray-900 text-center leading-snug no-select flex flex-wrap justify-center items-center gap-x-3 gap-y-4 w-full overflow-y-auto max-h-full">
                    <!-- Content injected via JS -->
                </div>
             </div>
            
            <!-- Navigation & Controls Toolbar -->
            <div class="flex flex-wrap items-center justify-between gap-4">
                
                <!-- Left Group: Nav -->
                <div class="flex items-center gap-3">
                    <button onclick="goHome()" class="nav-btn text-gray-600" title="Start Over">
                        <i class="ph ph-arrow-counter-clockwise text-xl"></i>
                    </button>
                    
                    <button onclick="prevSentence()" class="nav-btn text-gray-600" title="Previous">
                        <i class="ph ph-caret-left text-2xl"></i>
                    </button>
                    
                    <span id="counter" class="text-lg font-bold text-gray-400 min-w-[80px] text-center font-mono">1/100</span>

                    <button onclick="nextSentence()" class="nav-btn text-gray-600" title="Next">
                        <i class="ph ph-caret-right text-2xl"></i>
                    </button>

                    <!-- Shuffle Button -->
                    <button onclick="randomSentence()" class="nav-btn text-purple-600 border-purple-200 hover:bg-purple-50" title="Random Sentence">
                        <i class="ph ph-shuffle text-xl"></i>
                    </button>
                </div>

                <!-- Center: Read & Reveal All -->
                <div class="flex gap-2">
                    <button onclick="revealAll()" class="bg-gray-100 hover:bg-gray-200 text-gray-600 border-gray-200 px-5 py-2 rounded-full font-bold text-base flex items-center gap-2 transition shadow-md border-b-4 active:translate-y-1 active:shadow-none">
                        <i class="ph ph-eye text-xl"></i>
                        <span>Show All</span>
                    </button>

                    <button onclick="speakSentence()" class="bg-blue-100 hover:bg-blue-200 text-blue-700 border-blue-200 px-6 py-2 rounded-full font-bold text-base flex items-center gap-2 transition shadow-md border-b-4 active:translate-y-1 active:shadow-none">
                        <i class="ph ph-speaker-high text-xl"></i>
                        <span>Read</span>
                    </button>
                </div>

                <!-- Right: Points -->
                <button id="pointsBtn" onclick="addPoint()" class="bg-yellow-100 hover:bg-yellow-200 text-yellow-700 border-yellow-200 px-6 py-2 rounded-full font-bold text-lg flex items-center gap-2 transition shadow-md border-b-4 active:translate-y-1 active:shadow-none ml-auto md:ml-0">
                    <i class="ph ph-star-fill text-2xl text-yellow-500"></i>
                    <span id="pointsDisplay">0</span>
                </button>

            </div>
        </div>
    </div>

    <!-- Main Content: Buttons Grid -->
    <div class="flex-1 overflow-y-auto p-4 bg-gray-100">
        <div class="max-w-5xl mx-auto h-full flex flex-col justify-start pt-2 pb-12">
            
            <!-- Question Cards Grid (Reduced sizes by ~25%) -->
            <div class="grid grid-cols-4 gap-3 md:gap-4">
                <!-- WHO? -->
                <button onclick="activatePart('who')" class="card bg-[#fed7aa] text-gray-900 rounded-xl flex flex-col items-center justify-center shadow-[0_4px_0_#f97316] border-2 border-[#f97316] py-2 hover:bg-orange-200 hover:-translate-y-1 transition-all active:translate-y-1 active:shadow-none h-auto min-h-[85px]">
                    <span class="text-[10px] md:text-xs font-black uppercase tracking-widest opacity-70 mb-1">Who?</span>
                    <i class="ph ph-user text-2xl md:text-3xl text-orange-800"></i>
                </button>
                
                <!-- DOING WHAT? -->
                <button onclick="activatePart('action')" class="card bg-[#fef08a] text-gray-900 rounded-xl flex flex-col items-center justify-center shadow-[0_4px_0_#eab308] border-2 border-[#eab308] py-2 hover:bg-yellow-200 hover:-translate-y-1 transition-all active:translate-y-1 active:shadow-none h-auto min-h-[85px]">
                    <span class="text-[10px] md:text-xs font-black uppercase tracking-widest opacity-70 mb-1 text-center leading-none">Doing<br>what?</span>
                    <i class="ph ph-person-simple-run text-2xl md:text-3xl text-yellow-800"></i>
                </button>
                
                <!-- WHAT? -->
                <button onclick="activatePart('what')" class="card bg-[#bbf7d0] text-gray-900 rounded-xl flex flex-col items-center justify-center shadow-[0_4px_0_#16a34a] border-2 border-[#16a34a] py-2 hover:bg-green-200 hover:-translate-y-1 transition-all active:translate-y-1 active:shadow-none h-auto min-h-[85px]">
                    <span class="text-[10px] md:text-xs font-black uppercase tracking-widest opacity-70 mb-1">What?</span>
                    <i class="ph ph-soccer-ball text-2xl md:text-3xl text-green-800"></i>
                </button>
                
                <!-- WHERE? -->
                <button onclick="activatePart('where')" class="card bg-[#bae6fd] text-gray-900 rounded-xl flex flex-col items-center justify-center shadow-[0_4px_0_#0ea5e9] border-2 border-[#0ea5e9] py-2 hover:bg-sky-200 hover:-translate-y-1 transition-all active:translate-y-1 active:shadow-none h-auto min-h-[85px]">
                    <span class="text-[10px] md:text-xs font-black uppercase tracking-widest opacity-70 mb-1">Where?</span>
                    <i class="ph ph-map-pin text-2xl md:text-3xl text-sky-800"></i>
                </button>
                
                <!-- WHEN? -->
                <button onclick="activatePart('when')" class="card bg-[#e7d5c9] text-gray-900 rounded-xl flex flex-col items-center justify-center shadow-[0_4px_0_#854d0e] border-2 border-[#854d0e] py-2 hover:bg-[#dcc0b0] hover:-translate-y-1 transition-all active:translate-y-1 active:shadow-none h-auto min-h-[85px]">
                    <span class="text-[10px] md:text-xs font-black uppercase tracking-widest opacity-70 mb-1">When?</span>
                    <i class="ph ph-clock text-2xl md:text-3xl text-amber-900"></i>
                </button>
                
                <!-- TO WHOM? -->
                <button onclick="activatePart('whom')" class="card bg-[#fbcfe8] text-gray-900 rounded-xl flex flex-col items-center justify-center shadow-[0_4px_0_#ec4899] border-2 border-[#ec4899] py-2 hover:bg-pink-200 hover:-translate-y-1 transition-all active:translate-y-1 active:shadow-none h-auto min-h-[85px]">
                    <span class="text-[10px] md:text-xs font-black uppercase tracking-widest opacity-70 mb-1 text-center leading-none">To<br>whom?</span>
                    <i class="ph ph-gift text-2xl md:text-3xl text-pink-800"></i>
                </button>
                
                <!-- WHY? -->
                <button onclick="activatePart('why')" class="card bg-[#e9d5ff] text-gray-900 rounded-xl flex flex-col items-center justify-center shadow-[0_4px_0_#a855f7] border-2 border-[#a855f7] py-2 hover:bg-purple-200 hover:-translate-y-1 transition-all active:translate-y-1 active:shadow-none h-auto min-h-[85px]">
                    <span class="text-[10px] md:text-xs font-black uppercase tracking-widest opacity-70 mb-1">Why?</span>
                    <i class="ph ph-question text-2xl md:text-3xl text-purple-800"></i>
                </button>
                
                <!-- HOW? -->
                <button onclick="activatePart('how')" class="card bg-[#99f6e4] text-gray-900 rounded-xl flex flex-col items-center justify-center shadow-[0_4px_0_#14b8a6] border-2 border-[#14b8a6] py-2 hover:bg-teal-200 hover:-translate-y-1 transition-all active:translate-y-1 active:shadow-none h-auto min-h-[85px]">
                    <span class="text-[10px] md:text-xs font-black uppercase tracking-widest opacity-70 mb-1">How?</span>
                    <i class="ph ph-lightning text-2xl md:text-3xl text-teal-800"></i>
                </button>
            </div>

        </div>
    </div>

    <!-- Hidden Voice Selector -->
    <select id="voiceSelect" class="hidden"></select>

    <script>
        // --- Data: 100 A1 Sentences with Emojis ---
        const allSentences = [
            { who: "The cat ðŸ±", action: "eats ðŸ½ï¸", what: "a fish ðŸŸ", whom: "", where: "in the kitchen ðŸ ", when: "now â°", why: "because hungry ðŸ˜‹", how: "quickly âš¡" },
            { who: "I ðŸ™‹", action: "play ðŸŽ®", what: "soccer âš½", whom: "with friends ðŸ‘«", where: "at the park ðŸŒ³", when: "on Sunday ðŸ“…", why: "for fun ðŸ˜„", how: "happily ðŸ˜Š" },
            { who: "My mom ðŸ‘©", action: "cooks ðŸ³", what: "dinner ðŸ", whom: "for us ðŸ‘¨â€ðŸ‘©â€ðŸ‘§", where: "at home ðŸ¡", when: "at 6pm ðŸ••", why: "to eat ðŸ´", how: "well ðŸ‘" },
            { who: "The dog ðŸ¶", action: "runs ðŸƒ", what: "", whom: "to me ðŸ™‹", where: "in the garden ðŸŒ»", when: "today â˜€ï¸", why: "to play ðŸŽ¾", how: "fast ðŸ’¨" },
            { who: "She ðŸ‘§", action: "reads ðŸ“–", what: "a book ðŸ“š", whom: "", where: "in bed ðŸ›ï¸", when: "at night ðŸŒ™", why: "to sleep ðŸ˜´", how: "quietly ðŸ¤«" },
            { who: "We ðŸ‘¨â€ðŸ‘©â€ðŸ‘¦", action: "go ðŸš¶", what: "", whom: "", where: "to school ðŸ«", when: "every day ðŸ—“ï¸", why: "to learn ðŸ§ ", how: "together ðŸ¤" },
            { who: "The bird ðŸ¦", action: "sings ðŸŽµ", what: "a song ðŸŽ¶", whom: "", where: "in the tree ðŸŒ³", when: "in the morning ðŸŒ…", why: "because happy ðŸ˜„", how: "sweetly ðŸ­" },
            { who: "He ðŸ‘¦", action: "drinks ðŸ¥¤", what: "milk ðŸ¥›", whom: "", where: "at the table ðŸª‘", when: "for breakfast ðŸ¥ž", why: "to grow ðŸ’ª", how: "slowly ðŸ¢" },
            { who: "The car ðŸš—", action: "stops ðŸ›‘", what: "", whom: "", where: "at the light ðŸš¦", when: "now â°", why: "for safety ðŸ›¡ï¸", how: "suddenly â—" },
            { who: "You ðŸ«µ", action: "wear ðŸ‘•", what: "a hat ðŸ§¢", whom: "", where: "outside ðŸŒ²", when: "in winter â„ï¸", why: "because cold ðŸ¥¶", how: "always â™¾ï¸" },
            { who: "The teacher ðŸ‘©â€ðŸ«", action: "writes âœï¸", what: "words ðŸ”¤", whom: "", where: "on the board ðŸŸ©", when: "in class ðŸ«", why: "to teach ðŸŽ“", how: "clearly ðŸ‘€" },
            { who: "Rain ðŸŒ§ï¸", action: "falls ðŸ’§", what: "", whom: "", where: "on the ground ðŸŒ", when: "in April ðŸ—“ï¸", why: "for flowers ðŸŒ¸", how: "softly â˜ï¸" },
            { who: "My brother ðŸ‘¦", action: "jumps ðŸ¦˜", what: "", whom: "", where: "on the bed ðŸ›ï¸", when: "after school ðŸŽ’", why: "for fun ðŸ˜†", how: "high â¬†ï¸" },
            { who: "The moon ðŸŒ™", action: "shines âœ¨", what: "", whom: "", where: "in the sky ðŸŒŒ", when: "tonight ðŸŒƒ", why: "for light ðŸ’¡", how: "brightly ðŸŒŸ" },
            { who: "My friend ðŸ‘«", action: "calls ðŸ“±", what: "me ðŸ™‹", whom: "", where: "on the phone ðŸ“ž", when: "often ðŸ”", why: "to talk ðŸ—£ï¸", how: "loudly ðŸ”Š" },
            { who: "The baby ðŸ‘¶", action: "cries ðŸ˜­", what: "", whom: "for milk ðŸ¼", where: "in the crib ðŸ›ï¸", when: "at night ðŸŒ‘", why: "because hungry ðŸ˜‹", how: "loudly ðŸ“¢" },
            { who: "We ðŸ‘«", action: "watch ðŸ“º", what: "a movie ðŸŽ¬", whom: "", where: "at the cinema ðŸ¿", when: "on Friday ðŸ“…", why: "to relax ðŸ˜Œ", how: "quietly ðŸ¤«" },
            { who: "Tom ðŸ‘¨", action: "eats ðŸ•", what: "pizza ðŸ•", whom: "", where: "at the party ðŸŽ‰", when: "today ðŸ“…", why: "because tasty ðŸ˜‹", how: "quickly ðŸƒ" },
            { who: "The bus ðŸšŒ", action: "goes ðŸ’¨", what: "", whom: "", where: "to the city ðŸ™ï¸", when: "at 8am ðŸ•—", why: "for work ðŸ’¼", how: "fast ðŸŽï¸" },
            { who: "Grandma ðŸ‘µ", action: "sits ðŸª‘", what: "", whom: "", where: "in the chair ðŸ›‹ï¸", when: "in the afternoon â˜€ï¸", why: "to rest ðŸ’¤", how: "calmly ðŸ˜Œ" },
            { who: "I ðŸ™‹", action: "love â¤ï¸", what: "my family ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦", whom: "", where: "at home ðŸ ", when: "always â™¾ï¸", why: "because nice ðŸ˜Š", how: "very much ðŸ’¯" },
            { who: "The sun â˜€ï¸", action: "comes ðŸŒ…", what: "up â¬†ï¸", whom: "", where: "in the east ðŸ§­", when: "early ðŸ•–", why: "to start day ðŸ“…", how: "brightly ðŸŒŸ" },
            { who: "Fish ðŸŸ", action: "swim ðŸŠ", what: "", whom: "", where: "in the water ðŸŒŠ", when: "all day ðŸ•°ï¸", why: "to live â¤ï¸", how: "fast ðŸ’¨" },
            { who: "Dad ðŸ‘¨", action: "washes ðŸ§¼", what: "the car ðŸš—", whom: "", where: "outside ðŸ¡", when: "on Saturday ðŸ“…", why: "to clean âœ¨", how: "well ðŸ‘" },
            { who: "We ðŸ‘«", action: "dance ðŸ’ƒ", what: "", whom: "together ðŸ¤", where: "at the club ðŸª©", when: "at night ðŸŒ™", why: "to music ðŸŽµ", how: "happily ðŸ˜Š" },
            { who: "The girl ðŸ‘§", action: "draws ðŸŽ¨", what: "a flower ðŸŒ¸", whom: "", where: "on paper ðŸ“„", when: "in art class ðŸŽ¨", why: "for fun ðŸ˜„", how: "neatly ðŸ–Šï¸" },
            { who: "He ðŸ‘¦", action: "walks ðŸš¶", what: "to school ðŸ«", whom: "", where: "on the path ðŸ›£ï¸", when: "today ðŸ“…", why: "for class ðŸ“š", how: "slowly ðŸ¢" },
            { who: "The horse ðŸŽ", action: "eats ðŸŒ¾", what: "grass ðŸŒ¿", whom: "", where: "in the field ðŸšœ", when: "all day â˜€ï¸", why: "because hungry ðŸ˜‹", how: "slowly ðŸ¢" },
            { who: "We ðŸ‘¨â€ðŸ‘©â€ðŸ‘¦", action: "listen ðŸ‘‚", what: "to music ðŸŽ§", whom: "", where: "in the car ðŸš—", when: "on trips ðŸŽ’", why: "to enjoy ðŸ˜„", how: "loudly ðŸ”Š" },
            { who: "The shop ðŸª", action: "opens ðŸ”“", what: "", whom: "", where: "in town ðŸ˜ï¸", when: "at 9am ðŸ•˜", why: "for business ðŸ’¼", how: "early â°" },
            { who: "You ðŸ«µ", action: "help ðŸ¤", what: "me ðŸ™‹", whom: "", where: "with homework ðŸ“", when: "now â°", why: "because kind ðŸ’–", how: "nicely ðŸ˜Š" },
            { who: "The train ðŸš‚", action: "arrives ðŸ", what: "", whom: "", where: "at the station ðŸš‰", when: "soon â³", why: "for people ðŸ‘¥", how: "fast ðŸ’¨" },
            { who: "We ðŸ‘«", action: "clean ðŸ§¹", what: "the house ðŸ ", whom: "", where: "inside ðŸšª", when: "on Sunday ðŸ“…", why: "to be tidy âœ¨", how: "well ðŸ‘" },
            { who: "The star â­", action: "twinkles âœ¨", what: "", whom: "", where: "above us â¬†ï¸", when: "at night ðŸŒŒ", why: "like a diamond ðŸ’Ž", how: "brightly ðŸŒŸ" },
            { who: "My dad ðŸ‘¨", action: "works ðŸ’¼", what: "", whom: "", where: "in an office ðŸ¢", when: "every week ðŸ—“ï¸", why: "for money ðŸ’°", how: "hard ðŸ’ª" },
            { who: "She ðŸ‘©", action: "smiles ðŸ™‚", what: "", whom: "at me ðŸ™‹", where: "in class ðŸ«", when: "when happy ðŸ˜„", why: "because friendly ðŸ’–", how: "sweetly ðŸ¬" },
            { who: "The game ðŸŽ®", action: "starts â–¶ï¸", what: "", whom: "", where: "on TV ðŸ“º", when: "at 5pm ðŸ•”", why: "for fans ðŸ“£", how: "soon â³" },
            { who: "I ðŸ™‹", action: "brush ðŸª¥", what: "my teeth ðŸ¦·", whom: "", where: "in the bathroom ðŸš½", when: "at night ðŸŒ™", why: "to be clean âœ¨", how: "carefully âš ï¸" },
            { who: "Birds ðŸ¦", action: "fly âœˆï¸", what: "", whom: "", where: "in the sky â˜ï¸", when: "in the morning ðŸŒ…", why: "to find food ðŸ›", how: "high â¬†ï¸" },
            { who: "We ðŸ‘«", action: "say ðŸ—£ï¸", what: "hello ðŸ‘‹", whom: "to the teacher ðŸ‘©â€ðŸ«", where: "at the door ðŸšª", when: "at 8am ðŸ•—", why: "to be polite ðŸ¤", how: "loudly ðŸ“¢" },
            { who: "The snow â„ï¸", action: "falls ðŸŒ¨ï¸", what: "", whom: "", where: "outside ðŸ¡", when: "in winter â›„", why: "from clouds â˜ï¸", how: "silently ðŸ¤«" },
            { who: "Students ðŸŽ’", action: "sit ðŸª‘", what: "", whom: "", where: "at desks ðŸ«", when: "in class ðŸ“š", why: "to learn ðŸ§ ", how: "quietly ðŸ¤«" },
            { who: "My sister ðŸ‘§", action: "draws ðŸ–ï¸", what: "a cat ðŸ±", whom: "", where: "in her book ðŸ““", when: "after dinner ðŸ½ï¸", why: "for fun ðŸ˜†", how: "well ðŸ‘" },
            { who: "We ðŸ‘«", action: "walk ðŸš¶", what: "", whom: "", where: "in the forest ðŸŒ²", when: "on Sunday ðŸ“…", why: "for air ðŸŒ¬ï¸", how: "slowly ðŸ¢" },
            { who: "The boy ðŸ‘¦", action: "rides ðŸš´", what: "his bike ðŸš²", whom: "", where: "to the park ðŸŒ³", when: "after school ðŸŽ’", why: "to play ðŸŽ¾", how: "fast ðŸ’¨" },
            { who: "I ðŸ™‹", action: "see ðŸ‘€", what: "a big dog ðŸ•", whom: "", where: "on the street ðŸ›£ï¸", when: "today ðŸ“…", why: "walking ðŸš¶", how: "clearly ðŸ‘“" },
            { who: "She ðŸ‘§", action: "likes ðŸ‘", what: "ice cream ðŸ¦", whom: "", where: "", when: "in summer â˜€ï¸", why: "because cold â„ï¸", how: "very much ðŸ’¯" },
            { who: "He ðŸ‘¨", action: "plays ðŸŽ¸", what: "guitar ðŸŽ¸", whom: "", where: "in his room ðŸ ", when: "at night ðŸŒ™", why: "to practice ðŸŽµ", how: "loudly ðŸ”Š" },
            { who: "We ðŸ‘«", action: "drink ðŸ¹", what: "juice ðŸŠ", whom: "", where: "at lunch ðŸ¥ª", when: "every day ðŸ—“ï¸", why: "because sweet ðŸ¬", how: "happily ðŸ˜Š" },
            { who: "Teacher ðŸ‘¨â€ðŸ«", action: "reads ðŸ“–", what: "a story ðŸ“š", whom: "to us ðŸ‘‚", where: "in the library ðŸ“–", when: "on Friday ðŸ“…", why: "for fun ðŸ˜„", how: "clearly ðŸ—£ï¸" },
            { who: "Mom ðŸ‘©", action: "buys ðŸ›’", what: "food ðŸŽ", whom: "", where: "at the store ðŸª", when: "on Friday ðŸ“…", why: "for the week ðŸ—“ï¸", how: "carefully ðŸ§" },
            { who: "The girl ðŸ‘§", action: "sings ðŸŽ¤", what: "", whom: "", where: "in the shower ðŸš¿", when: "in the morning â˜€ï¸", why: "because happy ðŸ˜„", how: "loudly ðŸ“¢" },
            { who: "I ðŸ™‹", action: "wash ðŸ§¼", what: "my hands ðŸ‘", whom: "", where: "in the sink ðŸš°", when: "before dinner ðŸ½ï¸", why: "to be clean âœ¨", how: "carefully âš ï¸" },
            { who: "The bus ðŸšŒ", action: "goes ðŸšŒ", what: "", whom: "", where: "to the city ðŸ™ï¸", when: "every hour ðŸ•", why: "for people ðŸ‘¥", how: "slowly ðŸ¢" },
            { who: "We ðŸ˜´", action: "sleep ðŸ’¤", what: "", whom: "", where: "in beds ðŸ›ï¸", when: "at night ðŸŒ™", why: "to rest ðŸ”‹", how: "soundly ðŸ˜´" },
            { who: "The sun â˜€ï¸", action: "rises ðŸŒ…", what: "", whom: "", where: "in the morning ðŸŒ„", when: "at 6am ðŸ••", why: "start day ðŸ“…", how: "brightly ðŸŒŸ" },
            { who: "I âœï¸", action: "write ðŸ“", what: "my name ðŸ·ï¸", whom: "", where: "on paper ðŸ“„", when: "in class ðŸ«", why: "for teacher ðŸ‘©â€ðŸ«", how: "neatly ðŸ–Šï¸" },
            { who: "She ðŸ‘©", action: "buys ðŸ›ï¸", what: "milk ðŸ¥›", whom: "", where: "at the shop ðŸª", when: "today ðŸ“…", why: "for cereal ðŸ¥£", how: "quickly ðŸƒ" },
            { who: "He ðŸƒ", action: "runs ðŸƒ", what: "", whom: "", where: "to the bus ðŸšŒ", when: "in morning â˜€ï¸", why: "because late âŒš", how: "fast ðŸ’¨" },
            { who: "They ðŸ‘¯", action: "play ðŸ¤¾", what: "games ðŸŽ²", whom: "", where: "outside ðŸŒ³", when: "after school ðŸŽ’", why: "for fun ðŸ˜†", how: "happily ðŸ˜Š" },
            { who: "The cat ðŸ±", action: "chases ðŸƒ", what: "a mouse ðŸ­", whom: "", where: "in the house ðŸ ", when: "sometimes ðŸ•°ï¸", why: "for food ðŸ§€", how: "fast âš¡" },
            { who: "We ðŸ”­", action: "look ðŸ‘€", what: "at stars âœ¨", whom: "", where: "outside ðŸŒŒ", when: "at night ðŸŒ™", why: "because pretty ðŸ¤©", how: "quietly ðŸ¤«" },
            { who: "Mom ðŸ‘©", action: "works ðŸ’»", what: "", whom: "", where: "at home ðŸ¡", when: "every day ðŸ—“ï¸", why: "for her job ðŸ’¼", how: "hard ðŸ’ª" },
            { who: "The dog ðŸ•", action: "sleeps ðŸ’¤", what: "", whom: "", where: "on the floor ðŸ§±", when: "in afternoon â˜€ï¸", why: "to rest ðŸ”‹", how: "quietly ðŸ¤«" },
            { who: "I ðŸ™‹", action: "close ðŸšª", what: "the window ðŸªŸ", whom: "", where: "in my room ðŸ›Œ", when: "at night ðŸŒ™", why: "because cold ðŸ¥¶", how: "tightly ðŸ”’" },
            { who: "She ðŸ‘—", action: "wears ðŸ‘—", what: "a red dress ðŸ’ƒ", whom: "", where: "to the party ðŸŽ‰", when: "tonight ðŸŒƒ", why: "to look nice ðŸ’…", how: "proudly ðŸ¦š" },
            { who: "He ðŸŽ", action: "gives ðŸŽ", what: "a flower ðŸŒ¹", whom: "to his mom ðŸ‘©", where: "at home ðŸ ", when: "on Sunday ðŸ“…", why: "for love â¤ï¸", how: "kindly ðŸ¤" },
            { who: "We ðŸ°", action: "make ðŸŽ‚", what: "a cake ðŸ°", whom: "", where: "in kitchen ðŸ³", when: "for birthday ðŸŽ‚", why: "to eat ðŸ´", how: "carefully ðŸ§" },
            { who: "Rain ðŸŒ§ï¸", action: "hits â˜”", what: "the window ðŸªŸ", whom: "", where: "in my room ðŸ ", when: "now â°", why: "from storm â›ˆï¸", how: "hard ðŸ”¨" },
            { who: "I ðŸ“–", action: "read ðŸ“–", what: "words ðŸ”¡", whom: "", where: "in the book ðŸ“˜", when: "in class ðŸ«", why: "to learn ðŸ§ ", how: "slowly ðŸ¢" },
            { who: "The bird ðŸ¦…", action: "flies âœˆï¸", what: "", whom: "", where: "to the nest ðŸªº", when: "at night ðŸŒ™", why: "to sleep ðŸ˜´", how: "fast ðŸ’¨" },
            { who: "My friend ðŸ‘¯", action: "smiles ðŸ˜Š", what: "", whom: "", where: "at school ðŸ«", when: "today ðŸ“…", why: "because happy ðŸ˜„", how: "nicely ðŸŒ¸" },
            { who: "The car ðŸš—", action: "stops ðŸ›‘", what: "", whom: "", where: "at the sign ðŸ›‘", when: "now â°", why: "for safety ðŸ›¡ï¸", how: "quickly âš¡" },
            { who: "We ðŸ¤¸", action: "jump ðŸ¤¸", what: "rope âž°", whom: "", where: "in the yard ðŸ¡", when: "after lunch ðŸ¥ª", why: "for exercise ðŸ’ª", how: "high â¬†ï¸" },
            { who: "She ðŸ“ž", action: "calls ðŸ“±", what: "her dad ðŸ‘¨", whom: "", where: "on phone ðŸ“ž", when: "at night ðŸŒ™", why: "to say hello ðŸ‘‹", how: "happily ðŸ˜Š" },
            { who: "He ðŸ“¦", action: "opens ðŸ“¦", what: "the box ðŸ“¦", whom: "", where: "on table ðŸª‘", when: "now â°", why: "to see inside ðŸ‘€", how: "carefully ðŸ§" },
            { who: "They ðŸš¶", action: "walk ðŸš¶", what: "", whom: "", where: "to the shop ðŸª", when: "in morning â˜€ï¸", why: "to buy food ðŸŽ", how: "together ðŸ¤" },
            { who: "Wind ðŸŒ¬ï¸", action: "blows ðŸŒ¬ï¸", what: "", whom: "", where: "outside ðŸŒ³", when: "today ðŸ“…", why: "weather ðŸŒ¤ï¸", how: "strongly ðŸ’ª" },
            { who: "I ðŸ†˜", action: "help ðŸ†˜", what: "my mom ðŸ‘©", whom: "", where: "in kitchen ðŸ³", when: "at dinner ðŸ½ï¸", why: "to be good ðŸ˜‡", how: "well ðŸ‘" },
            { who: "The baby ðŸ‘¶", action: "plays ðŸ§¸", what: "with toys ðŸ§¸", whom: "", where: "on rug ðŸ§¶", when: "now â°", why: "for fun ðŸ˜†", how: "happily ðŸ˜Š" },
            { who: "We ðŸ§˜", action: "sit ðŸ§˜", what: "", whom: "", where: "on grass ðŸŒ±", when: "in summer â˜€ï¸", why: "to relax ðŸ˜Œ", how: "calmly ðŸƒ" },
            { who: "Dad ðŸš—", action: "drives ðŸš˜", what: "the car ðŸš—", whom: "", where: "to work ðŸ¢", when: "at 8am ðŸ•—", why: "to go there ðŸ“", how: "safely ðŸ›¡ï¸" },
            { who: "The girl ðŸ¥ª", action: "eats ðŸ¥ª", what: "lunch ðŸ±", whom: "", where: "at school ðŸ«", when: "at 12pm ðŸ•›", why: "because hungry ðŸ˜‹", how: "quickly ðŸƒ" },
            { who: "I â¤ï¸", action: "love â¤ï¸", what: "my dog ðŸ¶", whom: "", where: "at home ðŸ ", when: "always â™¾ï¸", why: "he is cute ðŸ¥º", how: "truly ðŸ’–" },
            { who: "The boy âœï¸", action: "writes âœï¸", what: "a letter âœ‰ï¸", whom: "to grandma ðŸ‘µ", where: "at desk ðŸª‘", when: "today ðŸ“…", why: "to say hi ðŸ‘‹", how: "slowly ðŸ¢" },
            { who: "We ðŸ¿", action: "watch ðŸ¿", what: "a movie ðŸŽ¬", whom: "", where: "at cinema ðŸŽ¥", when: "on Saturday ðŸ“…", why: "for fun ðŸ˜†", how: "quietly ðŸ¤«" },
            { who: "She ðŸš¿", action: "washes ðŸ§¼", what: "her face ðŸ‘±â€â™€ï¸", whom: "", where: "in bathroom ðŸš½", when: "in morning â˜€ï¸", why: "to be clean âœ¨", how: "well ðŸ‘" },
            { who: "He ðŸ‘‚", action: "listens ðŸ‘‚", what: "to teacher ðŸ‘©â€ðŸ«", whom: "", where: "in class ðŸ«", when: "now â°", why: "to learn ðŸ§ ", how: "carefully ðŸ§" },
            { who: "Sun ðŸŒ…", action: "goes ðŸ“‰", what: "", whom: "", where: "down â¬‡ï¸", when: "at night ðŸŒ™", why: "end day ðŸ”š", how: "slowly ðŸ¢" },
            { who: "I ðŸ˜Š", action: "am ðŸ˜Š", what: "happy ðŸ˜„", whom: "", where: "at school ðŸ«", when: "today ðŸ“…", why: "friends ðŸ‘«", how: "very ðŸ’¯" },
            { who: "We ðŸ‘¨â€ðŸ‘©â€ðŸ‘§", action: "are ðŸ‘¨â€ðŸ‘©â€ðŸ‘§", what: "family â¤ï¸", whom: "", where: "at home ðŸ ", when: "always â™¾ï¸", why: "love â¤ï¸", how: "truly âœ¨" },
            { who: "Sam ðŸ§‘", action: "kicks âš½", what: "the ball âš½", whom: "to Ben ðŸ§‘", where: "in park ðŸŒ³", when: "tomorrow ðŸ“…", why: "to practice ðŸƒ", how: "happily ðŸ˜Š" },
            { who: "The cat ðŸˆ", action: "sleeps ðŸ’¤", what: "", whom: "", where: "on rug ðŸ§¶", when: "all day ðŸ•°ï¸", why: "tired ðŸ˜´", how: "quietly ðŸ¤«" },
            { who: "I ðŸŽ", action: "eat ðŸŽ", what: "an apple ðŸŽ", whom: "", where: "in kitchen ðŸ³", when: "morning â˜€ï¸", why: "breakfast ðŸ¥£", how: "slowly ðŸ¢" },
            { who: "She ðŸš¶â€â™€ï¸", action: "walks ðŸš¶â€â™€ï¸", what: "to school ðŸ«", whom: "", where: "on street ðŸ›£ï¸", when: "every day ðŸ—“ï¸", why: "to learn ðŸ§ ", how: "quickly ðŸƒâ€â™€ï¸" },
            { who: "The dog ðŸ•", action: "barks ðŸ—£ï¸", what: "", whom: "at mailman ðŸ“®", where: "in garden ðŸ¡", when: "at noon ðŸ•›", why: "protect ðŸ›¡ï¸", how: "loudly ðŸ”Š" },
            { who: "We âš½", action: "play âš½", what: "soccer âš½", whom: "with friends ðŸ‘«", where: "at field ðŸ¥…", when: "on Sunday ðŸ“…", why: "fun ðŸ˜†", how: "well ðŸ‘" },
            { who: "Mom ðŸ‘©â€ðŸ³", action: "cooks ðŸ¥˜", what: "dinner ðŸ¥˜", whom: "for us ðŸ‘¨â€ðŸ‘©â€ðŸ‘§", where: "at home ðŸ ", when: "at 6pm ðŸ••", why: "hungry ðŸ˜‹", how: "nicely ðŸ‘Œ" },
            { who: "Bird ðŸ¦", action: "sings ðŸŽ¶", what: "song ðŸŽµ", whom: "", where: "in tree ðŸŒ³", when: "now â°", why: "morning â˜€ï¸", how: "sweetly ðŸ¬" },
            { who: "They ðŸ“º", action: "watch ðŸ“º", what: "TV ðŸ“º", whom: "", where: "in room ðŸ›‹ï¸", when: "after dinner ðŸ½ï¸", why: "relax ðŸ˜Œ", how: "quietly ðŸ¤«" }
        ];

        // --- State Management ---
        let currentIndex = 0;
        let points = 0;
        let currentActive = null;

        // --- DOM Elements ---
        const container = document.getElementById('sentence-container');
        const counterDisplay = document.getElementById('counter');
        const pointsDisplay = document.getElementById('pointsDisplay');

        // --- Config ---
        const config = {
            'who': { id: 'part-who', class: 'active-orange', label: 'Who?' },
            'action': { id: 'part-action', class: 'active-yellow', label: 'Action' },
            'what': { id: 'part-what', class: 'active-green', label: 'What?' },
            'where': { id: 'part-where', class: 'active-blue', label: 'Where?' },
            'when': { id: 'part-when', class: 'active-brown', label: 'When?' },
            'whom': { id: 'part-whom', class: 'active-pink', label: 'To Whom?' },
            'why': { id: 'part-why', class: 'active-purple', label: 'Why?' },
            'how': { id: 'part-how', class: 'active-teal', label: 'How?' }
        };

        // --- Render Logic ---
        function renderSentence() {
            if (allSentences.length === 0) return;
            const s = allSentences[currentIndex];
            container.innerHTML = ''; // Clear previous
            currentActive = null; 

            // Define parts in order
            const parts = ['who', 'action', 'what', 'whom', 'where', 'when', 'why', 'how'];

            // Create masked elements
            parts.forEach(key => {
                if (s[key]) {
                    const span = document.createElement('span');
                    span.id = config[key].id;
                    span.className = 'sentence-part';
                    span.setAttribute('data-full-text', s[key]);
                    span.setAttribute('data-label', config[key].label); // Set label for CSS ::before
                    // span.textContent = "_____"; // Hidden state (handled by color transparent now)
                    span.textContent = s[key]; // Text is there but hidden by color:transparent
                    
                    // Allow clicking the word itself to reveal
                    span.onclick = () => activatePart(key);
                    
                    container.appendChild(span);
                }
            });

            counterDisplay.textContent = `${currentIndex + 1}/${allSentences.length}`;
            resetStyles();
        }

        function resetStyles() {
            const parts = document.querySelectorAll('.sentence-part');
            parts.forEach(p => {
                p.classList.remove('revealed', 'active-orange', 'active-yellow', 'active-green', 'active-blue', 'active-brown', 'active-pink', 'active-purple', 'active-teal');
                // Ensure text is hidden again
            });
        }

        // --- Interaction Logic ---
        function activatePart(partName) {
            const targetConfig = config[partName];
            if (!targetConfig) return;

            const el = document.getElementById(targetConfig.id);
            
            // If element exists for this sentence
            if (el) {
                // Remove active highlight from all others to focus on this one
                document.querySelectorAll('.sentence-part').forEach(p => {
                    // Remove specific active color classes but keep 'revealed' if it was revealed
                    Object.values(config).forEach(c => p.classList.remove(c.class));
                });

                // Add revealed class (makes text visible) and specific color class
                el.classList.add('revealed');
                el.classList.add(targetConfig.class);
                
                // Animation for emphasis
                el.animate([
                    { transform: 'scale(1)' },
                    { transform: 'scale(1.1)' },
                    { transform: 'scale(1)' }
                ], { duration: 200 });

                // Speak just this part
                speakText(el.innerText);
            }
        }

        function revealAll() {
            const parts = document.querySelectorAll('.sentence-part');
            parts.forEach(el => {
                el.classList.add('revealed');
                // Add default border color or keep gray
                el.style.borderBottomStyle = 'solid';
            });
        }

        // --- Navigation ---
        function nextSentence() {
            if (currentIndex < allSentences.length - 1) {
                currentIndex++;
                renderSentence();
            }
        }

        function prevSentence() {
            if (currentIndex > 0) {
                currentIndex--;
                renderSentence();
            }
        }

        function goHome() {
            currentIndex = 0;
            renderSentence();
        }

        function randomSentence() {
            currentIndex = Math.floor(Math.random() * allSentences.length);
            renderSentence();
        }

        // --- Points ---
        function addPoint() {
            points += 5;
            pointsDisplay.textContent = points;
            const btn = document.getElementById('pointsBtn');
            btn.classList.remove('pop-anim');
            void btn.offsetWidth; 
            btn.classList.add('pop-anim');
            playDing();
        }

        function playDing() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            if (AudioContext) {
                const ctx = new AudioContext();
                const osc = ctx.createOscillator();
                const gain = ctx.createGain();
                osc.connect(gain);
                gain.connect(ctx.destination);
                osc.type = 'sine';
                osc.frequency.setValueAtTime(600, ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1000, ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.05, ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.1);
                osc.start();
                osc.stop(ctx.currentTime + 0.15);
            }
        }

        // --- TTS Logic (Emoji Stripping + Slow Speed + Voice Rotation) ---
        const synth = window.speechSynthesis;
        let voices = [];

        function populateVoices() {
            voices = synth.getVoices();
        }
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = populateVoices;
        }

        function speakText(text) {
            if (synth.speaking) synth.cancel();

            // Strip emojis using regex so the robot doesn't read them
            const cleanText = text.replace(/([\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF])/g, '');

            const utterThis = new SpeechSynthesisUtterance(cleanText);
            
            // User Preference: 85% speed
            utterThis.rate = 0.85; 

            // Voice Rotation Logic based on currentIndex
            // Preferred voices: Brian, Emma, Ava, Andrew
            const preferredRotation = ['Brian', 'Emma', 'Ava', 'Andrew'];
            
            // Determine which name to look for based on index (0,1,2,3,0,1...)
            const targetName = preferredRotation[currentIndex % preferredRotation.length];

            if (voices.length === 0) populateVoices();
            
            let selectedVoice = null;

            // 1. Try to find the specific "Microsoft [Name] Online (Natural)" voice
            selectedVoice = voices.find(v => v.name.includes(targetName) && v.name.includes('Online'));
            
            // 2. Fallback: Try to find just the name (e.g. offline versions)
            if (!selectedVoice) {
                selectedVoice = voices.find(v => v.name.includes(targetName));
            }

            // 3. Fallback: Generic English
            if (!selectedVoice) {
                selectedVoice = voices.find(v => v.lang.includes('en'));
            }

            if (selectedVoice) utterThis.voice = selectedVoice;

            synth.speak(utterThis);
        }

        function speakSentence() {
            // Get full text from data attributes to ensure we get hidden parts too if user clicks Read before revealing
            // Or just read visible text? Better to read full sentence for comprehension.
            const parts = document.querySelectorAll('.sentence-part');
            let sentence = "";
            parts.forEach(p => sentence += p.getAttribute('data-full-text') + " ");
            speakText(sentence);
        }
        
        // Initial load
        window.onload = () => {
            setTimeout(populateVoices, 100);
            renderSentence();
        };

    </script>
</body>
</html>
