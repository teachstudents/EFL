<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>💡 Energy Equity & Education Debate</title>
    <style>
        body {
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', Arial, sans-serif;
            background: linear-gradient(135deg, #1a365d 0%, #2d5a87 25%, #4a90b8 50%, #6bb6d6 75%, #8fd3e8 100%);
            background-attachment: fixed;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
            color: #ffffff;
        }

        /* Enhanced 3D Button Styles */
        .btn-3d {
            background: linear-gradient(145deg, #2563eb 0%, #1d4ed8 50%, #1e40af 100%);
            border: none;
            border-radius: 15px;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: 900;
            color: #ffffff;
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 
                0 8px 20px rgba(0,0,0,0.4),
                0 3px 10px rgba(0,0,0,0.3),
                inset 0 2px 5px rgba(255,255,255,0.2),
                inset 0 -2px 5px rgba(0,0,0,0.3);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            margin: 10px;
            min-width: 200px;
            text-align: center;
        }

        .btn-3d::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(145deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            border-radius: 25px;
            z-index: -1;
        }

        .btn-3d:hover {
            transform: translateY(-8px) scale(1.05);
            box-shadow: 
                0 25px 50px rgba(0,0,0,0.4),
                0 10px 25px rgba(0,0,0,0.3),
                inset 0 2px 8px rgba(255,255,255,0.4),
                inset 0 -2px 8px rgba(0,0,0,0.3);
        }

        .btn-3d:active {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 
                0 10px 25px rgba(0,0,0,0.3),
                0 5px 15px rgba(0,0,0,0.2),
                inset 0 2px 5px rgba(255,255,255,0.2),
                inset 0 -2px 5px rgba(0,0,0,0.3);
        }

        .btn-grade10 {
            background: linear-gradient(145deg, #dc2626 0%, #b91c1c 50%, #991b1b 100%);
        }

        .btn-grade11 {
            background: linear-gradient(145deg, #059669 0%, #047857 50%, #065f46 100%);
        }

        .btn-grade12 {
            background: linear-gradient(145deg, #7c3aed 0%, #6d28d9 50%, #5b21b6 100%);
        }

        /* Glowing Background Effect */
        .glow-background {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(255,255,255,0.2) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.5s ease;
            pointer-events: none;
            z-index: -1;
        }

        .glow-background.active {
            opacity: 1;
            animation: pulseGlow 2s ease-in-out infinite;
        }

        @keyframes pulseGlow {
            0%, 100% { transform: scale(1); opacity: 0.1; }
            50% { transform: scale(1.1); opacity: 0.3; }
        }

        /* Glitter Effect */
        .glitter-container {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 100;
        }

        .glitter {
            position: absolute;
            width: 8px;
            height: 8px;
            background: linear-gradient(45deg, #ffd700, #ffed4e, #ffffff);
            border-radius: 50%;
            animation: glitterFall 3s linear infinite;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.8);
        }

        @keyframes glitterFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 10px;
            text-align: center;
            height: 100vh;
            overflow: hidden;
        }

        /* Title Styles */
        .main-title {
            font-size: 32px;
            font-weight: 900;
            color: #ffffff;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8), 0 0 20px rgba(255, 255, 255, 0.3);
            margin-bottom: 10px;
            line-height: 1.1;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .subtitle {
            font-size: 18px;
            font-weight: 700;
            color: #ffffff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            margin-bottom: 15px;
        }

        /* Timer Display */
        .timer-display {
            position: fixed;
            top: 10px;
            right: 10px;
            background: linear-gradient(145deg, #1f2937, #111827);
            color: #ffffff;
            border: 2px solid #3b82f6;
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 900;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            z-index: 1000;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        /* Phase Display */
        .phase-display {
            position: fixed;
            top: 10px;
            left: 10px;
            background: linear-gradient(145deg, #1f2937, #111827);
            color: #ffffff;
            border: 2px solid #10b981;
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 700;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            z-index: 1000;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        /* Content Sections */
        .content-section {
            display: none;
            background: rgba(31, 41, 55, 0.95);
            color: #ffffff;
            border: 2px solid #374151;
            border-radius: 15px;
            padding: 15px;
            margin: 5px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            font-size: 14px;
            line-height: 1.4;
            text-align: left;
            height: calc(100vh - 160px);
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        .content-section.active {
            display: block;
            animation: slideIn 0.8s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.98);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .content-section h2 {
            font-size: 20px;
            font-weight: 900;
            color: #ffffff;
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        .content-section h3 {
            font-size: 16px;
            font-weight: 700;
            color: #60a5fa;
            margin: 10px 0 8px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        /* Team Display */
        .teams-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .team-card {
            background: linear-gradient(145deg, #1e40af, #1d4ed8);
            color: #ffffff;
            border: 2px solid #3b82f6;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            text-align: center;
        }

        .team-card h4 {
            font-size: 20px;
            font-weight: 900;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .team-member {
            font-size: 14px;
            font-weight: 600;
            margin: 5px 0;
            padding: 5px;
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
        }

        /* Student Perspective Cards */
        .student-card {
            background: linear-gradient(145deg, #374151, #1f2937);
            color: #ffffff;
            border: 2px solid #6b7280;
            padding: 10px;
            border-radius: 15px;
            margin: 5px 0;
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .student-card.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .student-card.sarah {
            background: linear-gradient(145deg, #991b1b, #7f1d1d);
            border-color: #dc2626;
        }

        .student-card.alex {
            background: linear-gradient(145deg, #1e40af, #1e3a8a);
            border-color: #3b82f6;
        }

        .student-card.chris {
            background: linear-gradient(145deg, #065f46, #064e3b);
            border-color: #10b981;
        }

        .student-card h4 {
            font-size: 20px;
            font-weight: 900;
            margin: 0 0 5px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .student-card p {
            margin: 4px 0;
            font-size: 13px;
        }

        .student-card .quote {
            font-size: 16px;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            border-left: 4px solid rgba(255,255,255,0.3);
            line-height: 1.5;
        }

        .highlight {
            background-color: rgba(251, 191, 36, 0.7);
            color: #1f2937;
            padding: 2px 0;
            border-radius: 3px;
            transition: background-color 0.2s ease, color 0.2s ease;
        }

        /* Decision Options */
        .decision-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }

        .option-card {
            padding: 15px;
            border-radius: 20px;
            text-align: center;
            font-weight: 700;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            transition: transform 0.3s ease;
        }

        .option-card h4 {
             font-size: 16px;
        }

        .option-card:hover {
            transform: translateY(-5px);
        }

        .option-a {
            background: linear-gradient(145deg, #991b1b, #7f1d1d);
            color: #ffffff;
            border: 2px solid #dc2626;
        }

        .option-b {
            background: linear-gradient(145deg, #065f46, #064e3b);
            color: #ffffff;
            border: 2px solid #10b981;
        }

        /* Instructions */
        .instruction-box {
            background: linear-gradient(145deg, #1f2937, #111827);
            color: #ffffff;
            border: 2px solid #fbbf24;
            padding: 10px;
            border-radius: 10px;
            margin: 8px 0;
            font-size: 14px;
            font-weight: 700;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
        }

        /* Progress Bar */
        .progress-container {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 10px;
            background: rgba(0,0,0,0.3);
            z-index: 1000;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #2563eb, #1d4ed8);
            width: 0%;
            transition: width 1s ease;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .main-title { font-size: 60px; }
            .subtitle { font-size: 36px; }
            .btn-3d { font-size: 28px; padding: 20px 40px; }
            .content-section { font-size: 24px; padding: 40px; }
        }

        /* Hide elements initially */
        .hidden {
            display: none !important;
        }

        /* Animated Emojis */
        .animated-emoji {
            display: inline-block;
            animation: emojiJiggle 2s ease-in-out infinite;
        }

        @keyframes emojiJiggle {
            0%, 100% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(-3deg) scale(1.05); }
            75% { transform: rotate(3deg) scale(1.05); }
        }

        /* Sound Effect Display */
        .sound-effect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            z-index: 2000;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
        }

        .sound-effect.show {
            opacity: 1;
            animation: soundPulse 1s ease-out;
        }

        @keyframes soundPulse {
            0% { transform: translate(-50%, -50%) scale(0.5); }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }

        /* Countdown Warning */
        .countdown-warning {
            position: fixed;
            top: 120px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(145deg, #991b1b, #7f1d1d);
            color: #ffffff;
            border: 3px solid #fbbf24;
            padding: 15px 30px;
            border-radius: 20px;
            font-size: 24px;
            font-weight: 900;
            box-shadow: 0 10px 30px rgba(0,0,0,0.6);
            z-index: 1500;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .countdown-warning.show {
            opacity: 1;
            animation: warningPulse 2s ease-in-out;
        }

        @keyframes warningPulse {
            0%, 100% { transform: translateX(-50%) scale(1); }
            50% { transform: translateX(-50%) scale(1.1); }
        }

        /* Audio Indicator */
        .audio-indicator {
            position: fixed;
            top: 60px;
            right: 10px;
            background: linear-gradient(145deg, #5b21b6, #4c1d95);
            color: #ffffff;
            border: 2px solid #8b5cf6;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 14px;
            font-weight: 700;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .audio-indicator.show {
            opacity: 1;
            animation: audioGlow 2s ease-in-out infinite;
        }

        @keyframes audioGlow {
            0%, 100% { box-shadow: 0 8px 25px rgba(0,0,0,0.3); }
            50% { box-shadow: 0 8px 35px rgba(165, 94, 234, 0.6); }
        }

        /* Impact Stats */
        .impact-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 10px 0;
        }
        
        .stat-box {
            background: rgba(255,255,255,0.1);
            padding: 8px;
            border-radius: 12px;
            text-align: center;
            font-weight: 700;
        }
        
        .stat-box div:first-child {
            font-size: 18px;
        }
        
        .stat-box div:last-child {
            font-size: 11px;
        }
    </style>
</head>
<body>
    <!-- Background Effects -->
    <div class="glow-background" id="glowBackground"></div>
    <div class="glitter-container" id="glitterContainer"></div>
    
    <!-- UI Overlays -->
    <div class="timer-display" id="timerDisplay">20:00</div>
    <div style="position: fixed; top: 10px; right: 120px; background: linear-gradient(145deg, #a55eea, #8854d0); color: white; padding: 8px 15px; border-radius: 10px; font-size: 14px; font-weight: 700; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 1000;" id="phaseTimer">00:00</div>
    <div class="phase-display" id="phaseDisplay">Select Grade Level</div>
    <div class="audio-indicator" id="audioIndicator">🎧</div>
    <div class="progress-container">
        <div class="progress-bar" id="progressBar"></div>
    </div>
    <div class="sound-effect" id="soundEffect">☀️</div>
    <div class="countdown-warning" id="countdownWarning">⚠️ 30 seconds remaining!</div>

    <div class="main-container">
        <!-- Grade Selection Screen -->
        <div id="gradeSelection" class="content-section active">
            <h1 class="main-title">⚡ Energy Equity & Global Development</h1>
            <h2 class="subtitle">Authentic Student Perspectives on Renewable Energy & Education Access</h2>
            
            <div style="text-align: center; margin: 20px 0;">
                <h3 style="font-size: 24px; color: #ffffff; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);">Select Your Grade Level</h3>
                
                <button class="btn-3d btn-grade10" onclick="selectGrade(10)">
                    Grade 10 Students
                </button>
                
                <button class="btn-3d btn-grade11" onclick="selectGrade(11)">
                    Grade 11 Students
                </button>
                
                <button class="btn-3d btn-grade12" onclick="selectGrade(12)">
                    Grade 12 Students
                </button>
            </div>
        </div>

        <!-- Team Assignment Screen -->
        <div id="teamAssignment" class="content-section">
            <h2>🎲 Debate Team Assignments</h2>
            <div id="teamsContainer" class="teams-container">
                <!-- Teams will be populated here -->
            </div>
            <div class="instruction-box">
                <strong>Listen carefully as your debate team assignments are announced!</strong><br>
                You'll be analyzing different ethical perspectives on two energy dilemmas.
            </div>
        </div>

        <!-- Group Formation Screen -->
        <div id="groupFormation" class="content-section">
            <h2>👥 Form Your Debate Team!</h2>
            <div class="instruction-box">
                <strong>You have 30 seconds to find your teammates and form your ethics debate team!</strong><br>
                Look for your assigned team members and gather together.
            </div>
            <div id="formationTeamsDisplay" class="teams-container">
                <!-- Teams for formation will be shown here -->
            </div>
        </div>

        <!-- Introduction Screen -->
        <div id="introduction" class="content-section">
            <h2>🌍 Welcome to the Energy Ethics Debate!</h2>
            <p><strong>You're about to hear a real student discussion about complex energy dilemmas!</strong></p>
            <p>Three students from different countries debate two scenarios: the best way to bring power to a remote community for education, and whether two towns should cooperate on a wind farm.</p>
            
            <div class="instruction-box">
                Listen carefully to Sarah from the US, Alex from the UK, and Chris from Australia. You'll then discuss their arguments with your team!
            </div>
        </div>

        <!-- Student Introductions -->
        <div id="studentIntros" class="content-section">
            <h2>👋 Meet the Student Debaters</h2>
            
            <div class="student-card sarah">
                <h4>🇺🇸 Sarah - United States</h4>
                <p><strong>Perspective:</strong> Passionate advocate for educational equity through technology</p>
                <p><strong>Focus:</strong> Believes renewable energy can bridge the digital divide in education</p>
            </div>

            <div class="student-card alex">
                <h4>🇬🇧 Alex - United Kingdom</h4>
                <p><strong>Perspective:</strong> Optimistic about decentralized renewable energy solutions</p>
                <p><strong>Focus:</strong> Sees renewable energy as fundamental to educational opportunity</p>
            </div>

            <div class="student-card chris">
                <h4>🇦🇺 Chris - Australia</h4>
                <p><strong>Perspective:</strong> Practical realist concerned about implementation challenges</p>
                <p><strong>Focus:</strong> Questions costs and technical feasibility of remote energy projects</p>
            </div>

            <div class="instruction-box">
                <strong>Listen as these students discuss renewable energy solutions for education!</strong>
            </div>
        </div>

        <!-- Dilemma 1 Explanation -->
        <div id="dilemmaExplanation" class="content-section">
            <h2>📚 The Educational Energy Challenge</h2>
            
            <div style="background: linear-gradient(145deg, #667eea, #764ba2); color: white; padding: 15px; border-radius: 20px; margin: 10px 0; box-shadow: 0 15px 35px rgba(0,0,0,0.3);">
                <h4 style="font-size: 20px; font-weight: 900; margin-bottom: 10px; text-align: center;">
                    <span class="animated-emoji">⚡</span> The Challenge
                </h4>
                <p style="margin: 0; font-size: 13px;"><strong>A remote community lacks reliable electricity, creating barriers to education. Students cannot study after sunset and have no access to digital learning tools.</strong></p>
            </div>

            <div class="decision-options">
                <div class="option-card option-a">
                    <h4>☀️ Solar Study Hub Solution</h4>
                    <div class="impact-stats">
                        <div class="stat-box">
                            <div>💡 LED Lighting</div>
                            <div>Evening study sessions</div>
                        </div>
                        <div class="stat-box">
                            <div>📱 Device Charging</div>
                            <div>Access to digital tools</div>
                        </div>
                        <div class="stat-box">
                            <div>🔋 Battery Storage</div>
                            <div>24/7 power availability</div>
                        </div>
                        <div class="stat-box">
                            <div>🌍 Community Impact</div>
                            <div>300+ students benefit</div>
                        </div>
                    </div>
                </div>
                
                <div class="option-card option-b">
                    <h4>⚡ Grid Extension Alternative</h4>
                    <div class="impact-stats">
                        <div class="stat-box">
                            <div>🏗️ Infrastructure</div>
                            <div>Power lines & poles</div>
                        </div>
                        <div class="stat-box">
                            <div>💰 High Cost</div>
                            <div>$500K+ investment</div>
                        </div>
                        <div class="stat-box">
                            <div>⏰ Long Timeline</div>
                            <div>2-3 years to complete</div>
                        </div>
                        <div class="stat-box">
                            <div>🌍 Wider Impact</div>
                            <div>Entire region benefits</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dilemma 1 Debate -->
        <div id="solarDebate" class="content-section">
            <h2>☀️ Solar Study Hub Discussion</h2>
            <div class="instruction-box">
                <strong>🎧 Listen to the student debate!</strong>
            </div>
            <div id="solarDebateContent">
                <!-- Dynamic debate content will be inserted here -->
            </div>
        </div>
        
        <!-- Q&A Session 1 -->
        <div id="qnaSession1" class="content-section">
            <h2>🙋 Q&A: Education Dilemma</h2>
            <div class="instruction-box">
                <strong>Listen for the question and the student called on to answer!</strong>
            </div>
            <div id="qnaContent1" style="text-align: center; font-size: 18px; padding: 20px;">
                <!-- Q&A content will be dynamically inserted here -->
            </div>
        </div>

        <!-- Dilemma 2 Explanation -->
        <div id="windDilemma" class="content-section">
            <h2>💨 The Wind Farm Cooperation Challenge</h2>
            
            <div style="background: linear-gradient(145deg, #667eea, #764ba2); color: white; padding: 15px; border-radius: 20px; margin: 10px 0; box-shadow: 0 15px 35px rgba(0,0,0,0.3);">
                <h4 style="font-size: 20px; font-weight: 900; margin-bottom: 10px; text-align: center;">
                    <span class="animated-emoji">💨</span> The Cooperation Challenge
                </h4>
                <p style="margin:0; font-size: 13px;"><strong>Two towns need clean energy and can co-invest in a wind farm. But trust is required...</strong></p>
            </div>

            <div class="decision-options">
                <div class="option-card" style="background: linear-gradient(145deg, #3742fa, #8854d0); color: white;">
                    <h4>💰 INVEST</h4>
                    <div class="impact-stats">
                        <div class="stat-box">
                            <div>🤝 Both Invest</div>
                            <div>Clean energy for all</div>
                        </div>
                        <div class="stat-box">
                            <div>😔 You Invest Alone</div>
                            <div>They benefit, you pay</div>
                        </div>
                        <div class="stat-box">
                            <div>💸 High Cost</div>
                            <div>Major financial risk</div>
                        </div>
                        <div class="stat-box">
                            <div>🌱 Clean Future</div>
                            <div>Zero emissions goal</div>
                        </div>
                    </div>
                </div>
                
                <div class="option-card" style="background: linear-gradient(145deg, #ffd700, #ffed4e); color: #2c3e50;">
                    <h4>⏳ DON'T INVEST</h4>
                    <div class="impact-stats">
                        <div class="stat-box">
                            <div>😊 They Invest Alone</div>
                            <div>Free clean energy!</div>
                        </div>
                        <div class="stat-box">
                            <div>😰 Both Don't Invest</div>
                            <div>Pollution continues</div>
                        </div>
                        <div class="stat-box">
                            <div>💰 No Cost</div>
                            <div>Protect town finances</div>
                        </div>
                        <div class="stat-box">
                            <div>⚡ Risk</div>
                            <div>Blackouts continue</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dilemma 2 Debate -->
        <div id="windDebate" class="content-section">
            <h2>🎙️ Wind Farm Cooperation Debate</h2>
            <div class="instruction-box">
                <strong>🎧 Listen to the student debate!</strong>
            </div>
            <div id="windDebateContent">
                <!-- Dynamic debate content will be inserted here -->
            </div>
        </div>
        
        <!-- Q&A Session 2 -->
        <div id="qnaSession2" class="content-section">
            <h2>🙋 Q&A: Wind Farm Dilemma</h2>
            <div class="instruction-box">
                <strong>Listen for the question and the student called on to answer!</strong>
            </div>
            <div id="qnaContent2" style="text-align: center; font-size: 18px; padding: 20px;">
                <!-- Q&A content will be dynamically inserted here -->
            </div>
        </div>

        <!-- Team Discussion -->
        <div id="teamDiscussion" class="content-section">
            <h2>💬 Your Team Discussion</h2>
            
            <div class="instruction-box">
                <strong>Now debate both scenarios with your team!</strong><br>
                Use the arguments you heard from Sarah, Alex, and Chris to guide your discussion.
            </div>

            <div style="background: linear-gradient(145deg, #ffd700, #ffed4e); color: #2c3e50; padding: 20px; border-radius: 15px; margin: 20px 0;">
                <h3 style="text-align: center; margin-bottom: 15px;">🤔 Discussion Questions</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px;">
                    <div>
                        <h4 style="color: #ff6347; margin-bottom: 10px;">📚 Educational Energy Scenario</h4>
                        <ul style="font-size: 16px; line-height: 1.5;">
                            <li><strong>Targeted vs. Broad:</strong> Is it better to help 300 students now or the whole region in 3 years?</li>
                            <li><strong>Feasibility:</strong> Which is more realistic: the Solar Hub or Grid Extension?</li>
                            <li><strong>Equity:</strong> What is the most equitable solution for the students?</li>
                            <li><strong>Sustainability:</strong> Which option is more sustainable in the long term?</li>
                        </ul>
                    </div>
                    
                    <div>
                        <h4 style="color: #3742fa; margin-bottom: 10px;">💨 Wind Farm Scenario</h4>
                        <ul style="font-size: 16px; line-height: 1.5;">
                            <li><strong>Trust vs. Risk:</strong> Should you invest despite the risk of being exploited?</li>
                            <li><strong>Collective Good:</strong> Is the environmental benefit worth the financial risk?</li>
                            <li><strong>Cooperation:</strong> How can you build trust between the towns?</li>
                            <li><strong>Creative Solutions:</strong> Are phased investments or mediators good ideas?</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="teams-container" id="discussionTeamsDisplay">
                <!-- Current teams will be shown here -->
            </div>
        </div>

        <!-- Debrief Discussion -->
        <div id="debriefDiscussion" class="content-section">
            <h2><span class="animated-emoji">🤔</span> Reflection & Analysis</h2>
            <div style="font-size: 18px; line-height: 1.5;">
                <h3>Analyze the Student Arguments Across Both Scenarios:</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                    <div style="padding: 15px; background: linear-gradient(145deg, #ff6b6b, #ee5a24); color: white; border-radius: 12px;">
                        <h4><span class="animated-emoji">🇺🇸</span> Sarah's Utilitarian Approach</h4>
                        <p><strong>Education:</strong> Favors the Grid Extension to benefit the entire region (greatest number).</p>
                        <p><strong>Wind:</strong> Accepts exploitation risk for the greater environmental good.</p>
                        <p><em>Focuses on the greatest good for the greatest number.</em></p>
                    </div>
                    
                    <div style="padding: 15px; background: linear-gradient(145deg, #3742fa, #8854d0); color: white; border-radius: 12px;">
                        <h4><span class="animated-emoji">🇬🇧</span> Alex's Analytical Thinking</h4>
                        <p><strong>Education:</strong> Supports the Solar Hub as an immediate, practical solution.</p>
                        <p><strong>Wind:</strong> Proposes creative solutions like phased investment and mediators.</p>
                        <p><em>Focuses on problem-solving and finding alternative solutions.</em></p>
                    </div>
                    
                    <div style="padding: 15px; background: linear-gradient(145deg, #26de81, #20bf6b); color: white; border-radius: 12px;">
                        <h4><span class="animated-emoji">🇦🇺</span> Chris's Practical Ethics</h4>
                        <p><strong>Education:</strong> Questions the long-term costs and maintenance of both options.</p>
                        <p><strong>Wind:</strong> Protects his town from financial risk and exploitation.</p>
                        <p><em>Focuses on feasibility, cost, and protecting his group.</em></p>
                    </div>
                    
                    <div style="padding: 15px; background: linear-gradient(145deg, #ffd700, #ffed4e); color: #2c3e50; border-radius: 12px;">
                        <h4><span class="animated-emoji">⚖️</span> The Real Challenge</h4>
                        <p><strong>Immediate Aid vs. Long-Term Infrastructure</strong></p>
                        <p><strong>Trust vs. Self-Protection</strong></p>
                        <p><strong>Costs vs. Benefits</strong></p>
                        <p><em>Ethical decisions require navigating complex trade-offs with no perfect answer.</em></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Activity Complete -->
        <div id="activityComplete" class="content-section">
            <h2><span class="animated-emoji">🎉</span> Energy Ethics Debate Complete!</h2>
            <div style="text-align: center; font-size: 20px; line-height: 1.6;">
                <p><strong>Congratulations on completing the Energy Ethics Debate!</strong></p>
                <p>You've experienced authentic student perspectives on complex energy dilemmas.</p>
                <p>Remember: Real-world ethical decisions involve competing values and imperfect solutions.</p>
                
                <div style="background: linear-gradient(145deg, #ff9a56, #ff7f50); color: white; padding: 25px; border-radius: 20px; margin: 20px 0;">
                    <h3 style="font-size: 28px; margin-bottom: 15px;"><span class="animated-emoji">💡</span> Key Takeaway</h3>
                    <p>Energy ethics involves balancing immediate needs vs. long-term goals, collective good vs. self-protection, and financial costs vs. environmental benefits. Each ethical framework—utilitarian, practical, and analytical—offers valuable insights for navigating these complex trade-offs.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Student data by grade
        const studentData = {
            10: ['Dino', 'Tracy', 'Billie', 'Jessie', 'VonTony', 'Tony', 'Jim', 'Andrew', 'Mark', 'Leo', 'Apollo', 'Lion', 'Alex', 'John', 'Jenny', 'Steven', 'Mike'],
            11: ['Schmidt', 'Harry', 'Zara', 'Jill', 'Helen', 'Roselia', 'Peter', 'Dio', 'Henry', 'Derek', 'Clara', 'Alexia', 'Olivia', 'Penny'],
            12: ['Anna', 'Mia', 'Kenn', 'Max', 'Sky', 'Sheng', 'Keying', 'Cen', 'Xifei', 'Jiaqi', 'Zack', 'Azure', 'Joe']
        };

        // TTS Voices
        let voiceAva, voiceBrian, voiceAndrew, voiceEmma;
        let initialWelcomeSpoken = false;

        // Game state
        let currentGrade = null;
        let teams = [];
        let currentPhase = 0;
        let totalTime = 20 * 60; // 20 minutes in seconds
        let remainingTime = totalTime;
        let phaseTimeRemaining = 0;
        let timerInterval = null;
        let phaseInterval = null;
        let isActivityRunning = false;
        
        const educationQnaQuestions = [
            "What is the most equitable solution for the students, and why?",
            "Which option is more sustainable in the long term, and what makes it so?",
            "Can you think of a creative, third solution that balances immediate and long-term needs?",
            "How do the concepts of 'equity' and 'equality' apply differently to the Solar Hub vs. Grid Extension options?"
        ];
        
        const windQnaQuestions = [
            "How could the two towns build trust to ensure a successful partnership?",
            "Is the environmental benefit of the wind farm worth the financial risk of being exploited?",
            "If you were Chris, what specific guarantees would you need before investing in the wind farm?",
            "What role should governments play in resolving disputes like this one?"
        ];
        
        let availableEducationQuestions = [...educationQnaQuestions];
        let availableWindQuestions = [...windQnaQuestions];

        // Phase configuration (20 minutes / 1200 seconds total)
        const phases = [
            { name: 'Team Assignment', duration: 90, tts: "Welcome to the Energy Ethics Debate! You will hear authentic student perspectives on two energy dilemmas. Let me announce your debate team assignments." },
            { name: 'Group Formation', duration: 30, tts: 'Now you have 30 seconds to find your teammates and form your ethics debate teams.' },
            { name: 'Introduction', duration: 60, tts: "You are about to hear real student discussions about complex energy dilemmas..." },
            { name: 'Student Introductions', duration: 30, tts: "Meet the student debaters: Sarah from the US, Alex from the UK, and Chris from Australia." },
            { name: 'Education Dilemma', duration: 60, tts: "First scenario: An educational energy challenge... Now, listen to their debate." },
            { 
                name: 'Education Debate', 
                duration: 120, 
                action: () => runDialogue('solarDebateContent', [
                    { speaker: 'alex', voice: 'Brian', text: "Alright team, the Solar Study Hub seems like a clear winner for immediate impact. We can get it running quickly and directly help the students who need it right now. It's a targeted, effective solution." },
                    { speaker: 'sarah', voice: 'Ava', text: "I agree, Alex. It's about equity. These students are falling behind because they lack this basic utility. The Hub is a direct intervention that addresses the immediate inequality they face." },
                    { speaker: 'chris', voice: 'Andrew', text: "Hang on, while a quick fix is nice, are we thinking long-term? The Grid Extension empowers the entire community, creating broader economic and social opportunities for everyone. A rising tide lifts all boats, doesn't it?" },
                    { speaker: 'sarah', voice: 'Ava', text: "But a rising tide is no good to someone who has already drowned. Their future is the immediate crisis. The targeted solution is the most ethical one for them right now." },
                    { speaker: 'alex', voice: 'Brian', text: "Chris has a point about long-term vision, though. Perhaps we can propose a hybrid model? Use the Solar Hub as an immediate solution, but build it as the first modular piece of a future, decentralized grid for the whole town." },
                    { speaker: 'chris', voice: 'Andrew', text: "That's a clever idea, Alex, but it sounds expensive. Who pays for that upgrade path? We need to be realistic about the budget. A project that starts small but has massive hidden costs later isn't practical." }
                ])
            },
            { name: 'Q&A: Education Dilemma', duration: 180, action: () => runQASession('education', 'qnaContent1') },
            { name: 'Wind Farm Dilemma', duration: 60, tts: "Second scenario: Two towns can co-invest in a wind farm... Let's hear the discussion." },
            { 
                name: 'Wind Farm Debate', 
                duration: 120,
                action: () => runDialogue('windDebateContent', [
                    { speaker: 'alex', voice: 'Brian', text: "This is a classic collective action problem. The logical outcome for everyone is to cooperate and invest. We should take the leap of faith for a cleaner future and set an example of collaboration." },
                    { speaker: 'chris', voice: 'Andrew', text: "A leap of faith with our town's money? No way. That's not responsible leadership. The risk of being taken for a ride is too high. My duty is to protect my community. We need a legally binding, phased agreement first." },
                    { speaker: 'sarah', voice: 'Ava', text: "But Chris, refusing to act also has a definite cost—the price of pollution and blackouts is real. Sometimes, a calculated risk is necessary to avoid a guaranteed negative outcome. The greater good requires us to find a way forward." },
                    { speaker: 'alex', voice: 'Brian', text: "Exactly, Sarah. Chris, your point on contracts is valid. What if we propose a smaller, joint pilot project to build trust? And bring in a neutral third-party mediator to oversee the funds and ensure fairness for both towns?" },
                    { speaker: 'chris', voice: 'Andrew', text: "A third-party mediator... that's interesting. That could work. It reduces the risk of one side backing out. It's still a risk, but it's a much more manageable and practical one. I could present that to my town." },
                     { speaker: 'sarah', voice: 'Ava', text: "See? By focusing on solutions instead of just the risks, we can find a path that serves the collective good while still protecting individual interests. It’s about finding that ethical balance." }
                ])
            },
            { name: 'Q&A: Wind Farm Dilemma', duration: 180, action: () => runQASession('wind', 'qnaContent2') },
            { name: 'Team Discussion', duration: 150, tts: "Now, debate both scenarios with your team! Discuss targeted aid versus broad infrastructure, and trust versus financial risks." },
            { name: 'Reflection', duration: 60, tts: "Time for reflection. These discussions show how energy ethics involves balancing competing values... Real-world decisions require navigating these complex trade-offs." }
        ];

        // TTS Functions
        function findVoice(name) {
            const voices = speechSynthesis.getVoices();
            return voices.find(v => v.name.includes(name) && v.name.includes('Microsoft') && v.name.includes('Online')) || voices.find(v => v.name.includes(name));
        }

        function initializeVoices() {
            voiceAva = findVoice('Ava');
            voiceBrian = findVoice('Brian');
            voiceAndrew = findVoice('Andrew');
            voiceEmma = findVoice('Emma');
            const allEnVoices = speechSynthesis.getVoices().filter(v => v.lang.startsWith('en'));
            if (!voiceAva) voiceAva = allEnVoices[0];
            if (!voiceBrian) voiceBrian = allEnVoices[1 % allEnVoices.length];
            if (!voiceAndrew) voiceAndrew = allEnVoices[2 % allEnVoices.length];
            if (!voiceEmma) voiceEmma = allEnVoices[3 % allEnVoices.length];
        }

        function speak(text, voice = voiceEmma, callback = null, onBoundary = null) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.voice = voice;
                utterance.rate = 0.85;
                utterance.pitch = 1.0;
                utterance.volume = 1.0;
                if (onBoundary) utterance.onboundary = onBoundary;
                utterance.onend = () => { if (callback) callback(); };
                utterance.onerror = (e) => {
                    console.error("Speech synthesis error:", e);
                    if (callback) callback();
                };
                speechSynthesis.speak(utterance);
            } else if (callback) {
                callback();
            }
        }

        // Visual Effects & Highlighting
        function highlightWords(quoteElement, fullText) {
            return (event) => {
                if (event.name === 'word') {
                    const charIndex = event.charIndex;
                    const highlightedText = `<span class="highlight">${fullText.substring(0, charIndex + event.charLength)}</span>`;
                    const remainingText = fullText.substring(charIndex + event.charLength);
                    quoteElement.innerHTML = highlightedText + remainingText;
                }
            };
        }

        function runDialogue(containerId, dialogue) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            let currentLine = 0;

            function nextLine() {
                if (currentLine >= dialogue.length) return;
                const part = dialogue[currentLine];
                
                const card = document.createElement('div');
                card.className = `student-card ${part.speaker}`;
                
                let flag = '';
                if (part.speaker.includes('sarah') || part.speaker.includes('ava')) flag = '🇺🇸';
                if (part.speaker.includes('alex') || part.speaker.includes('brian')) flag = '🇬🇧';
                if (part.speaker.includes('chris') || part.speaker.includes('andrew')) flag = '🇦🇺';
                
                card.innerHTML = `<h4>${flag} ${part.speaker.charAt(0).toUpperCase() + part.speaker.slice(1)}</h4><div class="quote">${part.text}</div>`;
                container.appendChild(card);
                card.scrollIntoView({ behavior: 'smooth', block: 'end' });
                setTimeout(() => card.classList.add('visible'), 50);

                const quoteEl = card.querySelector('.quote');
                const voiceMap = { 'Ava': voiceAva, 'Brian': voiceBrian, 'Andrew': voiceAndrew, 'Emma': voiceEmma };
                
                speak(part.text, voiceMap[part.voice], () => {
                    quoteEl.innerHTML = part.text;
                    currentLine++;
                    nextLine();
                }, highlightWords(quoteEl, part.text));
            }
            nextLine();
        }

        function createGlitter() {
            const container = document.getElementById('glitterContainer');
            if (!container) return;
            const glitter = document.createElement('div');
            glitter.className = 'glitter';
            glitter.style.left = Math.random() * 100 + '%';
            glitter.style.animationDelay = Math.random() * 1 + 's';
            glitter.style.animationDuration = (1.5 + Math.random() * 1) + 's';
            container.appendChild(glitter);
            setTimeout(() => {
                if (glitter.parentNode) glitter.parentNode.removeChild(glitter);
            }, 3000);
        }

        function activateGlowAndGlitter() {
            document.getElementById('glowBackground').classList.add('active');
            for (let i = 0; i < 15; i++) setTimeout(() => createGlitter(), i * 50);
            setTimeout(() => document.getElementById('glowBackground').classList.remove('active'), 2000);
        }

        function showSoundEffect(emoji) {
            const effect = document.getElementById('soundEffect');
            effect.textContent = emoji;
            effect.classList.add('show');
            setTimeout(() => effect.classList.remove('show'), 1000);
        }

        function showCountdownWarning() {
            const warning = document.getElementById('countdownWarning');
            warning.classList.add('show');
            showSoundEffect('⚠️');
            setTimeout(() => warning.classList.remove('show'), 2000);
        }

        function showAudioIndicator() { document.getElementById('audioIndicator').classList.add('show'); }
        function hideAudioIndicator() { document.getElementById('audioIndicator').classList.remove('show'); }

        // Team Management
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        function createTeams(grade) {
            const students = shuffleArray(studentData[grade]);
            const teamNames = ['☀️ Solar Innovators', '💡 Energy Equity Advocates', '🔋 Future Power Group', '🌍 Global Solutions', '📚 Education First', '⚡ Renewable Pioneers', '💨 Wind Warriors', '🌱 Sustainable Futures'];
            const numTeams = Math.floor(students.length / 3);
            teams = [];
            let studentIndex = 0;
            for (let i = 0; i < numTeams; i++) {
                teams.push({ name: teamNames[i % teamNames.length], members: students.slice(studentIndex, studentIndex + 3) });
                studentIndex += 3;
            }
            if (studentIndex < students.length) {
                students.slice(studentIndex).forEach((student, index) => {
                    if (teams[index % teams.length]) teams[index % teams.length].members.push(student);
                });
            }
        }

        function displayTeams(containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            teams.forEach(team => {
                const card = document.createElement('div');
                card.className = 'team-card';
                let content = `<h4>${team.name}</h4>`;
                if (containerId === 'formationTeamsDisplay') {
                    content += `<div style="font-size: 16px; margin: 10px 0;"><strong>Find these teammates:</strong><br>${team.members.join(', ')}</div>`;
                } else if (containerId === 'discussionTeamsDisplay') {
                    content += `<div style="font-size: 18px; margin: 15px 0;"><strong>Ethical Analysis...</strong></div><div style="font-size: 14px;">${team.members.join(', ')}</div>`;
                } else {
                    content += team.members.map(m => `<div class="team-member">${m}</div>`).join('');
                }
                card.innerHTML = content;
                container.appendChild(card);
            });
        }

        // Grade Selection
        function selectGrade(grade) {
            activateGlowAndGlitter();
            currentGrade = grade;
            createTeams(grade);
            setTimeout(() => startAutomatedActivity(), 1000);
        }

        // Timer Management
        function updateTimer() {
            const minutes = Math.floor(remainingTime / 60);
            const seconds = remainingTime % 60;
            document.getElementById('timerDisplay').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('progressBar').style.width = `${((totalTime - remainingTime) / totalTime) * 100}%`;
        }

        function updatePhaseTimer() {
            const minutes = Math.floor(phaseTimeRemaining / 60);
            const seconds = phaseTimeRemaining % 60;
            document.getElementById('phaseTimer').textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                if (isActivityRunning) {
                    remainingTime--;
                    phaseTimeRemaining--;
                    updateTimer();
                    updatePhaseTimer();
                    if (phaseTimeRemaining === 30) showCountdownWarning();
                    if (phaseTimeRemaining === 10) showSoundEffect('🚨');
                    if (remainingTime <= 0) {
                        clearInterval(timerInterval);
                        completeActivity();
                    }
                }
            }, 1000);
        }

        // Phase Management
        function showPhase(phaseIndex) {
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            const phase = phases[phaseIndex];
            document.getElementById('phaseDisplay').textContent = phase.name;
            phaseTimeRemaining = phase.duration;
            updatePhaseTimer();
            (phase.name.toLowerCase().includes('debate')) ? showAudioIndicator() : hideAudioIndicator();

            const phaseContentMap = { 0: 'teamAssignment', 1: 'groupFormation', 2: 'introduction', 3: 'studentIntros', 4: 'dilemmaExplanation', 5: 'solarDebate', 6: 'qnaSession1', 7: 'windDilemma', 8: 'windDebate', 9: 'qnaSession2', 10: 'teamDiscussion', 11: 'debriefDiscussion' };
            const elementId = phaseContentMap[phaseIndex];
            if (elementId) document.getElementById(elementId).classList.add('active');

            if (phaseIndex === 0) displayTeams('teamsContainer');
            if (phaseIndex === 1) displayTeams('formationTeamsDisplay');
            if (phaseIndex === 10) displayTeams('discussionTeamsDisplay');

            speechSynthesis.cancel();
            if (phase.action) {
                const narration = `Now starting the ${phase.name}.`;
                speak(narration, voiceEmma, () => phase.action());
            } else if (phase.tts) {
                const ttsText = phaseIndex === 0 ? `${phase.tts} ${getTeamAnnouncementText()}` : phase.tts;
                speak(ttsText, voiceEmma);
            }
            activateGlowAndGlitter();
        }
        
        function getTeamAnnouncementText() {
            return teams.map((team, i) => `Team ${i + 1}, the ${team.name}, has members: ${team.members.join(', ')}.`).join(' ');
        }

        function runQASession(topic, containerId) {
            const qnaContent = document.getElementById(containerId);
            let questionPool = topic === 'education' ? availableEducationQuestions : availableWindQuestions;
            let questionCount = 0;
            const maxQuestions = 2;

            function askNextQuestion() {
                if (questionCount >= maxQuestions || questionPool.length === 0) return;
                
                const qIndex = Math.floor(Math.random() * questionPool.length);
                const question = questionPool.splice(qIndex, 1)[0];
                const student = shuffleArray(studentData[currentGrade])[0];

                const qnaTimerDiv = document.createElement('div');
                qnaTimerDiv.style.fontSize = '24px';
                qnaTimerDiv.style.marginTop = '20px';
                qnaContent.innerHTML = `<h3>Question ${questionCount + 1}/${maxQuestions}</h3><p>"${question}"</p><h4>Responding: ${student}</h4>`;
                qnaContent.appendChild(qnaTimerDiv);

                const announcement = `Question ${questionCount + 1}. ${question}. ${student}, you will have one minute to respond. Your preparation time begins now.`;
                speak(announcement, voiceEmma);
                
                let prepTime = 15;
                const prepInterval = setInterval(() => {
                    qnaTimerDiv.innerHTML = `Time to prepare: ${prepTime}s`;
                    prepTime--;
                    if (prepTime < 0) {
                        clearInterval(prepInterval);
                        speak(`${student}, please begin your one-minute response.`, voiceEmma);
                        
                        let responseTime = 60;
                        const responseInterval = setInterval(() => {
                            qnaTimerDiv.innerHTML = `Response Time: ${responseTime}s`;
                            responseTime--;
                            if (responseTime < 0) {
                                clearInterval(responseInterval);
                                questionCount++;
                                askNextQuestion();
                            }
                        }, 1000);
                    }
                }, 1000);
            }
            askNextQuestion();
        }

        // Activity Flow
        function startAutomatedActivity() {
            document.getElementById('gradeSelection').classList.remove('active');
            isActivityRunning = true;
            if (!timerInterval) startTimer();
            showPhase(0);
            phaseInterval = setInterval(() => {
                if (isActivityRunning && phaseTimeRemaining <= 0) {
                    currentPhase++;
                    if (currentPhase >= phases.length) {
                        clearInterval(phaseInterval);
                        if (remainingTime > 0) completeActivity();
                        return;
                    }
                    showPhase(currentPhase);
                    showSoundEffect('✨');
                }
            }, 1000);
        }

        function playCompletionSound() {
            try {
                const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioCtx.createOscillator();
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(523.25, audioCtx.currentTime);
                oscillator.connect(audioCtx.destination);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            } catch (e) { console.error("Could not play sound:", e); }
        }

        function completeActivity() {
            isActivityRunning = false;
            remainingTime = 0;
            updateTimer();
            clearInterval(timerInterval);
            timerInterval = null;
            clearInterval(phaseInterval);
            phaseInterval = null;
            hideAudioIndicator();
            playCompletionSound();
            speechSynthesis.cancel();
            
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.getElementById('activityComplete').classList.add('active');
            
            document.getElementById('timerDisplay').textContent = '00:00';
            document.getElementById('phaseTimer').textContent = '00:00';
            document.getElementById('phaseDisplay').textContent = 'Complete';
            
            setTimeout(() => speak("Time's up! The Energy Ethics Debate is now complete. Thank you for participating!", voiceEmma), 500);
            activateGlowAndGlitter();
        }
        
        function startApp() {
            updateTimer();
            updatePhaseTimer();
            if (!initialWelcomeSpoken) {
                speak('Welcome to the Energy Ethics Debate! Please select your grade level to begin the automated 20-minute simulation.', voiceEmma);
                initialWelcomeSpoken = true;
            }
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            if ('speechSynthesis' in window && speechSynthesis.onvoiceschanged !== undefined) {
                speechSynthesis.onvoiceschanged = () => { initializeVoices(); startApp(); };
            } else {
                setTimeout(() => { initializeVoices(); startApp(); }, 500);
            }
        });
    </script>
</body>
</html>
