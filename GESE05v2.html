<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trinity GESE 5 Classroom (Version 2)</title>
    
    <!-- Tailwind CSS (Styling) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (Core Logic) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel (To understand JSX) -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom Animations */
        @keyframes floatUp {
            0% { transform: translateY(0px) scale(0.5); opacity: 0; }
            10% { opacity: 1; transform: translateY(-10px) scale(1.2); }
            100% { transform: translateY(-100px) scale(1); opacity: 0; }
        }
        .animate-float-up {
            animation: floatUp 2s ease-out forwards;
        }
        
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop {
            animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* Custom Scrollbar for cleaner look */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #93c5fd; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #60a5fa; 
        }
    </style>
</head>
<body class="bg-indigo-50 text-slate-900 overflow-hidden h-screen">
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // --- ICON COMPONENTS ---
        const Icon = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        
        const Play = ({ className }) => <Icon className={className}><polygon points="5 3 19 12 5 21 5 3"></polygon></Icon>;
        const RotateCcw = ({ className }) => <Icon className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"></path><path d="M3 3v9h9"></path></Icon>;
        const MessageSquare = ({ className }) => <Icon className={className}><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></Icon>;
        const BookOpen = ({ className }) => <Icon className={className}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></Icon>;
        const AlertCircle = ({ className }) => <Icon className={className}><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="12"></line><line x1="12" y1="16" x2="12.01" y2="16"></line></Icon>;
        const Star = ({ className }) => <Icon className={className}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></Icon>;
        const Trophy = ({ className }) => <Icon className={className}><path d="M8 21h8"></path><path d="M12 17v4"></path><path d="M7 4h10"></path><path d="M17 4v3a5 5 0 0 1-10 0V4"></path><path d="M7 4H5a2 2 0 0 0-2 2v2a3 3 0 0 0 3 3h1"></path><path d="M17 4h2a2 2 0 0 1 2 2v2a3 3 0 0 1-3 3h-1"></path></Icon>;
        const Clock = ({ className }) => <Icon className={className}><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></Icon>;
        const CheckSquare = ({ className }) => <Icon className={className}><polyline points="9 11 12 14 22 4"></polyline><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path></Icon>;
        const Lightbulb = ({ className }) => <Icon className={className}><path d="M9 18h6"></path><path d="M10 22h4"></path><path d="M15.09 14c.18-.9.27-1.48.27-2.06a5.5 5.5 0 0 0-9.68-2.67c-.6.94-1.2 2.67-1.2 4.73 0 1.25.4 2 1.25 2H15.09z"></path></Icon>;
        const Check = ({ className }) => <Icon className={className}><polyline points="20 6 9 17 4 12"></polyline></Icon>;

        // --- NEW DATA SET (VERSION 2 - UPDATED) ---

        const conversationData = {
            tv_cinema: {
                title: "TV & Cinema (ç”µè§†ç”µå½±)",
                icon: "ðŸŽ¬",
                color: "bg-purple-100 border-purple-300",
                vocab: [
                    "comedy (å–œå‰§)", "action movie (åŠ¨ä½œç‰‡)", "horror (ææ€–ç‰‡)", "cartoon (åŠ¨ç”»)", 
                    "screen (å±å¹•)", "actor (ç”·æ¼”å‘˜)", "actress (å¥³æ¼”å‘˜)", "popcorn (çˆ†ç±³èŠ±)", 
                    "ticket (ç¥¨)", "streaming (æµåª’ä½“)", "series (è¿žç»­å‰§)", "episode (ä¸€é›†)", 
                    "funny (å¥½ç¬‘)", "scary (å¯æ€•)", "boring (æ— èŠ)", "exciting (åˆºæ¿€)",
                    "character (è§’è‰²)", "story (æ•…äº‹)", "watch (è§‚çœ‹)", "recommend (æŽ¨è)",
                    "cinema (ç”µå½±é™¢)", "loud (å¤§å£°)", "special effects (ç‰¹æ•ˆ)", "channel (é¢‘é“)"
                ],
                grammar: ["Pref: I prefer comedies to horror", "Pres Perf: Have you seen...?", "Dur: for 2 hours", "Reason: because it's funny"],
                tips: [
                    "Use 'I prefer X to Y' (e.g., 'I prefer watching TV to going to the cinema').",
                    "Use 'Have you ever seen...?' to ask about movie experiences.",
                    "Explain why you like a character using 'because'."
                ],
                questions: [
                    "Do you prefer watching movies at home or in the cinema?",
                    "What is the best movie you have ever seen?",
                    "Have you seen any good TV series recently?",
                    "How many hours a week do you watch TV?",
                    "Who is your favourite actor or actress?",
                    "Do you like watching cartoons? Why or why not?",
                    "What are you going to watch tonight?",
                    "Have you ever cried while watching a movie?",
                    "Is watching TV good or bad for students?",
                    "Do you prefer comedy movies or scary movies?",
                    "Have you ever been to a 3D cinema?",
                    "Tell me about a movie you didn't like."
                ]
            },
            city_travel: {
                title: "City Travel (åŸŽå¸‚äº¤é€š)",
                icon: "ðŸšŒ",
                color: "bg-blue-100 border-blue-300",
                vocab: [
                    "bus stop (å…¬äº¤ç«™)", "subway station (åœ°é“ç«™)", "taxi (å‡ºç§Ÿè½¦)", "traffic jam (å µè½¦)", 
                    "crowded (æ‹¥æŒ¤)", "passenger (ä¹˜å®¢)", "driver (å¸æœº)", "ticket (è½¦ç¥¨)", 
                    "cheap (ä¾¿å®œ)", "expensive (è´µ)", "fast (å¿«)", "slow (æ…¢)", 
                    "convenient (æ–¹ä¾¿)", "pollution (æ±¡æŸ“)", "bicycle (è‡ªè¡Œè½¦)", "walk (èµ°è·¯)",
                    "route (è·¯çº¿)", "map (åœ°å›¾)", "seat (åº§ä½)", "wait (ç­‰å¾…)",
                    "rush hour (é«˜å³°æœŸ)", "late (æ™šç‚¹)", "arrive (åˆ°è¾¾)", "leave (ç¦»å¼€)"
                ],
                grammar: ["Comp: The subway is faster than...", "Dur: It takes 20 minutes", "Cond: If I miss the bus...", "Pres Perf: Have you taken...?"],
                tips: [
                    "Compare transport methods using comparatives (faster, cheaper, more convenient).",
                    "Use 'It takes [time]' to describe your journey to school.",
                    "Talk about a recent problem (e.g., 'I was late because of the traffic')."
                ],
                questions: [
                    "How do you usually get to school?",
                    "How long does it take you to get to the city center?",
                    "Do you prefer taking the bus or the subway?",
                    "Is the traffic bad in your city?",
                    "Have you ever taken a taxi alone?",
                    "Do you think riding a bike in the city is safe?",
                    "What is the cheapest way to travel in your city?",
                    "Have you ever been late because of traffic?",
                    "Do you prefer walking or taking the bus?",
                    "What are you going to do if it rains and you need to travel?",
                    "Have you ever lost your bus pass?",
                    "Why do so many people drive cars?"
                ]
            },
            family_party: {
                title: "Anniversary (å‘¨å¹´çºªå¿µ)",
                icon: "ðŸŽ‰",
                color: "bg-pink-100 border-pink-300",
                vocab: [
                    "anniversary (å‘¨å¹´çºªå¿µ)", "grandparents (ç¥–çˆ¶æ¯)", "married (ç»“å©š)", "celebrate (åº†ç¥)", 
                    "party (èšä¼š)", "family (å®¶åº­)", "restaurant (é¤åŽ…)", "meal (å¤§é¤)", 
                    "surprise (æƒŠå–œ)", "gift (ç¤¼ç‰©)", "speech (æ¼”è®²)", "happy (å¿«ä¹)", 
                    "together (ä¸€èµ·)", "love (çˆ±)", "years (å¹´)", "relative (äº²æˆš)",
                    "card (å¡ç‰‡)", "music (éŸ³ä¹)", "cake (è›‹ç³•)", "decorations (è£…é¥°)",
                    "proud (éª„å‚²)", "invite (é‚€è¯·)", "memory (å›žå¿†)", "fun (æœ‰è¶£)"
                ],
                grammar: ["Pres Perf: They have been married for...", "Past: We had a...", "Fut: We are going to...", "Comp: better than a birthday"],
                tips: [
                    "Use Present Perfect for marriage duration: 'They have been married for 50 years'.",
                    "Describe the party atmosphere: 'It was exciting and emotional'.",
                    "Compare anniversaries to other parties."
                ],
                questions: [
                    "Have you ever been to a wedding anniversary party?",
                    "How long have your grandparents been married?",
                    "What is the best gift for an anniversary?",
                    "Do you prefer family parties or parties with friends?",
                    "What food did you eat at the last family party?",
                    "Did you give a speech?",
                    "How do people celebrate anniversaries in your country?",
                    "Are you going to organize a party for your parents soon?",
                    "Who usually cooks for family parties?",
                    "Do you think it is important to celebrate anniversaries?",
                    "What did you wear to the party?",
                    "What is your favourite family memory?"
                ]
            },
            school_sports: {
                title: "School Sports (æ ¡è¿ä¼š)",
                icon: "ðŸ…",
                color: "bg-yellow-100 border-yellow-300",
                vocab: [
                    "sports day (è¿åŠ¨ä¼š)", "race (æ¯”èµ›)", "run (è·‘)", "win (èµ¢)", 
                    "medal (å¥–ç‰Œ)", "team (é˜Ÿä¼)", "cheer (æ¬¢å‘¼)", "stadium (ä½“è‚²åœº)", 
                    "PE class (ä½“è‚²è¯¾)", "subject (ç§‘ç›®)", "practice (ç»ƒä¹ )", "fast (å¿«)", 
                    "tired (ç´¯)", "competition (ç«žèµ›)", "join (å‚åŠ )", "score (å¾—åˆ†)",
                    "football (è¶³çƒ)", "basketball (ç¯®çƒ)", "exciting (åˆºæ¿€)", "proud (éª„å‚²)",
                    "training (è®­ç»ƒ)", "exercise (é”»ç‚¼)", "healthy (å¥åº·)", "coach (æ•™ç»ƒ)"
                ],
                grammar: ["Pref: I prefer running to swimming", "Dur: for 2 weeks", "Past: I won a medal", "Comp: harder than Math"],
                tips: [
                    "Compare sports to other school subjects (e.g., 'PE is more fun than Math').",
                    "Talk about a specific event (Sports Day) in the past.",
                    "Use 'prefer doing' for your favourite activities."
                ],
                questions: [
                    "Do you like your school sports day?",
                    "What is your favourite subject at school?",
                    "Have you ever won a medal or a trophy?",
                    "Do you prefer team sports or individual sports?",
                    "How often do you have PE classes?",
                    "Is playing sports better than playing computer games?",
                    "What sport are you going to play next term?",
                    "Have you ever been injured while playing sports?",
                    "Do you think sports are important for students?",
                    "Who is the best runner in your class?",
                    "Did you enjoy your last sports day?",
                    "What happens on sports day in your school?"
                ]
            },
            new_year: {
                title: "New Year (æ–°å¹´)",
                icon: "ðŸŽ†",
                color: "bg-red-100 border-red-300",
                vocab: [
                    "celebration (åº†å…¸)", "fireworks (çƒŸèŠ±)", "countdown (å€’æ•°)", "midnight (åˆå¤œ)", 
                    "resolution (å†³å¿ƒ)", "party (æ´¾å¯¹)", "family (å®¶åº­)", "dinner (æ™šé¤)", 
                    "tradition (ä¼ ç»Ÿ)", "lucky money (åŽ‹å²é’±)", "decorations (è£…é¥°)", "dumplings (é¥ºå­)", 
                    "visit (æ‹œè®¿)", "relatives (äº²æˆš)", "holiday (å‡æœŸ)", "special (ç‰¹åˆ«)",
                    "clean (æ‰“æ‰«)", "new clothes (æ–°è¡£)", "wish (æ„¿æœ›)", "happy (å¿«ä¹)",
                    "noisy (åµé—¹)", "lantern (ç¯ç¬¼)", "spring (æ˜¥å¤©)", "calendar (æ—¥åŽ†)"
                ],
                grammar: ["Fut: I'm going to...", "Pres Perf: Have you ever...", "Reason: so we were happy", "Comp: better than last year"],
                tips: [
                    "Compare this New Year to last New Year.",
                    "Use 'going to' for your resolutions/plans.",
                    "Describe family traditions using Present Simple (usually) and Present Perfect (have always)."
                ],
                questions: [
                    "How do you usually celebrate New Year?",
                    "What did you do last New Year's Eve?",
                    "Do you prefer New Year or your birthday?",
                    "What are you going to do for the next New Year?",
                    "Do you make New Year's resolutions?",
                    "What traditional food do you eat at New Year?",
                    "Have you ever spent New Year in another city?",
                    "Do you like fireworks? Why or why not?",
                    "Who do you usually spend New Year with?",
                    "Is New Year noisy in your city?",
                    "What is the most important part of New Year for you?",
                    "Have you ever stayed up until midnight?"
                ]
            },
            theme_parks: {
                title: "Theme Parks (æ¸¸ä¹å›­)",
                icon: "ðŸŽ¢",
                color: "bg-teal-100 border-teal-300",
                vocab: [
                    "rollercoaster (è¿‡å±±è½¦)", "ride (æ¸¸ä¹è®¾æ–½)", "queue (æŽ’é˜Ÿ)", "ticket (é—¨ç¥¨)", 
                    "expensive (è´µ)", "scary (å¯æ€•)", "fast (å¿«)", "scream (å°–å«)", 
                    "candy floss (æ£‰èŠ±ç³–)", "souvenir (çºªå¿µå“)", "carousel (æ—‹è½¬æœ¨é©¬)", "haunted house (é¬¼å±‹)", 
                    "water park (æ°´ä¸Šä¹å›­)", "slide (æ»‘æ¢¯)", "wet (æ¹¿)", "fun (æœ‰è¶£)",
                    "dizzy (å¤´æ™•)", "height (é«˜åº¦)", "view (æ™¯è‰²)", "photos (ç…§ç‰‡)",
                    "friends (æœ‹å‹)", "snack (é›¶é£Ÿ)", "busy (å¿™ç¢Œ)", "wait (ç­‰å¾…)"
                ],
                grammar: ["Pres Perf: Have you been to...?", "Superlative: The scariest ride...", "Past: I went to...", "Reason: because it was fast"],
                tips: [
                    "Use superlatives (e.g., 'It was the most exciting day ever').",
                    "Talk about recent experiences using Present Perfect.",
                    "Give reasons for liking/disliking rides (e.g., 'I hate rollercoasters because they make me dizzy')."
                ],
                questions: [
                    "Do you like theme parks?",
                    "What is the best theme park you have ever visited?",
                    "Have you ever been on a really big rollercoaster?",
                    "Do you prefer water parks or normal theme parks?",
                    "What is your favourite ride?",
                    "Do you like haunted houses?",
                    "Is the food at theme parks expensive?",
                    "Have you ever queued for a long time for a ride?",
                    "Who do you usually go to theme parks with?",
                    "Are you going to a theme park this year?",
                    "Do you prefer scary rides or slow rides?",
                    "Tell me about a fun day you had at a park."
                ]
            },
            recent_trip: {
                title: "Recent Trip (è¿‘æœŸæ—…è¡Œ)",
                icon: "ðŸ§³",
                color: "bg-green-100 border-green-300",
                vocab: [
                    "suitcase (æ‰‹æç®±)", "pack (æ‰“åŒ…)", "journey (æ—…ç¨‹)", "hotel (é…’åº—)", 
                    "sightseeing (è§‚å…‰)", "museum (åšç‰©é¦†)", "beach (æµ·æ»©)", "mountain (å±±)", 
                    "souvenir (çºªå¿µå“)", "restaurant (é¤åŽ…)", "local food (å½“åœ°ç¾Žé£Ÿ)", "map (åœ°å›¾)", 
                    "tired (ç´¯)", "relaxing (æ”¾æ¾)", "weather (å¤©æ°”)", "rainy (ä¸‹é›¨)",
                    "sunny (æ™´æœ—)", "photo (ç…§ç‰‡)", "guide (å¯¼æ¸¸)", "lost (è¿·è·¯)",
                    "visit (å‚è§‚)", "explore (æŽ¢ç´¢)", "return (è¿”å›ž)", "memory (è®°å¿†)"
                ],
                grammar: ["Pres Perf: I have just returned...", "Past: I went to...", "Conn: although", "Adj: It was wonderful"],
                tips: [
                    "Combine 'I have just been to...' (recent) with 'I went there last week' (past details).",
                    "Use 'although' to contrast (e.g., 'It was fun although it rained').",
                    "Describe the best thing you did."
                ],
                questions: [
                    "Have you been on a trip recently?",
                    "Where did you go?",
                    "Who did you go with?",
                    "How long did you stay there?",
                    "What was the best thing about the trip?",
                    "Did you buy any souvenirs?",
                    "Have you ever lost something on a trip?",
                    "Do you prefer city trips or countryside trips?",
                    "What food did you eat there?",
                    "Was the weather good?",
                    "Are you planning another trip soon?",
                    "Why do you think people like travelling?"
                ]
            },
            special_meal: {
                title: "Special Dinner (å¤§é¤)",
                icon: "ðŸ½ï¸",
                color: "bg-orange-100 border-orange-300",
                vocab: [
                    "restaurant (é¤åŽ…)", "menu (èœå•)", "order (ç‚¹é¤)", "waiter (æœåŠ¡å‘˜)", 
                    "chef (åŽ¨å¸ˆ)", "delicious (ç¾Žå‘³)", "spicy (è¾£)", "dessert (ç”œç‚¹)", 
                    "full (é¥±)", "expensive (è´µ)", "celebrate (åº†ç¥)", "atmosphere (æ°”æ°›)", 
                    "bill (è´¦å•)", "tip (å°è´¹)", "traditional (ä¼ ç»Ÿ)", "flavour (å‘³é“)",
                    "cook (åšé¥­)", "ingredients (é…æ–™)", "recommend (æŽ¨è)", "try (å°è¯•)",
                    "seafood (æµ·é²œ)", "drink (é¥®æ–™)", "meal (ä¸€é¤)", "tasty (å¥½åƒ)"
                ],
                grammar: ["Pres Perf: Have you eaten...?", "Past: I ordered...", "Pref: prefer sweet to salty", "Adj: It was tasty"],
                tips: [
                    "Describe a specific restaurant visit in the past.",
                    "Use 'Have you ever tried...?' to talk about exotic foods.",
                    "Explain preferences (e.g., 'I prefer Italian food to Chinese food because...')."
                ],
                questions: [
                    "What is your favourite restaurant?",
                    "Have you eaten a special meal recently?",
                    "Do you prefer eating out or eating at home?",
                    "What did you order last time you went to a restaurant?",
                    "Have you ever tried very spicy food?",
                    "Can you cook? What can you make?",
                    "What is the most expensive meal you have ever had?",
                    "Who do you usually go to restaurants with?",
                    "Do you like trying new food?",
                    "What are you going to eat for dinner tonight?",
                    "Is there any food you refuse to eat?",
                    "Why do people like going to restaurants?"
                ]
            }
        };

        const mockExams = [
            { 
                id: 1, 
                title: "Mock 1: Entertainment", 
                topic: "My Favourite TV Show", 
                areas: ["TV & Cinema", "School Sports"], 
                vocab: ["comedy (å–œå‰§)", "character (è§’è‰²)", "funny (å¥½ç¬‘)", "episode (ä¸€é›†)", "watch (çœ‹)", "relaxing (æ”¾æ¾)", "actor (æ¼”å‘˜)", "medal (å¥–ç‰Œ)", "race (æ¯”èµ›)", "win (èµ¢)"], 
                script: [ 
                    { role: "E", text: "Good morning. What is your topic?" }, 
                    { role: "C", text: "My topic is my favourite TV show, 'Friends'." }, 
                    { role: "E", text: "Why do you like it?" }, 
                    { role: "C", text: "I like it because it is very funny and the characters are great." },
                    { role: "E", text: "How long have you watched this show?" }, 
                    { role: "E", text: "Have you ever seen it in English?" }, 
                    { role: "E", text: "Do you prefer watching TV or going to the cinema?" }, 
                    { role: "Note", text: "WAIT: Student must ask: 'What TV shows do you like?'" }, 
                    { role: "E", text: "Let's talk about School. Do you like Sports Day?" }, 
                    { role: "E", text: "What is your favourite subject?" }, 
                    { role: "E", text: "Have you ever won a race?" } 
                ] 
            },
            { 
                id: 2, 
                title: "Mock 2: Transport", 
                topic: "Getting to School", 
                areas: ["City Travel", "New Year"], 
                vocab: ["bus (å…¬äº¤è½¦)", "traffic (äº¤é€š)", "late (è¿Ÿåˆ°)", "crowded (æ‹¥æŒ¤)", "ride (éª‘)", "bicycle (è‡ªè¡Œè½¦)", "fireworks (çƒŸèŠ±)", "celebrate (åº†ç¥)", "family (å®¶åº­)", "dinner (æ™šé¤)"], 
                script: [ 
                    { role: "E", text: "Hello. What are we going to talk about?" }, 
                    { role: "C", text: "I'm going to talk about how I get to school." }, 
                    { role: "E", text: "How do you usually travel to school?" }, 
                    { role: "E", text: "How long does it take?" }, 
                    { role: "E", text: "Have you ever been late because of the traffic?" }, 
                    { role: "E", text: "Do you prefer the bus or walking?" }, 
                    { role: "Note", text: "WAIT: Student must ask: 'Do you drive to work?'" }, 
                    { role: "E", text: "Let's move to Festivals. How do you usually celebrate New Year?" }, 
                    { role: "E", text: "Did you watch the fireworks last year?" }, 
                    { role: "E", text: "What are you going to do next New Year?" } 
                ] 
            },
            { 
                id: 3, 
                title: "Mock 3: Occasions", 
                topic: "Grandparents' Anniversary", 
                areas: ["Anniversary", "Theme Parks"], 
                vocab: ["anniversary (å‘¨å¹´)", "married (ç»“å©š)", "fifty (äº”å)", "party (æ´¾å¯¹)", "surprise (æƒŠå–œ)", "rollercoaster (è¿‡å±±è½¦)", "scary (å¯æ€•)", "fun (æœ‰è¶£)", "ticket (ç¥¨)", "fast (å¿«)"], 
                script: [ 
                    { role: "E", text: "What is your topic sheet about?" }, 
                    { role: "C", text: "It's about my grandparents' 50th wedding anniversary." }, 
                    { role: "E", text: "Wow, 50 years! How did you celebrate?" }, 
                    { role: "C", text: "We had a big surprise party at a hotel." },
                    { role: "E", text: "Have you ever been to a big family party before?" }, 
                    { role: "E", text: "What did you give them as a gift?" }, 
                    { role: "E", text: "Do you prefer parties or quiet dinners?" }, 
                    { role: "Note", text: "WAIT: Student must ask: 'Do you like family parties?'" }, 
                    { role: "E", text: "Theme Parks. Have you ever been to Disney Land?" }, 
                    { role: "E", text: "Do you like scary rides?" }, 
                    { role: "E", text: "What is the best ride you have ever been on?" } 
                ] 
            },
            { 
                id: 4, 
                title: "Mock 4: Recent Experience", 
                topic: "A Trip to the Museum", 
                areas: ["Recent Trip", "Special Dinner"], 
                vocab: ["museum (åšç‰©é¦†)", "history (åŽ†å²)", "boring (æ— èŠ)", "interesting (æœ‰è¶£)", "guide (å¯¼æ¸¸)", "restaurant (é¤åŽ…)", "delicious (ç¾Žå‘³)", "spicy (è¾£)", "menu (èœå•)", "happy (å¿«ä¹)"], 
                script: [ 
                    { role: "E", text: "Please tell me your topic." }, 
                    { role: "C", text: "My topic is my recent trip to the science museum." }, 
                    { role: "E", text: "When did you go?" }, 
                    { role: "E", text: "Who did you go with?" }, 
                    { role: "E", text: "Have you been there before?" }, 
                    { role: "E", text: "Did you enjoy it?" }, 
                    { role: "Note", text: "WAIT: Student must ask: 'Do you like museums?'" }, 
                    { role: "E", text: "Food. Have you eaten a special meal recently?" }, 
                    { role: "E", text: "What is your favourite restaurant?" }, 
                    { role: "E", text: "Do you prefer spicy food or sweet food?" } 
                ] 
            },
            { 
                id: 5, 
                title: "Mock 5: School & Sports", 
                topic: "School Sports Day", 
                areas: ["School Sports", "City Travel"], 
                vocab: ["race (æ¯”èµ›)", "run (è·‘)", "win (èµ¢)", "medal (å¥–ç‰Œ)", "cheer (æ¬¢å‘¼)", "bus (å…¬äº¤è½¦)", "subway (åœ°é“)", "ticket (ç¥¨)", "station (ç«™)", "wait (ç­‰)"], 
                script: [ 
                    { role: "E", text: "What topic have you prepared?" }, 
                    { role: "C", text: "I have prepared the topic: My School Sports Day." }, 
                    { role: "E", text: "Do you like sports day?" }, 
                    { role: "E", text: "What events did you do?" }, 
                    { role: "C", text: "I ran in the 100 meter race." },
                    { role: "E", text: "Did you win a medal?" }, 
                    { role: "E", text: "Do you prefer individual sports or team sports?" }, 
                    { role: "Note", text: "WAIT: Student must ask: 'Do you like running?'" }, 
                    { role: "E", text: "Transport. Do you take the bus to school?" }, 
                    { role: "E", text: "Is the subway convenient in your city?" }, 
                    { role: "E", text: "Have you ever lost your ticket?" } 
                ] 
            },
            { 
                id: 6, 
                title: "Mock 6: Festivals", 
                topic: "Chinese New Year", 
                areas: ["New Year", "TV & Cinema"], 
                vocab: ["red envelope (çº¢åŒ…)", "dumplings (é¥ºå­)", "fireworks (çƒŸèŠ±)", "family (å®¶äºº)", "lucky (å¹¸è¿)", "movie (ç”µå½±)", "cinema (å½±é™¢)", "popcorn (çˆ†ç±³èŠ±)", "watch (çœ‹)", "comedy (å–œå‰§)"], 
                script: [ 
                    { role: "E", text: "Hello. What is your topic?" }, 
                    { role: "C", text: "My topic is Chinese New Year." }, 
                    { role: "E", text: "How do you usually celebrate it?" }, 
                    { role: "E", text: "Have you ever spent New Year abroad?" }, 
                    { role: "E", text: "What is your favourite New Year food?" }, 
                    { role: "E", text: "What are you going to do next year?" }, 
                    { role: "Note", text: "WAIT: Student must ask: 'Have you seen the lion dance?'" }, 
                    { role: "E", text: "Entertainment. Do you watch TV during the holidays?" }, 
                    { role: "E", text: "What is the best movie you have seen recently?" }, 
                    { role: "E", text: "Do you prefer action movies or comedies?" } 
                ] 
            },
            { 
                id: 7, 
                title: "Mock 7: Entertainment", 
                topic: "Theme Parks", 
                areas: ["Theme Parks", "Anniversary"], 
                vocab: ["ride (è®¾æ–½)", "fast (å¿«)", "scream (å°–å«)", "fun (æœ‰è¶£)", "queue (æŽ’é˜Ÿ)", "anniversary (å‘¨å¹´)", "couple (å¤«å¦‡)", "gift (ç¤¼ç‰©)", "love (çˆ±)", "celebrate (åº†ç¥)"], 
                script: [ 
                    { role: "E", text: "Let's start. What is your topic?" }, 
                    { role: "C", text: "My topic is my visit to Universal Studios." }, 
                    { role: "E", text: "When did you go?" }, 
                    { role: "E", text: "Have you ever been on a really scary ride?" }, 
                    { role: "E", text: "Which ride do you prefer?" }, 
                    { role: "E", text: "Are you going to go again?" }, 
                    { role: "Note", text: "WAIT: Student must ask: 'Do you like rollercoasters?'" }, 
                    { role: "E", text: "Occasions. Tell me about a family party you have been to." }, 
                    { role: "E", text: "What did you celebrate?" }, 
                    { role: "E", text: "What was the best part?" } 
                ] 
            },
            { 
                id: 8, 
                title: "Mock 8: Food", 
                topic: "A Special Dinner", 
                areas: ["Special Dinner", "Recent Trip"], 
                vocab: ["restaurant (é¤åŽ…)", "menu (èœå•)", "pizza (æŠ«è¨)", "chef (åŽ¨å¸ˆ)", "delicious (ç¾Žå‘³)", "trip (æ—…è¡Œ)", "beach (æµ·æ»©)", "swim (æ¸¸æ³³)", "hotel (é…’åº—)", "sun (å¤ªé˜³)"], 
                script: [ 
                    { role: "E", text: "Good afternoon. What is your topic?" }, 
                    { role: "C", text: "My topic is a special dinner I had with my family." }, 
                    { role: "E", text: "Where did you go?" }, 
                    { role: "E", text: "What did you order?" }, 
                    { role: "E", text: "Have you ever eaten there before?" }, 
                    { role: "E", text: "Do you prefer eating out or cooking at home?" }, 
                    { role: "Note", text: "WAIT: Student must ask: 'What is your favourite food?'" }, 
                    { role: "E", text: "Recent Experiences. Have you been on a trip recently?" }, 
                    { role: "E", text: "Where did you go?" }, 
                    { role: "E", text: "Did you stay in a hotel?" } 
                ] 
            }
        ];

        const sampleTopics = {
            "tv_cinema": { 
                title: "My Favourite Movie", 
                point1: "NOW: I love watching movies. My favourite genre is science fiction because it is very exciting.", 
                point2: "PAST: Last week, I went to the cinema with my friends. We saw a new Marvel movie and ate popcorn.", 
                point3: "COMPARE: I think watching movies in the cinema is better than at home because the screen is bigger.", 
                point4: "FUTURE: I am going to watch the sequel next month. I have already bought the tickets.", 
                question: "Do you like science fiction movies?", 
                vocab: ["cinema (å½±é™¢)", "screen (å±å¹•)", "popcorn (çˆ†ç±³èŠ±)", "exciting (åˆºæ¿€)", "tickets (ç¥¨)", "watch (çœ‹)", "friends (æœ‹å‹)"] 
            },
            "city_travel": { 
                title: "Travelling in My City", 
                point1: "NOW: I usually go to school by bus. It is convenient but sometimes it is crowded.", 
                point2: "PAST: Yesterday, I was late for school because there was a huge traffic jam.", 
                point3: "COMPARE: The subway is faster than the bus, but it is more expensive.", 
                point4: "FUTURE: Tomorrow, I am going to ride my bike to the park. It is good exercise.", 
                question: "How do you get to work?", 
                vocab: ["bus (å…¬äº¤è½¦)", "subway (åœ°é“)", "traffic (äº¤é€š)", "late (è¿Ÿåˆ°)", "fast (å¿«)", "expensive (è´µ)", "bike (è‡ªè¡Œè½¦)"] 
            },
            "family_party": { 
                title: "Grandparents' Anniversary", 
                point1: "NOW: My grandparents have been married for 50 years. This is a very special occasion called a Golden Anniversary.", 
                point2: "PAST: Last weekend, we organized a surprise party for them. We decorated the room with gold balloons.", 
                point3: "COMPARE: It was better than a normal birthday party because all my relatives came from different cities.", 
                point4: "FUTURE: Next year, I am going to make a photo album for them. I want to save our happy memories.", 
                question: "Do you like family parties?", 
                vocab: ["anniversary (å‘¨å¹´)", "married (ç»“å©š)", "surprise (æƒŠå–œ)", "balloons (æ°”çƒ)", "relatives (äº²æˆš)", "album (ç›¸å†Œ)", "memories (å›žå¿†)"] 
            },
            "school_sports": { 
                title: "School Sports Day", 
                point1: "NOW: I love sports. PE is my favourite subject because I like running and being active.", 
                point2: "PAST: Last week, we had our school Sports Day. I ran in the 200m race and I won a silver medal.", 
                point3: "COMPARE: I think running is better than swimming because you don't get wet.", 
                point4: "FUTURE: Next term, I am going to join the school football team. I need to buy new boots.", 
                question: "Do you like sports?", 
                vocab: ["sports day (è¿åŠ¨ä¼š)", "PE (ä½“è‚²)", "subject (ç§‘ç›®)", "race (æ¯”èµ›)", "medal (å¥–ç‰Œ)", "wet (æ¹¿)", "team (é˜Ÿä¼)"] 
            },
            "new_year": { 
                title: "New Year Celebration", 
                point1: "NOW: New Year is my favourite festival. I love the fireworks and the family dinner.", 
                point2: "PAST: Last New Year, we visited my grandparents. We ate dumplings and got lucky money.", 
                point3: "COMPARE: I prefer New Year to Christmas because the holiday is longer.", 
                point4: "FUTURE: Next year, we are going to travel to the south for the holiday.", 
                question: "How do you celebrate New Year?", 
                vocab: ["fireworks (çƒŸèŠ±)", "dinner (æ™šé¤)", "grandparents (ç¥–çˆ¶æ¯)", "dumplings (é¥ºå­)", "lucky money (åŽ‹å²é’±)", "holiday (å‡æœŸ)"] 
            },
            "theme_parks": { 
                title: "Fun at the Park", 
                point1: "NOW: I enjoy going to theme parks. I like the exciting rides and the atmosphere.", 
                point2: "PAST: I went to Disney Land last summer. I queued for one hour for the roller coaster.", 
                point3: "COMPARE: The water park is more fun than the zoo because you can swim.", 
                point4: "FUTURE: I am going to go to Universal Studios next holiday. I want to see Harry Potter world.", 
                question: "Do you like roller coasters?", 
                vocab: ["theme park (æ¸¸ä¹å›­)", "rides (è®¾æ–½)", "queue (æŽ’é˜Ÿ)", "roller coaster (è¿‡å±±è½¦)", "swim (æ¸¸æ³³)", "fun (æœ‰è¶£)"] 
            },
            "recent_trip": { 
                title: "My Trip to the Beach", 
                point1: "NOW: I love the beach. I have just come back from a trip to the seaside.", 
                point2: "PAST: We stayed in a nice hotel. The weather was sunny and we swam in the sea.", 
                point3: "COMPARE: The beach is better than the mountains because I like swimming more than hiking.", 
                point4: "FUTURE: I am going to go back there next summer with my cousins.", 
                question: "Where was your last trip?", 
                vocab: ["beach (æµ·æ»©)", "seaside (æµ·è¾¹)", "hotel (é…’åº—)", "sunny (æ™´æœ—)", "swim (æ¸¸æ³³)", "mountains (å±±)", "hiking (å¾’æ­¥)"] 
            },
            "special_meal": { 
                title: "A Special Dinner", 
                point1: "NOW: I really enjoy eating out. My favourite food is Italian because I love pasta and pizza.", 
                point2: "PAST: Yesterday, my family went to a new restaurant. I ordered a spicy pizza and it was delicious.", 
                point3: "COMPARE: Eating in a restaurant is more expensive than cooking at home, but it tastes better.", 
                point4: "FUTURE: For my next birthday, I am going to choose a Japanese restaurant. I want to try sushi.", 
                question: "What is your favourite restaurant?", 
                vocab: ["restaurant (é¤åŽ…)", "Italian (æ„å¼)", "pasta (æ„é¢)", "pizza (æŠ«è¨)", "spicy (è¾£)", "expensive (è´µ)", "sushi (å¯¿å¸)"] 
            }
        };

        // --- COMPONENTS DEFINED OUTSIDE APP (To fix resetting issue) ---

        const PhaseTimer = ({ timeLeft, timerActive, toggleTimer, resetTimer, formatTime }) => (
            <div className={`flex items-center gap-2 px-3 py-1 rounded-lg border ${timeLeft < 30 ? 'bg-red-100 border-red-500 text-red-700 animate-pulse' : 'bg-white border-gray-200 text-gray-700'}`}>
                <Clock className="w-4 h-4" />
                <span className="font-mono font-bold text-lg w-12 text-center">{formatTime(timeLeft)}</span>
                <button onClick={toggleTimer} className="text-xs font-bold hover:text-blue-600">{timerActive ? 'PAUSE' : 'START'}</button>
                <button onClick={resetTimer} className="text-xs font-bold hover:text-red-600">RESET</button>
            </div>
        );

        const GrammarChecklist = ({ onReward }) => {
            const [checkedItems, setCheckedItems] = useState({
                future: false,
                but: false,
                compare: false,
                past: false,
                question: false,
                perfect: false,
                duration: false,
                prefer: false
            });

            const handleCheck = (key) => {
                if (!checkedItems[key]) {
                    onReward(5); 
                    setCheckedItems(prev => ({ ...prev, [key]: true }));
                } else {
                    setCheckedItems(prev => ({ ...prev, [key]: false }));
                }
            };

            return (
                <div className="bg-blue-50 p-2 rounded-lg border border-blue-100 flex-shrink-0 h-full overflow-y-auto">
                    <div className="text-xs font-bold text-blue-800 uppercase mb-2 flex items-center gap-1"><CheckSquare size={14}/> GESE 5 Check (+5)</div>
                    <div className="space-y-1">
                        {[
                            { k: 'past', label: 'Past Simple (did/went)' },
                            { k: 'future', label: 'Future (Going to/Will)' },
                            { k: 'perfect', label: 'Pres. Perfect (Have you...)' },
                            { k: 'duration', label: 'Duration (For/Since)' },
                            { k: 'prefer', label: 'Preference (Prefer X to Y)' },
                            { k: 'compare', label: 'Comparative (Better than)' },
                            { k: 'but', label: 'Connectives (Because/So)' },
                            { k: 'question', label: 'Ask Question?' }
                        ].map(item => (
                            <button 
                                key={item.k}
                                onClick={() => handleCheck(item.k)}
                                className={`w-full text-left text-xs px-2 py-2 rounded flex items-center justify-between gap-2 transition-all duration-200 border ${
                                    checkedItems[item.k] 
                                    ? 'bg-green-100 text-green-800 border-green-300 font-bold shadow-sm animate-pop' 
                                    : 'bg-white text-gray-700 border-transparent hover:bg-blue-100'
                                }`}
                            >
                                <span className="flex items-center gap-2">
                                    <div className={`w-3 h-3 rounded-full border flex items-center justify-center transition-colors ${
                                        checkedItems[item.k] ? 'bg-green-500 border-green-500' : 'border-gray-400'
                                    }`}>
                                        {checkedItems[item.k] && <Check className="w-2 h-2 text-white" />}
                                    </div>
                                    {item.label}
                                </span>
                                {checkedItems[item.k] && <span className="text-[10px] text-green-600 font-extrabold">+5</span>}
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        const ConversationTool = ({ timerProps }) => {
            const [selectedArea, setSelectedArea] = useState(null);
            const [currentQuestion, setCurrentQuestion] = useState(null);
            const [usedWords, setUsedWords] = useState({}); 

            const pickRandomQuestion = (areaKey) => {
                const qs = conversationData[areaKey].questions;
                const randomQ = qs[Math.floor(Math.random() * qs.length)];
                setCurrentQuestion(randomQ);
            };

            const toggleWord = (word) => {
                setUsedWords(prev => ({
                    ...prev,
                    [selectedArea]: {
                        ...prev[selectedArea],
                        [word]: !prev[selectedArea]?.[word]
                    }
                }));
            };

            return (
                <div className="flex flex-col h-full overflow-hidden">
                    <div className="flex justify-between items-center mb-2 flex-shrink-0">
                        <div className="flex items-center gap-4">
                            <h2 className="text-xl font-bold text-gray-800 flex items-center gap-2">
                                <MessageSquare className="w-6 h-6 text-blue-600" />
                                Conversation (5 mins)
                            </h2>
                            {selectedArea && (
                                <button 
                                    onClick={() => pickRandomQuestion(selectedArea)}
                                    className="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-lg font-bold shadow-sm active:transform active:scale-95 transition-all flex items-center gap-2 text-xs"
                                >
                                    <RotateCcw className="w-3 h-3" /> Next Question
                                </button>
                            )}
                        </div>
                        <PhaseTimer {...timerProps} />
                    </div>
                    
                    <div className="flex-shrink-0 grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-2 mb-3">
                        {Object.entries(conversationData).map(([key, data]) => (
                            <button
                            key={key}
                            onClick={() => { setSelectedArea(key); pickRandomQuestion(key); }}
                            className={`p-2 rounded-lg border-2 transition-all flex flex-col items-center text-center ${
                                selectedArea === key 
                                ? 'border-blue-600 shadow-md bg-white' 
                                : 'border-transparent opacity-80 hover:opacity-100 hover:bg-white/50'
                            } ${data.color}`}
                            >
                            <div className="text-xl">{data.icon}</div>
                            <div className="font-bold text-gray-800 text-[10px] leading-tight mt-1">{data.title}</div>
                            </button>
                        ))}
                    </div>

                    <div className="flex-grow flex gap-4 overflow-hidden">
                        {selectedArea && (
                            <div className="w-80 bg-blue-50 rounded-xl border border-blue-100 p-4 overflow-y-auto flex-shrink-0 animate-in fade-in slide-in-from-left-4 hidden md:flex flex-col">
                                <div className="flex items-center gap-2 mb-2 text-blue-800 font-bold border-b border-blue-200 pb-2">
                                    <CheckSquare size={16} /> Key Structures
                                </div>
                                <ul className="space-y-2 mb-4">
                                    {conversationData[selectedArea].grammar.map((rule, i) => (
                                        <li key={i} className="bg-white px-2 py-1 rounded text-sm text-blue-900 shadow-sm border border-blue-100">
                                            {rule}
                                        </li>
                                    ))}
                                </ul>
                                <div className="flex items-center gap-2 mb-2 mt-2 text-blue-800 font-bold border-b border-blue-200 pb-2">
                                    <Lightbulb size={16} /> Pro Tips
                                </div>
                                <ul className="space-y-2">
                                    {conversationData[selectedArea].tips.map((tip, i) => (
                                        <li key={i} className="bg-yellow-50 px-2 py-2 rounded text-xs text-blue-900 border border-yellow-200 flex gap-2">
                                            <span className="text-yellow-600 font-bold flex-shrink-0 mt-0.5">â˜…</span> 
                                            <span className="leading-tight">{tip}</span>
                                        </li>
                                    ))}
                                </ul>
                            </div>
                        )}

                        <div className="flex-1 bg-white rounded-xl shadow-inner border border-gray-200 p-6 flex flex-col items-start justify-center text-left relative transition-all">
                        {selectedArea ? (
                            <>
                            <span className="absolute top-4 left-4 text-xs font-bold uppercase text-gray-400 tracking-wider">
                                Current Subject: {conversationData[selectedArea].title}
                            </span>
                            <p className="text-2xl md:text-3xl font-medium text-gray-800 leading-relaxed animate-in fade-in slide-in-from-top-4 duration-500">
                                "{currentQuestion}"
                            </p>
                            </>
                        ) : (
                            <div className="w-full text-center text-gray-400 flex flex-col items-center">
                            <Star className="w-12 h-12 mb-2 opacity-20" />
                            <p>Select a topic above to start.</p>
                            </div>
                        )}
                        </div>

                        {selectedArea && (
                            <div className="w-80 bg-yellow-50 rounded-xl border border-yellow-100 p-4 overflow-y-auto flex-shrink-0 animate-in fade-in slide-in-from-right-4 hidden md:flex flex-col">
                                <div className="flex items-center gap-2 mb-3 text-yellow-800 font-bold border-b border-yellow-200 pb-2">
                                    <BookOpen size={16} /> Word Bank
                                </div>
                                <div className="text-xs text-yellow-600 mb-2 italic">Click words to mark as used!</div>
                                <ul className="space-y-2">
                                    {conversationData[selectedArea].vocab.map((word, i) => (
                                        <button 
                                            key={i} 
                                            onClick={() => toggleWord(word)}
                                            className={`w-full text-left px-2 py-1 rounded text-sm shadow-sm border transition-all duration-200 flex items-center justify-between ${
                                                usedWords[selectedArea]?.[word]
                                                ? 'bg-green-100 text-green-800 border-green-300 font-bold transform scale-[1.02]'
                                                : 'bg-white text-gray-700 border-yellow-100 hover:bg-yellow-100'
                                            }`}
                                        >
                                            {word}
                                            {usedWords[selectedArea]?.[word] && <Check className="w-3 h-3 text-green-600" />}
                                        </button>
                                    ))}
                                </ul>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const MockExamTool = ({ timerProps, onReward }) => {
            const [selectedMock, setSelectedMock] = useState(null);
            const [lineIndex, setLineIndex] = useState(0);
            const [usedWords, setUsedWords] = useState({}); 

            const handleNextLine = () => {
                if (selectedMock && lineIndex < selectedMock.script.length) {
                    setLineIndex(prev => prev + 1);
                }
            };

            const handlePrevLine = () => {
                if (selectedMock && lineIndex > 0) {
                    setLineIndex(prev => prev - 1);
                }
            };

            const toggleWord = (word) => {
                setUsedWords(prev => ({ ...prev, [word]: !prev[word] }));
            };

            return (
                <div className="h-full flex flex-col">
                        {!selectedMock ? (
                            <div className="h-full flex flex-col">
                            <div className="flex justify-between items-center mb-2 flex-shrink-0">
                                <h2 className="text-xl font-bold text-gray-800">Select Mock Exam</h2>
                            </div>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3 overflow-y-auto pr-2 pb-2">
                                {mockExams.map(mock => (
                                <button
                                    key={mock.id}
                                    onClick={() => { setSelectedMock(mock); setUsedWords({}); }}
                                    className="bg-white p-3 rounded-lg shadow-sm border border-gray-200 hover:border-blue-400 hover:shadow-md transition-all text-left group h-full"
                                >
                                    <div className="font-bold text-gray-800 group-hover:text-blue-600 text-sm">{mock.title}</div>
                                    <div className="text-xs text-gray-500 mt-1 line-clamp-1">{mock.topic}</div>
                                </button>
                                ))}
                            </div>
                        </div>
                    ) : (
                    <div className="flex flex-col h-full overflow-hidden">
                        <div className="flex items-center justify-between mb-2 border-b pb-2 flex-shrink-0">
                            <div className="flex items-center gap-4">
                                <h3 className="font-bold text-lg">{selectedMock.title}</h3>
                                <PhaseTimer {...timerProps} />
                            </div>
                            <button onClick={() => { setSelectedMock(null); setLineIndex(0); }} className="text-sm text-red-500 font-bold hover:bg-red-50 px-2 py-1 rounded">Exit</button>
                        </div>
                        
                        <div className="flex gap-4 h-full overflow-hidden">
                            <div className="flex-grow flex flex-col h-full overflow-hidden">
                                <div className="flex-grow overflow-y-auto bg-gray-50 rounded-xl p-4 mb-4 border border-gray-200 shadow-inner">
                                {selectedMock.script.slice(0, lineIndex + 1).map((line, idx) => (
                                    <div key={idx} className={`mb-3 flex ${line.role === 'E' ? 'justify-start' : (line.role === 'Note' ? 'justify-center' : 'justify-end')}`}>
                                        <div className={`max-w-[85%] rounded-2xl px-4 py-2 text-sm md:text-base shadow-sm
                                            ${line.role === 'E' ? 'bg-white text-gray-800 border-l-4 border-blue-500' : ''}
                                            ${line.role === 'C' ? 'bg-blue-100 text-blue-900 italic' : ''}
                                            ${line.role === 'Note' ? 'bg-yellow-100 text-yellow-800 font-bold border-2 border-yellow-300 animate-pulse text-center' : ''}
                                        `}>
                                            {line.text}
                                        </div>
                                    </div>
                                ))}
                                <div id="scroll-anchor"></div>
                                </div>
                                <div className="grid grid-cols-3 gap-3 flex-shrink-0">
                                    <button onClick={() => setLineIndex(0)} className="bg-gray-200 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-300">Restart</button>
                                    <button onClick={handlePrevLine} disabled={lineIndex === 0} className="bg-gray-300 text-gray-700 py-3 rounded-lg font-bold hover:bg-gray-400 disabled:opacity-50">Previous</button>
                                    <button onClick={handleNextLine} disabled={lineIndex >= selectedMock.script.length - 1} className="bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 shadow-lg disabled:opacity-50 flex items-center justify-center gap-2">
                                        Next Line <Play className="w-4 h-4 fill-current" />
                                    </button>
                                </div>
                            </div>
                            <div className="hidden lg:flex gap-2 flex-shrink-0 h-full">
                                {/* GRAMMAR CHECKLIST COLUMN */}
                                <div className="w-80 h-full overflow-y-auto">
                                     <GrammarChecklist onReward={onReward} />
                                </div>

                                {/* WORD BANK COLUMN - INTERACTIVE */}
                                <div className="w-80 bg-yellow-50 rounded-xl border border-yellow-100 p-4 overflow-y-auto h-full">
                                    <div className="flex items-center gap-2 mb-3 text-yellow-800 font-bold border-b border-yellow-200 pb-2"><BookOpen size={16} /> Word Bank</div>
                                    <div className="text-xs text-yellow-600 mb-2 italic">Click words to mark as used!</div>
                                    <ul className="space-y-2">
                                        {selectedMock.vocab.map((word, i) => (
                                            <button 
                                                key={i} 
                                                onClick={() => toggleWord(word)}
                                                className={`w-full text-left px-2 py-1 rounded text-base shadow-sm border transition-all duration-200 flex items-center justify-between ${
                                                    usedWords[word]
                                                    ? 'bg-green-100 text-green-800 border-green-300 font-bold transform scale-[1.02]'
                                                    : 'bg-white text-gray-700 border-yellow-100 hover:bg-yellow-100'
                                                }`}
                                            >
                                                {word}
                                                {usedWords[word] && <Check className="w-3 h-3 text-green-600" />}
                                            </button>
                                        ))}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    )}
                </div>
            );
        };

        const TopicBuilder = ({ timerProps, onReward }) => {
            const [topicData, setTopicData] = useState({ title: "", point1: "", point2: "", point3: "", point4: "", question: "", vocab: [] });
            
            const loadTopic = (key) => {
                if(key === "") return;
                const t = sampleTopics[key];
                setTopicData({ 
                    title: t.title, 
                    point1: t.point1, 
                    point2: t.point2, 
                    point3: t.point3, 
                    point4: t.point4, 
                    question: t.question,
                    vocab: t.vocab 
                });
            };

            const handleChange = (field, value) => {
                setTopicData(prev => ({ ...prev, [field]: value }));
            };

            return (
                <div className="h-full overflow-hidden flex flex-col">
                    <div className="flex justify-between items-center mb-1 flex-shrink-0">
                        <h2 className="text-lg font-bold text-gray-800 flex items-center gap-2"><BookOpen className="w-5 h-5 text-purple-600" /> Topic Planner</h2>
                        <div className="flex gap-2 items-center">
                            <PhaseTimer {...timerProps} />
                            <select onChange={(e) => loadTopic(e.target.value)} className="bg-purple-600 text-white text-xs font-bold py-1 px-2 rounded shadow-md border-none outline-none cursor-pointer max-w-[150px]">
                                <option value="">Load Sample...</option>
                                <option value="tv_cinema">TV & Cinema</option>
                                <option value="city_travel">City Travel</option>
                                <option value="family_party">Family Party</option>
                                <option value="school_sports">School Sports</option>
                                <option value="new_year">New Year</option>
                                <option value="theme_parks">Theme Parks</option>
                                <option value="recent_trip">Recent Trip</option>
                                <option value="special_meal">Special Meal</option>
                            </select>
                            <button onClick={() => setTopicData({ title: "", point1: "", point2: "", point3: "", point4: "", question: "", vocab: [] })} className="bg-gray-200 hover:bg-gray-300 text-gray-700 text-xs font-bold py-1 px-2 rounded">Clear</button>
                        </div>
                    </div>
                    
                    <div className="flex gap-2 h-full overflow-hidden">
                        {/* Main Form Area - EDITABLE */}
                        <div className="bg-white p-0 rounded-lg shadow-sm border border-gray-200 overflow-y-auto flex-grow flex flex-col gap-px">
                            <div className="space-y-0.5 flex-shrink-0 p-1">
                                <label className="text-xs font-bold uppercase text-gray-500">Topic Title</label>
                                <input 
                                    value={topicData.title} 
                                    onChange={(e) => handleChange('title', e.target.value)}
                                    placeholder="Enter your topic title..."
                                    type="text" 
                                    className="w-full p-0.5 border rounded font-bold text-base bg-white focus:ring-2 focus:ring-purple-200 outline-none" 
                                />
                            </div>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-px flex-grow">
                                <div className="p-0.5 border rounded bg-blue-50 flex flex-col h-full">
                                    <label className="text-xs font-bold text-blue-600 block px-1">1. Present (What do you do now?)</label>
                                    <textarea 
                                        value={topicData.point1} 
                                        onChange={(e) => handleChange('point1', e.target.value)}
                                        placeholder="I usually..."
                                        className="w-full bg-white p-1 rounded text-base resize-none flex-grow leading-tight border-0 focus:ring-2 focus:ring-blue-200 outline-none"
                                    ></textarea>
                                </div>
                                <div className="p-0.5 border rounded bg-green-50 flex flex-col h-full">
                                    <label className="text-xs font-bold text-green-600 block px-1">2. Past (What happened?)</label>
                                    <textarea 
                                        value={topicData.point2} 
                                        onChange={(e) => handleChange('point2', e.target.value)}
                                        placeholder="Last week/year, I..."
                                        className="w-full bg-white p-1 rounded text-base resize-none flex-grow leading-tight border-0 focus:ring-2 focus:ring-green-200 outline-none"
                                    ></textarea>
                                </div>
                                <div className="p-0.5 border rounded bg-yellow-50 flex flex-col h-full">
                                    <label className="text-xs font-bold text-yellow-600 block px-1">3. Compare (Which is better?)</label>
                                    <textarea 
                                        value={topicData.point3} 
                                        onChange={(e) => handleChange('point3', e.target.value)}
                                        placeholder="I prefer X to Y because..."
                                        className="w-full bg-white p-1 rounded text-base resize-none flex-grow leading-tight border-0 focus:ring-2 focus:ring-yellow-200 outline-none"
                                    ></textarea>
                                </div>
                                <div className="p-0.5 border rounded bg-pink-50 flex flex-col h-full">
                                    <label className="text-xs font-bold text-pink-600 block px-1">4. Future (What's next?)</label>
                                    <textarea 
                                        value={topicData.point4} 
                                        onChange={(e) => handleChange('point4', e.target.value)}
                                        placeholder="I am going to..."
                                        className="w-full bg-white p-1 rounded text-base resize-none flex-grow leading-tight border-0 focus:ring-2 focus:ring-pink-200 outline-none"
                                    ></textarea>
                                </div>
                            </div>

                            <div className="p-1 bg-red-50 border border-red-100 rounded flex items-center gap-2 flex-shrink-0">
                                <AlertCircle className="text-red-500 w-4 h-4" />
                                <div className="flex-grow">
                                    <label className="text-xs font-bold text-red-600 block">Question for Examiner:</label>
                                    <input 
                                        value={topicData.question} 
                                        onChange={(e) => handleChange('question', e.target.value)}
                                        placeholder="Do you like...?"
                                        type="text" 
                                        className="w-full p-0.5 border rounded text-base font-medium bg-white focus:ring-2 focus:ring-red-200 outline-none" 
                                    />
                                </div>
                            </div>
                        </div>

                        {/* Word Bank Sidebar + Grammar */}
                        <div className="hidden lg:flex gap-2 flex-shrink-0 h-full overflow-hidden">
                            {/* Grammar Check Column */}
                            <div className="w-80 h-full overflow-y-auto">
                                <GrammarChecklist onReward={onReward} />
                            </div>

                            {/* Word Bank Column */}
                            <div className="w-80 bg-purple-50 rounded-lg border border-purple-100 p-2 overflow-y-auto h-full">
                                <div className="flex items-center gap-1 mb-1 text-purple-800 font-bold border-b border-purple-200 pb-1 text-xs">
                                    <BookOpen size={12} /> Word Bank (Sample)
                                </div>
                                {topicData.vocab.length > 0 ? (
                                    <ul className="space-y-1">
                                        {topicData.vocab.map((word, i) => (
                                            <li key={i} className="bg-white px-1.5 py-0.5 rounded text-sm text-gray-700 shadow-sm border border-purple-100 leading-tight">
                                                {word}
                                            </li>
                                        ))}
                                    </ul>
                                ) : (
                                    <div className="text-sm text-gray-400 text-center mt-2">Load a sample to see words...</div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP COMPONENT ---

        const App = () => {
            const [activeTab, setActiveTab] = useState('conversation'); 
            const [score, setScore] = useState(0);
            const [rewards, setRewards] = useState([]);
            
            // Timer State
            const [timeLeft, setTimeLeft] = useState(300); // 5 minutes
            const [timerActive, setTimerActive] = useState(false);

            const playWinSound = useCallback(() => {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return;
                const ctx = new AudioContext();
                const t = ctx.currentTime;
                [440, 554, 659, 880].forEach((freq, i) => {
                    const osc = ctx.createOscillator();
                    const gain = ctx.createGain();
                    osc.type = 'sine';
                    osc.frequency.value = freq;
                    gain.gain.setValueAtTime(0.1, t + i * 0.05);
                    gain.gain.exponentialRampToValueAtTime(0.001, t + i * 0.05 + 0.5);
                    osc.connect(gain);
                    gain.connect(ctx.destination);
                    osc.start(t + i * 0.05);
                    osc.stop(t + i * 0.05 + 0.5);
                });
            }, []);

            const triggerReward = useCallback((amount = 10) => {
                setScore(s => s + amount);
                playWinSound();
                const newRewards = Array.from({ length: 8 }).map(() => ({
                    id: Math.random().toString(36).substr(2, 9),
                    x: 30 + Math.random() * 40,
                    y: 40 + Math.random() * 30,
                    emoji: ['ðŸª™', 'â­', 'âœ¨', 'ðŸ†', 'ðŸŽ‰'][Math.floor(Math.random() * 5)],
                    scale: 0.5 + Math.random()
                }));
                
                setRewards(prev => [...prev, ...newRewards]);
                
                setTimeout(() => {
                    const idsToRemove = newRewards.map(r => r.id);
                    setRewards(prev => prev.filter(r => !idsToRemove.includes(r.id)));
                }, 2000);
            }, [playWinSound]);

            useEffect(() => {
                let interval = null;
                if (timerActive && timeLeft > 0) {
                    interval = setInterval(() => {
                        setTimeLeft(t => t - 1);
                    }, 1000);
                } else if (timeLeft === 0) {
                    setTimerActive(false);
                }
                return () => clearInterval(interval);
            }, [timerActive, timeLeft]);

            const formatTime = (seconds) => {
                const m = Math.floor(seconds / 60);
                const s = seconds % 60;
                return `${m}:${s < 10 ? '0' : ''}${s}`;
            };

            const toggleTimer = () => setTimerActive(!timerActive);
            const resetTimer = () => { setTimerActive(false); setTimeLeft(300); };

            const timerProps = { timeLeft, timerActive, toggleTimer, resetTimer, formatTime };

            return (
                <div className="bg-gray-100 font-sans text-gray-900 h-screen flex flex-col overflow-hidden relative">
                    <div className="absolute inset-0 pointer-events-none z-50 overflow-hidden">
                        {rewards.map(r => (
                            <div 
                                key={r.id} 
                                className="animate-float-up absolute text-4xl" 
                                style={{ 
                                    left: `${r.x}%`, 
                                    top: `${r.y}%`,
                                    transform: `scale(${r.scale})` 
                                }}
                            >
                                {r.emoji}
                            </div>
                        ))}
                    </div>

                    <header className="bg-slate-800 text-white p-2 shadow-md flex items-center justify-between shrink-0 h-12 z-20">
                        <div className="flex gap-2">
                            <button onClick={() => setActiveTab('conversation')} className={`flex items-center gap-1 px-3 py-1 rounded text-xs font-bold transition-all ${activeTab === 'conversation' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-700 hover:text-white'}`}>
                                <MessageSquare size={14} /> Talk
                            </button>
                            <button onClick={() => setActiveTab('mock')} className={`flex items-center gap-1 px-3 py-1 rounded text-xs font-bold transition-all ${activeTab === 'mock' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-700 hover:text-white'}`}>
                                <Play size={14} /> Mock
                            </button>
                            <button onClick={() => setActiveTab('dashboard')} className={`flex items-center gap-1 px-3 py-1 rounded text-xs font-bold transition-all ${activeTab === 'dashboard' ? 'bg-blue-600 text-white shadow-lg' : 'text-slate-400 hover:bg-slate-700 hover:text-white'}`}>
                                <BookOpen size={14} /> Topic
                            </button>
                        </div>

                        <div className="flex items-center gap-3">
                            <div className="bg-slate-700 rounded px-2 py-1 flex items-center gap-2">
                                <span className="text-[10px] text-slate-400 font-bold uppercase">Score</span>
                                <span className="text-sm font-black text-yellow-400">{score}</span>
                            </div>
                            <button onClick={() => triggerReward(10)} className="bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-400 hover:to-orange-400 text-white font-bold py-1 px-3 rounded shadow-lg active:scale-95 flex items-center gap-1 text-xs">
                                <Trophy size={14} className="text-yellow-100" /> Award
                            </button>
                        </div>
                    </header>

                    <main className="flex-grow p-4 h-full overflow-hidden relative flex flex-col z-10">
                        <div className="bg-white rounded-xl shadow-lg h-full overflow-hidden border border-gray-200 flex-grow">
                            <div className="h-full p-4">
                                {activeTab === 'dashboard' && <TopicBuilder timerProps={timerProps} onReward={triggerReward} />}
                                {activeTab === 'conversation' && <ConversationTool timerProps={timerProps} />}
                                {activeTab === 'mock' && <MockExamTool timerProps={timerProps} onReward={triggerReward} />}
                            </div>
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
