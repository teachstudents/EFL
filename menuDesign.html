<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçΩÔ∏è Restaurant Dialogue Practice üó£Ô∏è</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');
        
        body, button, input, h1, h2, h3, h4, p, div {
            font-family: 'Fredoka', sans-serif;
            font-weight: 500;
        }
        
        .menu-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .dialogue-bubble {
            position: relative;
            border-radius: 20px;
            padding: 12px 18px;
            margin: 8px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            opacity: 0.6;
            transition: all 0.4s ease-in-out;
            transform: scale(0.98);
        }

        .dialogue-bubble.active {
            opacity: 1;
            transform: scale(1.02);
            box-shadow: 0 8px 20px rgba(79, 70, 229, 0.2);
        }
        
        .customer-bubble {
            background: linear-gradient(135deg, #e3f2fd, #bbdefb);
            margin-left: 20px;
        }
        
        .staff-bubble {
            background: linear-gradient(135deg, #f3e5f5, #e1bee7);
            margin-right: 20px;
        }
        
        mark {
            background-color: #fde047; /* yellow-300 */
            border-radius: 3px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-orange-400 via-red-500 to-pink-500 min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-5xl md:text-6xl font-bold text-white mb-3">üçΩÔ∏è Restaurant Dialogue Practice</h1>
            <p class="text-xl md:text-2xl text-white/95 font-semibold">Practice conversations between customers and restaurant staff</p>
        </div>

        <!-- Main Menu Selection -->
        <div id="menuSelection" class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-6 shadow-2xl mb-6">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">üè™ Welcome to Sunny Side Caf√©</h2>
            <p class="text-lg text-gray-600 text-center mb-6">Choose a meal time to start your dialogue practice</p>
            
            <div class="grid md:grid-cols-3 gap-6">
                <div class="menu-card bg-gradient-to-br from-yellow-100 to-orange-100 rounded-2xl p-6" onclick="generateScenario('breakfast')">
                    <div class="text-center">
                        <div class="text-7xl mb-3">üåÖ</div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">Breakfast</h3>
                        <p class="text-gray-600">Morning conversations</p>
                    </div>
                </div>
                
                <div class="menu-card bg-gradient-to-br from-green-100 to-teal-100 rounded-2xl p-6" onclick="generateScenario('lunch')">
                    <div class="text-center">
                        <div class="text-7xl mb-3">‚òÄÔ∏è</div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">Lunch</h3>
                        <p class="text-gray-600">Midday conversations</p>
                    </div>
                </div>
                
                <div class="menu-card bg-gradient-to-br from-purple-100 to-indigo-100 rounded-2xl p-6" onclick="generateScenario('dinner')">
                    <div class="text-center">
                        <div class="text-7xl mb-3">üåô</div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-2">Dinner</h3>
                        <p class="text-gray-600">Evening conversations</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Restaurant Details -->
        <div id="restaurantDetails" class="hidden">
            <!-- Restaurant Info Header -->
            <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-5 shadow-2xl mb-6">
                <div class="grid md:grid-cols-3 gap-4 items-center">
                    <div class="text-center">
                        <div class="text-3xl mb-1" id="mealIcon">üåÖ</div>
                        <h3 class="text-lg font-bold text-gray-800" id="mealType">Breakfast</h3>
                    </div>
                    
                    <div class="text-center cursor-pointer" id="staffContainer">
                        <div class="text-3xl mb-1">üë®‚Äçüç≥</div>
                        <h3 class="text-lg font-bold text-gray-800">Today's Staff</h3>
                        <p class="text-md text-gray-600" id="staffInfo">Sarah (Waitress)</p>
                    </div>
                    
                    <div class="text-center cursor-pointer" id="specialContainer">
                        <div class="text-3xl mb-1">‚≠ê</div>
                        <h3 class="text-lg font-bold text-gray-800">Special Today</h3>
                        <p class="text-sm text-gray-600" id="specialOffer">10% off pancakes!</p>
                    </div>
                </div>
                
                <div class="text-center mt-5">
                    <button onclick="generateScenario(currentMeal)" class="bg-blue-500 text-white px-5 py-2 rounded-xl font-bold hover:bg-blue-600 transition-colors mr-3">
                        üîÑ Shuffle Details
                    </button>
                    <button onclick="backToMenu()" class="bg-gray-500 text-white px-5 py-2 rounded-xl font-bold hover:bg-gray-600 transition-colors">
                        ‚Üê Back to Menu
                    </button>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="grid lg:grid-cols-2 gap-6">
                <!-- Menu & Info -->
                <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-6 shadow-2xl">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center" id="menuTitle">Today's Menu</h2>
                    <div class="grid md:grid-cols-2 gap-4" id="menuItems">
                        <!-- Menu items will be populated here -->
                    </div>
                </div>

                <!-- Dialogue Practice Section -->
                <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-6 shadow-2xl">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">üí¨ Interactive Dialogue</h2>
                    
                    <div id="dialogueBox" class="h-96 overflow-y-auto bg-gray-50 rounded-2xl p-3">
                        <!-- Dialogue will be generated here -->
                    </div>
                    
                    <div class="text-center mt-5">
                        <button id="startDialogueBtn" onclick="startDialogue()" class="bg-purple-500 text-white px-6 py-3 rounded-xl font-bold hover:bg-purple-600 transition-colors text-lg">
                            ‚ñ∂Ô∏è Start Conversation
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =================================================================================
        // --- 1. GLOBAL STATE & DATA ---
        // =================================================================================
        let currentMeal = '';
        let currentMenu = [];
        let currentStaff = {};
        let dialogueScript = [];
        let currentDialogueLine = 0;

        const restaurantData = {
            breakfast: {
                icon: 'üåÖ',
                items: [
                    { name: 'Classic Pancakes', emoji: 'ü•û', price: 8.99, description: 'Fluffy pancakes with maple syrup' },
                    { name: 'Eggs Benedict', emoji: 'üç≥', price: 12.50, description: 'Poached eggs on English muffin with hollandaise' },
                    { name: 'Avocado Toast', emoji: 'ü•ë', price: 9.75, description: 'Smashed avocado on sourdough with tomatoes' },
                    { name: 'French Toast', emoji: 'üçû', price: 10.25, description: 'Thick-cut brioche with cinnamon and berries' },
                    { name: 'Coffee', emoji: '‚òï', price: 3.50, description: 'Freshly brewed coffee' },
                    { name: 'Orange Juice', emoji: 'üßÉ', price: 4.00, description: 'Freshly squeezed orange juice' }
                ]
            },
            lunch: {
                icon: '‚òÄÔ∏è',
                items: [
                    { name: 'Caesar Salad', emoji: 'ü•ó', price: 11.99, description: 'Crisp romaine with parmesan and croutons' },
                    { name: 'Chicken Sandwich', emoji: 'ü•™', price: 13.50, description: 'Marinated chicken breast with avocado and bacon' },
                    { name: 'Fish Tacos', emoji: 'üåÆ', price: 14.75, description: 'Grilled fish with cabbage slaw and lime crema' },
                    { name: 'Margherita Pizza', emoji: 'üçï', price: 15.25, description: 'Fresh mozzarella, basil, and tomato sauce' },
                    { name: 'Iced Tea', emoji: 'üçπ', price: 3.75, description: 'Refreshing iced tea with lemon' },
                    { name: 'Soda', emoji: 'ü•§', price: 2.99, description: 'Choice of popular sodas' }
                ]
            },
            dinner: {
                icon: 'üåô',
                items: [
                    { name: 'Grilled Salmon', emoji: 'üêü', price: 22.99, description: 'Atlantic salmon with lemon herb butter' },
                    { name: 'Ribeye Steak', emoji: 'ü•©', price: 28.50, description: '12oz ribeye with garlic mashed potatoes' },
                    { name: 'Chicken Parmesan', emoji: 'üçó', price: 19.75, description: 'Breaded chicken with marinara and mozzarella' },
                    { name: 'Lobster Ravioli', emoji: 'ü¶û', price: 24.25, description: 'Homemade ravioli in creamy lobster sauce' },
                    { name: 'Red Wine', emoji: 'üç∑', price: 9.00, description: 'A glass of our house red' },
                    { name: 'Sparkling Water', emoji: 'üíß', price: 4.50, description: 'Imported sparkling mineral water' }
                ]
            }
        };

        const staffMembers = [
            { name: 'Ava', role: 'Waitress', lang: 'en-US', voiceName: 'Ava' },
            { name: 'Emma', role: 'Waitress', lang: 'en-US', voiceName: 'Emma' },
            { name: 'Brian', role: 'Waiter', lang: 'en-US', voiceName: 'Brian' },
            { name: 'Andrew', role: 'Waiter', lang: 'en-US', voiceName: 'Andrew' },
            { name: 'Jean-Pierre', role: 'Waiter', lang: 'fr-FR' },
            { name: 'Sofia', role: 'Waitress', lang: 'es-ES' },
            { name: 'Klaus', role: 'Waiter', lang: 'de-DE' },
            { name: 'Mei', role: 'Waitress', lang: 'zh-CN' }
        ];

        const specialOffers = [ '10% off all main courses!', 'Free dessert with any entree', 'Happy hour: 2-for-1 drinks', '15% student discount' ];

        // =================================================================================
        // --- 2. AUDIO & SPEECH SYNTHESIS (OPTIMIZED) ---
        // =================================================================================
        let allVoices = [];
        function loadVoices() {
            allVoices = speechSynthesis.getVoices();
            if (allVoices.length === 0) {
                speechSynthesis.onvoiceschanged = () => {
                    allVoices = speechSynthesis.getVoices();
                };
            }
        }
        document.addEventListener('DOMContentLoaded', loadVoices);

        function speakText(text, lang = 'en-US', voiceName = null, onEndCallback = null, highlightElementId = null) {
            if (!('speechSynthesis' in window)) return;
            if (allVoices.length === 0) {
                setTimeout(() => speakText(text, lang, voiceName, onEndCallback, highlightElementId), 100);
                return;
            }
            speechSynthesis.cancel();

            let voice;
            if (voiceName) {
                 voice = allVoices.find(v => v.lang.startsWith('en') && v.name.includes('Microsoft') && v.name.includes(voiceName) && (v.name.includes('Online') || v.name.includes('Multilingual')));
            }
            if (!voice) {
                voice = allVoices.find(v => v.lang === lang && v.name.includes('Microsoft') && (v.name.includes('Online') || v.name.includes('Natural')));
            }
            if (!voice) {
                voice = allVoices.find(v => v.lang === lang);
            }
            if (!voice) {
                voice = allVoices.find(v => v.lang === 'en-US');
            }
            if (!voice) {
                if (onEndCallback) onEndCallback();
                return;
            }

            const utterance = new SpeechSynthesisUtterance(text);
            utterance.voice = voice;
            utterance.lang = voice.lang;
            utterance.rate = 0.85;

            const highlightElement = document.getElementById(highlightElementId);
            if (highlightElement) {
                utterance.onboundary = (event) => {
                    if (event.name === 'word') {
                        const start = event.charIndex;
                        let end = text.indexOf(' ', start);
                        if (end === -1) end = text.length;
                        const highlightedText = 
                            text.substring(0, start) + 
                            '<mark>' + 
                            text.substring(start, end) + 
                            '</mark>' + 
                            text.substring(end);
                        highlightElement.innerHTML = `"${highlightedText}"`;
                    }
                };
                utterance.onend = () => {
                    highlightElement.innerHTML = `"${text}"`; // Reset on end
                    if (onEndCallback) onEndCallback();
                };
            } else {
                 if (onEndCallback) utterance.onend = onEndCallback;
            }
            
            speechSynthesis.speak(utterance);
        }
        
        // =================================================================================
        // --- 3. SCENARIO GENERATION & UI LOGIC ---
        // =================================================================================
        function getRandomItems(arr, count) {
            return [...arr].sort(() => 0.5 - Math.random()).slice(0, count);
        }

        function generateScenario(mealType) {
            currentMeal = mealType;
            const mealData = restaurantData[mealType];

            currentMenu = getRandomItems(mealData.items, Math.floor(Math.random() * 2) + 4);
            currentStaff = getRandomItems(staffMembers, 1)[0];
            const currentSpecial = getRandomItems(specialOffers, 1)[0];

            document.getElementById('mealIcon').textContent = mealData.icon;
            document.getElementById('mealType').textContent = mealType.charAt(0).toUpperCase() + mealType.slice(1);
            
            const staffInfoEl = document.getElementById('staffInfo');
            staffInfoEl.textContent = `${currentStaff.name} (${currentStaff.role})`;
            document.getElementById('staffContainer').onclick = () => speakText(staffInfoEl.textContent, currentStaff.lang, currentStaff.voiceName);

            const specialOfferEl = document.getElementById('specialOffer');
            specialOfferEl.textContent = currentSpecial;
            document.getElementById('specialContainer').onclick = () => speakText(specialOfferEl.textContent);

            document.getElementById('menuTitle').textContent = `Today's ${mealType.charAt(0).toUpperCase() + mealType.slice(1)} Menu`;

            const menuContainer = document.getElementById('menuItems');
            menuContainer.innerHTML = currentMenu.map(item => `
                <div class="bg-gradient-to-br from-gray-50 to-gray-100 rounded-xl p-3 border-2 border-gray-200 cursor-pointer" onclick="speakText('${item.name}. ${item.description.replace(/'/g, "\\'")}')">
                    <div class="flex items-start space-x-3">
                        <div class="text-3xl pt-1">${item.emoji}</div>
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-800">${item.name}</h4>
                            <p class="text-xl font-bold text-green-600">$${item.price.toFixed(2)}</p>
                            <p class="text-xs text-gray-600">${item.description}</p>
                        </div>
                    </div>
                </div>
            `).join('');

            prepareInteractiveDialogue();

            document.getElementById('menuSelection').classList.add('hidden');
            document.getElementById('restaurantDetails').classList.remove('hidden');
        }

        function backToMenu() {
            document.getElementById('restaurantDetails').classList.add('hidden');
            document.getElementById('menuSelection').classList.remove('hidden');
            speechSynthesis.cancel();
        }
        
        // =================================================================================
        // --- 4. DIALOGUE LOGIC ---
        // =================================================================================

        function prepareInteractiveDialogue() {
            const customerVoice = getRandomItems(['Ava', 'Andrew'], 1)[0];
            const randomFood = getRandomItems(currentMenu.filter(i => i.price > 5), 1)[0] || getRandomItems(currentMenu, 1)[0];
            const randomDrink = getRandomItems(currentMenu.filter(i => i.price <= 5), 1)[0] || getRandomItems(currentMenu, 1)[0];
            const totalPrice = randomFood.price + randomDrink.price;

            dialogueScript = [
                { speaker: currentStaff.role, name: currentStaff.name, text: `Hello! Welcome. My name is ${currentStaff.name}. Can I start you off with a drink?`, lang: currentStaff.lang, voice: currentStaff.voiceName },
                { speaker: 'Customer', name: 'You', text: `Yes, I'll have the ${randomDrink.name}, please.`, lang: 'en-US', voice: customerVoice },
                { speaker: currentStaff.role, name: currentStaff.name, text: `Excellent choice. Are you ready to order your meal, or would you like another moment?`, lang: currentStaff.lang, voice: currentStaff.voiceName },
                { speaker: 'Customer', name: 'You', text: `I think I'm ready. I would like the ${randomFood.name}. Can you tell me if it contains nuts?`, lang: 'en-US', voice: customerVoice },
                { speaker: currentStaff.role, name: currentStaff.name, text: `Let me check with the kitchen for you. One moment... Yes, our chef confirms the ${randomFood.name} is nut-free.`, lang: currentStaff.lang, voice: currentStaff.voiceName },
                { speaker: 'Customer', name: 'You', text: `Wonderful, I'll have that then.`, lang: 'en-US', voice: customerVoice },
                { speaker: currentStaff.role, name: currentStaff.name, text: `I'll be right back with your order.`, lang: currentStaff.lang, voice: currentStaff.voiceName },
                { speaker: 'Customer', name: 'You', text: `Excuse me, could I have the bill please?`, lang: 'en-US', voice: customerVoice },
                { speaker: currentStaff.role, name: currentStaff.name, text: `Of course. Here you are. Your total is $${totalPrice.toFixed(2)}.`, lang: currentStaff.lang, voice: currentStaff.voiceName },
                { speaker: 'Customer', name: 'You', text: `Thank you for the wonderful service! Have a great day.`, lang: 'en-US', voice: customerVoice }
            ];

            const dialogueBox = document.getElementById('dialogueBox');
            dialogueBox.innerHTML = dialogueScript.map((line, index) => `
                <div class="dialogue-bubble ${line.speaker.toLowerCase().includes('wait') ? 'staff-bubble' : 'customer-bubble'} cursor-pointer" id="line-${index}" onclick="speakTextWithHighlight(${index})">
                    <div class="flex items-start space-x-3">
                        <div class="text-2xl">${line.speaker.toLowerCase().includes('wait') ? 'üë®‚Äçüç≥' : 'üë§'}</div>
                        <div>
                            <p class="font-semibold text-gray-800 mb-1">${line.name}</p>
                            <p class="text-black" id="line-text-${index}">"${line.text}"</p>
                        </div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('startDialogueBtn').disabled = false;
        }

        function speakTextWithHighlight(index) {
            const line = dialogueScript[index];
            speakText(line.text, line.lang, line.voice, null, `line-text-${index}`);
        }

        function startDialogue() {
            currentDialogueLine = 0;
            document.getElementById('startDialogueBtn').disabled = true;
            playNextLine();
        }

        function playNextLine() {
            if (currentDialogueLine >= dialogueScript.length) {
                document.getElementById('startDialogueBtn').disabled = false;
                speakText("Practice complete! Feel free to shuffle the details or start a new scenario.", 'en-US');
                document.querySelectorAll('.dialogue-bubble').forEach(el => el.classList.remove('active'));
                return;
            }

            document.querySelectorAll('.dialogue-bubble').forEach(el => el.classList.remove('active'));
            const lineElement = document.getElementById(`line-${currentDialogueLine}`);
            lineElement.classList.add('active');
            lineElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            const line = dialogueScript[currentDialogueLine];
            const onEnd = () => {
                currentDialogueLine++;
                setTimeout(playNextLine, 800);
            };
            speakText(line.text, line.lang, line.voice, onEnd, `line-text-${currentDialogueLine}`);
        }
        
    </script>
</body>
</html>
