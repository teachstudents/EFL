<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>✍️ Writing Tutor Pro - Master 6 Strategies</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Fredoka', cursive;
            font-weight: 500;
        }
        
        /* --- Readability & Contrast Enhancements --- */
        .instruction-text, .modal-instruction {
            font-weight: 600;
            font-size: 1.25rem; /* Increased font size for readability */
            line-height: 1.6;
        }

        .strategy-card h3, .strategy-card p, .strategy-card div {
             text-shadow: 0 1px 4px rgba(0, 0, 0, 0.3); /* Improved text contrast on gradients */
        }

        .modal-step-title {
            font-size: 1.75rem;
            font-weight: 700;
        }

        .modal-body-text {
            font-size: 1.1rem;
            line-height: 1.6;
        }

        /* --- Larger Touch Targets for Checkboxes --- */
        .review-checkbox-label {
            display: flex;
            align-items: center;
            padding: 0.75rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .review-checkbox-label:hover {
            background-color: #f0f9ff;
        }
        .review-checkbox-label input[type="checkbox"] {
            width: 1.5rem;
            height: 1.5rem;
            margin-right: 1rem;
        }
        
        .tts-button {
            background: linear-gradient(135deg, #10b981, #059669);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .tts-button:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        
        .content-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
        }
        
        .strategy-card {
            transition: all 0.3s ease;
        }
        
        .strategy-card:hover {
            transform: translateY(-8px) scale(1.02);
        }
        
        .completed {
            background: linear-gradient(135deg, #10b981, #059669) !important;
        }
        
        .bounce {
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .fade-in {
            animation: fadeIn 0.8s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .progress-bar {
            transition: width 0.5s ease;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-600 via-blue-600 to-teal-500 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-6xl font-bold text-white mb-4 bounce instruction-text">✍️ Writing Tutor Pro 📚</h1>
            <p class="text-2xl text-white/95 instruction-text">Master each writing strategy from start to finish!</p>
        </div>

        <!-- Student Info -->
        <div class="content-container rounded-3xl p-8 mb-8 shadow-2xl">
            <div class="grid md:grid-cols-2 gap-6">
                <div>
                    <label class="block text-xl font-bold text-gray-800 mb-3">✏️ Your Name:</label>
                    <input type="text" id="studentName" class="w-full p-4 text-xl border-4 border-teal-400 rounded-2xl focus:border-yellow-400 focus:outline-none" placeholder="Enter your name..." onchange="updateStudentInfo()">
                </div>
                <div>
                    <label class="block text-xl font-bold text-gray-800 mb-3">📚 Writing Focus:</label>
                    <select id="writingFocus" class="w-full p-4 text-xl border-4 border-teal-400 rounded-2xl focus:border-yellow-400 focus:outline-none" onchange="updateStudentInfo()">
                        <option value="">Choose your focus...</option>
                        <option value="persuasive">🗣️ Persuasive Writing</option>
                        <option value="narrative">📖 Narrative Writing</option>
                        <option value="informational">📊 Informational Writing</option>
                    </select>
                </div>
            </div>
            
            <!-- Overall Progress -->
            <div class="mt-6">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-xl font-bold text-gray-800">🎯 <span id="studentDisplay">Your</span> Overall Progress</span>
                    <span class="text-lg font-bold text-teal-600" id="overallPercent">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-6">
                    <div class="progress-bar bg-gradient-to-r from-green-400 to-blue-500 h-6 rounded-full" id="overallProgress" style="width: 0%"></div>
                </div>
                <p class="text-center mt-2 text-gray-600" id="progressMessage">Ready to start your writing journey!</p>
            </div>
        </div>

        <!-- Strategy Cards Grid -->
        <div class="grid lg:grid-cols-3 md:grid-cols-2 grid-cols-1 gap-8 mb-8">
            <!-- STOP Strategy -->
            <div class="strategy-card bg-gradient-to-br from-red-500 to-pink-600 rounded-3xl p-8 text-white shadow-2xl cursor-pointer" onclick="openStrategy('stop')">
                <div class="text-center">
                    <div class="text-6xl mb-4 bounce">🛑</div>
                    <h3 class="text-2xl font-bold mb-3">STOP Strategy</h3>
                    <p class="text-lg mb-4 opacity-90">Complete Persuasive Writing Process</p>
                    
                    <div class="space-y-2 mb-6">
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">📝 Suspend judgment</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">🎯 Take a side</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">⭐ Organize ideas</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">📈 Plan more</div>
                    </div>
                    
                    <div class="bg-white/30 rounded-2xl p-3">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold">Progress</span>
                            <span id="stopPercent">0%</span>
                        </div>
                        <div class="w-full bg-white/30 rounded-full h-3">
                            <div class="progress-bar bg-yellow-400 h-3 rounded-full" id="stopProgress" style="width: 0%"></div>
                        </div>
                        <div class="mt-2 font-bold" id="stopStatus">Ready to start!</div>
                    </div>
                </div>
            </div>

            <!-- AIM Strategy -->
            <div class="strategy-card bg-gradient-to-br from-blue-500 to-indigo-600 rounded-3xl p-8 text-white shadow-2xl cursor-pointer" onclick="openStrategy('aim')">
                <div class="text-center">
                    <div class="text-6xl mb-4 bounce">🎯</div>
                    <h3 class="text-2xl font-bold mb-3">AIM Strategy</h3>
                    <p class="text-lg mb-4 opacity-90">Complete Introduction Writing Process</p>
                    
                    <div class="space-y-2 mb-6">
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">🎪 Attract attention</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">🔍 Identify main idea</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">🗺️ Map background</div>
                    </div>
                    
                    <div class="bg-white/30 rounded-2xl p-3">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold">Progress</span>
                            <span id="aimPercent">0%</span>
                        </div>
                        <div class="w-full bg-white/30 rounded-full h-3">
                            <div class="progress-bar bg-yellow-400 h-3 rounded-full" id="aimProgress" style="width: 0%"></div>
                        </div>
                        <div class="mt-2 font-bold" id="aimStatus">Ready to start!</div>
                    </div>
                </div>
            </div>

            <!-- PLAN Strategy -->
            <div class="strategy-card bg-gradient-to-br from-green-500 to-emerald-600 rounded-3xl p-8 text-white shadow-2xl cursor-pointer" onclick="openStrategy('plan')">
                <div class="text-center">
                    <div class="text-6xl mb-4 bounce">📋</div>
                    <h3 class="text-2xl font-bold mb-3">PLAN Strategy</h3>
                    <p class="text-lg mb-4 opacity-90">Complete Organization Process</p>
                    
                    <div class="space-y-2 mb-6">
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">📖 Pay attention</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">📝 List ideas</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">➕ Add details</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">🔢 Number order</div>
                    </div>
                    
                    <div class="bg-white/30 rounded-2xl p-3">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold">Progress</span>
                            <span id="planPercent">0%</span>
                        </div>
                        <div class="w-full bg-white/30 rounded-full h-3">
                            <div class="progress-bar bg-yellow-400 h-3 rounded-full" id="planProgress" style="width: 0%"></div>
                        </div>
                        <div class="mt-2 font-bold" id="planStatus">Ready to start!</div>
                    </div>
                </div>
            </div>

            <!-- DARE Strategy -->
            <div class="strategy-card bg-gradient-to-br from-yellow-500 to-orange-600 rounded-3xl p-8 text-white shadow-2xl cursor-pointer" onclick="openStrategy('dare')">
                <div class="text-center">
                    <div class="text-6xl mb-4 bounce">⚡</div>
                    <h3 class="text-2xl font-bold mb-3">DARE Strategy</h3>
                    <p class="text-lg mb-4 opacity-90">Complete Argumentative Process</p>
                    
                    <div class="space-y-2 mb-6">
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">📝 Develop thesis</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">➕ Add support</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">❌ Reject counter-args</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">🏁 End strong</div>
                    </div>
                    
                    <div class="bg-white/30 rounded-2xl p-3">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold">Progress</span>
                            <span id="darePercent">0%</span>
                        </div>
                        <div class="w-full bg-white/30 rounded-full h-3">
                            <div class="progress-bar bg-yellow-400 h-3 rounded-full" id="dareProgress" style="width: 0%"></div>
                        </div>
                        <div class="mt-2 font-bold" id="dareStatus">Ready to start!</div>
                    </div>
                </div>
            </div>

            <!-- STAR Strategy -->
            <div class="strategy-card bg-gradient-to-br from-purple-500 to-pink-600 rounded-3xl p-8 text-white shadow-2xl cursor-pointer" onclick="openStrategy('star')">
                <div class="text-center">
                    <div class="text-6xl mb-4 bounce">⭐</div>
                    <h3 class="text-2xl font-bold mb-3">STAR Strategy</h3>
                    <p class="text-lg mb-4 opacity-90">Complete Revision Process</p>
                    
                    <div class="space-y-2 mb-6">
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">🔄 Substitute words</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">✂️ Take out extra</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">➕ Add details</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">🔀 Rearrange flow</div>
                    </div>
                    
                    <div class="bg-white/30 rounded-2xl p-3">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold">Progress</span>
                            <span id="starPercent">0%</span>
                        </div>
                        <div class="w-full bg-white/30 rounded-full h-3">
                            <div class="progress-bar bg-yellow-400 h-3 rounded-full" id="starProgress" style="width: 0%"></div>
                        </div>
                        <div class="mt-2 font-bold" id="starStatus">Ready to start!</div>
                    </div>
                </div>
            </div>

            <!-- KWL Strategy -->
            <div class="strategy-card bg-gradient-to-br from-teal-500 to-cyan-600 rounded-3xl p-8 text-white shadow-2xl cursor-pointer" onclick="openStrategy('kwl')">
                <div class="text-center">
                    <div class="text-6xl mb-4 bounce">🧠</div>
                    <h3 class="text-2xl font-bold mb-3">KWL Strategy</h3>
                    <p class="text-lg mb-4 opacity-90">Complete Research Process</p>
                    
                    <div class="space-y-2 mb-6">
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">📚 Know current info</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">❓ Want to learn</div>
                        <div class="bg-white/20 rounded-full px-4 py-2 text-sm">💡 Learned new facts</div>
                    </div>
                    
                    <div class="bg-white/30 rounded-2xl p-3">
                        <div class="flex justify-between items-center mb-2">
                            <span class="font-bold">Progress</span>
                            <span id="kwlPercent">0%</span>
                        </div>
                        <div class="w-full bg-white/30 rounded-full h-3">
                            <div class="progress-bar bg-yellow-400 h-3 rounded-full" id="kwlProgress" style="width: 0%"></div>
                        </div>
                        <div class="mt-2 font-bold" id="kwlStatus">Ready to start!</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Export Portfolio Button -->
        <div class="text-center">
            <button onclick="exportPortfolio()" class="bg-gradient-to-r from-green-500 to-blue-600 text-white text-xl font-bold px-8 py-4 rounded-2xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300">
                📤 Export Your Writing Portfolio
            </button>
        </div>
    </div>

    <!-- Strategy Modal -->
    <div id="strategyModal" class="fixed inset-0 bg-black/60 backdrop-blur-sm hidden items-center justify-center z-50 p-4">
        <div class="bg-white rounded-3xl max-w-4xl w-full max-h-[90vh] flex flex-col">
            <div class="sticky top-0 bg-white border-b-4 border-gray-200 p-6 rounded-t-3xl flex-shrink-0">
                <div class="flex justify-between items-center">
                    <h2 id="modalTitle" class="text-3xl font-bold text-gray-800">Strategy</h2>
                    <button onclick="closeModal()" class="text-4xl text-gray-500 hover:text-gray-700 leading-none">×</button>
                </div>
                <div class="mt-4">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-lg font-bold text-gray-700">Progress</span>
                        <span id="modalPercent" class="text-lg font-bold text-blue-600">0%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-4">
                        <div class="progress-bar bg-gradient-to-r from-green-400 to-blue-500 h-4 rounded-full" id="modalProgress" style="width: 0%"></div>
                    </div>
                </div>
            </div>
            
            <div id="modalContent" class="p-6 overflow-y-auto">
                <!-- Dynamic content will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // --- Application State ---
        let currentStrategy = '';
        let studentName = '';
        let writingFocus = '';
        let strategyProgress = {
            stop: 0, aim: 0, plan: 0, dare: 0, star: 0, kwl: 0
        };
        // Data for each strategy is now stored in strategyData.js (conceptually)
        // For single-file implementation, it's included below.

        // --- Local Storage Persistence ---
        function loadProgress() {
            const saved = localStorage.getItem('writingTutorProgress');
            if (saved) {
                const data = JSON.parse(saved);
                strategyProgress = data.progress || strategyProgress;
                studentName = data.studentName || '';
                writingFocus = data.writingFocus || '';
                
                if (studentName) document.getElementById('studentName').value = studentName;
                if (writingFocus) document.getElementById('writingFocus').value = writingFocus;
                
                Object.keys(strategyProgress).forEach(strategy => {
                    updateStrategyProgress(strategy, strategyProgress[strategy]);
                });
                updateStudentInfo();
            }
        }

        function saveProgress() {
            const data = {
                progress: strategyProgress,
                studentName: studentName,
                writingFocus: writingFocus,
                lastSaved: new Date().toISOString()
            };
            localStorage.setItem('writingTutorProgress', JSON.stringify(data));
        }

        // --- UI Update Functions ---
        function updateStudentInfo() {
            studentName = document.getElementById('studentName').value;
            writingFocus = document.getElementById('writingFocus').value;
            
            document.getElementById('studentDisplay').textContent = studentName ? `${studentName}'s` : 'Your';
            updateOverallProgress();
            saveProgress();
        }

        function updateOverallProgress() {
            const totalProgress = Object.values(strategyProgress).reduce((sum, progress) => sum + progress, 0);
            const averageProgress = Math.round(totalProgress / 6);
            
            document.getElementById('overallProgress').style.width = averageProgress + '%';
            document.getElementById('overallPercent').textContent = averageProgress + '%';
            
            const completedCount = Object.values(strategyProgress).filter(p => p === 100).length;
            const messages = [
                'Ready to start your writing journey!',
                `Great start! ${completedCount}/6 strategies completed.`,
                `Excellent progress! ${completedCount}/6 strategies mastered.`,
                '🎉 All strategies mastered! You\'re a writing expert!'
            ];
            let messageIndex = 0;
            if (completedCount === 6) messageIndex = 3;
            else if (completedCount >= 3) messageIndex = 2;
            else if (completedCount > 0) messageIndex = 1;
            document.getElementById('progressMessage').textContent = messages[messageIndex];
        }

        function updateStrategyProgress(strategy, progress) {
            strategyProgress[strategy] = progress;
            
            document.getElementById(strategy + 'Progress').style.width = progress + '%';
            document.getElementById(strategy + 'Percent').textContent = progress + '%';
            
            const statusElement = document.getElementById(strategy + 'Status');
            const cardElement = document.querySelector(`[onclick="openStrategy('${strategy}')"]`);
            if (progress === 100) {
                statusElement.textContent = '✅ Completed!';
                cardElement.classList.add('completed');
            } else {
                cardElement.classList.remove('completed');
                if (progress >= 50) statusElement.textContent = 'Making progress!';
                else if (progress > 0) statusElement.textContent = 'Getting started...';
                else statusElement.textContent = 'Ready to start!';
            }
            
            if (currentStrategy === strategy) {
                document.getElementById('modalProgress').style.width = progress + '%';
                document.getElementById('modalPercent').textContent = progress + '%';
            }
            
            updateOverallProgress();
            saveProgress();
        }

        // --- Modal Control ---
        function openStrategy(strategy) {
            currentStrategy = strategy;
            document.getElementById('strategyModal').classList.remove('hidden');
            document.getElementById('strategyModal').classList.add('flex');
            
            const titles = {
                stop: '🛑 STOP Strategy - Persuasive Writing',
                aim: '🎯 AIM Strategy - Introduction Writing',
                plan: '📋 PLAN Strategy - Organization',
                dare: '⚡ DARE Strategy - Argumentative Writing',
                star: '⭐ STAR Strategy - Revision',
                kwl: '🧠 KWL Strategy - Research Writing'
            };
            
            document.getElementById('modalTitle').textContent = titles[strategy];
            document.getElementById('modalProgress').style.width = strategyProgress[strategy] + '%';
            document.getElementById('modalPercent').textContent = strategyProgress[strategy] + '%';
            
            loadStrategyContent(strategy);
        }

        function closeModal() {
            document.getElementById('strategyModal').classList.add('hidden');
            document.getElementById('strategyModal').classList.remove('flex');
            currentStrategy = '';
        }
        
        // --- Dynamic Content Generation ---
        function loadStrategyContent(strategy) {
            const content = document.getElementById('modalContent');
            // This function now calls the new UI pattern generator
            content.innerHTML = generateStrategyContent(strategy);
        }

        // NOTE: All get...Content() functions are now replaced by the single generator below.

        // --- Strategy-Specific Action Functions ---
        // These are called by the dynamically generated buttons and inputs.
        function updateStopTopic() {
            const topic = document.getElementById('stopTopic').value;
            const display = document.getElementById('stopTopicDisplay');
            if (topic.trim()) {
                display.textContent = `🛑 Arguing about: "${topic}"`;
                updateStrategyProgress('stop', 15);
            }
        }
        function completeStopBrainstorm() {
            const forArgs = document.getElementById('stopFor').value;
            const againstArgs = document.getElementById('stopAgainst').value;
            if (forArgs.trim() && againstArgs.trim()) {
                updateStrategyProgress('stop', 35);
                showSuccess('Brainstorming completed! Great job exploring both sides.');
            } else {
                showError('Please complete both FOR and AGAINST arguments!');
            }
        }
        function takeSide(side) {
            document.getElementById('sideFor').classList.toggle('bg-green-600', side === 'for');
            document.getElementById('sideAgainst').classList.toggle('bg-red-600', side === 'against');
            document.getElementById('chosenSide').textContent = side === 'for' ? '✅ You chose: FOR this topic' : '❌ You chose: AGAINST this topic';
            updateStrategyProgress('stop', 50);
        }
        function completeStopOrganize() {
            if (document.getElementById('stopOrganize').value.trim()) {
                updateStrategyProgress('stop', 70);
                showSuccess('Ideas organized! Ready to write your draft.');
            } else {
                showError('Please organize your ideas with stars and numbers!');
            }
        }
        function completeStopDraft() {
            const draft = document.getElementById('stopDraft').value;
            if (draft.trim() && draft.length > 50) {
                updateStrategyProgress('stop', 85);
                showSuccess('Draft completed! Time for final review.');
            } else {
                showError('Please write a substantial draft (at least 50 words)!');
            }
        }
        function completeStopStrategy() {
            updateStrategyProgress('stop', 100);
            showSuccess('🎉 STOP Strategy mastered! You\'ve learned the complete persuasive writing process!');
        }
        function updateAimTopic() {
            const topic = document.getElementById('aimTopic').value;
            if (topic.trim()) {
                document.getElementById('aimTopicDisplay').textContent = `🎯 Writing about: "${topic}"`;
                updateStrategyProgress('aim', 15);
            }
        }
        function completeAimAttract() {
            if (document.getElementById('aimAttract').value.trim()) {
                updateStrategyProgress('aim', 40);
                showSuccess('Great hook! You\'ve grabbed the reader\'s attention.');
            } else {
                showError('Please write your attention-grabbing hook!');
            }
        }
        function completeAimIdentify() {
            if (document.getElementById('aimIdentify').value.trim()) {
                updateStrategyProgress('aim', 65);
                showSuccess('Main point identified! Clear and focused.');
            } else {
                showError('Please clearly state your main point!');
            }
        }
        function completeAimMap() {
            if (document.getElementById('aimMap').value.trim()) {
                updateStrategyProgress('aim', 85);
                showSuccess('Background information added! Your readers have context.');
            } else {
                showError('Please provide background information!');
            }
        }
        function generateAimIntro() {
            const attract = document.getElementById('aimAttract').value;
            const identify = document.getElementById('aimIdentify').value;
            const map = document.getElementById('aimMap').value;
            if (attract.trim() && identify.trim() && map.trim()) {
                document.getElementById('aimIntroduction').value = `${attract}\n\n${identify}\n\n${map}`;
                showSuccess('Introduction sections combined! Review and edit as needed.');
            } else {
                showError('Please complete all three AIM sections first!');
            }
        }
        function completeAimStrategy() {
            if (document.getElementById('aimIntroduction').value.trim()) {
                updateStrategyProgress('aim', 100);
                showSuccess('🎉 AIM Strategy mastered! You\'ve learned how to write compelling introductions!');
            } else {
                showError('Please complete your introduction!');
            }
        }
        function checkPlanProgress() {
            if (document.getElementById('planAssignment').value.trim()) {
                updateStrategyProgress('plan', 20);
            }
        }
        function completePlanAttention() {
            const checkedBoxes = document.querySelectorAll('#modalContent input[type="checkbox"]:checked').length;
            if (checkedBoxes >= 3) {
                updateStrategyProgress('plan', 35);
                showSuccess('Assignment analyzed! You understand what\'s needed.');
            } else {
                showError('Please complete at least 3 items in the checklist!');
            }
        }
        function completePlanList() {
            const list = document.getElementById('planList').value;
            if (list.trim() && list.split('\n').filter(line => line.trim()).length >= 3) {
                updateStrategyProgress('plan', 55);
                showSuccess('Main ideas listed! Good brainstorming.');
            } else {
                showError('Please list at least 3 main ideas!');
            }
        }
        function completePlanAdd() {
            const filled = document.getElementById('planIdea1').value.trim() && document.getElementById('planSupport1').value.trim() && document.getElementById('planIdea2').value.trim() && document.getElementById('planSupport2').value.trim();
            if (filled) {
                updateStrategyProgress('plan', 80);
                showSuccess('Supporting details added! Your ideas are well-developed.');
            } else {
                showError('Please complete at least 2 main ideas with supporting details!');
            }
        }
        function completePlanStrategy() {
            const numbered = document.getElementById('planNumber').value;
            if (numbered.trim() && numbered.includes('1.') && numbered.includes('2.')) {
                updateStrategyProgress('plan', 100);
                showSuccess('🎉 PLAN Strategy mastered! You\'ve learned systematic organization!');
            } else {
                showError('Please number your ideas in order!');
            }
        }
        function updateDareTopic() {
            const topic = document.getElementById('dareTopic').value;
            if (topic.trim()) {
                document.getElementById('dareTopicDisplay').textContent = `⚡ Arguing: "${topic}"`;
                updateStrategyProgress('dare', 15);
            }
        }
        function completeDareDevelop() {
            const thesis = document.getElementById('dareDevelop').value;
            if (thesis.trim() && thesis.length > 20) {
                updateStrategyProgress('dare', 35);
                showSuccess('Strong thesis developed! Clear position stated.');
            } else {
                showError('Please write a clear, detailed thesis statement!');
            }
        }
        function completeDareAdd() {
            if (document.getElementById('dareSupport1').value.trim() && document.getElementById('dareSupport2').value.trim()) {
                updateStrategyProgress('dare', 60);
                showSuccess('Supporting arguments added! Strong evidence provided.');
            } else {
                showError('Please complete at least 2 supporting arguments!');
            }
        }
        function completeDareReject() {
            if (document.getElementById('dareCounterArg').value.trim() && document.getElementById('dareRebuttal').value.trim()) {
                updateStrategyProgress('dare', 80);
                showSuccess('Counter-arguments addressed! Your argument is stronger.');
            } else {
                showError('Please address counter-arguments and provide rebuttals!');
            }
        }
        function completeDareStrategy() {
            if (document.getElementById('dareEnd').value.trim()) {
                updateStrategyProgress('dare', 100);
                showSuccess('🎉 DARE Strategy mastered! You\'ve learned powerful argumentative writing!');
            } else {
                showError('Please write your conclusion!');
            }
        }
        function loadStarDraft() {
            const draft = document.getElementById('starOriginalDraft').value;
            if (draft.trim()) {
                document.getElementById('starSubstitute').value = draft;
                document.getElementById('starTakeOut').value = draft;
                document.getElementById('starAdd').value = draft;
                document.getElementById('starRearrange').value = draft;
                updateStrategyProgress('star', 20);
                showSuccess('Draft loaded! Ready for revision.');
            } else {
                showError('Please paste your draft first!');
            }
        }
        function completeStarSubstitute() {
            const revised = document.getElementById('starSubstitute').value;
            if (revised.trim()) {
                updateStrategyProgress('star', 40);
                document.getElementById('starTakeOut').value = revised;
                showSuccess('Word substitutions completed! Stronger vocabulary used.');
            } else {
                showError('Please complete your word substitutions!');
            }
        }
        function completeStarTakeOut() {
            const revised = document.getElementById('starTakeOut').value;
            if (revised.trim()) {
                updateStrategyProgress('star', 60);
                document.getElementById('starAdd').value = revised;
                showSuccess('Unnecessary words removed! Writing is more concise.');
            } else {
                showError('Please remove repetitive elements!');
            }
        }
        function completeStarAdd() {
            const revised = document.getElementById('starAdd').value;
            if (revised.trim()) {
                updateStrategyProgress('star', 80);
                document.getElementById('starRearrange').value = revised;
                showSuccess('Details added! Writing is more vivid and engaging.');
            } else {
                showError('Please add more details and descriptions!');
            }
        }
        function completeStarStrategy() {
            if (document.getElementById('starRearrange').value.trim()) {
                updateStrategyProgress('star', 100);
                showSuccess('🎉 STAR Strategy mastered! You\'ve learned systematic revision!');
            } else {
                showError('Please complete your final revision!');
            }
        }
        function updateKwlTopic() {
            const topic = document.getElementById('kwlTopic').value;
            if (topic.trim()) {
                document.getElementById('kwlTopicDisplay').textContent = `🧠 Researching: "${topic}"`;
                updateStrategyProgress('kwl', 15);
            }
        }
        function completeKwlKnow() {
            const know = document.getElementById('kwlKnow').value;
            if (know.trim() && know.split('\n').filter(line => line.trim()).length >= 3) {
                updateStrategyProgress('kwl', 30);
                showSuccess('Prior knowledge recorded! Good starting point.');
            } else {
                showError('Please list at least 3 things you know!');
            }
        }
        function completeKwlWant() {
            const want = document.getElementById('kwlWant').value;
            if (want.trim() && want.split('\n').filter(line => line.trim()).length >= 3) {
                updateStrategyProgress('kwl', 50);
                showSuccess('Research questions created! Ready to investigate.');
            } else {
                showError('Please write at least 3 questions!');
            }
        }
        function completeKwlResearch() {
            if (document.getElementById('kwlResearch').value.trim().length > 50) {
                updateStrategyProgress('kwl', 75);
                showSuccess('Research completed! Lots of new information gathered.');
            } else {
                showError('Please complete substantial research notes (at least 50 characters)!');
            }
        }
        function completeKwlStrategy() {
            if (document.getElementById('kwlLearned').value.trim()) {
                updateStrategyProgress('kwl', 100);
                showSuccess('🎉 KWL Strategy mastered! You\'ve learned systematic research and writing!');
            } else {
                showError('Please complete what you learned!');
            }
        }

        // --- Utility Functions ---
        function updateWordCount(textareaId, countId) {
            const text = document.getElementById(textareaId).value;
            const words = text.trim() ? text.trim().split(/\s+/).length : 0;
            if (document.getElementById(countId)) {
                document.getElementById(countId).textContent = `Word count: ${words}`;
            }
        }

        // Replaces alert() with styled, non-blocking feedback
        function showFeedback(message, type = 'success') {
            const feedbackDiv = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';
            feedbackDiv.className = `fixed top-5 right-5 ${bgColor} text-white px-6 py-3 rounded-xl shadow-lg z-[100] fade-in`;
            feedbackDiv.textContent = message;
            document.body.appendChild(feedbackDiv);
            
            setTimeout(() => {
                feedbackDiv.remove();
            }, 3000);
        }

        function showSuccess(message) {
            showFeedback(message, 'success');
        }

        function showError(message) {
            showFeedback(message, 'error');
        }

        function exportPortfolio() {
            const completedStrategies = Object.keys(strategyProgress).filter(key => strategyProgress[key] === 100);
            const portfolioText = `
                📄 Portfolio Export Ready!\n
                Student: ${studentName || 'Student'}\n
                Focus: ${writingFocus || 'Not selected'}\n
                Completed: ${completedStrategies.length}/6 strategies\n
                In a real application, this would generate a complete PDF portfolio with all your writing samples and progress!
            `;
            // Using showError as a styled alert alternative
            showFeedback(portfolioText.replace(/\n/g, '<br>').replace(/ /g, '&nbsp;'), 'success');
        }

        // --- Page Initialization ---
        document.addEventListener('DOMContentLoaded', function() {
            loadProgress();
        });
    </script>
    <script>
        // Data structure defining all strategy steps. This centralizes content and structure.
        const strategyDefinitions = {
            stop: {
                steps: [
                    { type: 'learn', title: '📚 Step 1: Learn STOP Strategy', instruction: 'STOP stands for Suspend judgment, Take a side, Organize ideas, and Plan more. This strategy helps you write persuasive essays by thinking through both sides of an argument first.', items: [{ icon: '📝', title: 'Suspend Judgment', description: 'Brainstorm ideas for and against the topic' }, { icon: '🎯', title: 'Take a Side', description: 'Choose your position on the topic' }, { icon: '⭐', title: 'Organize Ideas', description: 'Star ideas you\'ll use, number their order' }, { icon: '📈', title: 'Plan More', description: 'Continue planning as you write' }] },
                    { type: 'input', title: '📝 Step 2: Choose Your Persuasive Topic', id: 'stopTopic', placeholder: 'e.g., Should students have longer recess?', onchange: 'updateStopTopic()', displayId: 'stopTopicDisplay' },
                    { type: 'dual_textarea', title: '📝 Step 3: Suspend Judgment - Brainstorm Both Sides', id1: 'stopFor', label1: '✅ Arguments FOR:', placeholder1: 'List all reasons supporting this position...', id2: 'stopAgainst', label2: '❌ Arguments AGAINST:', placeholder2: 'List all reasons opposing this position...', buttonText: '✅ Complete Brainstorming', onclick: 'completeStopBrainstorm()' },
                    { type: 'buttons', title: '🎯 Step 4: Take a Side - Choose Your Position', button1: { text: '✅ I\'m FOR this topic', onclick: "takeSide('for')", id: 'sideFor', class: 'bg-green-500 hover:bg-green-600' }, button2: { text: '❌ I\'m AGAINST this topic', onclick: "takeSide('against')", id: 'sideAgainst', class: 'bg-red-500 hover:bg-red-600' }, displayId: 'chosenSide' },
                    { type: 'textarea', title: '⭐ Step 5: Organize Ideas - Star and Number', instruction: '<strong>Instructions:</strong> Copy your chosen arguments below, then mark your best ones with ⭐ and number them in order (1, 2, 3).', id: 'stopOrganize', placeholder: 'Copy your chosen arguments here and mark them...', buttonText: '📋 Complete Organization', onclick: 'completeStopOrganize()' },
                    { type: 'draft', title: '✍️ Step 6: Write Your Persuasive Essay', id: 'stopDraft', placeholder: 'Write your persuasive essay here using your organized ideas...', guide: { title: '📝 Writing Structure', items: ['<strong>Introduction:</strong> Hook + State your position', '<strong>Body Paragraph 1:</strong> Your strongest argument + evidence', '<strong>Body Paragraph 2:</strong> Your second argument + evidence', '<strong>Body Paragraph 3:</strong> Address counter-arguments', '<strong>Conclusion:</strong> Restate position + call to action'] }, buttonText: '📝 Complete Draft', onclick: 'completeStopDraft()', wordCountId: 'stopWordCount' },
                    { type: 'review', title: '🔄 Step 7: Review and Finalize', checkboxes: ['Clear thesis statement in introduction', 'Strong evidence for each argument', 'Addressed counter-arguments', 'Strong conclusion with call to action'], buttonText: '🎉 Complete STOP Strategy!', onclick: 'completeStopStrategy()' }
                ]
            },
            aim: {
                steps: [
                    { type: 'learn', title: '📚 Step 1: Learn AIM Strategy', instruction: 'AIM stands for Attract, Identify, and Map. It helps you write a powerful introduction for any type of essay.', items: [{ icon: '🎪', title: 'Attract', description: "Grab the reader's attention at the start" }, { icon: '🔍', title: 'Identify', description: 'Clearly state the problem or main idea' }, { icon: '🗺️', title: 'Map', description: 'Provide background context and information' }] },
                    { type: 'input', title: '📝 Step 2: Choose Your Topic', id: 'aimTopic', placeholder: 'Works for any writing type', onchange: 'updateAimTopic()', displayId: 'aimTopicDisplay' },
                    { type: 'textarea', title: '🎪 Step 3: Attract - Create Your Hook', id: 'aimAttract', placeholder: 'Write 2-3 attention-grabbing opening sentences...', guide: { title: '💡 Hook Ideas', items: ['<strong>Question:</strong> "What if I told you that..."', '<strong>Statistic:</strong> "Did you know that 75% of..."', '<strong>Story:</strong> "Imagine walking into..."', '<strong>Quote:</strong> "As Maya Angelou once said..."', '<strong>Surprising fact:</strong> "Most people believe... but actually..."'] }, buttonText: '🎪 Complete Hook', onclick: 'completeAimAttract()' },
                    { type: 'textarea', title: '🔍 Step 4: Identify - State Your Main Point', id: 'aimIdentify', placeholder: 'Clearly state your main point or thesis...', guide: { title: '🎯 What to Identify', items: ['<strong>Persuasive:</strong> State your position clearly', '<strong>Narrative:</strong> Introduce the main conflict or theme', '<strong>Informational:</strong> Present your main topic or thesis'] }, buttonText: '🔍 Complete Identification', onclick: 'completeAimIdentify()' },
                    { type: 'textarea', title: '🗺️ Step 5: Map - Provide Background Context', id: 'aimMap', placeholder: 'Provide background information your reader needs...', guide: { title: '🗺️ Background Information', items: ['What does your reader need to know?', "What's the history or context?", 'Why is this topic important?', 'What are the key terms or concepts?'] }, buttonText: '🗺️ Complete Background', onclick: 'completeAimMap()' },
                    { type: 'textarea', title: '📝 Step 6: Create Your Complete Introduction', id: 'aimIntroduction', placeholder: 'Combine your hook, main point, and background...', instruction: '<strong>Instructions:</strong> Combine your Attract, Identify, and Map sections into one flowing introduction paragraph.', specialButton: { text: '🔄 Auto-Combine Sections', onclick: 'generateAimIntro()' }, buttonText: '🎉 Complete AIM Strategy!', onclick: 'completeAimStrategy()' }
                ]
            },
            plan: {
                steps: [
                    { type: 'learn', title: '📚 Step 1: Learn PLAN Strategy', instruction: 'PLAN helps you organize your thoughts before and during writing.', items: [{ icon: '📖', title: 'Pay Attention', description: 'Understand the writing assignment' }, { icon: '📝', title: 'List', description: 'Write down your main ideas' }, { icon: '➕', title: 'Add', description: 'Include supporting details for each main idea' }, { icon: '🔢', title: 'Number', description: 'Put ideas in logical order' }] },
                    { type: 'textarea_review', title: '📖 Step 2: Pay Attention - Understand Your Assignment', id: 'planAssignment', placeholder: 'Enter your writing assignment or prompt...', onchange: 'checkPlanProgress()', guide: { title: 'Assignment Analysis Checklist:', items: ['What is the main topic?', 'What type of writing is required?', 'Who is my audience?', 'What is my purpose?'] }, buttonText: '📖 Complete Assignment Analysis', onclick: 'completePlanAttention()' },
                    { type: 'textarea', title: '📝 Step 3: List - Brainstorm Your Main Ideas', id: 'planList', placeholder: 'List all your main ideas here (one per line)...', guide: { title: '💡 Brainstorming Tips', items: ["Write down everything that comes to mind", "Don't worry about order yet", "Aim for 4-6 main ideas", "Think about what your audience needs to know"] }, buttonText: '📝 Complete Main Ideas List', onclick: 'completePlanList()' },
                    { type: 'dual_input_textarea', title: '➕ Step 4: Add - Supporting Details for Each Idea', id1: 'planIdea1', label1: 'Main Idea 1:', placeholder1: 'Enter main idea 1...', supportId1: 'planSupport1', id2: 'planIdea2', label2: 'Main Idea 2:', placeholder2: 'Enter main idea 2...', supportId2: 'planSupport2', buttonText: '➕ Complete Supporting Details', onclick: 'completePlanAdd()' },
                    { type: 'textarea', title: '🔢 Step 5: Number - Organize Your Ideas', id: 'planNumber', placeholder: "Copy your ideas here and number them in order...\n1. First idea (strongest/most important)\n2. Second idea\n3. etc.", guide: { title: '📊 Organization Strategies', items: ['<strong>Strongest to weakest:</strong> Start with your best point', '<strong>Chronological:</strong> Time order for narratives', '<strong>Problem to solution:</strong> For persuasive writing', '<strong>General to specific:</strong> For informational writing'] }, buttonText: '🎉 Complete PLAN Strategy!', onclick: 'completePlanStrategy()' }
                ]
            },
            dare: {
                steps: [
                    { type: 'learn', title: '📚 Step 1: Learn DARE Strategy', instruction: 'DARE provides a structure for building a strong, convincing argument from start to finish.', items: [{ icon: '📝', title: 'Develop', description: 'Create a strong topic sentence/thesis' }, { icon: '➕', title: 'Add', description: 'Include supporting ideas and evidence' }, { icon: '❌', title: 'Reject', description: 'Address counter-arguments' }, { icon: '🏁', title: 'End', description: 'Write a powerful conclusion' }] },
                    { type: 'input', title: '📝 Step 2: Choose Your Argumentative Topic', id: 'dareTopic', placeholder: 'e.g., Schools should start later in the morning', onchange: 'updateDareTopic()', displayId: 'dareTopicDisplay' },
                    { type: 'textarea', title: '📝 Step 3: Develop - Create Your Thesis Statement', id: 'dareDevelop', placeholder: 'Write your thesis statement here...', guide: { title: '💡 Strong Thesis Elements', items: ['<strong>Clear position:</strong> State exactly what you believe', '<strong>Specific:</strong> Avoid vague language', '<strong>Arguable:</strong> Someone could disagree with it', '<strong>Preview:</strong> Hint at your main supporting points'] }, buttonText: '📝 Complete Thesis', onclick: 'completeDareDevelop()' },
                    { type: 'dual_labeled_textarea', title: '➕ Step 4: Add - Supporting Arguments and Evidence', id1: 'dareSupport1', label1: 'Supporting Argument 1:', placeholder1: 'Your strongest supporting argument with evidence...', id2: 'dareSupport2', label2: 'Supporting Argument 2:', placeholder2: 'Your second supporting argument with evidence...', buttonText: '➕ Complete Supporting Arguments', onclick: 'completeDareAdd()' },
                    { type: 'dual_labeled_textarea', title: '❌ Step 5: Reject - Address Counter-Arguments', id1: 'dareCounterArg', label1: 'What would opponents say?', placeholder1: 'List the strongest arguments against your position...', id2: 'dareRebuttal', label2: 'How will you respond?', placeholder2: 'Explain why these counter-arguments are wrong...', buttonText: '❌ Complete Counter-Arguments', onclick: 'completeDareReject()' },
                    { type: 'textarea', title: '🏁 Step 6: End - Write Your Conclusion', id: 'dareEnd', placeholder: 'Write a powerful conclusion...', guide: { title: '🎯 Powerful Conclusion Elements', items: ['<strong>Restate thesis:</strong> Remind readers of your position', '<strong>Summarize main points:</strong> Briefly review your arguments', '<strong>Call to action:</strong> Tell readers what they should do', '<strong>Final impact:</strong> Leave them with something memorable'] }, buttonText: '🎉 Complete DARE Strategy!', onclick: 'completeDareStrategy()' }
                ]
            },
            star: {
                steps: [
                    { type: 'learn', title: '📚 Step 1: Learn STAR Revision Strategy', instruction: 'STAR is a powerful tool for revising your first draft to make it clearer, more engaging, and more professional.', items: [{ icon: '🔄', title: 'Substitute', description: 'Replace overused or weak words' }, { icon: '✂️', title: 'Take Out', description: 'Remove unnecessary repetitions' }, { icon: '➕', title: 'Add', description: 'Include more details and descriptions' }, { icon: '🔀', title: 'Rearrange', description: 'Improve flow and organization' }] },
                    { type: 'textarea', title: '📝 Step 2: Import Your Draft for Revision', id: 'starOriginalDraft', placeholder: 'Paste your draft here that you want to revise...', buttonText: '📥 Load Draft for Revision', onclick: 'loadStarDraft()' },
                    { type: 'textarea', title: '🔄 Step 3: Substitute - Replace Weak Words', id: 'starSubstitute', placeholder: 'Rewrite your draft here, replacing weak words...', guide: { title: '🎯 Words to Replace', isDual: true, items: ['<strong>Weak Words:</strong><ul class="text-sm"><li>very → extremely</li><li>really → truly</li><li>good → excellent</li><li>bad → awful</li></ul>', '<strong>Boring Verbs:</strong><ul class="text-sm"><li>said → declared</li><li>went → traveled</li><li>got → obtained</li><li>made → created</li></ul>'] }, buttonText: '🔄 Complete Substitutions', onclick: 'completeStarSubstitute()' },
                    { type: 'textarea', title: '✂️ Step 4: Take Out - Remove Unnecessary Repetitions', id: 'starTakeOut', placeholder: 'Remove repetitive words and unnecessary phrases...', buttonText: '✂️ Complete Removal', onclick: 'completeStarTakeOut()' },
                    { type: 'textarea', title: '➕ Step 5: Add - Include More Details and Descriptions', id: 'starAdd', placeholder: 'Add more specific details, examples, and descriptions...', buttonText: '➕ Complete Additions', onclick: 'completeStarAdd()' },
                    { type: 'textarea', title: '🔀 Step 6: Rearrange - Improve Flow and Organization', id: 'starRearrange', placeholder: 'Rearrange sentences and paragraphs for better logical flow...', buttonText: '🎉 Complete STAR Strategy!', onclick: 'completeStarStrategy()' }
                ]
            },
            kwl: {
                steps: [
                    { type: 'learn', title: '📚 Step 1: Learn KWL Strategy', instruction: 'The KWL chart is a simple but effective way to guide your research process and organize your findings.', items: [{ icon: '📚', title: 'Know', description: 'What do you already know about the topic?' }, { icon: '❓', title: 'Want to Know', description: 'What questions do you have?' }, { icon: '💡', title: 'Learned', description: 'What new information did you discover?' }] },
                    { type: 'input', title: '📝 Step 2: Choose Your Research/Writing Topic', id: 'kwlTopic', placeholder: 'Enter your topic for research...', onchange: 'updateKwlTopic()', displayId: 'kwlTopicDisplay' },
                    { type: 'textarea', title: '📚 Step 3: Know - What You Already Know', id: 'kwlKnow', placeholder: 'List everything you already know about your topic...', buttonText: '📚 Complete "What I Know"', onclick: 'completeKwlKnow()' },
                    { type: 'textarea', title: '❓ Step 4: Want to Know - Your Questions', id: 'kwlWant', placeholder: 'Write your questions about the topic...', buttonText: '❓ Complete "What I Want to Know"', onclick: 'completeKwlWant()' },
                    { type: 'textarea', title: '🔍 Step 5: Research - Find Answers to Your Questions', id: 'kwlResearch', placeholder: 'Take notes while you research...', buttonText: '🔍 Complete Research', onclick: 'completeKwlResearch()' },
                    { type: 'textarea', title: '💡 Step 6: Learned - What You Discovered', id: 'kwlLearned', placeholder: 'Write what you learned from your research...', buttonText: '🎉 Complete KWL Strategy!', onclick: 'completeKwlStrategy()' }
                ]
            }
        };

        /**
         * Generates the HTML content for a strategy modal based on a structured data object.
         * This reduces HTML duplication and makes the code more maintainable.
         * @param {string} strategyKey - The key for the strategy (e.g., 'stop', 'aim').
         * @returns {string} The generated HTML string.
         */
        function generateStrategyContent(strategyKey) {
            const definition = strategyDefinitions[strategyKey];
            if (!definition) return '<p>Strategy not found.</p>';

            let html = '<div class="space-y-8">';
            definition.steps.forEach(step => {
                const titleHtml = `<div class="flex items-center mb-4"><h3 class="modal-step-title text-gray-800">${step.title}</h3></div>`;
                const instructionHtml = step.instruction ? `<p class="mb-4 text-gray-600 modal-body-text">${step.instruction}</p>` : '';
                const guideHtml = step.guide ? `<div class="bg-blue-50 rounded-xl p-4 mb-4"><h4 class="font-bold text-lg mb-2">${step.guide.title}</h4>${step.guide.isDual ? '<div class="grid md:grid-cols-2 gap-4">' + step.guide.items.map(item => `<div>${item}</div>`).join('') + '</div>' : '<ul class="space-y-1 text-gray-700">' + step.guide.items.map(item => `<li>${item}</li>`).join('') + '</ul>'}</div>` : '';
                const buttonHtml = step.buttonText ? `<button onclick="${step.onclick}" class="mt-4 bg-blue-500 text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-600 transition-colors">${step.buttonText}</button>` : '';
                const finalButtonHtml = (step.type === 'review' || (step.onclick && step.buttonText.startsWith('🎉'))) ? `<button onclick="${step.onclick}" class="mt-6 bg-gradient-to-r from-green-500 to-blue-600 text-white px-8 py-4 rounded-xl font-bold text-lg hover:shadow-lg transition-all">${step.buttonText}</button>` : buttonHtml;

                html += `<div class="bg-white rounded-2xl p-6 border-4 border-gray-200 fade-in">`;
                switch (step.type) {
                    case 'learn':
                        html += `${titleHtml}<div class="grid md:grid-cols-2 gap-4">${step.items.map(item => `<div class="bg-gray-50 rounded-xl p-4 border"><div class="text-3xl mb-2">${item.icon}</div><h4 class="font-bold text-lg">${item.title}</h4><p class="text-gray-600">${item.description}</p></div>`).join('')}</div>`;
                        break;
                    case 'input':
                        html += `${titleHtml}<input type="text" id="${step.id}" class="w-full p-4 text-lg border-2 border-gray-300 rounded-xl" placeholder="${step.placeholder}" onchange="${step.onchange}"><div id="${step.displayId}" class="mt-4 text-center text-lg font-bold text-blue-600"></div>`;
                        break;
                    case 'textarea':
                        html += `${titleHtml}${instructionHtml}${guideHtml}<textarea id="${step.id}" class="w-full h-48 p-4 border-2 border-gray-300 rounded-xl" placeholder="${step.placeholder}"></textarea>`;
                        if (step.specialButton) html += `<button onclick="${step.specialButton.onclick}" class="my-4 bg-purple-500 text-white px-6 py-3 rounded-xl font-bold hover:bg-purple-600 transition-colors">${step.specialButton.text}</button><br>`;
                        html += finalButtonHtml;
                        break;
                    case 'dual_textarea':
                        html += `${titleHtml}<div class="grid md:grid-cols-2 gap-6"><div><label class="block text-lg font-bold text-green-600 mb-2">${step.label1}</label><textarea id="${step.id1}" class="w-full h-32 p-4 border-2 border-green-300 rounded-xl" placeholder="${step.placeholder1}"></textarea></div><div><label class="block text-lg font-bold text-red-600 mb-2">${step.label2}</label><textarea id="${step.id2}" class="w-full h-32 p-4 border-2 border-red-300 rounded-xl" placeholder="${step.placeholder2}"></textarea></div></div>${buttonHtml}`;
                        break;
                    case 'dual_labeled_textarea':
                        html += `${titleHtml}<div class="space-y-4"><div><label class="block text-lg font-bold text-gray-700 mb-2">${step.label1}</label><textarea id="${step.id1}" class="w-full h-24 p-4 border-2 rounded-xl" placeholder="${step.placeholder1}"></textarea></div><div><label class="block text-lg font-bold text-gray-700 mb-2">${step.label2}</label><textarea id="${step.id2}" class="w-full h-24 p-4 border-2 rounded-xl" placeholder="${step.placeholder2}"></textarea></div></div>${buttonHtml}`;
                        break;
                    case 'buttons':
                        html += `${titleHtml}<div class="flex gap-4 justify-center"><button onclick="${step.button1.onclick}" id="${step.button1.id}" class="${step.button1.class} text-white px-8 py-4 rounded-xl font-bold transition-colors">${step.button1.text}</button><button onclick="${step.button2.onclick}" id="${step.button2.id}" class="${step.button2.class} text-white px-8 py-4 rounded-xl font-bold transition-colors">${step.button2.text}</button></div><div id="${step.displayId}" class="mt-4 text-center text-lg font-bold"></div>`;
                        break;
                    case 'draft':
                        html += `${titleHtml}${guideHtml}<textarea id="${step.id}" class="w-full h-64 p-4 border-2 rounded-xl" placeholder="${step.placeholder}" oninput="updateWordCount('${step.id}', '${step.wordCountId}')"></textarea><div class="mt-2 text-gray-600" id="${step.wordCountId}">Word count: 0</div>${buttonHtml}`;
                        break;
                    case 'review':
                        html += `${titleHtml}<div class="space-y-4">${step.checkboxes.map(label => `<label class="review-checkbox-label"><input type="checkbox" class="text-blue-600 rounded"><span class="text-lg">${label}</span></label>`).join('')}</div>${finalButtonHtml}`;
                        break;
                    case 'textarea_review':
                         html += `${titleHtml}<textarea id="${step.id}" class="w-full h-24 p-4 border-2 rounded-xl mb-4" placeholder="${step.placeholder}" oninput="${step.onchange}"></textarea><div class="bg-blue-50 rounded-xl p-4"><h4 class="font-bold text-lg mb-3">${step.guide.title}</h4><div class="space-y-2">${step.guide.items.map(item => `<label class="review-checkbox-label"><input type="checkbox" onchange="${step.onchange}"><span class="text-lg">${item}</span></label>`).join('')}</div></div>${buttonHtml}`;
                        break;
                    case 'dual_input_textarea':
                        html += `${titleHtml}<div class="grid md:grid-cols-2 gap-6"><div><label class="block text-lg font-bold text-gray-700 mb-2">${step.label1}</label><input type="text" id="${step.id1}" class="w-full p-3 border-2 rounded-xl mb-2" placeholder="${step.placeholder1}"><textarea id="${step.supportId1}" class="w-full h-24 p-3 border-2 rounded-xl" placeholder="Add supporting details..."></textarea></div><div><label class="block text-lg font-bold text-gray-700 mb-2">${step.label2}</label><input type="text" id="${step.id2}" class="w-full p-3 border-2 rounded-xl mb-2" placeholder="${step.placeholder2}"><textarea id="${step.supportId2}" class="w-full h-24 p-3 border-2 rounded-xl" placeholder="Add supporting details..."></textarea></div></div>${buttonHtml}`;
                        break;
                }
                html += `</div>`;
            });

            html += '</div>';
            return html;
        }
    </script>
</body>
</html>
