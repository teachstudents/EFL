<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🌱 Ultimate Rooftop Garden 🌱</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            background: linear-gradient(135deg, #87CEEB 0%, #98FB98 50%, #F0E68C 100%);
            transition: all 3s ease;
        }

        .game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            cursor: grab;
        }

        .sky {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 55%;
            background: linear-gradient(to bottom, #87CEEB 0%, #B0E0E6 50%, #E0F6FF 100%);
            transition: all 3s ease;
            overflow: hidden;
        }

        .clouds {
            position: absolute;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 20"><circle cx="20" cy="10" r="8" fill="white" opacity="0.7"/><circle cx="30" cy="8" r="6" fill="white" opacity="0.7"/><circle cx="40" cy="12" r="7" fill="white" opacity="0.7"/></svg>') repeat-x;
            animation: drift 60s linear infinite;
        }

        @keyframes drift {
            from { transform: translateX(-100px); }
            to { transform: translateX(100vw); }
        }

        .sun-moon {
            position: absolute;
            width: 100px;
            height: 100px;
            border-radius: 50%;
            font-size: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 3s ease;
            z-index: 10;
            filter: drop-shadow(0 0 20px rgba(255, 255, 0, 0.6));
        }

        .rooftop {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 45%;
            background: linear-gradient(to bottom, #8B4513 0%, #A0522D 50%, #CD853F 100%);
            border-top: 8px solid #654321;
            box-shadow: inset 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .garden-plot {
            position: absolute;
            width: 90px;
            height: 90px;
            background: radial-gradient(circle, #8B4513 0%, #654321 100%);
            border: 4px solid #5D4037;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.4s ease;
            box-shadow: inset 0 4px 8px rgba(0, 0, 0, 0.3), 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .garden-plot:hover {
            transform: scale(1.08) translateY(-2px);
            box-shadow: 0 0 25px rgba(255, 255, 0, 0.6), inset 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .garden-plot.planted {
            background: radial-gradient(circle, #4A4A4A 0%, #2E2E2E 100%);
        }

        .plant {
            position: absolute;
            font-size: 45px;
            cursor: grab;
            transition: all 0.5s ease;
            z-index: 5;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
            transform-origin: bottom center;
        }

        .plant:hover {
            transform: scale(1.15) rotate(5deg);
        }

        .plant.stage-1 { font-size: 25px; opacity: 0.8; }
        .plant.stage-2 { font-size: 35px; opacity: 0.9; }
        .plant.stage-3 { font-size: 45px; opacity: 1; }
        .plant.stage-4 { font-size: 55px; opacity: 1; animation: mature-glow 3s ease infinite; }

        @keyframes mature-glow {
            0%, 100% { filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3)); }
            50% { filter: drop-shadow(2px 2px 8px rgba(0, 255, 0, 0.5)); }
        }

        .chicken {
            position: absolute;
            font-size: 40px;
            cursor: pointer;
            transition: all 0.6s ease;
            z-index: 6;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
        }

        .chicken:hover {
            transform: scale(1.2) rotate(-10deg);
            animation: chicken-dance 0.5s ease;
        }

        @keyframes chicken-dance {
            0%, 100% { transform: scale(1.2) rotate(-10deg); }
            25% { transform: scale(1.2) rotate(10deg); }
            75% { transform: scale(1.2) rotate(-5deg); }
        }

        .egg {
            position: absolute;
            font-size: 30px;
            cursor: grab;
            transition: all 0.4s ease;
            z-index: 4;
            filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.3));
        }

        .egg:hover {
            transform: scale(1.2) rotate(15deg);
        }

        .pest {
            position: absolute;
            font-size: 35px;
            cursor: pointer;
            transition: all 0.4s ease;
            z-index: 7;
            animation: pest-wiggle 2s ease-in-out infinite;
        }

        @keyframes pest-wiggle {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(10deg); }
            75% { transform: rotate(-10deg); }
        }

        .pest:hover {
            transform: scale(1.3);
            animation: pest-angry 0.3s ease infinite;
        }

        @keyframes pest-angry {
            0%, 100% { transform: scale(1.3) rotate(0deg); }
            50% { transform: scale(1.3) rotate(180deg); }
        }

        .flying-creature {
            position: absolute;
            font-size: 30px;
            z-index: 8;
            transition: all 1s ease;
            filter: drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.2));
        }

        .ui-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(240, 248, 255, 0.95));
            padding: 25px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 100;
            min-width: 280px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .score {
            font-size: 18px;
            font-weight: bold;
            color: #2E8B57;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 5px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .badges {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 15px;
        }

        .badge {
            font-size: 24px;
            padding: 8px;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            border-radius: 12px;
            text-align: center;
            animation: badge-shine 3s ease infinite;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        @keyframes badge-shine {
            0%, 100% { transform: scale(1); box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); }
            50% { transform: scale(1.05); box-shadow: 0 6px 12px rgba(255, 215, 0, 0.4); }
        }

        .tools {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95), rgba(240, 248, 255, 0.95));
            padding: 20px;
            border-radius: 20px;
            display: flex;
            gap: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
            z-index: 100;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .tool {
            font-size: 45px;
            cursor: grab;
            padding: 15px;
            border-radius: 15px;
            background: linear-gradient(135deg, #F0F8FF, #E6F3FF);
            transition: all 0.4s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .tool:hover {
            transform: scale(1.15) translateY(-5px);
            background: linear-gradient(135deg, #E6F3FF, #D1E7FF);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
        }

        .tool::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .tool:hover::after {
            opacity: 1;
        }

        .basket {
            position: fixed;
            top: 20px;
            left: 20px;
            font-size: 70px;
            cursor: pointer;
            z-index: 100;
            transition: all 0.4s ease;
            filter: drop-shadow(4px 4px 8px rgba(0, 0, 0, 0.3));
        }

        .basket:hover {
            transform: scale(1.15) rotate(-5deg);
            animation: basket-bounce 0.6s ease;
        }

        @keyframes basket-bounce {
            0%, 100% { transform: scale(1.15) rotate(-5deg) translateY(0); }
            50% { transform: scale(1.15) rotate(-5deg) translateY(-10px); }
        }

        .particle {
            position: absolute;
            pointer-events: none;
            z-index: 15;
            font-size: 20px;
        }

        .water-particle {
            animation: water-fall 1.5s ease-out forwards;
        }

        .harvest-particle {
            animation: harvest-rise 2s ease-out forwards;
        }

        .sparkle-particle {
            animation: sparkle 1s ease-out forwards;
        }

        @keyframes water-fall {
            0% { transform: translateY(-30px) scale(1); opacity: 1; }
            100% { transform: translateY(120px) scale(0.5); opacity: 0; }
        }

        @keyframes harvest-rise {
            0% { transform: translateY(0) scale(1); opacity: 1; }
            100% { transform: translateY(-80px) scale(1.5); opacity: 0; }
        }

        @keyframes sparkle {
            0% { transform: scale(0) rotate(0deg); opacity: 1; }
            50% { transform: scale(1.2) rotate(180deg); opacity: 0.8; }
            100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }

        .weather-effect {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 12;
        }

        .rain-drop {
            position: absolute;
            width: 2px;
            height: 20px;
            background: linear-gradient(to bottom, transparent, #4FC3F7);
            animation: rain-fall 1s linear infinite;
        }

        @keyframes rain-fall {
            0% { transform: translateY(-100vh); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(100vh); opacity: 0; }
        }

        .season-spring { filter: hue-rotate(0deg) saturate(1.2); }
        .season-summer { filter: hue-rotate(30deg) saturate(1.4) brightness(1.1); }
        .season-autumn { filter: hue-rotate(60deg) saturate(1.1) brightness(0.9); }
        .season-winter { filter: hue-rotate(180deg) saturate(0.8) brightness(0.8); }

        .night {
            background: linear-gradient(135deg, #191970 0%, #483D8B 50%, #2F4F4F 100%);
        }

        .night .sky {
            background: linear-gradient(to bottom, #191970 0%, #483D8B 50%, #2F4F4F 100%);
        }

        .dragging {
            transform: scale(1.3) rotate(10deg);
            z-index: 1000;
            opacity: 0.9;
            filter: drop-shadow(0 0 20px rgba(255, 255, 0, 0.8));
        }

        .notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #FFD700, #FFA500);
            padding: 25px 35px;
            border-radius: 20px;
            font-size: 24px;
            font-weight: bold;
            z-index: 2000;
            animation: notification-popup 3s ease forwards;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 3px solid #FF8C00;
        }

        @keyframes notification-popup {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.3); }
            15% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            85% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        .combo-counter {
            position: fixed;
            top: 50%;
            right: 20px;
            background: linear-gradient(135deg, #FF6B6B, #FF8E53);
            color: white;
            padding: 15px 20px;
            border-radius: 15px;
            font-size: 20px;
            font-weight: bold;
            z-index: 150;
            transform: translateY(-50%) scale(0);
            transition: all 0.5s ease;
        }

        .combo-counter.active {
            transform: translateY(-50%) scale(1);
        }

        .help-btn {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .help-btn:hover {
            background: linear-gradient(135deg, #45a049, #4CAF50);
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
        }

        .weather-indicator {
            position: fixed;
            top: 100px;
            left: 20px;
            font-size: 40px;
            z-index: 100;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
        }

        .season-indicator {
            position: fixed;
            top: 150px;
            left: 20px;
            font-size: 30px;
            z-index: 100;
            filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.3));
        }

        @media (max-width: 768px) {
            .ui-panel { min-width: 200px; padding: 15px; }
            .tools { padding: 15px; gap: 15px; }
            .tool { font-size: 35px; padding: 10px; }
            .basket { font-size: 50px; }
            .garden-plot { width: 70px; height: 70px; }
        }
    </style>
</head>
<body>
    <div class="game-container" id="gameContainer">
        <div class="sky" id="sky">
            <div class="clouds"></div>
            <div class="weather-effect" id="weatherEffect"></div>
        </div>
        <div class="sun-moon" id="sunMoon">☀️</div>
        <div class="rooftop" id="rooftop"></div>
        
        <div class="ui-panel">
            <div class="score" id="score">🏆 <span>Score: 0</span></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="score" id="eggs">🥚 <span>Eggs: 0</span></div>
            <div class="score" id="vegetables">🥕 <span>Vegetables: 0</span></div>
            <div class="score" id="day">📅 <span>Day: 1</span></div>
            <div class="score" id="combo">🔥 <span>Combo: 0x</span></div>
            <div class="badges" id="badges"></div>
            <button class="help-btn" id="helpBtn">❓ Instructions</button>
        </div>

        <div class="weather-indicator" id="weatherIndicator">☀️</div>
        <div class="season-indicator" id="seasonIndicator">🌸</div>
        <div class="combo-counter" id="comboCounter">COMBO x0</div>
        <div class="basket" id="basket">🧺</div>

        <div class="tools">
            <div class="tool" id="seedTool" data-tooltip="Plant Seeds">🌱</div>
            <div class="tool" id="waterTool" data-tooltip="Water Plants">💧</div>
            <div class="tool" id="chickenTool" data-tooltip="Add Chickens">🐔</div>
            <div class="tool" id="fertilizerTool" data-tooltip="Fertilize">🌿</div>
        </div>
    </div>

    <script>
        class EnhancedRooftopGarden {
            constructor() {
                this.score = 0;
                this.eggs = 0;
                this.vegetables = 0;
                this.day = 1;
                this.isDay = true;
                this.season = 0; // 0: spring, 1: summer, 2: autumn, 3: winter
                this.weather = 'sunny'; // sunny, rainy, cloudy
                this.combo = 0;
                this.comboTimer = null;
                this.gameContainer = document.getElementById('gameContainer');
                this.rooftop = document.getElementById('rooftop');
                this.sky = document.getElementById('sky');
                this.sunMoon = document.getElementById('sunMoon');
                this.badges = [];
                this.plants = [];
                this.chickens = [];
                this.pests = [];
                this.plots = [];
                this.draggedElement = null;
                this.touchOffset = { x: 0, y: 0 };
                this.achievements = {
                    firstPlant: false,
                    firstEgg: false,
                    pestKiller: false,
                    gardener: false,
                    eggCollector: false,
                    harvester: false,
                    survivor: false,
                    master: false,
                    weatherMaster: false,
                    comboKing: false,
                    seasonSurvivor: false,
                    perfectGarden: false
                };

                this.init();
            }

            init() {
                this.createGardenPlots();
                this.startDayNightCycle();
                this.startWeatherSystem();
                this.startSeasonCycle();
                this.spawnFlyingCreatures();
                this.spawnPests();
                this.setupEventListeners();
                this.gameLoop();
                this.loadGame();
            }

            createGardenPlots() {
                for (let i = 0; i < 20; i++) {
                    const plot = document.createElement('div');
                    plot.className = 'garden-plot';
                    plot.style.left = `${60 + (i % 5) * 110}px`;
                    plot.style.bottom = `${60 + Math.floor(i / 5) * 100}px`;
                    this.rooftop.appendChild(plot);
                    this.plots.push(plot);
                }
            }

            setupEventListeners() {
                // Mouse and touch events
                this.gameContainer.addEventListener('mousedown', this.handleMouseDown.bind(this));
                this.gameContainer.addEventListener('mousemove', this.handleMouseMove.bind(this));
                this.gameContainer.addEventListener('mouseup', this.handleMouseUp.bind(this));
                this.gameContainer.addEventListener('touchstart', this.handleTouchStart.bind(this), { passive: false });
                this.gameContainer.addEventListener('touchmove', this.handleTouchMove.bind(this), { passive: false });
                this.gameContainer.addEventListener('touchend', this.handleTouchEnd.bind(this));

                // Tool interactions
                document.getElementById('waterTool').addEventListener('click', () => this.activateWaterTool());
                document.getElementById('fertilizerTool').addEventListener('click', () => this.activateFertilizer());
                document.getElementById('basket').addEventListener('click', () => this.collectItems());
                document.getElementById('helpBtn').addEventListener('click', () => this.showInstructions());
            }

            handleMouseDown(e) { this.startDrag(e, e.clientX, e.clientY); }
            handleMouseMove(e) { this.updateDrag(e.clientX, e.clientY); }
            handleMouseUp(e) { this.endDrag(e); }
            handleTouchStart(e) { e.preventDefault(); const touch = e.touches[0]; this.startDrag(e, touch.clientX, touch.clientY); }
            handleTouchMove(e) { e.preventDefault(); const touch = e.touches[0]; this.updateDrag(touch.clientX, touch.clientY); }
            handleTouchEnd(e) { this.endDrag(e); }

            startDrag(e, x, y) {
                const target = e.target;
                if (target.classList.contains('tool') || target.classList.contains('plant') || 
                    target.classList.contains('egg') || target.classList.contains('chicken')) {
                    this.draggedElement = target;
                    target.classList.add('dragging');
                    const rect = target.getBoundingClientRect();
                    this.touchOffset.x = x - rect.left;
                    this.touchOffset.y = y - rect.top;
                }
            }

            updateDrag(x, y) {
                if (this.draggedElement) {
                    this.draggedElement.style.position = 'fixed';
                    this.draggedElement.style.left = `${x - this.touchOffset.x}px`;
                    this.draggedElement.style.top = `${y - this.touchOffset.y}px`;
                    this.draggedElement.style.zIndex = '1000';
                }
            }

            endDrag(e) {
                if (this.draggedElement) {
                    const target = this.getDropTarget(e);
                    this.handleDrop(this.draggedElement, target);
                    this.draggedElement.classList.remove('dragging');
                    this.resetElementPosition(this.draggedElement);
                    this.draggedElement = null;
                }
            }

            getDropTarget(e) {
                const x = e.clientX || (e.changedTouches && e.changedTouches[0].clientX);
                const y = e.clientY || (e.changedTouches && e.changedTouches[0].clientY);
                return document.elementFromPoint(x, y);
            }

            resetElementPosition(element) {
                if (element.classList.contains('tool')) {
                    element.style.position = '';
                    element.style.left = '';
                    element.style.top = '';
                    element.style.zIndex = '';
                }
            }

            handleDrop(draggedElement, target) {
                if (!target) return;

                if (draggedElement.id === 'seedTool' && target.classList.contains('garden-plot')) {
                    this.plantSeed(target);
                } else if (draggedElement.id === 'chickenTool' && this.rooftop.contains(target)) {
                    this.placeChicken(target);
                } else if (draggedElement.classList.contains('egg') && target.id === 'basket') {
                    this.collectEgg(draggedElement);
                } else if (draggedElement.classList.contains('plant') && target.id === 'basket') {
                    this.harvestPlant(draggedElement);
                }
            }

            plantSeed(plot) {
                if (plot.querySelector('.plant')) return;

                const seeds = ['🌱', '🌿', '🥕', '🥬', '🍅', '🌶️', '🥒', '🌽', '🥔', '🧄'];
                const seed = seeds[Math.floor(Math.random() * seeds.length)];
                
                const plant = document.createElement('div');
                plant.className = 'plant stage-1';
                plant.textContent = seed;
                plant.style.left = '22px';
                plant.style.top = '22px';
                plant.dataset.growth = '1';
                plant.dataset.lastWatered = Date.now();
                plot.appendChild(plant);
                plot.classList.add('planted');
                
                this.plants.push(plant);
                this.updateScore(15);
                this.addCombo();
                this.createParticles(plot, '✨', 'sparkle-particle', 5);
                this.showNotification('🌱 Seed planted!');
                
                if (!this.achievements.firstPlant) {
                    this.achievements.firstPlant = true;
                    this.addBadge('🌱', 'First Plant');
                }
            }

            placeChicken(target) {
                const chicken = document.createElement('div');
                chicken.className = 'chicken';
                chicken.textContent = '🐔';
                chicken.style.left = `${Math.random() * (window.innerWidth - 100)}px`;
                chicken.style.bottom = `${Math.random() * 200 + 100}px`;
                chicken.addEventListener('click', () => this.chickenClicked(chicken));
                
                this.rooftop.appendChild(chicken);
                this.chickens.push(chicken);
                this.updateScore(25);
                this.addCombo();
                this.createParticles(chicken, '🎉', 'sparkle-particle', 3);
                this.showNotification('🐔 Chicken placed!');
            }

            chickenClicked(chicken) {
                if (Math.random() < 0.8) {
                    this.layEgg(chicken);
                }
            }

            layEgg(chicken) {
                const egg = document.createElement('div');
                egg.className = 'egg';
                egg.textContent = '🥚';
                egg.style.left = chicken.style.left;
                egg.style.bottom = chicken.style.bottom;
                
                this.rooftop.appendChild(egg);
                this.updateScore(20);
                this.addCombo();
                this.createParticles(chicken, '✨', 'sparkle-particle', 2);
                this.showNotification('🥚 Egg laid!');
                
                if (!this.achievements.firstEgg) {
                    this.achievements.firstEgg = true;
                    this.addBadge('🥚', 'First Egg');
                }
            }

            collectEgg(egg) {
                egg.remove();
                this.eggs++;
                this.updateScore(30);
                this.addCombo();
                this.createParticles(egg, '💰', 'harvest-particle', 3);
                this.updateUI();
                this.showNotification('🥚 Egg collected!');
                this.checkAchievements();
            }

            harvestPlant(plant) {
                const vegetables = ['🥕', '🥬', '🍅', '🌶️', '🥒', '🌽', '🥔', '🧄'];
                if (vegetables.includes(plant.textContent) && plant.dataset.growth >= 3) {
                    plant.remove();
                    plant.parentElement.classList.remove('planted');
                    this.vegetables++;
                    this.updateScore(40);
                    this.addCombo();
                    this.createParticles(plant.parentElement, '🎊', 'harvest-particle', 5);
                    this.updateUI();
                    this.showNotification('🥕 Vegetable harvested!');
                    this.checkAchievements();
                }
            }

            activateWaterTool() {
                let wateredCount = 0;
                this.plants.forEach(plant => {
                    if (Math.random() < 0.9) {
                        this.waterPlant(plant);
                        wateredCount++;
                    }
                });
                if (wateredCount > 0) {
                    this.addCombo();
                    this.showNotification(`💧 ${wateredCount} plants watered!`);
                }
            }

            waterPlant(plant) {
                this.createParticles(plant.parentElement, '💧', 'water-particle', 8);
                
                const growth = parseInt(plant.dataset.growth) + 1;
                plant.dataset.growth = growth;
                plant.dataset.lastWatered = Date.now();
                
                // Update plant appearance based on growth stage
                plant.className = `plant stage-${Math.min(growth, 4)}`;
                
                if (growth >= 3) {
                    const vegetables = ['🥕', '🥬', '🍅', '🌶️', '🥒', '🌽', '🥔', '🧄'];
                    plant.textContent = vegetables[Math.floor(Math.random() * vegetables.length)];
                }
            }

            activateFertilizer() {
                let fertilizedCount = 0;
                this.plants.forEach(plant => {
                    if (Math.random() < 0.7) {
                        const growth = parseInt(plant.dataset.growth) + 2;
                        plant.dataset.growth = growth;
                        plant.className = `plant stage-${Math.min(growth, 4)}`;
                        this.createParticles(plant.parentElement, '🌿', 'sparkle-particle', 4);
                        fertilizedCount++;
                    }
                });
                if (fertilizedCount > 0) {
                    this.addCombo();
                    this.showNotification(`🌿 ${fertilizedCount} plants fertilized!`);
                }
            }

            collectItems() {
                const eggs = document.querySelectorAll('.egg');
                const vegetables = document.querySelectorAll('.plant');
                let collected = 0;
                
                eggs.forEach(egg => {
                    if (Math.random() < 0.6) {
                        this.collectEgg(egg);
                        collected++;
                    }
                });

                vegetables.forEach(plant => {
                    const vegetables = ['🥕', '🥬', '🍅', '🌶️', '🥒', '🌽', '🥔', '🧄'];
                    if (vegetables.includes(plant.textContent) && plant.dataset.growth >= 3 && Math.random() < 0.4) {
                        this.harvestPlant(plant);
                        collected++;
                    }
                });

                if (collected > 0) {
                    this.showNotification(`🧺 Auto-collected ${collected} items!`);
                }
            }

            spawnPests() {
                setInterval(() => {
                    if (Math.random() < 0.4 && this.plants.length > 0) {
                        const pests = ['🐛', '🐜', '🦗', '🕷️', '🐝'];
                        const pest = document.createElement('div');
                        pest.className = 'pest';
                        pest.textContent = pests[Math.floor(Math.random() * pests.length)];
                        pest.style.left = `${Math.random() * (window.innerWidth - 50)}px`;
                        pest.style.bottom = `${Math.random() * 300 + 50}px`;
                        pest.addEventListener('click', () => this.removePest(pest));
                        
                        this.rooftop.appendChild(pest);
                        this.pests.push(pest);
                        
                        setTimeout(() => {
                            if (pest.parentElement) {
                                pest.remove();
                                // Damage random plant if pest not removed
                                if (this.plants.length > 0 && Math.random() < 0.3) {
                                    const randomPlant = this.plants[Math.floor(Math.random() * this.plants.length)];
                                    if (randomPlant && randomPlant.parentElement) {
                                        const growth = Math.max(1, parseInt(randomPlant.dataset.growth) - 1);
                                        randomPlant.dataset.growth = growth;
                                        randomPlant.className = `plant stage-${growth}`;
                                        this.createParticles(randomPlant.parentElement, '💥', 'sparkle-particle', 3);
                                    }
                                }
                            }
                        }, 12000);
                    }
                }, 6000);
            }

            removePest(pest) {
                pest.remove();
                this.updateScore(50);
                this.addCombo();
                this.createParticles(pest, '💥', 'sparkle-particle', 4);
                this.showNotification('🎯 Pest eliminated!');
                
                if (!this.achievements.pestKiller) {
                    this.achievements.pestKiller = true;
                    this.addBadge('🎯', 'Pest Killer');
                }
            }

            spawnFlyingCreatures() {
                const creatures = ['🦋', '🐝', '🐞', '🦅', '🕊️', '🐦'];
                
                setInterval(() => {
                    const creature = document.createElement('div');
                    creature.className = 'flying-creature';
                    creature.textContent = creatures[Math.floor(Math.random() * creatures.length)];
                    creature.style.left = '-50px';
                    creature.style.top = `${Math.random() * 300 + 50}px`;
                    creature.style.animation = `fly ${4 + Math.random() * 6}s linear forwards`;
                    
                    this.sky.appendChild(creature);
                    
                    setTimeout(() => creature.remove(), 12000);
                }, 3000);
            }

            startDayNightCycle() {
                setInterval(() => {
                    this.isDay = !this.isDay;
                    
                    if (this.isDay) {
                        this.sunMoon.textContent = '☀️';
                        document.body.classList.remove('night');
                        this.day++;
                    } else {
                        this.sunMoon.textContent = '🌙';
                        document.body.classList.add('night');
                    }
                    
                    this.sunMoon.style.left = this.isDay ? '15%' : '75%';
                    this.sunMoon.style.top = this.isDay ? '15%' : '25%';
                    
                    this.updateUI();
                    this.checkAchievements();
                    this.saveGame();
                }, 120000); // 2 minutes per day/night
            }

            startWeatherSystem() {
                setInterval(() => {
                    const weathers = ['sunny', 'rainy', 'cloudy'];
                    this.weather = weathers[Math.floor(Math.random() * weathers.length)];
                    
                    const weatherEffect = document.getElementById('weatherEffect');
                    const weatherIndicator = document.getElementById('weatherIndicator');
                    
                    weatherEffect.innerHTML = '';
                    
                    switch(this.weather) {
                        case 'rainy':
                            weatherIndicator.textContent = '🌧️';
                            this.createRain();
                            // Auto-water plants during rain
                            setTimeout(() => {
                                this.plants.forEach(plant => {
                                    if (Math.random() < 0.8) {
                                        this.waterPlant(plant);
                                    }
                                });
                            }, 2000);
                            break;
                        case 'cloudy':
                            weatherIndicator.textContent = '☁️';
                            break;
                        default:
                            weatherIndicator.textContent = '☀️';
                    }
                }, 90000); // Weather changes every 1.5 minutes
            }

            createRain() {
                const weatherEffect = document.getElementById('weatherEffect');
                for (let i = 0; i < 50; i++) {
                    setTimeout(() => {
                        const drop = document.createElement('div');
                        drop.className = 'rain-drop';
                        drop.style.left = `${Math.random() * 100}%`;
                        drop.style.animationDelay = `${Math.random() * 2}s`;
                        weatherEffect.appendChild(drop);
                        
                        setTimeout(() => drop.remove(), 3000);
                    }, i * 100);
                }
            }

            startSeasonCycle() {
                setInterval(() => {
                    this.season = (this.season + 1) % 4;
                    const seasons = ['🌸', '☀️', '🍂', '❄️'];
                    const seasonNames = ['spring', 'summer', 'autumn', 'winter'];
                    
                    document.getElementById('seasonIndicator').textContent = seasons[this.season];
                    document.body.className = `season-${seasonNames[this.season]}`;
                    
                    this.showNotification(`🌍 ${seasonNames[this.season].charAt(0).toUpperCase() + seasonNames[this.season].slice(1)} has arrived!`);
                }, 300000); // Season changes every 5 minutes
            }

            addCombo() {
                this.combo++;
                clearTimeout(this.comboTimer);
                
                const comboCounter = document.getElementById('comboCounter');
                comboCounter.textContent = `COMBO x${this.combo}`;
                comboCounter.classList.add('active');
                
                if (this.combo >= 5) {
                    this.updateScore(this.combo * 10);
                    this.createParticles(comboCounter, '🔥', 'sparkle-particle', this.combo);
                }
                
                this.comboTimer = setTimeout(() => {
                    this.combo = 0;
                    comboCounter.classList.remove('active');
                }, 5000);
                
                this.updateUI();
            }

            createParticles(element, emoji, className, count) {
                const rect = element.getBoundingClientRect();
                for (let i = 0; i < count; i++) {
                    setTimeout(() => {
                        const particle = document.createElement('div');
                        particle.className = `particle ${className}`;
                        particle.textContent = emoji;
                        particle.style.left = `${rect.left + Math.random() * rect.width}px`;
                        particle.style.top = `${rect.top + Math.random() * rect.height}px`;
                        document.body.appendChild(particle);
                        
                        setTimeout(() => particle.remove(), 2000);
                    }, i * 100);
                }
            }

            updateScore(points) {
                this.score += points * (1 + this.combo * 0.1);
                this.updateUI();
            }

            updateUI() {
                document.getElementById('score').querySelector('span').textContent = `Score: ${Math.floor(this.score)}`;
                document.getElementById('eggs').querySelector('span').textContent = `Eggs: ${this.eggs}`;
                document.getElementById('vegetables').querySelector('span').textContent = `Vegetables: ${this.vegetables}`;
                document.getElementById('day').querySelector('span').textContent = `Day: ${this.day}`;
                document.getElementById('combo').querySelector('span').textContent = `Combo: ${this.combo}x`;
                
                // Update progress bar
                const progress = Math.min(100, (this.score / 1000) * 100);
                document.getElementById('progressFill').style.width = `${progress}%`;
            }

            checkAchievements() {
                if (this.score >= 200 && !this.achievements.gardener) {
                    this.achievements.gardener = true;
                    this.addBadge('🌱', 'Gardener');
                }
                if (this.eggs >= 10 && !this.achievements.eggCollector) {
                    this.achievements.eggCollector = true;
                    this.addBadge('🥚', 'Egg Master');
                }
                if (this.vegetables >= 15 && !this.achievements.harvester) {
                    this.achievements.harvester = true;
                    this.addBadge('🥕', 'Harvester');
                }
                if (this.day >= 5 && !this.achievements.survivor) {
                    this.achievements.survivor = true;
                    this.addBadge('🏆', 'Survivor');
                }
                if (this.score >= 1000 && !this.achievements.master) {
                    this.achievements.master = true;
                    this.addBadge('👑', 'Garden Master');
                }
                if (this.combo >= 10 && !this.achievements.comboKing) {
                    this.achievements.comboKing = true;
                    this.addBadge('🔥', 'Combo King');
                }
            }

            addBadge(emoji, title) {
                const badge = document.createElement('div');
                badge.className = 'badge';
                badge.textContent = emoji;
                badge.title = title;
                document.getElementById('badges').appendChild(badge);
                this.badges.push({ emoji, title });
                this.showNotification(`🎉 Achievement: ${title}!`);
            }

            showNotification(message) {
                const notification = document.createElement('div');
                notification.className = 'notification';
                notification.textContent = message;
                document.body.appendChild(notification);
                
                setTimeout(() => notification.remove(), 3000);
            }

            showInstructions() {
                const modal = document.createElement('div');
                modal.style.cssText = `
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: rgba(0, 0, 0, 0.8);
                    z-index: 3000;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                `;
                
                const content = document.createElement('div');
                content.style.cssText = `
                    background: linear-gradient(135deg, #fff, #f0f8ff);
                    padding: 30px;
                    border-radius: 20px;
                    max-width: 500px;
                    max-height: 80vh;
                    overflow-y: auto;
                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
                    position: relative;
                `;
                
                content.innerHTML = `
                    <button style="position: absolute; top: 15px; right: 15px; background: #ff4444; color: white; border: none; padding: 8px 12px; border-radius: 50%; cursor: pointer; font-size: 16px;" onclick="this.closest('.modal').remove()">✖️</button>
                    <h2 style="color: #2E8B57; margin-bottom: 20px; text-align: center;">🌱 How to Play 🌱</h2>
                    <div style="font-size: 14px; line-height: 1.6;">
                        <p><strong>🎯 Goal:</strong> Build the ultimate rooftop garden!</p>
                        <br>
                        <p><strong>🔧 Controls:</strong></p>
                        <p>• Drag 🌱 to brown plots to plant</p>
                        <p>• Click 💧 to water all plants</p>
                        <p>• Drag 🐔 to add chickens</p>
                        <p>• Click 🌿 to fertilize plants</p>
                        <p>• Drag items to 🧺 to collect</p>
                        <br>
                        <p><strong>🏆 Points:</strong></p>
                        <p>• Plant: +15 • Eggs: +30 • Harvest: +40 • Kill pests: +50</p>
                        <br>
                        <p><strong>💡 Tips:</strong></p>
                        <p>• Water plants regularly • Remove pests quickly • Build combos!</p>
                    </div>
                `;
                
                modal.className = 'modal';
                modal.appendChild(content);
                document.body.appendChild(modal);
                
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) modal.remove();
                });
            }

            saveGame() {
                const gameState = {
                    score: this.score,
                    eggs: this.eggs,
                    vegetables: this.vegetables,
                    day: this.day,
                    achievements: this.achievements,
                    badges: this.badges
                };
                localStorage.setItem('rooftopGarden', JSON.stringify(gameState));
            }

            loadGame() {
                const saved = localStorage.getItem('rooftopGarden');
                if (saved) {
                    const gameState = JSON.parse(saved);
                    this.score = gameState.score || 0;
                    this.eggs = gameState.eggs || 0;
                    this.vegetables = gameState.vegetables || 0;
                    this.day = gameState.day || 1;
                    this.achievements = { ...this.achievements, ...gameState.achievements };
                    
                    if (gameState.badges) {
                        gameState.badges.forEach(badge => {
                            const badgeElement = document.createElement('div');
                            badgeElement.className = 'badge';
                            badgeElement.textContent = badge.emoji;
                            badgeElement.title = badge.title;
                            document.getElementById('badges').appendChild(badgeElement);
                        });
                        this.badges = gameState.badges;
                    }
                    
                    this.updateUI();
                }
            }

            gameLoop() {
                // Animate chickens
                this.chickens.forEach(chicken => {
                    if (Math.random() < 0.15) {
                        const newLeft = Math.max(50, Math.min(window.innerWidth - 100, 
                            parseInt(chicken.style.left) + (Math.random() - 0.5) * 120));
                        chicken.style.left = `${newLeft}px`;
                    }
                    
                    // Random egg laying
                    if (Math.random() < 0.03) {
                        this.layEgg(chicken);
                    }
                });

                // Plant growth over time
                this.plants.forEach(plant => {
                    const lastWatered = parseInt(plant.dataset.lastWatered);
                    const timeSinceWatered = Date.now() - lastWatered;
                    
                    // Slow natural growth
                    if (timeSinceWatered > 60000 && Math.random() < 0.02) { // 1 minute
                        const growth = Math.min(4, parseInt(plant.dataset.growth) + 1);
                        plant.dataset.growth = growth;
                        plant.className = `plant stage-${growth}`;
                        
                        if (growth >= 3) {
                            const vegetables = ['🥕', '🥬', '🍅', '🌶️', '🥒', '🌽', '🥔', '🧄'];
                            plant.textContent = vegetables[Math.floor(Math.random() * vegetables.length)];
                        }
                    }
                });

                setTimeout(() => this.gameLoop(), 2000);
            }
        }

        // Start the enhanced game
        window.addEventListener('load', () => {
            new EnhancedRooftopGarden();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9761af43222beb2e',t:'MTc1NjM2MTgzNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
