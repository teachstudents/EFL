<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ESL Fun Park!</title>
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Tone.js for Sound -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.min.js"></script>
    
    <!-- 3. Google Font (Mali for a fun, handwritten look) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Mali:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- 4. Custom Styles -->
    <style>
        /* Apply the fun font */
        body {
            font-family: 'Mali', sans-serif;
            background: linear-gradient(135deg, #ffdde1, #ee9ca7);
            /* A soft, happy pink gradient */
        }

        /* Fun, bubbly buttons */
        .btn {
            @apply px-4 py-2 md:px-6 md:py-3 rounded-full text-white font-bold shadow-lg transform transition-all duration-200 ease-in-out;
        }
        .btn-blue {
            @apply bg-blue-500 hover:bg-blue-600 active:scale-95;
        }
        .btn-pink {
            @apply bg-pink-500 hover:bg-pink-600 active:scale-95;
        }
        .btn-green {
            @apply bg-green-500 hover:bg-green-600 active:scale-95;
        }
        .btn-purple {
            @apply bg-purple-500 hover:bg-purple-600 active:scale-95;
        }
        .btn-yellow {
            @apply bg-yellow-400 hover:bg-yellow-500 text-gray-800 active:scale-95;
        }
        .btn-teal {
            @apply bg-teal-500 hover:bg-teal-600 active:scale-95;
        }
        .btn-indigo {
            @apply bg-indigo-500 hover:bg-indigo-600 active:scale-95;
        }
        
        /* The main content card */
        .card {
            @apply bg-white bg-opacity-90 backdrop-blur-sm rounded-3xl shadow-2xl p-6 my-4 transition-all duration-500;
        }

        /* Style for the praise modal */
        #praise-modal {
            @apply hidden fixed top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 bg-gradient-to-r from-yellow-400 to-orange-500 text-white text-5xl font-bold p-12 rounded-3xl shadow-2xl z-50 transition-all duration-300 ease-in-out;
            animation: praise-anim 1.5s ease-in-out;
        }
        
        @keyframes praise-anim {
            0% { transform: scale(0.5) translate(-100%, -100%) rotate(-15deg); opacity: 0; }
            50% { transform: scale(1.1) translate(-45%, -45%) rotate(5deg); opacity: 1; }
            100% { transform: scale(1) translate(-50%, -50%) rotate(0deg); opacity: 1; }
        }

        /* Sparkle container */
        #sparkle-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            overflow: hidden;
        }

        /* Individual sparkle */
        .sparkle {
            position: absolute;
            background: gold;
            border-radius: 50%;
            opacity: 0;
            animation: sparkle-anim 1s forwards;
            box-shadow: 0 0 10px gold, 0 0 5px yellow;
        }

        @keyframes sparkle-anim {
            0% {
                opacity: 1;
                transform: scale(0.1);
            }
            100% {
                opacity: 0;
                transform: scale(1.5) translate(var(--tx), var(--ty)) rotate(360deg);
            }
        }
        
        /* TTS Styles */
        .tts-word {
            @apply text-blue-600 font-bold underline cursor-pointer hover:text-blue-800 transition-colors;
        }
        .tts-icon {
            @apply inline-block ml-1 text-lg text-gray-400 cursor-pointer hover:text-blue-500 transition-colors;
        }
        .tts-button {
            @apply btn btn-blue text-lg flex items-center justify-center gap-2;
        }
        .tts-practice {
            @apply font-semibold text-gray-700 cursor-pointer hover:bg-blue-50 p-2 rounded-lg transition-colors;
        }

    </style>
</head>

<body class="bg-gray-100 min-h-screen p-4 md:p-8">

    <!-- Sparkle and Praise containers -->
    <div id="sparkle-container"></div>
    <div id="praise-modal">Wow! âœ¨</div>

    <!-- Main Content Area -->
    <div class="max-w-4xl mx-auto">

        <!-- Header -->
        <header class="bg-white rounded-2xl shadow-xl p-4 flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0">
            <h1 class="text-2xl md:text-4xl font-bold text-pink-600">
                ğŸŒ³ Danny's ESL Fun Park! ğŸŒ³
            </h1>
            <div class="flex items-center space-x-4">
                <span class="text-2xl font-bold text-yellow-500">
                    Points: <span id="score" class="text-yellow-600">0</span> âœ¨
                </span>
                <button id="praise-button" class="btn btn-yellow text-xl active:animate-ping">
                    Get Points! ğŸŒŸ
                </button>
            </div>
        </header>

        <!-- Game Mode Navigation -->
        <nav class="flex flex-wrap justify-center gap-2 md:gap-3 my-6">
            <button onclick="showMode('unit1')" class="btn btn-blue text-md md:text-lg">Family ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</button>
            <button onclick="showMode('unit2')" class="btn btn-pink text-md md:text-lg">Friends ğŸ¥°</button>
            <button onclick="showMode('reading1')" class="btn btn-teal text-md md:text-lg">Read: Charlie ğŸ§â€â™‚ï¸</button>
            <button onclick="showMode('reading2')" class="btn btn-teal text-md md:text-lg">Read: Batty ğŸ§â€â™€ï¸</button>
            <button onclick="showMode('reading3')" class="btn btn-indigo text-md md:text-lg">Read: Grandpa ğŸ‘´</button>
            <button onclick="showMode('reading4')" class="btn btn-indigo text-md md:text-lg">Read: Grandma ğŸ‘µ</button>
            <button onclick="showMode('reading5')" class="btn btn-purple text-md md:text-lg">Read: Father ğŸ‘¨</button>
            <button onclick="showMode('reading6')" class="btn btn-purple text-md md:text-lg">Read: Sister ğŸ‘§</button>
            <button onclick="showMode('game')" class="btn btn-green text-md md:text-lg">Game ğŸ®</button>
        </nav>

        <!-- Main Content Wrapper -->
        <main>

            <!-- ======================= -->
            <!-- UNIT 1: FAMILY          -->
            <!-- ======================= -->
            <div id="unit1" class="mode-content space-y-6">
                
                <!-- Part 1: Learn the Words -->
                <div class="card">
                    <h2 class="text-3xl font-bold text-center text-blue-700 mb-4">
                        Part 1: Learn the Words ğŸ¢ (Very Slow)
                    </h2>
                    <p class="text-center text-xl text-gray-600 mb-6">Click the word to listen! ğŸ‘‚</p>
                    
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4 text-center">
                        <div onclick="speak('Father', 'Brian')" class="bg-blue-100 p-4 rounded-2xl shadow-md cursor-pointer hover:shadow-lg transition-shadow">
                            <span class="text-6xl">ğŸ‘¨</span>
                            <p class="text-3xl font-semibold text-blue-800">Father</p>
                        </div>
                        <div onclick="speak('Mother', 'Ava')" class="bg-pink-100 p-4 rounded-2xl shadow-md cursor-pointer hover:shadow-lg transition-shadow">
                            <span class="text-6xl">ğŸ‘©</span>
                            <p class="text-3xl font-semibold text-pink-800">Mother</p>
                        </div>
                        <div onclick="speak('Brother', 'Andrew')" class="bg-green-100 p-4 rounded-2xl shadow-md cursor-pointer hover:shadow-lg transition-shadow">
                            <span class="text-6xl">ğŸ‘¦</span>
                            <p class="text-3xl font-semibold text-green-800">Brother</p>
                        </div>
                        <div onclick="speak('Sister', 'Emma')" class="bg-yellow-100 p-4 rounded-2xl shadow-md cursor-pointer hover:shadow-lg transition-shadow">
                            <span class="text-6xl">ğŸ‘§</span>
                            <p class="text-3xl font-semibold text-yellow-800">Sister</p>
                        </div>
                        <div onclick="speak('Grandfather', 'Brian')" class="bg-gray-100 p-4 rounded-2xl shadow-md cursor-pointer hover:shadow-lg transition-shadow">
                            <span class="text-6xl">ğŸ‘´</span>
                            <p class="text-3xl font-semibold text-gray-800">Grandfather</p>
                        </div>
                        <div onclick="speak('Grandmother', 'Ava')" class="bg-purple-100 p-4 rounded-2xl shadow-md cursor-pointer hover:shadow-lg transition-shadow">
                            <span class="text-6xl">ğŸ‘µ</span>
                            <p class="text-3xl font-semibold text-purple-800">Grandmother</p>
                        </div>
                    </div>
                </div>

                <!-- Part 2: Slow Practice - Who is this? -->
                <div class="card">
                    <h2 class="text-3xl font-bold text-center text-blue-700 mb-4">
                        Part 2: Slow Practice ğŸ¢ ... Click to Say ğŸ—£ï¸
                    </h2>
                    <div class="space-y-4 text-3xl p-4">
                        <p onclick="speak(`Who's he? He's my father.`, 'Andrew')" class="tts-practice">
                            Who's ... he? ğŸ¤” ... He's my <span class="text-blue-600 font-bold">father</span>. ğŸ‘¨ <span class="tts-icon">ğŸ”ˆ</span>
                        </p>
                        <hr>
                        <p onclick="speak(`Who's she? She's my mother.`, 'Emma')" class="tts-practice">
                            Who's ... she? ğŸ¤” ... She's my <span class="text-pink-600 font-bold">mother</span>. ğŸ‘© <span class="tts-icon">ğŸ”ˆ</span>
                        </p>
                        <hr>
                        <p onclick="speak(`Who's he? He's my brother.`, 'Andrew')" class="tts-practice">
                            Who's ... he? ğŸ¤” ... He's my <span class="text-green-600 font-bold">brother</span>. ğŸ‘¦ <span class="tts-icon">ğŸ”ˆ</span>
                        </p>
                        <hr>
                        <p onclick="speak(`Who's she? She's my sister.`, 'Emma')" class="tts-practice">
                            Who's ... she? ğŸ¤” ... She's my <span class="text-yellow-600 font-bold">sister</span>. ğŸ‘§ <span class="tts-icon">ğŸ”ˆ</span>
                        </p>
                    </div>
                </div>

                <!-- Part 3: Slow Practice - How many? -->
                <div class="card">
                    <h2 class="text-3xl font-bold text-center text-blue-700 mb-4">
                        Part 3: Slow Practice ğŸ¢ ... How Many? ğŸ–ï¸
                    </h2>
                    <div class="space-y-4 text-3xl p-4">
                        <p onclick="speak('How many people are there?', 'Ava')" class="tts-practice">
                            How... many... people... are... there? ğŸ¤” <span class="tts-icon">ğŸ”ˆ</span>
                        </p>
                        <p class="text-center text-6xl my-4">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§</p>
                        <p onclick="speak('There are three people.', 'Ava')" class="tts-practice">
                            There... are... <span class="text-purple-600 font-bold">three</span>... people. 3ï¸âƒ£ <span class="tts-icon">ğŸ”ˆ</span>
                        </p>
                        <hr>
                        <p class="text-center text-6xl my-4">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</p>
                        <p onclick="speak('There are four people.', 'Ava')" class="tts-practice">
                            There... are... <span class="text-purple-600 font-bold">four</span>... people. 4ï¸âƒ£ <span class="tts-icon">ğŸ”ˆ</span>
                        </p>
                    </div>
                </div>

            </div> <!-- End Unit 1 -->

            <!-- ======================= -->
            <!-- UNIT 2: FRIENDS         -->
            <!-- ======================= -->
            <div id="unit2" class="mode-content hidden space-y-6">
                
                <!-- Part 1: Learn the Words -->
                <div class="card">
                    <h2 class="text-3xl font-bold text-center text-pink-700 mb-4">
                        Part 1: Learn the Words ğŸ¢ (Very Slow)
                    </h2>
                    <p class="text-center text-xl text-gray-600 mb-6">Click the word to listen! ğŸ‘‚</p>
                    
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                        <div onclick="speak('Tall', 'Brian')" class="bg-blue-100 p-4 rounded-2xl shadow-md cursor-pointer hover:shadow-lg transition-shadow">
                            <span class="text-6xl">ğŸ“</span>
                            <p class="text-3xl font-semibold text-blue-800">Tall</p>
                        </div>
                        <div onclick="speak('Short', 'Emma')" class="bg-yellow-100 p-4 rounded-2xl shadow-md cursor-pointer hover:shadow-lg transition-shadow">
                            <span class="text-6xl">ğŸ¤</span>
                            <p class="text-3xl font-semibold text-yellow-800">Short</p>
                        </div>
                        <div onclick="speak('Long Hair', 'Ava')" class="bg-purple-100 p-4 rounded-2xl shadow-md cursor-pointer hover:shadow-lg transition-shadow">
                            <span class="text-6xl">ğŸ‘©â€ğŸ¦±</span>
                            <p class="text-3xl font-semibold text-purple-800">Long Hair</p>
                        </div>
                        <div onclick="speak('Short Hair', 'Andrew')" class="bg-green-100 p-4 rounded-2xl shadow-md cursor-pointer hover:shadow-lg transition-shadow">
                            <span class="text-6xl">ğŸ’‡â€â™‚ï¸</span>
                            <p class="text-3xl font-semibold text-green-800">Short Hair</p>
                        </div>
                    </div>
                </div>

                <!-- Part 2: Slow Practice - He is / She is -->
                <div class="card">
                    <h2 class="text-3xl font-bold text-center text-pink-700 mb-4">
                        Part 2: Slow Practice ğŸ¢ ... He is / She is ğŸ™‹â€â™€ï¸ğŸ™‹â€â™‚ï¸
                    </h2>
                    <div class="space-y-4 text-3xl p-4">
                        <p onclick="speak('Look! He is tall.', 'Brian')" class="tts-practice">
                            Look! ğŸ‘€ ... He is... <span class="text-blue-600 font-bold">tall</span>. ğŸ“ <span class="tts-icon">ğŸ”ˆ</span>
                        </p>
                        <hr>
                        <p onclick="speak('Look! She is short.', 'Emma')" class="tts-practice">
                            Look! ğŸ‘€ ... She is... <span class="text-yellow-600 font-bold">short</span>. ğŸ¤ <span class="tts-icon">ğŸ”ˆ</span>
                        </p>
                    </div>
                </div>
                
                <!-- Part 3: Slow Practice - He has / She has -->
                <div class="card">
                    <h2 class="text-3xl font-bold text-center text-pink-700 mb-4">
                        Part 3: Slow Practice ğŸ¢ ... He has / She has ğŸ‘±â€â™€ï¸ğŸ‘±â€â™‚ï¸
                    </h2>
                    <div class="space-y-4 text-3xl p-4">
                        <p onclick="speak('Look! He has short hair.', 'Andrew')" class="tts-practice">
                            Look! ğŸ‘€ ... He has... <span class="text-green-600 font-bold">short hair</span>. ğŸ’‡â€â™‚ï¸ <span class="tts-icon">ğŸ”ˆ</span>
                        </p>
                        <hr>
                        <p onclick="speak('Look! She has long hair.', 'Ava')" class="tts-practice">
                            Look! ğŸ‘€ ... She has... <span class="text-purple-600 font-bold">long hair</span>. ğŸ‘©â€ğŸ¦± <span class="tts-icon">ğŸ”ˆ</span>
                        </p>
                    </div>
                </div>

            </div> <!-- End Unit 2 -->

            <!-- ======================= -->
            <!-- READING 1: Charlie      -->
            <!-- ======================= -->
            <div id="reading1" class="mode-content hidden space-y-6">
                <div class="card">
                    <h2 class="text-3xl font-bold text-center text-teal-700 mb-6">
                        Reading: Charlie ğŸ§â€â™‚ï¸
                    </h2>
                    <button id="read-charlie" class="tts-button mx-auto mb-6">
                        Play Full Reading <span class="text-2xl">ğŸ”ˆ</span>
                    </button>
                    <p class="text-2xl md:text-3xl leading-relaxed text-gray-800">
                        Charlie is my best <span class="tts-word" onclick="speak('friend', 'Ava')">friend</span>. He's not <span class="tts-word" onclick="speak('tall', 'Brian')">tall</span> and not <span class="tts-word" onclick="speak('short', 'Brian')">short</span>. He has two big black <span class="tts-word" onclick="speak('eyes', 'Ava')">eyes</span>. He has <span class="tts-word" onclick="speak('short brown hair', 'Brian')">short brown hair</span>. And he has a red T-shirt, blue shorts, blue shoes, yellow socks and a blue cap. He's very <span class="tts-word" onclick="speak('smart', 'Ava')">smart</span> and <span class="tts-word" onclick="speak('lovely', 'Ava')">lovely</span>.
                    </p>
                    
                    <!-- NEW QUESTIONS SECTION -->
                    <div class="mt-6 border-t-2 border-teal-200 pt-4">
                        <h3 class="text-2xl font-bold text-center text-teal-800 mb-4">Let's Check! ğŸ¤”</h3>
                        <ul class="space-y-3 text-2xl text-gray-700">
                            <li class="tts-practice" onclick="speak('Is Charlie tall?', 'Ava')">
                                1. Is Charlie tall? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                            <li class="tts-practice" onclick="speak('Does he have long hair?', 'Andrew')">
                                2. Does he have long hair? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                            <li class="tts-practice" onclick="speak('Is he smart and lovely?', 'Ava')">
                                3. Is he smart and lovely? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                        </ul>
                    </div>
                    <!-- END NEW QUESTIONS SECTION -->

                </div>
            </div>

            <!-- ======================= -->
            <!-- READING 2: Batty        -->
            <!-- ======================= -->
            <div id="reading2" class="mode-content hidden space-y-6">
                <div class="card">
                    <h2 class="text-3xl font-bold text-center text-teal-700 mb-6">
                        Reading: Batty ğŸ§â€â™€ï¸
                    </h2>
                    <button id="read-batty" class="tts-button mx-auto mb-6">
                        Play Full Reading <span class="text-2xl">ğŸ”ˆ</span>
                    </button>
                    <p class="text-2xl md:text-3xl leading-relaxed text-gray-800">
                        Batty is my best <span class="tts-word" onclick="speak('friend', 'Emma')">friend</span>. She's not <span class="tts-word" onclick="speak('tall', 'Emma')">tall</span> and not <span class="tts-word" onclick="speak('short', 'Emma')">short</span>. She has two big <span class="tts-word" onclick="speak('eyes', 'Emma')">eyes</span>. She has <span class="tts-word" onclick="speak('long red hair', 'Emma')">long red hair</span>. And she has a pink dress, pink shoes and yellow socks. She's very <span class="tts-word" onclick="speak('pretty', 'Emma')">pretty</span>.
                    </p>

                    <!-- NEW QUESTIONS SECTION -->
                    <div class="mt-6 border-t-2 border-teal-200 pt-4">
                        <h3 class="text-2xl font-bold text-center text-teal-800 mb-4">Let's Check! ğŸ¤”</h3>
                        <ul class="space-y-3 text-2xl text-gray-700">
                            <li class="tts-practice" onclick="speak('Is Batty very tall?', 'Emma')">
                                1. Is Batty very tall? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                            <li class="tts-practice" onclick="speak('Does she have long hair?', 'Emma')">
                                2. Does she have long hair? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                            <li class="tts-practice" onclick="speak('Is she pretty?', 'Emma')">
                                3. Is she pretty? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                        </ul>
                    </div>
                    <!-- END NEW QUESTIONS SECTION -->

                </div>
            </div>

            <!-- ======================= -->
            <!-- READING 3: Grandpa      -->
            <!-- ======================= -->
            <div id="reading3" class="mode-content hidden space-y-6">
                <div class="card">
                    <h2 class="text-3xl font-bold text-center text-indigo-700 mb-6">
                        Reading: Grandpa ğŸ‘´
                    </h2>
                    <button id="read-grandpa" class="tts-button mx-auto mb-6">
                        Play Full Reading <span class="text-2xl">ğŸ”ˆ</span>
                    </button>
                    <p class="text-2xl md:text-3xl leading-relaxed text-gray-800">
                        Mr. Bush is my <span class="tts-word" onclick="speak('grandpa', 'Brian')">grandpa</span>. He is very <span class="tts-word" onclick="speak('old', 'Brian')">old</span>. He has two <span class="tts-word" onclick="speak('small eyes', 'Brian')">small eyes</span>. He has <span class="tts-word" onclick="speak('short grey hair', 'Brian')">short grey hair</span>. He has a purple coat, white pants and purple shoes. He is very, very <span class="tts-word" onclick="speak('humorous', 'Brian')">humorous</span>.
                    </p>

                    <!-- NEW QUESTIONS SECTION -->
                    <div class="mt-6 border-t-2 border-indigo-200 pt-4">
                        <h3 class="text-2xl font-bold text-center text-indigo-800 mb-4">Let's Check! ğŸ¤”</h3>
                        <ul class="space-y-3 text-2xl text-gray-700">
                            <li class="tts-practice" onclick="speak('Is Mister Bush young?', 'Brian')">
                                1. Is Mr. Bush young? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                            <li class="tts-practice" onclick="speak('Does he have big eyes?', 'Brian')">
                                2. Does he have big eyes? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                            <li class="tts-practice" onclick="speak('Is he humorous?', 'Brian')">
                                3. Is he humorous? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                        </ul>
                    </div>
                    <!-- END NEW QUESTIONS SECTION -->

                </div>
            </div>
            
            <!-- ======================= -->
            <!-- READING 4: Grandma      -->
            <!-- ======================= -->
            <div id="reading4" class="mode-content hidden space-y-6">
                <div class="card">
                    <h2 class="text-3xl font-bold text-center text-indigo-700 mb-6">
                        Reading: Grandma ğŸ‘µ
                    </h2>
                    <button id="read-grandma" class="tts-button mx-auto mb-6">
                        Play Full Reading <span class="text-2xl">ğŸ”ˆ</span>
                    </button>
                    <p class="text-2xl md:text-3xl leading-relaxed text-gray-800">
                        Mrs. Bush is my <span class="tts-word" onclick="speak('grandma', 'Ava')">grandma</span>. She is very <span class="tts-word" onclick="speak('old', 'Ava')">old</span>, too. She has two <span class="tts-word" onclick="speak('small eyes', 'Ava')">small eyes</span>. She has <span class="tts-word" onclick="speak('short grey hair', 'Ava')">short grey hair</span>. She has a brown coat, a brown dress and brown shoes. She is very, very <span class="tts-word" onclick="speak('kind', 'Ava')">kind</span>.
                    </p>

                    <!-- NEW QUESTIONS SECTION -->
                    <div class="mt-6 border-t-2 border-indigo-200 pt-4">
                        <h3 class="text-2xl font-bold text-center text-indigo-800 mb-4">Let's Check! ğŸ¤”</h3>
                        <ul class="space-y-3 text-2xl text-gray-700">
                            <li class="tts-practice" onclick="speak('Is Misses Bush old?', 'Ava')">
                                1. Is Mrs. Bush old? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                            <li class="tts-practice" onclick="speak('Does she have long hair?', 'Ava')">
                                2. Does she have long hair? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                            <li class="tts-practice" onclick="speak('Is she kind?', 'Ava')">
                                3. Is she kind? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                        </ul>
                    </div>
                    <!-- END NEW QUESTIONS SECTION -->

                </div>
            </div>
            
            <!-- ======================= -->
            <!-- READING 5: Father       -->
            <!-- ======================= -->
            <div id="reading5" class="mode-content hidden space-y-6">
                <div class="card">
                    <h2 class="text-3xl font-bold text-center text-purple-700 mb-6">
                        Reading: Father ğŸ‘¨
                    </h2>
                    <button id="read-father" class="tts-button mx-auto mb-6">
                        Play Full Reading <span class="text-2xl">ğŸ”ˆ</span>
                    </button>
                    <p class="text-2xl md:text-3xl leading-relaxed text-gray-800">
                        Harry is my <span class="tts-word" onclick="speak('father', 'Andrew')">father</span>. He's very <span class="tts-word" onclick="speak('tall', 'Andrew')">tall</span>. He has two big <span class="tts-word" onclick="speak('eyes', 'Andrew')">eyes</span>. He has <span class="tts-word" onclick="speak('short black hair', 'Andrew')">short black hair</span>. And he has a white shirt, blue tie, black belt, grey pants and a pair of black shoes. He's very, very <span class="tts-word" onclick="speak('handsome', 'Andrew')">handsome</span>.
                    </p>

                    <!-- NEW QUESTIONS SECTION -->
                    <div class="mt-6 border-t-2 border-purple-200 pt-4">
                        <h3 class="text-2xl font-bold text-center text-purple-800 mb-4">Let's Check! ğŸ¤”</h3>
                        <ul class="space-y-3 text-2xl text-gray-700">
                            <li class="tts-practice" onclick="speak('Is Harry short?', 'Andrew')">
                                1. Is Harry short? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                            <li class="tts-practice" onclick="speak('Does he have short hair?', 'Andrew')">
                                2. Does he have short hair? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                            <li class="tts-practice" onclick="speak('Is he handsome?', 'Andrew')">
                                3. Is he handsome? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                        </ul>
                    </div>
                    <!-- END NEW QUESTIONS SECTION -->

                </div>
            </div>
            
            <!-- ======================= -->
            <!-- READING 6: Sister       -->
            <!-- ======================= -->
            <div id="reading6" class="mode-content hidden space-y-6">
                <div class="card">
                    <h2 class="text-3xl font-bold text-center text-purple-700 mb-6">
                        Reading: Sister ğŸ‘§
                    </h2>
                    <button id="read-sister" class="tts-button mx-auto mb-6">
                        Play Full Reading <span class="text-2xl">ğŸ”ˆ</span>
                    </button>
                    <p class="text-2xl md:text-3xl leading-relaxed text-gray-800">
                        Jessica is my younger <span class="tts-word" onclick="speak('sister', 'Emma')">sister</span>. She's not very <span class="tts-word" onclick="speak('tall', 'Emma')">tall</span>. She has <span class="tts-word" onclick="speak('blond hair', 'Emma')">blond hair</span>. She has two big <span class="tts-word" onclick="speak('eyes', 'Emma')">eyes</span>, a big nose, and a big mouth. And she has a red down coat, a white hat, blue jeans and a pair of black boots. She's very <span class="tts-word" onclick="speak('pretty', 'Emma')">pretty</span>.
                    </p>

                    <!-- NEW QUESTIONS SECTION -->
                    <div class="mt-6 border-t-2 border-purple-200 pt-4">
                        <h3 class="text-2xl font-bold text-center text-purple-800 mb-4">Let's Check! ğŸ¤”</h3>
                        <ul class="space-y-3 text-2xl text-gray-700">
                            <li class="tts-practice" onclick="speak('Is Jessica very tall?', 'Emma')">
                                1. Is Jessica very tall? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                            <li class="tts-practice" onclick="speak('Does she have blond hair?', 'Emma')">
                                2. Does she have blond hair? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                            <li class="tts-practice" onclick="speak('Is she pretty?', 'Emma')">
                                3. Is she pretty? <span class="tts-icon">ğŸ”ˆ</span>
                            </li>
                        </ul>
                    </div>
                    <!-- END NEW QUESTIONS SECTION -->

                </div>
            </div>


            <!-- ======================= -->
            <!-- GAME MODE               -->
            <!-- ======================= -->
            <div id="game" class="mode-content hidden space-y-6">
                <div class="card">
                    <h2 class="text-3xl font-bold text-center text-green-700 mb-6">
                        Game Time! ğŸ® Click the right answer!
                    </h2>
                    
                    <!-- Question 1 -->
                    <div class="card bg-gray-50 border border-gray-200">
                        <p class="text-3xl font-bold text-center text-gray-800 mb-4">
                            Question 1: Who is he? ğŸ¤” <span class="tts-icon" onclick="speak('Who is he?', 'Andrew')">ğŸ”ˆ</span>
                        </p>
                        <p class="text-8xl text-center mb-4">ğŸ‘¨</p>
                        <div class="flex flex-wrap justify-center gap-4" id="q1-buttons">
                            <button onclick="checkQuizAnswer(this, false, 'q1-buttons')" class="btn btn-purple text-2xl">Sister</button>
                            <button onclick="checkQuizAnswer(this, true, 'q1-buttons')" class="btn btn-blue text-2xl">Father</button>
                            <button onclick="checkQuizAnswer(this, false, 'q1-buttons')" class="btn btn-purple text-2xl">Mother</button>
                        </div>
                        <p id="q1-feedback" class="text-center text-2xl font-bold mt-4"></p>
                    </div>
                    
                    <!-- Question 2 -->
                    <div class="card bg-gray-50 border border-gray-200">
                        <p class="text-3xl font-bold text-center text-gray-800 mb-4">
                            Question 2: She has...? ğŸ¤” <span class="tts-icon" onclick="speak('She has...?', 'Emma')">ğŸ”ˆ</span>
                        </p>
                        <div class="text-8xl text-center mb-4">ğŸ‘©â€ğŸ¦±</div>
                        <div class="flex flex-wrap justify-center gap-4" id="q2-buttons">
                            <button onclick="checkQuizAnswer(this, false, 'q2-buttons')" class="btn btn-purple text-2xl">Short Hair</button>
                            <button onclick="checkQuizAnswer(this, false, 'q2-buttons')" class="btn btn-purple text-2xl">Tall</button>
                            <button onclick="checkQuizAnswer(this, true, 'q2-buttons')" class="btn btn-blue text-2xl">Long Hair</button>
                        </div>
                        <p id="q2-feedback" class="text-center text-2xl font-bold mt-4"></p>
                    </div>
                    
                    <!-- Question 3 -->
                    <div class="card bg-gray-50 border border-gray-200">
                        <p class="text-3xl font-bold text-center text-gray-800 mb-4">
                            Question 3: What is this? ğŸ¤” <span class="tts-icon" onclick="speak('What is this?', 'Ava')">ğŸ”ˆ</span>
                        </p>
                        <p class="text-8xl text-center mb-4">ğŸ“</p>
                        <div class="flex flex-wrap justify-center gap-4" id="q3-buttons">
                            <button onclick="checkQuizAnswer(this, true, 'q3-buttons')" class="btn btn-blue text-2xl">Tall</button>
                            <button onclick="checkQuizAnswer(this, false, 'q3-buttons')" class="btn btn-purple text-2xl">Short</button>
                            <button onclick="checkQuizAnswer(this, false, 'q3-buttons')" class="btn btn-purple text-2xl">Brother</button>
                        </div>
                        <p id="q3-feedback" class="text-center text-2xl font-bold mt-4"></p>
                    </div>

                </div>
            </div> <!-- End Game Mode -->

        </main>
    </div> <!-- End Max-width container -->

    <!-- JavaScript -->
    <script>
        let isAudioReady = false;
        let score = 0;
        const scoreDisplay = document.getElementById('score');
        const praiseButton = document.getElementById('praise-button');
        const praiseModal = document.getElementById('praise-modal');
        const sparkleContainer = document.getElementById('sparkle-container');

        // Praise words
        const praiseWords = ["Wow! ğŸ¤©", "Super! ğŸŒŸ", "Amazing! âœ¨", "Great Job! ğŸ‰", "Hooray! ğŸ¥³", "Smart! ğŸ§ "];

        // Synths for sounds
        let praiseSynth, correctSynth, wrongSynth;

        // --- TTS (Text-to-Speech) Setup ---
        let voices = [];
        const voiceMap = {
            'Brian': { lang: 'en-GB', gender: 'male' },
            'Ava': { lang: 'en-US', gender: 'female' },
            'Emma': { lang: 'en-US', gender: 'female' },
            'Andrew': { lang: 'en-GB', gender: 'male' }
        };
        const voicePriority = ['Ava', 'Emma', 'Brian', 'Andrew'];


        function populateVoices() {
            voices = window.speechSynthesis.getVoices();
        }
        
        // This is necessary because voices load asynchronously
        window.speechSynthesis.onvoiceschanged = populateVoices;
        populateVoices(); // Initial call

        // Helper function to find a specific voice from the 4 allowed
        function searchForVoice(name) {
            if (voices.length === 0) populateVoices();
            
            // 1. Try exact name match
            let voice = voices.find(v => v.name === name);
            if (voice) return voice;

            // 2. Try partial name match (e.g., 'Ava' in 'Google US English Ava')
            voice = voices.find(v => v.name.includes(name));
            if (voice) return voice;

            // 3. Try properties from our map
            const properties = voiceMap[name];
            if (properties) {
                voice = voices.find(v => 
                    v.lang.startsWith(properties.lang) && 
                    (v.name.toLowerCase().includes(properties.gender) || v.name.includes(name))
                );
                if (voice) return voice;

                // 4. Fallback to just language from map (if properties failed)
                voice = voices.find(v => v.lang.startsWith(properties.lang));
                if (voice) return voice;
            }
            return null; // Not found
        }

        // Main function to find a voice, with fallbacks
        function findVoice(requestedName) {
            if (voices.length === 0) populateVoices();
            
            // Create a priority list, starting with the requested voice
            const priorityList = [requestedName, ...voicePriority.filter(v => v !== requestedName)];
            // Remove duplicates
            const uniquePriority = [...new Set(priorityList)]; 

            // Try to find each voice in order
            for (const name of uniquePriority) {
                if (voiceMap[name]) { // Only search for our 4 allowed voices
                    const found = searchForVoice(name);
                    if (found) return found; // Return the first one we find
                }
            }
            
            // If STILL nothing (e.g., browser has no 'en' voices at all), just return the first voice available
            return voices[0];
        }


        function speak(text, voiceName) {
            if (!window.speechSynthesis) {
                console.error("Speech synthesis not supported.");
                return;
            }

            const utterance = new SpeechSynthesisUtterance(text);
            
            // Find one of the 4 allowed voices, using voiceName as the first choice
            const voice = findVoice(voiceName); 
            
            if (voice) {
                utterance.voice = voice;
            }

            utterance.rate = 0.85; // Slowed down as requested
            utterance.pitch = 1.1; // A little higher pitch for a friendly tone

            window.speechSynthesis.cancel(); // Stop any previous speech
            window.speechSynthesis.speak(utterance);
        }
        // --- End of TTS Setup ---


        // 1. Initialize Audio (must be done on user click)
        async function initAudio() {
            if (isAudioReady) return;
            await Tone.start();
            
            // This is also a good time to ensure voices are loaded
            populateVoices();

            // Sound for praise button (happy arpeggio)
            praiseSynth = new Tone.PolySynth(Tone.Synth, {
                oscillator: { type: "sine" },
                envelope: { attack: 0.01, decay: 0.1, sustain: 0.2, release: 0.2 }
            }).toDestination();
            
            // Sound for correct answer (ping)
            correctSynth = new Tone.Synth({
                oscillator: { type: "triangle" },
                envelope: { attack: 0.01, decay: 0.1, sustain: 0.1, release: 0.1 }
            }).toDestination();
            
            // Sound for wrong answer (buzz)
            wrongSynth = new Tone.Synth({
                oscillator: { type: "square" },
                envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.1 }
            }).toDestination();
            
            isAudioReady = true;
            console.log("Audio Ready!");
        }

        // 2. Navigation
        function showMode(modeId) {
            // Hide all mode content
            document.querySelectorAll('.mode-content').forEach(div => {
                div.classList.add('hidden');
            });
            // Show the selected one
            const element = document.getElementById(modeId);
            if (element) {
                element.classList.remove('hidden');
            }
            // Stop any speaking when changing modes
            window.speechSynthesis.cancel();
        }

        // 3. Praise Button Logic
        praiseButton.addEventListener('click', async (e) => {
            await initAudio();
            
            // A. Play Sound
            const now = Tone.now();
            praiseSynth.triggerAttackRelease("C4", "8n", now);
            praiseSynth.triggerAttackRelease("E4", "8n", now + 0.1);
            praiseSynth.triggerAttackRelease("G4", "8n", now + 0.2);
            praiseSynth.triggerAttackRelease("C5", "8n", now + 0.3);

            // B. Add Score
            score += 5;
            scoreDisplay.textContent = score;

            // C. Show Praise Modal
            const randomWord = praiseWords[Math.floor(Math.random() * praiseWords.length)];
            showPraiseModal(randomWord);

            // D. Show Sparkles
            triggerSparkles(e.clientX, e.clientY);
        });

        // 4. Show Praise Modal
        function showPraiseModal(word) {
            praiseModal.textContent = word;
            praiseModal.classList.remove('hidden');
            
            // Hide after a short time
            setTimeout(() => {
                praiseModal.classList.add('hidden');
            }, 1500);
        }

        // 5. Trigger Sparkles
        function triggerSparkles(x, y) {
            for (let i = 0; i < 20; i++) {
                const sparkle = document.createElement('div');
                sparkle.classList.add('sparkle');
                
                // Position at click
                sparkle.style.left = `${x}px`;
                sparkle.style.top = `${y}px`;
                
                // Random size
                const size = Math.random() * 10 + 5;
                sparkle.style.width = `${size}px`;
                sparkle.style.height = `${size}px`;
                
                // Random trajectory
                const tx = (Math.random() - 0.5) * 300 + 'px';
                const ty = (Math.random() - 0.5) * 300 + 'px';
                sparkle.style.setProperty('--tx', tx);
                sparkle.style.setProperty('--ty', ty);

                sparkleContainer.appendChild(sparkle);
                
                // Remove from DOM after animation
                setTimeout(() => {
                    sparkle.remove();
                }, 1000);
            }
        }

        // 6. Quiz Game Logic
        async function checkQuizAnswer(button, isCorrect, buttonGroupId) {
            await initAudio();
            
            // This line caused the error. buttonGroupId must be a string.
            const questionNum = buttonGroupId.split('-')[0]; // e.g., "q1"
            const feedbackEl = document.getElementById(`${questionNum}-feedback`);
            
            if (isCorrect) {
                // A. Play Sound
                correctSynth.triggerAttackRelease("C5", "8n");
                
                // B. Add Score
                score += 10;
                scoreDisplay.textContent = score;
                
                // C. Show Feedback
                feedbackEl.textContent = "Correct! ğŸŒŸ +10 points!";
                feedbackEl.className = "text-center text-2xl font-bold mt-4 text-green-600";
                
                // D. Disable buttons for this question
                document.getElementById(buttonGroupId).querySelectorAll('button').forEach(btn => {
                    btn.disabled = true;
                    btn.classList.add('opacity-50', 'cursor-not-allowed');
                });
                
                // E. Highlight correct answer
                button.classList.remove('btn-blue', 'btn-purple');
                button.classList.add('bg-green-500', 'ring-4', 'ring-green-200');

            } else {
                // A. Play Sound
                wrongSynth.triggerAttackRelease("C3", "4n");
                
                // B. Show Feedback
                feedbackEl.textContent = "Try again! ğŸ˜¥";
                feedbackEl.className = "text-center text-2xl font-bold mt-4 text-red-600";
                
                // C. Highlight wrong answer
                button.classList.remove('btn-blue', 'btn-purple');
                button.classList.add('bg-red-500');
                
                // D. Hide feedback after a second
                setTimeout(() => {
                    if (feedbackEl.textContent === "Try again! ğŸ˜¥") {
                         feedbackEl.textContent = "";
                    }
                    button.classList.remove('bg-red-500');
                    button.classList.add('btn-purple'); // Reset color
                }, 1500);
            }
        }

        // --- Add Event Listeners for Reading Buttons ---
        const readingData = {
            'read-charlie': { text: "Charlie is my best friend. He's not tall and not short. He has two big black eyes. He has short brown hair. And he has a red T-shirt, blue shorts, blue shoes, yellow socks and a blue cap. He's very smart and lovely.", voice: 'Brian' },
            'read-batty': { text: "Batty is my best friend. She's not tall and not short. She has two big eyes. She has long red hair. And she has a pink dress, pink shoes and yellow socks. She's very pretty.", voice: 'Emma' },
            'read-grandpa': { text: "Mr. Bush is my grandpa. He is very old. He has two small eyes. He has short grey hair. He has a purple coat, white pants and purple shoes. He is very, very humorous.", voice: 'Brian' },
            'read-grandma': { text: "Mrs. Bush is my grandma. She is very old, too. She has two small eyes. She has short grey hair. She has a brown coat, a brown dress and brown shoes. She is very, very kind.", voice: 'Ava' },
            'read-father': { text: "Harry is my father. He's very tall. He has two big eyes. He has short black hair. And he has a white shirt, blue tie, black belt, grey pants and a pair of black shoes. He's very, very handsome.", voice: 'Andrew' },
            'read-sister': { text: "Jessica is my younger sister. She's not very tall. She has blond hair. She has two big eyes, a big nose, and a big mouth. And she has a red down coat, a white hat, blue jeans and a pair of black boots. She's very pretty.", voice: 'Emma' }
        };

        for (const [buttonId, data] of Object.entries(readingData)) {
            const button = document.getElementById(buttonId);
            if (button) {
                button.addEventListener('click', async () => {
                    await initAudio(); // Ensure audio is ready
                    speak(data.text, data.voice);
                });
            }
        }

        // Set default mode
        showMode('unit1');

    </script>

</body>
</html>
