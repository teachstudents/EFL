<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üèõÔ∏è Ethics & Decision Making - Two Teaching Methods</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Fredoka', cursive;
            font-weight: 500;
        }
        
        .instruction-text {
            font-weight: 700;
            line-height: 1.6;
        }
        
        .timer-circle {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 8px solid #e5e7eb;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
        }
        
        .timer-progress {
            position: absolute;
            top: -8px;
            left: -8px;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            border: 8px solid transparent;
            border-top-color: #10b981;
            transform: rotate(-90deg);
            transition: border-top-color 0.3s ease;
        }
        
        .step-card {
            transition: all 0.5s ease;
            transform: scale(0.95);
            opacity: 0.7;
        }
        
        .step-card.active {
            transform: scale(1);
            opacity: 1;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .step-card.completed {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }
        
        .visual-element {
            animation: fadeInUp 0.8s ease;
        }
        
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .discussion-bubble {
            position: relative;
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin: 10px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .discussion-bubble::before {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 30px;
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid white;
        }
        
        .choice-card {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .choice-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        .choice-card.selected {
            border: 4px solid #10b981;
            background: linear-gradient(135deg, #ecfdf5, #d1fae5);
        }
        
        .page-content {
            transition: all 0.5s ease;
            min-height: 70vh;
        }
        
        .page-content.hidden {
            display: none;
        }
        
        .page-fade-in {
            animation: pageSlideIn 0.5s ease;
        }
        
        @keyframes pageSlideIn {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-600 via-purple-600 to-teal-500 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- Header -->
        <div class="text-center mb-12">
            <h1 class="text-6xl font-bold text-white mb-4 instruction-text">üèõÔ∏è Ethics & Decision Making</h1>
            <p class="text-2xl text-white/95 instruction-text">Two Teaching Methods for Complex Scenarios</p>
        </div>

        <!-- Student Management -->
        <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-8 mb-8 shadow-2xl">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">üë• Class Management</h2>
            
            <!-- Class Selection -->
            <div class="flex justify-center space-x-4 mb-6">
                <button onclick="switchClass('grade10a')" id="classBtn10a" class="bg-blue-500 text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-600 transition-colors">
                    üìö Grade 10A (16 students)
                </button>
                <button onclick="switchClass('grade11')" id="classBtn11" class="bg-gray-300 text-gray-700 px-6 py-3 rounded-xl font-bold hover:bg-gray-400 transition-colors">
                    üìö Grade 11 (14 students)
                </button>
                <button onclick="switchClass('grade12')" id="classBtn12" class="bg-gray-300 text-gray-700 px-6 py-3 rounded-xl font-bold hover:bg-gray-400 transition-colors">
                    üìö Grade 12 (13 students)
                </button>
            </div>
            
            <div class="text-center mb-4">
                <h3 class="text-xl font-bold text-gray-700" id="currentClassName">Grade 10A - 16 Students</h3>
            </div>
            <div class="grid md:grid-cols-4 gap-4 mb-6">
                <div class="bg-blue-50 rounded-xl p-4">
                    <h3 class="font-bold text-blue-800 mb-2">üü¶ Group 1</h3>
                    <ul class="text-sm space-y-1" id="group1">
                        <li>‚Ä¢ Dino</li>
                        <li>‚Ä¢ Von Tony</li>
                        <li>‚Ä¢ Leo</li>
                        <li>‚Ä¢ Jenny</li>
                    </ul>
                </div>
                <div class="bg-green-50 rounded-xl p-4">
                    <h3 class="font-bold text-green-800 mb-2">üü© Group 2</h3>
                    <ul class="text-sm space-y-1" id="group2">
                        <li>‚Ä¢ Tracy</li>
                        <li>‚Ä¢ Jim</li>
                        <li>‚Ä¢ Apollo</li>
                        <li>‚Ä¢ Steven</li>
                    </ul>
                </div>
                <div class="bg-purple-50 rounded-xl p-4">
                    <h3 class="font-bold text-purple-800 mb-2">üü™ Group 3</h3>
                    <ul class="text-sm space-y-1" id="group3">
                        <li>‚Ä¢ Billie</li>
                        <li>‚Ä¢ Andrew</li>
                        <li>‚Ä¢ Lion</li>
                        <li>‚Ä¢ Alex</li>
                    </ul>
                </div>
                <div class="bg-orange-50 rounded-xl p-4">
                    <h3 class="font-bold text-orange-800 mb-2">üüß Group 4</h3>
                    <ul class="text-sm space-y-1" id="group4">
                        <li>‚Ä¢ Jessie</li>
                        <li>‚Ä¢ Mark</li>
                        <li>‚Ä¢ Tony</li>
                        <li>‚Ä¢ Mike</li>
                    </ul>
                </div>
            </div>
            <div class="text-center space-y-4">
                <div class="flex justify-center space-x-4">
                    <button onclick="shuffleGroups()" class="bg-blue-500 text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-600 transition-colors">
                        üîÑ Shuffle Groups
                    </button>
                    <button onclick="randomizeGroups()" class="bg-purple-500 text-white px-6 py-3 rounded-xl font-bold hover:bg-purple-600 transition-colors">
                        üé≤ Random Groups
                    </button>
                </div>
                
                <!-- Group Size Selector -->
                <div class="bg-gray-50 rounded-xl p-4 inline-block">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">Group Size:</label>
                    <select id="groupSizeSelector" onchange="updateGroupSize()" class="px-4 py-2 border-2 border-gray-300 rounded-lg font-semibold">
                        <option value="2">2 students per group</option>
                        <option value="3">3 students per group</option>
                        <option value="4" selected>4 students per group</option>
                        <option value="5">5 students per group</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-1" id="groupInfo">4 groups of 4 students</p>
                </div>
            </div>
        </div>

        <!-- Page Navigation Header -->
        <div id="pageNavigation" class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-6 mb-8 shadow-2xl hidden">
            <div class="flex justify-between items-center">
                <!-- Left: Navigation Buttons -->
                <div class="flex items-center space-x-4">
                    <button id="prevPageBtn" onclick="previousPage()" class="bg-gray-500 text-white px-6 py-3 rounded-xl font-bold hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                        ‚Üê Previous
                    </button>
                    <button id="nextPageBtn" onclick="nextPage()" class="bg-blue-500 text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-600 transition-colors">
                        Next ‚Üí
                    </button>
                </div>
                
                <!-- Center: Timer (for visual method) -->
                <div id="timerSection" class="flex items-center space-x-4 hidden">
                    <div class="timer-circle bg-white shadow-lg">
                        <div class="timer-progress" id="timerProgress"></div>
                        <span id="timerDisplay">5:00</span>
                    </div>
                    <button id="startTimer" onclick="startTimer()" class="bg-green-500 text-white px-6 py-3 rounded-xl font-bold hover:bg-green-600 transition-colors">
                        ‚è±Ô∏è Start Timer
                    </button>
                </div>
                
                <!-- Right: Progress Info -->
                <div class="text-right">
                    <div class="text-3xl font-bold text-blue-600" id="pageCounter">1/3</div>
                    <p class="text-gray-600" id="pageTitle">Setup</p>
                </div>
            </div>
        </div>

        <!-- Page Container -->
        <div id="pageContainer" class="min-h-[70vh]">
            
            <!-- Page 1: Method Selection -->
            <div id="page1" class="page-content">
                <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-8 shadow-2xl h-full">
                    <h2 class="text-4xl font-bold text-gray-800 mb-8 text-center">Choose Your Teaching Method</h2>
                    <div class="grid md:grid-cols-2 gap-8 h-full">
                        <div class="choice-card bg-gradient-to-br from-green-100 to-emerald-100 rounded-2xl p-8 border-4 border-transparent flex flex-col justify-center" onclick="selectMethod('visual')">
                            <div class="text-center">
                                <div class="text-8xl mb-6">üìä</div>
                                <h3 class="text-3xl font-bold text-gray-800 mb-4">Method 1: Visual Step-by-Step</h3>
                                <p class="text-gray-600 mb-6 text-lg">Guided visual analysis with timers and interactive graphics</p>
                                <ul class="text-left text-gray-700 space-y-2">
                                    <li>‚úÖ Timed thinking sessions</li>
                                    <li>‚úÖ Visual decision trees</li>
                                    <li>‚úÖ Interactive stakeholder analysis</li>
                                    <li>‚úÖ Structured comparison charts</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div class="choice-card bg-gradient-to-br from-blue-100 to-indigo-100 rounded-2xl p-8 border-4 border-transparent flex flex-col justify-center" onclick="selectMethod('discussion')">
                            <div class="text-center">
                                <div class="text-8xl mb-6">üí¨</div>
                                <h3 class="text-3xl font-bold text-gray-800 mb-4">Method 2: Interactive Discussion</h3>
                                <p class="text-gray-600 mb-6 text-lg">Socratic dialogue with role-playing and debate</p>
                                <ul class="text-left text-gray-700 space-y-2">
                                    <li>‚úÖ Role-playing exercises</li>
                                    <li>‚úÖ Guided questioning</li>
                                    <li>‚úÖ Perspective-taking activities</li>
                                    <li>‚úÖ Collaborative decision-making</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page 2: Scenario Selection -->
            <div id="page2" class="page-content hidden">
                <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-8 shadow-2xl h-full">
                    <h2 class="text-4xl font-bold text-gray-800 mb-8 text-center">Choose Your Ethical Scenario</h2>
                    <div class="grid md:grid-cols-2 gap-8 h-full">
                        <div class="choice-card bg-gradient-to-br from-orange-100 to-red-100 rounded-2xl p-8 border-4 border-transparent flex flex-col justify-center" onclick="selectScenario('cityplanning')">
                            <div class="text-center">
                                <div class="text-8xl mb-6">üèôÔ∏è</div>
                                <h3 class="text-3xl font-bold text-gray-800 mb-4">City Planning Dilemma</h3>
                                <p class="text-gray-600 text-lg">High-tech rooftop farm vs. community gardens - balancing efficiency with equity</p>
                            </div>
                        </div>
                        
                        <div class="choice-card bg-gradient-to-br from-purple-100 to-pink-100 rounded-2xl p-8 border-4 border-transparent flex flex-col justify-center" onclick="selectScenario('cooperation')">
                            <div class="text-center">
                                <div class="text-8xl mb-6">ü§ù</div>
                                <h3 class="text-3xl font-bold text-gray-800 mb-4">Cooperation Challenge</h3>
                                <p class="text-gray-600 text-lg">Shared rooftop garden - trust and cooperation in community projects</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page 3+: Dynamic Content Pages -->
            <div id="dynamicPages" class="hidden">
                <!-- Content will be dynamically loaded here -->
            </div>

        </div>
    </div>

    <script>
        // Application State
        let currentMethod = '';
        let currentScenario = '';
        let currentPage = 1;
        let totalPages = 2; // Start with method and scenario selection
        let currentStep = 0;
        let totalSteps = 0;
        let timer = null;
        let timeRemaining = 300; // 5 minutes default
        let isTimerRunning = false;
        let methodPages = [];

        // Student Data
        const studentLists = {
            grade10a: ['Dino', 'Tracy', 'Billie', 'Jessie', 'Von Tony', 'Jim', 'Andrew', 'Mark', 'Leo', 'Apollo', 'Lion', 'Tony', 'Alex', 'Jenny', 'Steven', 'Mike'],
            grade11: ['Henry', 'Harris', 'Helen', 'Peter', 'Richard', 'Harry', 'Dio', 'Olivia', 'Roselia', 'Zara', 'Jill', 'Ashley', 'Derek', 'Penny'],
            grade12: ['Anna', 'Mia', 'Kenn', 'Max', 'Sky', 'Sheng', 'Keying', 'Cen', 'XieSieFei', 'Jiaqi', 'Zach', 'Azure', 'Joe']
        };
        
        let currentClass = 'grade10a';
        let currentStudents = studentLists.grade10a;
        let currentGroups = [
            ['Dino', 'Von Tony', 'Leo', 'Jenny'],
            ['Tracy', 'Jim', 'Apollo', 'Steven'],
            ['Billie', 'Andrew', 'Lion', 'Alex'],
            ['Jessie', 'Mark', 'Tony', 'Mike']
        ];

        // Scenario Data
        const scenarios = {
            cityplanning: {
                title: "City Planning Budget Decision",
                description: "As head of city planning, choose between a high-tech rooftop farm or community gardens",
                stakeholders: ["Wealthy residents", "Low-income communities", "Environmental groups", "City budget office"],
                options: [
                    {
                        name: "High-Tech Rooftop Farm",
                        pros: ["Reduces carbon footprint significantly", "Feeds thousands", "Advanced technology", "Efficient use of space"],
                        cons: ["Benefits mainly wealthy area", "High initial cost", "Limited community access", "No social benefits"]
                    },
                    {
                        name: "Five Community Gardens",
                        pros: ["Serves underserved communities", "Creates social hubs", "Provides green space", "Community ownership"],
                        cons: ["Less food production", "Higher maintenance", "Multiple locations to manage", "Lower environmental impact"]
                    }
                ]
            },
            cooperation: {
                title: "Rooftop Garden Cooperation",
                description: "Decide whether to trust your neighbor building in a shared garden project",
                stakeholders: ["Your building residents", "Neighbor building residents", "Garden maintenance crew", "Local community"],
                options: [
                    {
                        name: "Cooperate and Trust",
                        pros: ["Successful garden if both cooperate", "Builds community relationships", "Shared costs and work", "Sets positive precedent"],
                        cons: ["Risk of being exploited", "Do all work if partner doesn't cooperate", "Vulnerable to free-riding", "Potential conflict"]
                    },
                    {
                        name: "Refuse to Cooperate",
                        pros: ["Protect from exploitation", "No risk of doing all work", "Maintain resources", "Avoid potential conflict"],
                        cons: ["Garden project fails", "Miss opportunity for community building", "No benefits for anyone", "Perpetuates distrust"]
                    }
                ]
            }
        };

        // Page Navigation Functions
        function nextPage() {
            if (currentPage < totalPages) {
                currentPage++;
                showPage(currentPage);
            }
        }

        function previousPage() {
            if (currentPage > 1) {
                currentPage--;
                showPage(currentPage);
            }
        }

        function showPage(pageNum) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            
            // Show current page
            if (pageNum <= 2) {
                document.getElementById(`page${pageNum}`).classList.remove('hidden');
                document.getElementById(`page${pageNum}`).classList.add('page-fade-in');
            } else {
                // Show dynamic method pages
                const methodPageIndex = pageNum - 3;
                if (methodPages[methodPageIndex]) {
                    document.getElementById('dynamicPages').innerHTML = methodPages[methodPageIndex];
                    document.getElementById('dynamicPages').classList.remove('hidden');
                    document.getElementById('dynamicPages').classList.add('page-fade-in');
                }
            }
            
            updatePageNavigation();
        }

        function updatePageNavigation() {
            document.getElementById('pageNavigation').classList.remove('hidden');
            document.getElementById('pageCounter').textContent = `${currentPage}/${totalPages}`;
            
            // Update page title
            let pageTitle = '';
            if (currentPage === 1) pageTitle = 'Method Selection';
            else if (currentPage === 2) pageTitle = 'Scenario Selection';
            else if (currentMethod === 'visual') {
                const stepTitles = ["Understand Scenario", "Identify Stakeholders", "Analyze Options", "Consider Consequences", "Apply Ethics", "Make Decision"];
                pageTitle = stepTitles[currentPage - 3] || 'Analysis';
            } else {
                const phaseNames = ["Role Assignment", "Individual Reflection", "Small Group Discussion", "Large Group Debate", "Consensus Building"];
                pageTitle = phaseNames[currentPage - 3] || 'Discussion';
            }
            document.getElementById('pageTitle').textContent = pageTitle;
            
            // Update button states
            document.getElementById('prevPageBtn').disabled = currentPage === 1;
            document.getElementById('nextPageBtn').textContent = currentPage === totalPages ? 'Complete' : 'Next ‚Üí';
            
            // Show/hide timer for visual method
            if (currentMethod === 'visual' && currentPage > 2) {
                document.getElementById('timerSection').classList.remove('hidden');
                // Update timer for current step
                const stepTimes = [300, 240, 360, 300, 420, 180];
                const stepIndex = currentPage - 3;
                if (stepIndex >= 0 && stepIndex < stepTimes.length) {
                    timeRemaining = stepTimes[stepIndex];
                    updateTimerDisplay();
                }
            } else {
                document.getElementById('timerSection').classList.add('hidden');
            }
        }

        // Method Selection
        function selectMethod(method) {
            currentMethod = method;
            document.querySelectorAll('#page1 .choice-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.choice-card').classList.add('selected');
            
            setTimeout(() => {
                nextPage();
            }, 500);
        }

        // Scenario Selection
        function selectScenario(scenario) {
            currentScenario = scenario;
            document.querySelectorAll('#page2 .choice-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.choice-card').classList.add('selected');
            
            setTimeout(() => {
                if (currentMethod === 'visual') {
                    loadVisualMethod();
                } else {
                    loadDiscussionMethod();
                }
            }, 500);
        }

        // Load Visual Method
        function loadVisualMethod() {
            totalPages = 8; // 2 setup pages + 6 visual steps
            methodPages = [];
            
            // Generate all visual method pages
            for (let i = 0; i < 6; i++) {
                methodPages.push(getVisualStepPage(i));
            }
            
            nextPage();
        }

        // Load Discussion Method
        function loadDiscussionMethod() {
            totalPages = 7; // 2 setup pages + 5 discussion phases
            methodPages = [];
            
            // Generate all discussion method pages
            for (let i = 0; i < 5; i++) {
                methodPages.push(getDiscussionPhasePage(i));
            }
            
            nextPage();
        }

        // Visual Method Page Generation
        function getVisualStepPage(step) {
            const scenario = scenarios[currentScenario];
            
            switch(step) {
                case 0:
                    return getScenarioUnderstandingStep(scenario);
                case 1:
                    return getStakeholderAnalysisStep(scenario);
                case 2:
                    return getOptionsAnalysisStep(scenario);
                case 3:
                    return getConsequencesStep(scenario);
                case 4:
                    return getEthicalFrameworksStep(scenario);
                case 5:
                    return getDecisionStep(scenario);
                default:
                    return '<div>Step not found</div>';
            }
        }

        // Discussion Method Page Generation
        function getDiscussionPhasePage(phase) {
            const scenario = scenarios[currentScenario];
            
            switch(phase) {
                case 0:
                    return getRoleAssignmentPhase(scenario);
                case 1:
                    return getIndividualReflectionPhase(scenario);
                case 2:
                    return getSmallGroupPhase(scenario);
                case 3:
                    return getLargeGroupDebatePhase(scenario);
                case 4:
                    return getConsensusPhase(scenario);
                default:
                    return '<div>Phase not found</div>';
            }
        }

        // Visual Step Content Functions
        function getScenarioUnderstandingStep(scenario) {
            return `
                <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-8 shadow-2xl h-full">
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4">üìñ</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Understand the Scenario</h2>
                        <p class="text-xl text-gray-600">Take time to fully comprehend the situation</p>
                    </div>
                    
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 mb-6">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">${scenario.title}</h3>
                        <p class="text-lg text-gray-700 leading-relaxed">${scenario.description}</p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="bg-yellow-50 rounded-2xl p-6">
                            <h4 class="text-xl font-bold text-gray-800 mb-3">üéØ Key Questions to Consider</h4>
                            <ul class="space-y-2 text-gray-700">
                                <li>‚Ä¢ What is the main decision to be made?</li>
                                <li>‚Ä¢ Who will be affected by this decision?</li>
                                <li>‚Ä¢ What are the potential outcomes?</li>
                                <li>‚Ä¢ What values are in conflict?</li>
                            </ul>
                        </div>
                        
                        <div class="bg-green-50 rounded-2xl p-6">
                            <h4 class="text-xl font-bold text-gray-800 mb-3">üí≠ Your Initial Thoughts</h4>
                            <textarea class="w-full h-32 p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none" placeholder="Write your first impressions and questions about this scenario..."></textarea>
                        </div>
                    </div>
                </div>
            `;
        }

        function getStakeholderAnalysisStep(scenario) {
            return `
                <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-8 shadow-2xl h-full">
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4">üë•</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Identify Stakeholders</h2>
                        <p class="text-xl text-gray-600">Map out everyone who will be affected</p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="visual-element">
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">üé≠ Key Stakeholders</h3>
                            <div class="space-y-4">
                                ${scenario.stakeholders.map((stakeholder, index) => `
                                    <div class="stakeholder-card bg-gradient-to-r from-purple-100 to-pink-100 rounded-xl p-4 cursor-pointer hover:shadow-lg transition-all" onclick="analyzeStakeholder('${stakeholder}', ${index})">
                                        <div class="flex items-center space-x-3">
                                            <div class="w-12 h-12 bg-purple-500 rounded-full flex items-center justify-center text-white font-bold">${index + 1}</div>
                                            <div>
                                                <h4 class="font-bold text-gray-800">${stakeholder}</h4>
                                                <p class="text-sm text-gray-600">Click to analyze their interests</p>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <div class="visual-element">
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">üìä Stakeholder Analysis</h3>
                            <div id="stakeholderAnalysis" class="bg-gray-50 rounded-xl p-6 min-h-64">
                                <p class="text-gray-500 text-center">Click on a stakeholder to analyze their interests and concerns</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getOptionsAnalysisStep(scenario) {
            return `
                <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-8 shadow-2xl h-full">
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4">‚öñÔ∏è</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Analyze Options</h2>
                        <p class="text-xl text-gray-600">Compare the pros and cons of each choice</p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-8">
                        ${scenario.options.map((option, index) => `
                            <div class="visual-element bg-gradient-to-br from-${index === 0 ? 'green' : 'blue'}-50 to-${index === 0 ? 'emerald' : 'indigo'}-50 rounded-2xl p-6">
                                <h3 class="text-2xl font-bold text-gray-800 mb-4">${option.name}</h3>
                                
                                <div class="space-y-4">
                                    <div class="bg-white rounded-xl p-4">
                                        <h4 class="font-bold text-green-600 mb-2">‚úÖ Advantages</h4>
                                        <ul class="space-y-1">
                                            ${option.pros.map(pro => `<li class="text-sm text-gray-700">‚Ä¢ ${pro}</li>`).join('')}
                                        </ul>
                                    </div>
                                    
                                    <div class="bg-white rounded-xl p-4">
                                        <h4 class="font-bold text-red-600 mb-2">‚ùå Disadvantages</h4>
                                        <ul class="space-y-1">
                                            ${option.cons.map(con => `<li class="text-sm text-gray-700">‚Ä¢ ${con}</li>`).join('')}
                                        </ul>
                                    </div>
                                    
                                    <div class="bg-white rounded-xl p-4">
                                        <h4 class="font-bold text-gray-800 mb-2">üìù Your Rating (1-10)</h4>
                                        <input type="range" min="1" max="10" value="5" class="w-full" onchange="updateRating(${index}, this.value)">
                                        <div class="text-center mt-2">
                                            <span id="rating${index}" class="text-2xl font-bold text-blue-600">5</span>/10
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function getConsequencesStep(scenario) {
            return `
                <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-8 shadow-2xl h-full">
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4">üéØ</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Consider Consequences</h2>
                        <p class="text-xl text-gray-600">Think about short-term and long-term impacts</p>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="grid md:grid-cols-2 gap-6">
                            <div class="bg-orange-50 rounded-2xl p-6">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">‚ö° Short-term Consequences (1-2 years)</h3>
                                <textarea class="w-full h-32 p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none" placeholder="What will happen immediately after this decision?"></textarea>
                            </div>
                            
                            <div class="bg-purple-50 rounded-2xl p-6">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">üîÆ Long-term Consequences (5+ years)</h3>
                                <textarea class="w-full h-32 p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none" placeholder="What are the lasting effects of this choice?"></textarea>
                            </div>
                        </div>
                        
                        <div class="bg-red-50 rounded-2xl p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">‚ö†Ô∏è Unintended Consequences</h3>
                            <p class="text-gray-600 mb-4">What negative effects might occur that you didn't plan for?</p>
                            <textarea class="w-full h-24 p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none" placeholder="Consider potential negative side effects..."></textarea>
                        </div>
                    </div>
                </div>
            `;
        }

        function getEthicalFrameworksStep(scenario) {
            return `
                <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-8 shadow-2xl h-full">
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4">üí≠</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Apply Ethical Frameworks</h2>
                        <p class="text-xl text-gray-600">Use different ethical lenses to evaluate your options</p>
                    </div>
                    
                    <div class="grid md:grid-cols-3 gap-6">
                        <div class="bg-blue-50 rounded-2xl p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-3">‚öñÔ∏è Utilitarian</h3>
                            <p class="text-sm text-gray-600 mb-4">"Greatest good for the greatest number"</p>
                            <div class="space-y-2">
                                <p class="text-sm font-semibold">Which option helps more people?</p>
                                <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="Your analysis..."></textarea>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 rounded-2xl p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-3">üëë Rights-Based</h3>
                            <p class="text-sm text-gray-600 mb-4">"Respect individual rights and dignity"</p>
                            <div class="space-y-2">
                                <p class="text-sm font-semibold">Which option better respects people's rights?</p>
                                <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="Your analysis..."></textarea>
                            </div>
                        </div>
                        
                        <div class="bg-purple-50 rounded-2xl p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-3">‚öñÔ∏è Justice-Based</h3>
                            <p class="text-sm text-gray-600 mb-4">"Fair distribution and equal treatment"</p>
                            <div class="space-y-2">
                                <p class="text-sm font-semibold">Which option is more fair and just?</p>
                                <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="Your analysis..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-yellow-50 rounded-2xl p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-3">ü§î Synthesis</h3>
                        <p class="text-sm text-gray-600 mb-4">Considering all three frameworks, what insights emerge?</p>
                        <textarea class="w-full h-24 p-4 border-2 border-gray-300 rounded-xl" placeholder="Synthesize your ethical analysis..."></textarea>
                    </div>
                </div>
            `;
        }

        function getDecisionStep(scenario) {
            return `
                <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-8 shadow-2xl h-full">
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4">‚úÖ</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Make Your Decision</h2>
                        <p class="text-xl text-gray-600">Choose your path and justify your reasoning</p>
                    </div>
                    
                    <div class="space-y-6">
                        <div class="grid md:grid-cols-2 gap-6">
                            ${scenario.options.map((option, index) => `
                                <div class="choice-card bg-gradient-to-br from-${index === 0 ? 'green' : 'blue'}-100 to-${index === 0 ? 'emerald' : 'indigo'}-100 rounded-2xl p-6 border-4 border-transparent" onclick="selectFinalChoice(${index})">
                                    <h3 class="text-xl font-bold text-gray-800 mb-3">${option.name}</h3>
                                    <p class="text-gray-600">Click to select this option</p>
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="bg-gray-50 rounded-2xl p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">üìù Justify Your Decision</h3>
                            <textarea id="finalJustification" class="w-full h-32 p-4 border-2 border-gray-300 rounded-xl focus:border-blue-500 focus:outline-none" placeholder="Explain why you chose this option. What factors were most important to you?"></textarea>
                        </div>
                        
                        <div class="text-center">
                            <button onclick="completeVisualAnalysis()" class="bg-gradient-to-r from-green-500 to-blue-600 text-white text-xl font-bold px-8 py-4 rounded-2xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all">
                                üéâ Complete Analysis
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Discussion Phase Content Functions (updated for page format)

        // Discussion Phase Content Functions
        function getRoleAssignmentPhase(scenario) {
            const roleAssignments = assignRolesToGroups(currentScenario);
            
            return `
                <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-8 shadow-2xl h-full">
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4">üé≠</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Role Assignment & Context Setting</h2>
                        <p class="text-xl text-gray-600">Each group represents a different stakeholder</p>
                    </div>
                    
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-2xl p-6 mb-8">
                        <h3 class="text-2xl font-bold text-gray-800 mb-4">${scenario.title}</h3>
                        <p class="text-lg text-gray-700">${scenario.description}</p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">üë• Group Role Assignments</h3>
                            <div class="space-y-4">
                                ${Object.entries(roleAssignments).map(([groupName, assignment]) => `
                                    <div class="bg-${assignment.color}-50 rounded-xl p-4 border-2 border-${assignment.color}-200">
                                        <div class="flex items-center space-x-3 mb-3">
                                            <div class="w-10 h-10 bg-${assignment.color}-500 rounded-full flex items-center justify-center text-white font-bold">${groupName.split(' ')[1]}</div>
                                            <div>
                                                <h4 class="font-bold text-gray-800">${groupName}</h4>
                                                <p class="text-sm text-${assignment.color}-700 font-semibold">${assignment.role}</p>
                                            </div>
                                        </div>
                                        <div class="text-sm text-gray-600">
                                            <strong>Students:</strong> ${assignment.students.join(', ')}
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <div class="mt-6 text-center">
                                <button onclick="shuffleGroups(); loadDiscussionPhase(0);" class="bg-blue-500 text-white px-6 py-2 rounded-xl font-bold hover:bg-blue-600 transition-colors">
                                    üîÑ Reassign Groups & Roles
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">üìã Instructions for Teachers</h3>
                            <div class="bg-yellow-50 rounded-2xl p-6">
                                <ul class="space-y-3 text-gray-700">
                                    <li><strong>1. Groups assigned:</strong> Each group of 4 students represents one stakeholder</li>
                                    <li><strong>2. Research time:</strong> Give groups 5-10 minutes to discuss their role's perspective</li>
                                    <li><strong>3. Set ground rules:</strong> Respectful dialogue, listen actively, stay in character</li>
                                    <li><strong>4. Group coordination:</strong> Each group should choose a spokesperson</li>
                                </ul>
                            </div>
                            
                            <div class="mt-6 bg-green-50 rounded-2xl p-6">
                                <h4 class="font-bold text-gray-800 mb-2">üí° Group Role-Playing Tips</h4>
                                <ul class="space-y-1 text-sm text-gray-700">
                                    <li>‚Ä¢ Discuss your stakeholder's main concerns as a group</li>
                                    <li>‚Ä¢ Brainstorm what success looks like for your role</li>
                                    <li>‚Ä¢ Prepare 2-3 key arguments together</li>
                                    <li>‚Ä¢ Choose who will speak for your group</li>
                                    <li>‚Ä¢ Think about potential compromises you could accept</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getIndividualReflectionPhase(scenario) {
            return `
                <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-8 shadow-2xl h-full">
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4">ü§î</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Individual Reflection</h2>
                        <p class="text-xl text-gray-600">Students develop their character's perspective</p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="space-y-6">
                            <div class="bg-blue-50 rounded-2xl p-6">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">üé≠ Character Development</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block font-semibold text-gray-700 mb-2">Your Role:</label>
                                        <input type="text" class="w-full p-3 border-2 border-gray-300 rounded-xl" placeholder="Which stakeholder are you representing?">
                                    </div>
                                    <div>
                                        <label class="block font-semibold text-gray-700 mb-2">Main Concerns:</label>
                                        <textarea class="w-full h-24 p-3 border-2 border-gray-300 rounded-xl" placeholder="What does your character care most about?"></textarea>
                                    </div>
                                    <div>
                                        <label class="block font-semibold text-gray-700 mb-2">Preferred Outcome:</label>
                                        <textarea class="w-full h-24 p-3 border-2 border-gray-300 rounded-xl" placeholder="What would be the ideal solution for your character?"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="space-y-6">
                            <div class="bg-green-50 rounded-2xl p-6">
                                <h3 class="text-xl font-bold text-gray-800 mb-4">üí≠ Argument Preparation</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block font-semibold text-gray-700 mb-2">Key Argument 1:</label>
                                        <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="Your strongest point..."></textarea>
                                    </div>
                                    <div>
                                        <label class="block font-semibold text-gray-700 mb-2">Key Argument 2:</label>
                                        <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="Your second strongest point..."></textarea>
                                    </div>
                                    <div>
                                        <label class="block font-semibold text-gray-700 mb-2">Potential Compromise:</label>
                                        <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="What middle ground might work?"></textarea>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="bg-purple-50 rounded-2xl p-6">
                                <h3 class="text-xl font-bold text-gray-800 mb-3">‚è∞ Reflection Time: 10 minutes</h3>
                                <p class="text-gray-600">Use this time to really think deeply about your character's perspective and motivations.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function getSmallGroupPhase(scenario) {
            return `
                <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-8 shadow-2xl">
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4">üí¨</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Small Group Discussion</h2>
                        <p class="text-xl text-gray-600">Groups of 3-4 students explore different perspectives</p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">üéØ Discussion Structure</h3>
                            <div class="space-y-4">
                                <div class="discussion-bubble bg-blue-50">
                                    <h4 class="font-bold text-gray-800">Round 1: Introductions (5 min)</h4>
                                    <p class="text-sm text-gray-600">Each person introduces their character and main concerns</p>
                                </div>
                                <div class="discussion-bubble bg-green-50">
                                    <h4 class="font-bold text-gray-800">Round 2: Present Arguments (10 min)</h4>
                                    <p class="text-sm text-gray-600">Share your key arguments and reasoning</p>
                                </div>
                                <div class="discussion-bubble bg-purple-50">
                                    <h4 class="font-bold text-gray-800">Round 3: Find Common Ground (10 min)</h4>
                                    <p class="text-sm text-gray-600">Identify shared values and potential compromises</p>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">üìù Group Notes</h3>
                            <div class="space-y-4">
                                <div>
                                    <label class="block font-semibold text-gray-700 mb-2">Key Points Raised:</label>
                                    <textarea class="w-full h-24 p-3 border-2 border-gray-300 rounded-xl" placeholder="What important arguments were made?"></textarea>
                                </div>
                                <div>
                                    <label class="block font-semibold text-gray-700 mb-2">Areas of Agreement:</label>
                                    <textarea class="w-full h-24 p-3 border-2 border-gray-300 rounded-xl" placeholder="What did everyone agree on?"></textarea>
                                </div>
                                <div>
                                    <label class="block font-semibold text-gray-700 mb-2">Major Disagreements:</label>
                                    <textarea class="w-full h-24 p-3 border-2 border-gray-300 rounded-xl" placeholder="Where were the biggest conflicts?"></textarea>
                                </div>
                                <div>
                                    <label class="block font-semibold text-gray-700 mb-2">Proposed Solutions:</label>
                                    <textarea class="w-full h-24 p-3 border-2 border-gray-300 rounded-xl" placeholder="What compromises or solutions emerged?"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 bg-yellow-50 rounded-2xl p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">üë®‚Äçüè´ Teacher Facilitation Tips</h3>
                        <ul class="space-y-2 text-gray-700">
                            <li>‚Ä¢ Circulate between groups to ensure everyone participates</li>
                            <li>‚Ä¢ Ask probing questions: "Why is that important to your character?"</li>
                            <li>‚Ä¢ Encourage students to challenge ideas respectfully</li>
                            <li>‚Ä¢ Help groups that get stuck by suggesting new angles</li>
                            <li>‚Ä¢ Take notes on interesting points for the large group discussion</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function getLargeGroupDebatePhase(scenario) {
            return `
                <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-8 shadow-2xl">
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4">üó£Ô∏è</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Large Group Debate</h2>
                        <p class="text-xl text-gray-600">Whole class discussion and debate</p>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">üé™ Debate Format</h3>
                            <div class="space-y-4">
                                <div class="discussion-bubble bg-red-50">
                                    <h4 class="font-bold text-gray-800">Opening Statements (15 min)</h4>
                                    <p class="text-sm text-gray-600">Each group presents their position and key arguments</p>
                                </div>
                                <div class="discussion-bubble bg-orange-50">
                                    <h4 class="font-bold text-gray-800">Cross-Examination (15 min)</h4>
                                    <p class="text-sm text-gray-600">Groups question each other's positions</p>
                                </div>
                                <div class="discussion-bubble bg-yellow-50">
                                    <h4 class="font-bold text-gray-800">Rebuttal Round (10 min)</h4>
                                    <p class="text-sm text-gray-600">Respond to challenges and strengthen arguments</p>
                                </div>
                                <div class="discussion-bubble bg-green-50">
                                    <h4 class="font-bold text-gray-800">Closing Arguments (10 min)</h4>
                                    <p class="text-sm text-gray-600">Final appeals and summary of position</p>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-4">üìä Debate Tracker</h3>
                            <div class="space-y-4">
                                <div class="bg-blue-50 rounded-xl p-4">
                                    <h4 class="font-bold text-gray-800 mb-2">Strongest Arguments Heard:</h4>
                                    <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="Which arguments were most convincing?"></textarea>
                                </div>
                                <div class="bg-purple-50 rounded-xl p-4">
                                    <h4 class="font-bold text-gray-800 mb-2">Weakest Points:</h4>
                                    <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="Which arguments had flaws or gaps?"></textarea>
                                </div>
                                <div class="bg-green-50 rounded-xl p-4">
                                    <h4 class="font-bold text-gray-800 mb-2">Surprising Insights:</h4>
                                    <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="What new perspectives emerged?"></textarea>
                                </div>
                                <div class="bg-pink-50 rounded-xl p-4">
                                    <h4 class="font-bold text-gray-800 mb-2">Questions Raised:</h4>
                                    <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="What questions still need answers?"></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-8 bg-indigo-50 rounded-2xl p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-3">üéØ Socratic Questions for Teachers</h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            <ul class="space-y-2 text-gray-700">
                                <li>‚Ä¢ "What assumptions are you making?"</li>
                                <li>‚Ä¢ "How do you know that's true?"</li>
                                <li>‚Ä¢ "What evidence supports that claim?"</li>
                                <li>‚Ä¢ "What would someone who disagrees say?"</li>
                            </ul>
                            <ul class="space-y-2 text-gray-700">
                                <li>‚Ä¢ "What are the implications of that choice?"</li>
                                <li>‚Ä¢ "How does this connect to other issues?"</li>
                                <li>‚Ä¢ "What values are in conflict here?"</li>
                                <li>‚Ä¢ "Is there a middle ground possible?"</li>
                            </ul>
                        </div>
                    </div>
                </div>
            `;
        }

        function getConsensusPhase(scenario) {
            return `
                <div class="bg-white/95 backdrop-filter backdrop-blur-lg rounded-3xl p-8 shadow-2xl">
                    <div class="text-center mb-8">
                        <div class="text-6xl mb-4">ü§ù</div>
                        <h2 class="text-3xl font-bold text-gray-800 mb-4">Consensus Building</h2>
                        <p class="text-xl text-gray-600">Work together to find common ground</p>
                    </div>
                    
                    <div class="space-y-8">
                        <div class="grid md:grid-cols-2 gap-8">
                            <div>
                                <h3 class="text-2xl font-bold text-gray-800 mb-4">üéØ Consensus Process</h3>
                                <div class="space-y-4">
                                    <div class="discussion-bubble bg-blue-50">
                                        <h4 class="font-bold text-gray-800">Step 1: Identify Shared Values</h4>
                                        <p class="text-sm text-gray-600">What does everyone care about?</p>
                                    </div>
                                    <div class="discussion-bubble bg-green-50">
                                        <h4 class="font-bold text-gray-800">Step 2: Brainstorm Creative Solutions</h4>
                                        <p class="text-sm text-gray-600">Think outside the original options</p>
                                    </div>
                                    <div class="discussion-bubble bg-purple-50">
                                        <h4 class="font-bold text-gray-800">Step 3: Evaluate Compromises</h4>
                                        <p class="text-sm text-gray-600">What can each side live with?</p>
                                    </div>
                                    <div class="discussion-bubble bg-yellow-50">
                                        <h4 class="font-bold text-gray-800">Step 4: Test the Solution</h4>
                                        <p class="text-sm text-gray-600">Does it address core concerns?</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h3 class="text-2xl font-bold text-gray-800 mb-4">üìù Consensus Worksheet</h3>
                                <div class="space-y-4">
                                    <div>
                                        <label class="block font-semibold text-gray-700 mb-2">Shared Values:</label>
                                        <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="What does everyone agree is important?"></textarea>
                                    </div>
                                    <div>
                                        <label class="block font-semibold text-gray-700 mb-2">Creative Alternatives:</label>
                                        <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="New solutions beyond the original options..."></textarea>
                                    </div>
                                    <div>
                                        <label class="block font-semibold text-gray-700 mb-2">Proposed Compromise:</label>
                                        <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="What solution can most people accept?"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-green-50 to-blue-50 rounded-2xl p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">üéâ Final Class Decision</h3>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block font-semibold text-gray-700 mb-2">Our Chosen Solution:</label>
                                    <textarea class="w-full h-24 p-3 border-2 border-gray-300 rounded-xl" placeholder="What did the class ultimately decide?"></textarea>
                                </div>
                                <div>
                                    <label class="block font-semibold text-gray-700 mb-2">Why This Works:</label>
                                    <textarea class="w-full h-24 p-3 border-2 border-gray-300 rounded-xl" placeholder="How does this address everyone's main concerns?"></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-yellow-50 rounded-2xl p-6">
                            <h3 class="text-xl font-bold text-gray-800 mb-4">ü§î Reflection Questions</h3>
                            <div class="grid md:grid-cols-2 gap-6">
                                <div>
                                    <p class="font-semibold text-gray-700 mb-2">What did you learn about ethical decision-making?</p>
                                    <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="Your insights..."></textarea>
                                </div>
                                <div>
                                    <p class="font-semibold text-gray-700 mb-2">How did hearing other perspectives change your thinking?</p>
                                    <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="Your reflection..."></textarea>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center">
                            <button onclick="completeDiscussion()" class="bg-gradient-to-r from-green-500 to-blue-600 text-white text-xl font-bold px-8 py-4 rounded-2xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all">
                                üéâ Complete Discussion
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Timer Functions
        function startTimer() {
            if (isTimerRunning) {
                pauseTimer();
                return;
            }
            
            isTimerRunning = true;
            document.getElementById('startTimer').textContent = '‚è∏Ô∏è Pause Timer';
            
            timer = setInterval(() => {
                timeRemaining--;
                updateTimerDisplay();
                updateTimerProgress();
                
                if (timeRemaining <= 0) {
                    clearInterval(timer);
                    isTimerRunning = false;
                    document.getElementById('startTimer').textContent = '‚è±Ô∏è Start Timer';
                    alert('‚è∞ Time\'s up! Move to the next step when ready.');
                }
            }, 1000);
        }

        function pauseTimer() {
            clearInterval(timer);
            isTimerRunning = false;
            document.getElementById('startTimer').textContent = '‚ñ∂Ô∏è Resume Timer';
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeRemaining / 60);
            const seconds = timeRemaining % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function updateTimerProgress() {
            const totalTime = currentMethod === 'visual' ? [300, 240, 360, 300, 420, 180][currentStep] : 300;
            const progress = ((totalTime - timeRemaining) / totalTime) * 360;
            const progressElement = document.getElementById('timerProgress');
            if (progressElement) {
                progressElement.style.transform = `rotate(${progress - 90}deg)`;
                
                // Change color as time runs out
                if (timeRemaining < 60) {
                    progressElement.style.borderTopColor = '#ef4444'; // red
                } else if (timeRemaining < 120) {
                    progressElement.style.borderTopColor = '#f59e0b'; // yellow
                } else {
                    progressElement.style.borderTopColor = '#10b981'; // green
                }
            }
        }

        // Navigation Functions
        function nextStep() {
            if (currentMethod === 'visual') {
                if (currentStep < totalSteps - 1) {
                    currentStep++;
                    loadVisualStep(currentStep);
                } else {
                    completeVisualAnalysis();
                }
            } else {
                if (currentStep < totalSteps - 1) {
                    currentStep++;
                    loadDiscussionPhase(currentStep);
                } else {
                    completeDiscussion();
                }
            }
        }

        function previousStep() {
            if (currentStep > 0) {
                currentStep--;
                if (currentMethod === 'visual') {
                    loadVisualStep(currentStep);
                } else {
                    loadDiscussionPhase(currentStep);
                }
            }
        }

        // Utility Functions
        function analyzeStakeholder(stakeholder, index) {
            const analysisDiv = document.getElementById('stakeholderAnalysis');
            const scenario = scenarios[currentScenario];
            
            let interests = '';
            switch(stakeholder) {
                case 'Wealthy residents':
                    interests = 'Property values, convenience, environmental benefits, prestige';
                    break;
                case 'Low-income communities':
                    interests = 'Access to fresh food, community spaces, economic opportunities, fair treatment';
                    break;
                case 'Environmental groups':
                    interests = 'Carbon reduction, sustainable practices, green spaces, long-term environmental impact';
                    break;
                case 'City budget office':
                    interests = 'Cost-effectiveness, measurable outcomes, public accountability, efficient resource use';
                    break;
                case 'Your building residents':
                    interests = 'Shared costs, community benefits, avoiding exploitation, successful project outcomes';
                    break;
                case 'Neighbor building residents':
                    interests = 'Garden benefits, fair cost-sharing, community cooperation, avoiding conflicts';
                    break;
                default:
                    interests = 'Various community and personal interests';
            }
            
            analysisDiv.innerHTML = `
                <div class="bg-white rounded-xl p-4">
                    <h4 class="text-xl font-bold text-purple-600 mb-3">${stakeholder}</h4>
                    <div class="space-y-3">
                        <div>
                            <h5 class="font-semibold text-gray-800">Key Interests:</h5>
                            <p class="text-gray-600">${interests}</p>
                        </div>
                        <div>
                            <h5 class="font-semibold text-gray-800">Likely Position:</h5>
                            <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="What would this stakeholder probably want?"></textarea>
                        </div>
                        <div>
                            <h5 class="font-semibold text-gray-800">Potential Concerns:</h5>
                            <textarea class="w-full h-20 p-3 border-2 border-gray-300 rounded-xl text-sm" placeholder="What might they be worried about?"></textarea>
                        </div>
                    </div>
                </div>
            `;
        }

        function updateRating(optionIndex, value) {
            document.getElementById(`rating${optionIndex}`).textContent = value;
        }

        function selectFinalChoice(optionIndex) {
            document.querySelectorAll('#visualSteps .choice-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.choice-card').classList.add('selected');
        }

        function completeVisualAnalysis() {
            const justification = document.getElementById('finalJustification').value;
            if (justification.trim()) {
                alert('üéâ Excellent work! You\'ve completed a thorough ethical analysis using the visual step-by-step method. Your systematic approach to this complex decision demonstrates strong critical thinking skills.');
            } else {
                alert('Please provide a justification for your decision before completing the analysis.');
            }
        }

        function completeDiscussion() {
            alert('üéâ Outstanding discussion! You\'ve experienced collaborative ethical decision-making through role-playing and consensus building. This method helps develop empathy and understanding of multiple perspectives.');
        }

        // Class Management Functions
        function switchClass(classId) {
            currentClass = classId;
            currentStudents = [...studentLists[classId]]; // Create a copy to avoid reference issues
            
            // Update button styles
            const buttons = ['classBtn10a', 'classBtn11', 'classBtn12'];
            const classes = ['grade10a', 'grade11', 'grade12'];
            
            buttons.forEach((btnId, index) => {
                const isActive = classId === classes[index];
                document.getElementById(btnId).className = isActive
                    ? 'bg-blue-500 text-white px-6 py-3 rounded-xl font-bold hover:bg-blue-600 transition-colors'
                    : 'bg-gray-300 text-gray-700 px-6 py-3 rounded-xl font-bold hover:bg-gray-400 transition-colors';
            });
            
            // Update class name display
            let className;
            switch(classId) {
                case 'grade10a': className = 'Grade 10A'; break;
                case 'grade11': className = 'Grade 11'; break;
                case 'grade12': className = 'Grade 12'; break;
            }
            document.getElementById('currentClassName').textContent = `${className} - ${currentStudents.length} Students`;
            
            // Create initial groups with the new student list
            createInitialGroups();
            updateGroupSize();
        }

        function createInitialGroups() {
            const groupSize = parseInt(document.getElementById('groupSizeSelector').value);
            currentGroups = [];
            
            // Use the current students list to create groups
            for (let i = 0; i < currentStudents.length; i += groupSize) {
                currentGroups.push(currentStudents.slice(i, i + groupSize));
            }
            
            updateGroupDisplay();
        }

        // Group Management Functions
        function shuffleGroups() {
            // Shuffle the current students array (make sure we're using the right student list)
            const shuffledStudents = [...currentStudents].sort(() => Math.random() - 0.5);
            const groupSize = parseInt(document.getElementById('groupSizeSelector').value);
            
            // Create new groups with selected size
            currentGroups = [];
            for (let i = 0; i < shuffledStudents.length; i += groupSize) {
                currentGroups.push(shuffledStudents.slice(i, i + groupSize));
            }
            
            // Update the display
            updateGroupDisplay();
            showGroupAnimation();
        }

        function randomizeGroups() {
            // Completely random assignment - students can end up in any group
            const groupSize = parseInt(document.getElementById('groupSizeSelector').value);
            const numGroups = Math.ceil(currentStudents.length / groupSize);
            
            // Create empty groups
            currentGroups = Array.from({ length: numGroups }, () => []);
            
            // Randomly assign each student to a group
            currentStudents.forEach(student => {
                let attempts = 0;
                let groupIndex;
                
                // Keep trying until we find a group that isn't full (max 50 attempts to avoid infinite loop)
                do {
                    groupIndex = Math.floor(Math.random() * numGroups);
                    attempts++;
                } while (currentGroups[groupIndex].length >= groupSize && attempts < 50);
                
                // If all groups are full or we've tried too many times, put in the first available group
                if (currentGroups[groupIndex].length >= groupSize) {
                    groupIndex = currentGroups.findIndex(group => group.length < groupSize);
                    if (groupIndex === -1) groupIndex = 0; // Fallback
                }
                
                currentGroups[groupIndex].push(student);
            });
            
            // Remove any empty groups
            currentGroups = currentGroups.filter(group => group.length > 0);
            
            updateGroupDisplay();
            showGroupAnimation();
        }

        function updateGroupSize() {
            const groupSize = parseInt(document.getElementById('groupSizeSelector').value);
            const totalStudents = currentStudents.length;
            const numGroups = Math.ceil(totalStudents / groupSize);
            const lastGroupSize = totalStudents % groupSize || groupSize;
            
            let infoText = `${numGroups} groups`;
            if (lastGroupSize !== groupSize && numGroups > 1) {
                infoText += ` (${numGroups - 1} groups of ${groupSize}, 1 group of ${lastGroupSize})`;
            } else {
                infoText += ` of ${groupSize} students`;
            }
            
            document.getElementById('groupInfo').textContent = infoText;
            
            // Recreate groups with new size using current students
            // Get all students from current groups first to maintain any existing order
            let allStudents = [];
            currentGroups.forEach(group => {
                allStudents = allStudents.concat(group);
            });
            
            // If no current groups exist, use the original student list
            if (allStudents.length === 0) {
                allStudents = [...currentStudents];
            }
            
            // Create new groups with the selected size
            currentGroups = [];
            for (let i = 0; i < allStudents.length; i += groupSize) {
                currentGroups.push(allStudents.slice(i, i + groupSize));
            }
            
            updateGroupDisplay();
        }

        function showGroupAnimation() {
            document.querySelectorAll('[id^="group"]').forEach(group => {
                group.style.transform = 'scale(0.9)';
                group.style.opacity = '0.5';
                setTimeout(() => {
                    group.style.transform = 'scale(1)';
                    group.style.opacity = '1';
                }, 200);
            });
        }

        function updateGroupDisplay() {
            const groupColors = ['blue', 'green', 'purple', 'orange', 'red', 'indigo', 'pink', 'yellow'];
            const groupContainer = document.querySelector('.grid.md\\:grid-cols-4');
            
            // Clear existing groups
            groupContainer.innerHTML = '';
            
            // Create new group displays
            currentGroups.forEach((group, index) => {
                const colorIndex = index % groupColors.length;
                const color = groupColors[colorIndex];
                
                const groupDiv = document.createElement('div');
                groupDiv.className = `bg-${color}-50 rounded-xl p-4`;
                groupDiv.innerHTML = `
                    <h3 class="font-bold text-${color}-800 mb-2">üü¶ Group ${index + 1}</h3>
                    <ul class="text-sm space-y-1" id="group${index + 1}">
                        ${group.map(student => `<li>‚Ä¢ ${student}</li>`).join('')}
                    </ul>
                `;
                
                groupContainer.appendChild(groupDiv);
            });
            
            // Update grid layout based on number of groups
            const numGroups = currentGroups.length;
            if (numGroups <= 2) {
                groupContainer.className = 'grid md:grid-cols-2 gap-4 mb-6';
            } else if (numGroups <= 4) {
                groupContainer.className = 'grid md:grid-cols-4 gap-4 mb-6';
            } else if (numGroups <= 6) {
                groupContainer.className = 'grid md:grid-cols-3 gap-4 mb-6';
            } else {
                groupContainer.className = 'grid md:grid-cols-4 gap-4 mb-6';
            }
        }

        function assignRolesToGroups(scenario) {
            const stakeholders = scenarios[scenario].stakeholders;
            const roleAssignments = {};
            
            currentGroups.forEach((group, groupIndex) => {
                if (groupIndex < stakeholders.length) {
                    roleAssignments[`Group ${groupIndex + 1}`] = {
                        students: group,
                        role: stakeholders[groupIndex],
                        color: ['blue', 'green', 'purple', 'orange'][groupIndex]
                    };
                }
            });
            
            return roleAssignments;
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set up initial state
            console.log('Ethics & Decision Making Tool Loaded');
            createInitialGroups();
            updateGroupSize();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'97c306d1d7be26b0',t:'MTc1NzM4MjU0MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
